hui=window.hui||{},function(e,t,i){e.browser={};e=e.browser;e.msie=!/opera/i.test(t)&&/MSIE/.test(t)||/Trident/.test(t),e.msie6=-1!==t.indexOf("MSIE 6"),e.msie7=-1!==t.indexOf("MSIE 7"),e.msie8=-1!==t.indexOf("MSIE 8"),e.msie9=-1!==t.indexOf("MSIE 9"),e.msie9compat=e.msie7&&-1!==t.indexOf("Trident/5.0"),e.msie10=-1!==t.indexOf("MSIE 10"),e.msie11=-1!==t.indexOf("Trident/7.0"),e.webkit=-1!==t.indexOf("WebKit"),e.safari=-1!==t.indexOf("Safari"),e.webkitVersion=null,e.gecko=!e.webkit&&!e.msie&&-1!==t.indexOf("Gecko"),e.ipad=e.webkit&&-1!==t.indexOf("iPad"),e.windows=-1!==t.indexOf("Windows"),e.opacity=!e.msie6&&!e.msie7&&!e.msie8,e.mediaQueries=e.opacity,e.animation=!(e.msie6||e.msie7||e.msie8||e.msie9),e.wordbreak=!e.msie6&&!e.msie7&&!e.msie8,e.touch=!!("ontouchstart"in i||"onmsgesturechange"in i&&i.navigator.maxTouchPoints);t=/Safari\/([\d.]+)/.exec(t);t&&(e.webkitVersion=parseFloat(t[1]))}(hui,navigator.userAgent,window),hui.log=function(e){if(window.console&&console.log)try{console.log.apply(null,arguments)}catch(e){}},hui._postponed=[],hui.define=function(e,t){for(var i=hui._postponed,n=i.length-1;0<=n;n--){var s=i[n];if(s){for(var h=[],u=0;u<s.requirements.length;u++){var o=s.requirements[u],o=hui.evaluate(o);if(!o)break;h.push(o)}s.requirements.length==h.length&&(hui.array.remove(i,s),s.callback.apply(null,h))}}},hui._runOrPostpone=function(){for(var e=[],t=null,i=0;i<arguments.length;i++)"function"==typeof arguments[i]?t=arguments[i]:hui.isArray(arguments[i])&&(e=arguments[i]);var n=[];for(i=0;i<e.length;i++){var s=hui.evaluate(e[i]);if(!s){n=!1;break}n[i]=s}n?t.apply(null,n):(hui.log("Postponing: "+e),hui._postponed.push({requirements:e,callback:t}))},hui.evaluate=function(e,t){for(var i=e.split("."),n=t||window,s=0;s<i.length&&void 0!==n;s++)n=n[i[s]];return n},hui.defer=function(e,t){t&&(e=e.bind(t)),window.setTimeout(e)},hui.extend=function(e,t){var i,n=e.prototype;for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function s(){this.constructor=e}if(s.prototype=t.prototype,e.prototype=new s,n)for(var h in n)e.prototype[h]=n[h]},hui.override=function(e,t){if(t)for(var i in t)e[i]=t[i];return e},hui.each=function(e,t){var i;if(hui.isArray(e))for(i=0;i<e.length;i++)t(e[i],i);else if(e instanceof NodeList)for(i=0;i<e.length;i++)t(e.item(i),i);else if(hui.isDefined(e))for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},hui.when=function(e,t){return e?t:""},hui.intOrString=function(e){if(hui.isDefined(e)){var t=/[0-9]+/.exec(e);if(null!==t&&t[0]==e&&parseInt(e,10)==e)return parseInt(e,10)}return e},hui.between=function(e,t,i){t=Math.min(i,Math.max(e,t));return isNaN(t)?e:t},hui.fit=function(e,t,i){var n,s=e.width/e.height,h=t.width/t.height,t=!1===(i=i||{}).upscale&&e.width<=t.width&&e.height<=t.height?(n=e.width,e.height):h<s?(n=t.width,Math.round(t.width/e.width*e.height)):(n=Math.round(t.height/e.height*e.width),t.height);return{width:n,height:t}},hui.isBlank=function(e){return null==e||""===e||"string"==typeof e&&0===hui.string.trim(e).length},hui.isDefined=function(e){return null!=e},hui.isString=function(e){return"string"==typeof e},hui.isNumber=function(e){return"number"==typeof e},hui.isArray=function(e){return null!=e&&(e.constructor==Array||"[object Array]"===Object.prototype.toString.call(e))},hui.string={startsWith:function(e,t){return!(!hui.isString(e)||!hui.isString(t))&&e.match("^"+t)==t},endsWith:function(e,t){return!(!hui.isString(e)||!hui.isString(t))&&e.match(t+"$")==t},camelize:function(e){if(-1==e.indexOf("-"))return e;for(var t=e.split("-"),i=0===e.indexOf("-")?t[0].charAt(0).toUpperCase()+t[0].substring(1):t[0],n=1,s=t.length;n<s;n++){var h=t[n];i+=h.charAt(0).toUpperCase()+h.substring(1)}return i},trim:function(e){return hui.isDefined(e)?(e=!hui.isString(e)?String(e):e).replace(/^[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+|[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+$/g,""):""},wrap:function(e){return null==e?"":e.split("").join("â€‹")},shorten:function(e,t){if(hui.isNumber(e))e+="";else if(!hui.isString(e))return"";return e.length>t?e.substring(0,t-3)+"...":e},escapeHTML:function(e){return hui.isDefined(e)?hui.build("div",{text:e}).innerHTML:""},escape:function(e){if(!hui.isString(e))return e;var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};return e.replace(/[&<>'`"]/g,function(e){return t[e]||e})},fromJSON:function(e){try{return JSON.parse(e)}catch(e){return hui.log(e),null}},toJSON:function(e){return JSON.stringify(e)}},hui.array={add:function(e,t){if(t.constructor==Array)for(var i=0;i<t.length;i++)hui.array.contains(e,t[i])||e.push(t);else hui.array.contains(e,t)||e.push(t)},contains:function(e,t){return-1!==hui.array.indexOf(e,t)},flip:function(e,t){hui.array.contains(e,t)?hui.array.remove(e,t):e.push(t)},remove:function(e,t){for(var i=e.length-1;0<=i;i--)e[i]==t&&e.splice(i,1)},indexOf:function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1},toIntegers:function(e){for(var t=e.split(","),i=t.length-1;0<=i;i--)t[i]=parseInt(t[i],10);return t}},hui.dom={isElement:function(e,t){return 1==e.nodeType&&(void 0===t||e.nodeName.toLowerCase()==t)},isDefinedText:function(e){return 3==e.nodeType&&0<e.nodeValue.length},addText:function(e,t){e.appendChild(document.createTextNode(t))},firstChild:function(e){for(var t=e.childNodes,i=0;i<t.length;i++)if(1==t[i].nodeType)return t[i];return null},parse:function(e){e=hui.build("div",{html:e});return hui.get.firstChild(e)},clear:function(e){for(var t=e.childNodes,i=t.length-1;0<=i;i--)t[i].parentNode.removeChild(t[i])},remove:function(e){e.parentNode&&e.parentNode.removeChild(e)},replaceNode:function(e,t){t.parentNode&&t.parentNode.removeChild(t),e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e)},changeTag:function(e,t){for(var i=hui.build(t);e.firstChild;)i.appendChild(e.firstChild);for(var n=e.attributes.length-1;0<=n;--n)i.attributes.setNamedItem(e.attributes[n].cloneNode());return e.parentNode.insertBefore(i,e),e.parentNode.removeChild(e),i},insertBefore:function(e,t){e.parentNode.insertBefore(t,e)},insertAfter:function(e,t){var i=e.nextSibling;i?i.parentNode.insertBefore(t,i):e.parentNode.appendChild(t)},replaceHTML:function(e,t){(e=hui.get(e)).innerHTML=t},runScripts:function(node){if(hui.dom.isElement(node))if(hui.dom.isElement(node,"script"))eval(node.innerHTML);else for(var scripts=node.getElementsByTagName("script"),i=0;i<scripts.length;i++)eval(scripts[i].innerHTML)},setText:function(e,t){null==t&&(t="");for(var i=e.childNodes,n=!1,s=i.length-1;0<=s;s--)n||3!==i[s].nodeType?e.removeChild(i[s]):(i[s].nodeValue=t,n=!0);n||hui.dom.addText(e,t)},getText:function(e){for(var t="",i=e.childNodes,n=0;n<i.length;n++)3===i[n].nodeType&&null!==i[n].nodeValue?t+=i[n].nodeValue:1==i[n].nodeType&&(t+=hui.dom.getText(i[n]));return t},isVisible:function(e){for(;e;){if(e.style&&("none"===hui.style.get(e,"display")||"hidden"===hui.style.get(e,"visibility")))return!1;e=e.parentNode}return!0},isDescendantOrSelf:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}},hui.form={getValues:function(e){for(var t={},i=e.getElementsByTagName("input"),n=0;n<i.length;n++)hui.isDefined(i[n].name)&&(t[i[n].name]=i[n].value);return t}},hui.get=function(e){return"string"==typeof e?document.getElementById(e):e},hui.get.children=function(e){for(var t=[],i=e.childNodes,n=0;n<i.length;n++)hui.dom.isElement(i[n])&&t.push(i[n]);return t},hui.get.next=function(e){if(!e)return null;if(e.nextElementSibling)return e.nextElementSibling;if(!e.nextSibling)return null;for(var t=e.nextSibling;t&&1!=t.nodeType;)t=t.nextSibling;return t&&1==t.nodeType?t:null},hui.get.previous=function(e){if(!e)return null;if(e.previousElementSibling)return e.previousElementSibling;if(!e.previousSibling)return null;for(var t=e.previousSibling;t&&1!=t.nodeType;)t=t.previousSibling;return t&&1==t.nodeType?t:null},hui.get.before=function(e){var t=[];if(e)for(var i=e.parentNode.childNodes,n=0;n<i.length&&i[n]!=e;n++)1===i[n].nodeType&&t.push(i[n]);return t},hui.get.after=function(e){for(var t=[],i=hui.get.next(e);i;)t.push(i),i=hui.get.next(i);return t},hui.get.firstByClass=function(e,t,i){if((e=hui.get(e)||document.body).querySelector)return e.querySelector((i?i+".":".")+t);for(var n=e.getElementsByTagName(i||"*"),s=0;s<n.length;s++)if(hui.cls.has(n[s],t))return n[s];return null},hui.get.byClass=function(e,t,i){if((e=hui.get(e)||document.body).querySelectorAll){var n=e.querySelectorAll((i?i+".":".")+t),s=[],h=0;for(ll=n.length;h!=ll;s.push(n[h++]));return s}var u=e.getElementsByTagName(i||"*"),o=[];for(h=0;h<u.length;h++)hui.cls.has(u[h],t)&&(o[o.length]=u[h]);return o},hui.get.byId=function(e,t){for(var i=e.childNodes,n=i.length-1;0<=n;n--){if(1===i[n].nodeType&&i[n].getAttribute("id")===t)return i[n];var s=hui.get.byId(i[n],t);if(s)return s}return null},hui.get.firstByTag=function(e,t){return(e=hui.get(e)||document.body).querySelector&&"*"!==t?e.querySelector(t):e.getElementsByTagName(t)[0]},hui.get.firstChild=hui.dom.firstChild,hui.find=function(e,t){return(t||document).querySelector(e)},hui.findAll=function(e,t){e=(t||document).querySelectorAll(e);return Array.prototype.slice.call(e)},hui.closest=function(e,t){for(var i=t;i&&1===i.nodeType;){if(hui.matches(i,e))return i;i=i.parentNode}},hui.matches=function(e,t){var i=document.documentElement;return(i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector).call(e,t)},document.querySelector||(hui.find=function(e,t){return t=t||document.documentElement,"."==e[0]?hui.get.firstByClass(t,e.substr(1)):hui.get.firstByTag(t,e)}),hui.collect=function(e,t){var i,n={};for(i in e)n[i]=hui.find(e[i],t);return n},hui.build=function(e,t,i){i=i||document;var n="";if(-1!==e.indexOf(".")){var s=e.split(".");e=s[0];for(var h=1;h<s.length;h++)1<h&&(n+=" "),n+=s[h]}var u=i.createElement(e);if(n&&(u.className=n),t)for(var o in t)if("text"==o)u.appendChild(i.createTextNode(t.text));else if("html"==o)u.innerHTML=t.html;else if("parent"==o&&hui.isDefined(t.parent))t.parent.appendChild(u);else if("parentFirst"==o)0===t.parentFirst.childNodes.length?t.parentFirst.appendChild(u):t.parentFirst.insertBefore(u,t.parentFirst.childNodes[0]);else if("children"==o)for(h=0;h<t.children.length;h++)u.appendChild(t.children[h]);else"before"==o?t.before.parentNode.insertBefore(u,t.before):"className"==o?hui.cls.add(u,t.className):"class"==o?hui.cls.add(u,t.class):"style"==o&&"object"==typeof t[o]?hui.style.set(u,t[o]):"style"==o&&(hui.browser.msie7||hui.browser.msie6)?u.style.setAttribute("cssText",t[o]):hui.isDefined(t[o])&&u.setAttribute(o,t[o]);return u},hui.position={getTop:function(e){if(e=hui.get(e)){for(var t=e.offsetTop,i=e.offsetParent;null!==i;)t+=i.offsetTop,i=i.offsetParent;return t}return 0},getLeft:function(e){if(e=hui.get(e)){for(var t=e.offsetLeft,i=e.offsetParent;null!==i;)t+=i.offsetLeft,i=i.offsetParent;return t}return 0},get:function(e){return{left:hui.position.getLeft(e),top:hui.position.getTop(e)}},getScrollOffset:function(e){e=hui.get(e);for(var t=0,i=0;t+=e.scrollTop||0,i+=e.scrollLeft||0,e=e.parentNode;);return{top:t,left:i}},place:function(e){var t=0,i=0,n=hui.get(e.source.element),s=hui.get(e.target.element),h=hui.position.getLeft(s),u=hui.position.getTop(s),t=h+s.clientWidth*(e.target.horizontal||0);i=u+s.clientHeight*(e.target.vertical||0),t-=n.clientWidth*(e.source.horizontal||0),i-=n.clientHeight*(e.source.vertical||0),e.top&&(i+=e.top),e.left&&(t+=e.left),e.insideViewPort&&(s=hui.window.getViewWidth(),(t=t+n.clientWidth>s?s-n.clientWidth-(e.viewPortMargin||0):t)<0&&(t=0),i<0&&(i=0),hui.window.getViewHeight(),s=hui.window.getScrollTop()+hui.window.getViewHeight()-n.clientHeight,e=hui.window.getScrollTop(),i=Math.max(Math.min(i,s),e)),n.style.top=Math.round(i)+"px",n.style.left=Math.round(t)+"px"},getRemainingHeight:function(e){for(var t=e.parentNode.clientHeight,i=e.parentNode.childNodes,n=0;n<i.length;n++){var s=i[n];s!==e&&hui.dom.isElement(i[n])&&"absolute"!=hui.style.get(s,"position")&&(t-=s.offsetHeight)}return t}},hui.window={getScrollTop:function(){return window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body?document.body.scrollTop:0)},getScrollLeft:function(){return window.pageYOffset?window.pageXOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollLeft:document.body?document.body.scrollLeft:0},scrollTo:function(i){var n,s,h,e=(i=hui.override({duration:0,top:0},i)).element,t=hui.position.get(e),u=hui.window.getScrollTop(),o=hui.window.getViewHeight();(u<t.top+e.clientHeight||t.top<u+o)&&(n=t.top-Math.round((o-e.clientHeight)/2),n-=i.top/2,n=Math.max(0,n),s=(new Date).getTime(),(h=function(){var e=((new Date).getTime()-s)/i.duration;(1<e||isNaN(e))&&(e=1);var t=u+Math.round((n-u)*hui.ease.fastSlow(e));window.scrollTo(0,t),e<1&&window.setTimeout(h)})())},getViewHeight:function(){return window.innerHeight||(document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body?document.body.clientHeight:void 0)},getViewWidth:function(){return document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body?document.body.clientWidth:window.innerWidth}},hui.cls={has:function(e,t){if(!(e=hui.get(e))||!e.className)return!1;if(e.hasClassName)return e.hasClassName(t);if(e.className==t)return!0;if(void 0!==e.className.animVal)return!1;for(var i=e.className.split(/\s+/),n=0;n<i.length;n++)if(i[n]==t)return!0;return!1},add:function(e,t){(e=hui.get(e))&&(e.classList&&-1===t.indexOf(" ")?e.classList.add(t):e.addClassName?e.addClassName(t):(hui.cls.remove(e,t),e.className+=" "+t))},remove:function(e,t){if((e=hui.get(e))&&e.className)if(e.removeClassName&&e.removeClassName(t),e.className!=t){for(var i="",n=e.className.split(/\s+/),s=0;s<n.length;s++)n[s]!=t&&(0<s&&(i+=" "),i+=n[s]);e.className=i}else e.className=""},toggle:function(e,t){hui.cls.has(e,t)?hui.cls.remove(e,t):hui.cls.add(e,t)},set:function(e,t,i){i?hui.cls.add(e,t):hui.cls.remove(e,t)}},hui.on=function(e,t,i,n){return 1==arguments.length&&"function"==typeof e?hui.onReady(e):2==arguments.length&&"function"==typeof t&&hui.isArray(e)?hui._runOrPostpone.apply(hui,arguments):void("tap"==t?(n&&(i=i.bind(n)),h=s=!1,hui.listen(e,"touchstart",function(){s=!(h=!0)},n),hui.listen(e,"touchmove",function(){s=!0},n),hui.listen(e,"touchend",function(e){h=!1,s||(h=!0,hui._callListener(i,e))},n),hui.listen(e,"click",function(e){s||h||hui._callListener(i,e)},n)):hui.listen(e,t,i,n));var s,h},hui._callListener=function(e,t){if("function"==typeof e)e(t);else for(var i in e)if(e.hasOwnProperty(i)){var n=hui.closest(i,t.target);if(n)return void e[i](n,t)}},hui.listen=function(e,t,i,n){var s;(e=hui.get(e))&&("function"!=typeof(s=i)?s=function(e){hui._callListener(i,e)}:n&&(s=i.bind(n)),document.addEventListener?e.addEventListener(t,s):e.attachEvent("on"+t,s))},hui.listenOnce=function(t,i,n){var s=function(e){hui.unListen(t,i,s),n(e)};hui.listen(t,i,s)},hui.unListen=function(e,t,i,n){e=hui.get(e),document.removeEventListener?e.removeEventListener(t,i,!!n):e.detachEvent("on"+t,i)},hui.event=function(e){return void 0!==e&&!0===e.huiEvent?e:new hui.Event(e)},hui.Event=function(e){this.huiEvent=!0,this.event=e=e||window.event,e||hui.log("No event"),this.element=e.target||e.srcElement,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.metaKey=e.metaKey,this.returnKey=13==e.keyCode,this.escapeKey=27==e.keyCode,this.spaceKey=32==e.keyCode,this.backspaceKey=8==e.keyCode,this.upKey=38==e.keyCode,this.downKey=40==e.keyCode,this.leftKey=37==e.keyCode,this.rightKey=39==e.keyCode,this.keyCode=e.keyCode},hui.Event.prototype={getLeft:function(){var e=0;return this.event&&(this.event.pageX?e=this.event.pageX:this.event.clientX&&(e=this.event.clientX+hui.window.getScrollLeft())),e},getTop:function(){var e=0;return this.event&&(this.event.pageY?e=this.event.pageY:this.event.clientY&&(e=this.event.clientY+hui.window.getScrollTop())),e},getElement:function(){return this.element},findByClass:function(e){return hui.closest("."+e,this.element)},findByTag:function(e){return hui.closest(e,this.element)},find:function(e){return this.closest(e)},closest:function(e){if(hui.isString(e))return hui.closest(e,this.element);for(var t=this.element;t;){if(e(t))return t;t=t.parentNode}return null},isDescendantOf:function(e){for(var t=this.element;t;){if(t===e)return!0;t=t.parentNode}return!1},stop:function(){hui.stop(this.event)},prevent:function(){this.event.preventDefault&&this.event.preventDefault()}},hui.stop=function(e){(e=e||window.event).stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.stopped=!0},hui._=hui._||[],hui._ready="complete"==document.readyState,hui.onReady=function(){hui._ready?hui._runOrPostpone.apply(hui,arguments):hui._.push(arguments)},hui.onDraw=function(e){window.setTimeout(e,13)},hui.onDraw=function(e,t){for(var i=t.requestAnimationFrame,n=0;n<e.length&&!i;++n)i=t[e[n]+"RequestAnimationFrame"];return i?i.bind(t):hui.onDraw}(["ms","moz","webkit","o"],window),hui._onReady=function(e){"interactive"==document.readyState?window.setTimeout(e):window.addEventListener?window.addEventListener("DOMContentLoaded",e,!1):window.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),e())})},hui.request=function(t){t=hui.override({method:"POST",async:!0,headers:{Accept:"application/json"}},t);var e=new XMLHttpRequest;if(t.credentials&&(e.withCredentials=!0),e){e.onreadystatechange=function(){4==e.readyState&&(200==e.status&&t.$success?t.$success(e):403==e.status&&t.$forbidden?t.$forbidden(e):0!==e.status&&t.$failure?t.$failure(e):0===e.status&&t.$abort&&t.$abort(e),t.$finally&&t.$finally())};var i=t.method.toUpperCase();e.open(i,t.url,t.async);var n=null;if("POST"==i&&t.file){if(0,(n=new FormData).append("file",t.file),t.parameters)for(var s in t.parameters){var h=t.parameters[s];if(hui.isArray(h))for(var u=0;u<h.length;u++)n.append(s,h[u]);else n.append(s,h)}t.$progress&&e.upload.addEventListener("progress",function(e){t.$progress(e.loaded,e.total)},!1),t.$load&&e.upload.addEventListener("load",function(e){t.$load()},!1)}else if("POST"==i&&t.files)for(var n=new FormData,o=0;o<t.files.length;o++)n.append("file"+o,t.files[o]);else t.parameters?(n=hui.request._buildPostBody(t.parameters),e.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8")):n="";if(t.headers)for(var a in t.headers)e.setRequestHeader(a,t.headers[a]);return e.send(n),e}},hui.request.isXMLResponse=function(e){return e.responseXML&&e.responseXML.documentElement&&"parsererror"!=e.responseXML.documentElement.nodeName},hui.request._buildPostBody=function(e){if(!e)return null;var t,i,n="";if(hui.isArray(e))for(i=0;i<e.length;i++)t=e[i],0<i&&(n+="&"),n+=encodeURIComponent(t.name)+"=",void 0!==t.value&&null!==t.value&&(n+=encodeURIComponent(t.value));else for(t in e){var s=e[t];if(hui.isArray(s))for(i=0;i<s.length;i++)0<n.length&&(n+="&"),n+=encodeURIComponent(t)+"=",void 0!==s[i]&&null!==s[i]&&(n+=encodeURIComponent(s[i]));else 0<n.length&&(n+="&"),n+=encodeURIComponent(t)+"=",null!=s&&(n+=encodeURIComponent(s))}return n},hui.style={copy:function(e,t,i){for(var n=0;n<i.length;n++){var s=i[n],h=hui.style.get(e,s);h&&(t.style[hui.string.camelize(s)]=h)}},set:function(e,t){for(var i in t)"transform"===i?e.style.webkitTransform=t[i]:"opacity"===i?hui.style.setOpacity(e,t[i]):e.style[i]=t[i]},get:function(e,t){e=hui.get(e);var i,n=hui.string.camelize(t),s=e.style[n];return s||(document.defaultView&&document.defaultView.getComputedStyle?s=(i=document.defaultView.getComputedStyle(e,null))?i.getPropertyValue(t):null:e.currentStyle&&(s=e.currentStyle[n])),"auto"==s?"":s},setOpacity:function(e,t){hui.browser.opacity?e.style.opacity=t:e.style.filter=1==t?null:"alpha(opacity="+100*t+")"},length:function(e){return"number"==typeof e?e+"px":e}},hui.frame={getDocument:function(e){return e.contentDocument||(e.contentWindow?e.contentWindow.document:e.document||void 0)},getWindow:function(e){return e.defaultView||e.contentWindow||void 0}},hui.selection={clear:function(){var e;document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&(e=window.getSelection())&&e.removeAllRanges&&e.removeAllRanges()},getText:function(e){return(e=e||document).getSelection?e.getSelection()+"":e.selection?e.selection.createRange().text:""},getNode:function(e){if((e=e||document).getSelection){e=e.getSelection().getRangeAt(0);return"function"==typeof e.commonAncestorContainer?e.commonAncestorContainer():e.commonAncestorContainer}return null},get:function(e){return{node:hui.selection.getNode(e),text:hui.selection.getText(e)}},enable:function(e){document.onselectstart=e?null:function(){return!1},document.body.style.webkitUserSelect=e?null:"none"}},hui.effect={makeFlippable:function(e){hui.browser.webkit?(hui.cls.add(e.container,"hui_flip_container"),hui.cls.add(e.front,"hui_flip_front"),hui.cls.add(e.back,"hui_flip_back")):(hui.cls.add(e.front,"hui_flip_front_legacy"),hui.cls.add(e.back,"hui_flip_back_legacy"))},flip:function(e){var t,i,n;hui.browser.webkit?(n=hui.get(e.element),t=e.duration||"1s",i=hui.get.firstByClass(n,"hui_flip_front"),n=hui.get.firstByClass(n,"hui_flip_back"),i.style.webkitTransitionDuration=t,n.style.webkitTransitionDuration=t,hui.cls.toggle(e.element,"hui_flip_flipped")):hui.cls.toggle(e.element,"hui_flip_flipped_legacy")},bounceIn:function(e){var t=e.element;hui.browser.msie?hui.style.set(t,{display:"block",visibility:"visible"}):(hui.style.set(t,{display:"block",opacity:0,visibility:"visible"}),hui.animate(t,"transform","scale(0.1)",0),window.setTimeout(function(){hui.animate(t,"opacity",1,300),hui.animate(t,"transform","scale(1)",400,{ease:hui.ease.backOut})}))},fadeIn:function(e){var t=e.element;"none"==hui.style.get(t,"display")&&hui.style.set(t,{opacity:0,display:"inherit"}),hui.animate({node:t,css:{opacity:1},delay:e.delay||null,duration:e.duration||500,$complete:e.onComplete||e.$complete})},fadeOut:function(e){hui.animate({node:e.element,css:{opacity:0},delay:e.delay||null,duration:e.duration||500,hideOnComplete:!0,complete:e.onComplete||e.$complete})},wiggle:function(e){hui.ui.getElement(e.element);hui.cls.add(e.element,"hui_effect_wiggle"),window.setTimeout(function(){hui.cls.remove(e.element,"hui_effect_wiggle")},e.duration||1e3)},shake:function(e){this._do(e.element,"hui_effect_shake",e.duration||1e3)},tada:function(e){this._do(e.element,"hui_effect_tada",1e3)},_do:function(e,t,i){e=hui.ui.getElement(e),hui.cls.add(e,t),window.setTimeout(function(){hui.cls.remove(e,t)},i)}},hui.drag={attach:function(t){var e=t.touch&&hui.browser.touch;hui.listen(t.element,e?"touchstart":"mousedown",function(e){e=hui.event(e),t.$check&&!1===t.$check(e)||(e.stop(),hui.drag.start(t,e))})},register:function(e){this.attach(e)},start:function(t,e){var i=t.window||window,n=window.document.body.parentNode,s=hui.browser.msie?i.document:i,h=t.touch&&hui.browser.touch;t.$before&&t.$before(),t.onStart&&t.onStart();e.getLeft(),e.getTop(),Date.now();var u,o=!1,a=function(e){(e=hui.event(e)).stop(e),o||(t.onBeforeMove&&t.onBeforeMove(e),t.$startMove&&t.$startMove(e)),o=!0,t.onMove&&t.onMove(e),t.$move&&t.$move(e)}.bind(this);hui.listen(n,h?"touchmove":"mousemove",a),u=function(e){hui.unListen(n,h?"touchmove":"mousemove",a),hui.unListen(s,h?"touchend":"mouseup",u),t.onEnd&&t.onEnd(),o?(t.onAfterMove&&t.onAfterMove(e),t.$endMove&&t.$endMove(e)):(t.onNotMoved&&t.onNotMoved(e),t.$notMoved&&t.$notMoved(e)),t.$finally&&t.$finally(),hui.selection.enable(!0)}.bind(this),hui.listen(s,h?"touchend":"mouseup",u),hui.selection.enable(!1)},_nativeListeners:[],_activeDrop:null,listen:function(e){hui.browser.msie||(hui.drag._nativeListeners.push(e),1<hui.drag._nativeListeners.length||(hui.listen(document.body,"dragenter",function(e){for(var t=hui.drag._nativeListeners,i=null,n=0;n<t.length;n++){var s=t[n].element;if(hui.dom.isDescendantOrSelf(e.target,s)){i=t[n],null!==hui.drag._activeDrop&&hui.drag._activeDrop==i||hui.cls.add(s,i.hoverClass);break}}hui.drag._activeDrop&&(hui.drag._activeDrop!=i?(hui.cls.remove(hui.drag._activeDrop.element,hui.drag._activeDrop.hoverClass),hui.drag._activeDrop.$leave&&hui.drag._activeDrop.$leave(e)):hui.drag._activeDrop.$hover&&hui.drag._activeDrop.$hover(e)),hui.drag._activeDrop=i}),hui.listen(document.body,"dragover",function(e){hui.stop(e),hui.drag._activeDrop&&hui.drag._activeDrop.$hover&&hui.drag._activeDrop.$hover(e)}),hui.listen(document.body,"dragend",function(e){hui.log("drag end")}),hui.listen(document.body,"dragstart",function(e){hui.log("drag start")}),hui.listen(document.body,"drop",function(e){var t=hui.event(e);t.stop();var i,n,s=hui.drag._activeDrop;hui.drag._activeDrop=null,s&&(hui.cls.remove(s.element,s.hoverClass),s.$drop&&s.$drop(e,{event:t}),e.dataTransfer&&(hui.log(e.dataTransfer.types),s.$dropFiles&&e.dataTransfer.files&&0<e.dataTransfer.files.length?s.$dropFiles(e.dataTransfer.files,{event:t}):s.$dropURL&&null!==e.dataTransfer.types&&(hui.array.contains(e.dataTransfer.types,"public.url")||hui.array.contains(e.dataTransfer.types,"text/uri-list"))?(i=e.dataTransfer.getData("public.url"),n=e.dataTransfer.getData("text/uri-list"),i&&!hui.string.startsWith(i,"data:")?s.$dropURL(i,{event:t}):n&&!hui.string.startsWith(i,"data:")&&s.$dropURL(n,{event:t})):s.$dropText&&null!==e.dataTransfer.types&&hui.array.contains(e.dataTransfer.types,"text/plain")&&s.$dropText(e.dataTransfer.getData("text/plain"),{event:t})))})))}},hui.location={getParameter:function(e){for(var t=hui.location.getParameters(),i=0;i<t.length;i++)if(t[i].name==e)return t[i].value;return null},setParameter:function(e,t){for(var i=hui.location.getParameters(),n=!1,s=0;s<i.length;s++)if(i[s].name==e){i[s].value=t,n=!0;break}n||i.push({name:e,value:t}),hui.location.setParameters(i)},hasHash:function(e){var t=document.location.hash;return""!==t&&t=="#"+e},getHash:function(){var e=document.location.hash;return""!==e?e.substring(1):null},getHashParameter:function(e){var t=document.location.hash;if(""!==t){var i=t.indexOf(e+"=");if(-1!==i){e=t.substring(i+e.length+1);return-1!==e.indexOf("&")?e.substring(0,e.indexOf("&")):e}}return null},clearHash:function(){document.location.hash="#"},setParameters:function(e){for(var t="",i=0;i<e.length;i++)t+=0===i?"?":"&",t+=e[i].name+"="+e[i].value;document.location.search=t},getBoolean:function(e){e=hui.location.getParameter(e);return"true"==e||"1"==e},getInt:function(e){e=parseInt(hui.location.getParameter(e));return isNaN(e)?null:e},getParameters:function(){for(var e=document.location.search.substring(1).split("&"),t=[],i=0;i<e.length;i++){var n=e[i].split("="),s=unescape(n[0]).replace(/^\s*|\s*$/g,""),n=unescape(n[1]).replace(/^\s*|\s*$/g,"");s&&t.push({name:s,value:n})}return t}},hui._onReady(function(){hui._ready=!0;for(var e=0;e<hui._.length;e++){var t=hui._[e];"function"==typeof t&&(t=[t]),hui._runOrPostpone.apply(hui,t)}delete hui._}),hui=window.hui||{},hui.animate=function(e,t,i,n,s){if("string"==typeof e||hui.dom.isElement(e))hui.animation.get(e).animate(null,i,t,n,s);else{var h=hui.animation.get(e.node);if(e.property)h.animate(null,e.value,e.property,e.duration,e);else if(e.css){var u,o=e;for(u in e.css)h.animate(null,e.css[u],u,e.duration,o),(o=hui.override({},e)).$complete=void 0}else h.animate(null,"","",e.duration,e)}},hui.animation={objects:{},running:!1,latestId:0,get:function(e){return(e=hui.get(e)).huiAnimationId||(e.huiAnimationId=this.latestId++),this.objects[e.huiAnimationId]||(this.objects[e.huiAnimationId]=new hui.animation.Item(e)),this.objects[e.huiAnimationId]},start:function(){this.running||hui.animation._render()}},hui.animation._lengthUpater=function(e,t,i){e.style[i.property]=i.from+(i.to-i.from)*t+(i.unit||"")},hui.animation._transformUpater=function(e,t,i){var n=i.transform,i="";n.rotate&&(i+=" rotate("+(n.rotate.from+(n.rotate.to-n.rotate.from)*t)+n.rotate.unit+")"),n.scale&&(i+=" scale("+(n.scale.from+(n.scale.to-n.scale.from)*t)+")"),e.style[hui.animation.TRANSFORM]=i},hui.animation._colorUpater=function(e,t,i){var n=Math.round(i.from.red+(i.to.red-i.from.red)*t),s=Math.round(i.from.green+(i.to.green-i.from.green)*t),h=Math.round(i.from.blue+(i.to.blue-i.from.blue)*t);i.to.alpha<255||i.from.alpha<255?(t=Math.max(0,Math.min(1,i.from.alpha+(i.to.alpha-i.from.alpha)*t)),e.style[i.property]="rgba("+n+","+s+","+h+","+t+")"):e.style[i.property]="rgb("+n+","+s+","+h+")"},hui.animation._propertyUpater=function(e,t,i){e[i.property]=Math.round(i.from+(i.to-i.from)*t)},hui.animation._ieOpacityUpdater=function(e,t,i){t=i.from+(i.to-i.from)*t;1==t?e.style.removeAttribute("filter"):e.style.filter="alpha(opacity="+100*t+")"},hui.animation._render=function(){var e,t=!(hui.animation.running=!0),i=Date.now();for(e in hui.animation.objects){var n=hui.animation.objects[e];if(n.work)for(var s=n.element,h=0;h<n.work.length;h++){var u,o,a=n.work[h];a.finished||((u=(i-a.start)/(a.end-a.start))<0?t=!0:(isNaN(u)||1<u?u=1:u<1&&(t=!0),o=u,a.delegate&&a.delegate.ease&&(o=a.delegate.ease(o)),a.delegate&&a.delegate.$render?a.delegate.$render(s,o):a.delegate&&a.delegate.callback?a.delegate.callback(s,o):a.updater&&a.updater(s,o,a),1==u&&(a.finished=!0,a.delegate&&a.delegate.$complete?window.setTimeout(a.delegate.$complete):a.delegate&&a.delegate.onComplete?window.setTimeout(a.delegate.onComplete):a.delegate&&a.delegate.hideOnComplete&&(s.style.display="none"))))}}t?hui.onDraw(hui.animation._render):hui.animation.running=!1},hui.animation._parseStyle=function(e){var t,i={type:null,value:null,unit:null};if(!hui.isDefined(e))return i;if(!isNaN(e))return i.value=parseFloat(e),i;if(t=e.match(/([\-]?[0-9\.]+)(px|pt|%)/))return i.type="length",i.value=parseFloat(t[1]),i.unit=t[2],i;if(t=e.match(/rgb\(([0-9]+),[ ]?([0-9]+),[ ]?([0-9]+)\)/))return i.type="color",i.value={red:parseInt(t[1]),green:parseInt(t[2]),blue:parseInt(t[3]),alpha:1},i;if(t=e.match(/rgba\(([0-9]+),[ ]?([0-9]+),[ ]?([0-9]+),[ ]?([\.0-9]+)\)/))return i.type="color",i.value={red:parseInt(t[1]),green:parseInt(t[2]),blue:parseInt(t[3]),alpha:parseFloat(t[4])},i;e=new hui.Color(e);return e.ok&&(i.type="color",i.value={red:e.r,green:e.g,blue:e.b,alpha:1}),i},hui.animation.Item=function(e){this.element=e,this.work=[]},hui.animation.Item.prototype.animate=function(e,t,i,n,s){var h=this.getWork(hui.string.camelize(i));h.delegate=s,h.finished=!1;var u=!("scrollLeft"==i||"scrollTop"==i||""===i);null!==e?h.from=e:"transform"==i?h.transform=hui.animation.Item.parseTransform(t,this.element):hui.browser.opacity||"opacity"!=i?u?(e=hui.style.get(this.element,i),e=hui.animation._parseStyle(e),h.from=e.value):h.from=this.element[i]:h.from=this._getIEOpacity(this.element),u?(u=hui.animation._parseStyle(t),h.to=u.value,h.unit=u.unit,hui.browser.opacity||"opacity"!=i?"transform"==i?h.updater=hui.browser.msie?function(){}:hui.animation._transformUpater:"color"==u.type?h.updater=hui.animation._colorUpater:h.updater=hui.animation._lengthUpater:h.updater=hui.animation._ieOpacityUpdater):(h.to=t,h.unit=null,h.updater=hui.animation._propertyUpater),h.start=Date.now(),s&&s.delay&&(h.start+=s.delay),h.end=h.start+n,hui.animation.start()},hui.animation.TRANSFORM=function(){var e=navigator.userAgent;return-1!==e.indexOf("Gecko")&&-1===e.indexOf("WebKit")?"MozTransform":"WebkitTransform"}(),hui.animation.Item.parseTransform=function(e,t){var i,n,s={},h=/rotate\(([0-9\.]+)([a-z]+)\)/i,u=e.match(h);u&&(i=0,t.style[hui.animation.TRANSFORM]&&(n=t.style[hui.animation.TRANSFORM].match(h))&&(i=parseFloat(n[1])),s.rotate={from:i,to:parseFloat(u[1]),unit:u[2]});u=/scale\(([0-9\.]+)\)/i,e=e.match(u);return e&&(i=1,t.style[hui.animation.TRANSFORM]&&(n=t.style[hui.animation.TRANSFORM].match(u))&&(i=parseFloat(n[1])),s.scale={from:i,to:parseFloat(e[1])}),s},hui.animation.Item.prototype._getIEOpacity=function(e){e=hui.style.get(e,"filter").toLowerCase().match(/opacity=([0-9]+)/);return e?parseFloat(e[1])/100:1},hui.animation.Item.prototype.getWork=function(e){for(var t=this.work.length-1;0<=t;t--)if(this.work[t].property===e)return this.work[t];var i={property:e};return this.work[this.work.length]=i},hui.animation.Loop=function(e){this.recipe=e,this.position=-1,this.running=!1},hui.animation.Loop.prototype.next=function(){this.position++,this.position>=this.recipe.length&&(this.position=0);var e=this.recipe[this.position];"function"==typeof e?e():e.element&&hui.animate(e.element,e.property,e.value,e.duration,{ease:e.ease});var t=this,i=e.duration||0;void 0!==e.wait&&(i=e.wait),window.setTimeout(function(){t.next()},i)},hui.animation.Loop.prototype.start=function(){this.running=!0,this.next()},hui.ease={slowFastSlow:function(e){return-1*Math.pow(Math.cos(Math.PI/2*Math.pow(e,1.6)),Math.pow(Math.PI,1.4))+1},fastSlow:function(e){return-1*Math.pow(Math.cos(Math.PI/2*Math.pow(e,.5)),Math.pow(Math.PI,.7))+1},elastic:function(e){return 1-hui.ease.elastic2(1-e)},elastic2:function(e,t,i){return e<=0||1<=e?e:(i=i||.45,n=!t||t<1?(t=1,i/4):i/(2*Math.PI)*Math.asin(1/t),-(t*Math.pow(2,10*--e)*Math.sin((e-n)*(2*Math.PI)/i)));var n},bounce:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},flicker:function(e){return 1==e?1:Math.random()*e},quadIn:function(e){return Math.pow(e,2)},quadOut:function(e){return e*(e-2)*-1},quadInOut:function(e){return(e*=2)<1?Math.pow(e,2)/2:-1*(--e*(e-2)-1)/2},cubicIn:function(e){return Math.pow(e,3)},cubicOut:function(e){return Math.pow(e-1,3)+1},cubicInOut:function(e){return(e*=2)<1?Math.pow(e,3)/2:(e-=2,(Math.pow(e,3)+2)/2)},quartIn:function(e){return Math.pow(e,4)},quartOut:function(e){return-1*(Math.pow(e-1,4)-1)},quartInOut:function(e){return(e*=2)<1?Math.pow(e,4)/2:(e-=2,-.5*(Math.pow(e,4)-2))},quintIn:function(e){return Math.pow(e,5)},quintOut:function(e){return Math.pow(e-1,5)+1},quintInOut:function(e){return(e*=2)<1?Math.pow(e,5)/2:(e-=2,(Math.pow(e,5)+2)/2)},sineIn:function(e){return-1*Math.cos(e*(Math.PI/2))+1},sineOut:function(e){return Math.sin(e*(Math.PI/2))},sineInOut:function(e){return-1*(Math.cos(Math.PI*e)-1)/2},expoIn:function(e){return 0===e?0:Math.pow(2,10*(e-1))},expoOut:function(e){return 1==e?1:-1*Math.pow(2,-10*e)+1},expoInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?Math.pow(2,10*(e-1))/2:(--e,(-1*Math.pow(2,-10*e)+2)/2)},circIn:function(e){return-1*(Math.sqrt(1-Math.pow(e,2))-1)},circOut:function(e){return e-=1,Math.sqrt(1-Math.pow(e,2))},circInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-Math.pow(e,2))-1):(e-=2,.5*(Math.sqrt(1-Math.pow(e,2))+1))},backIn:function(e){return Math.pow(e,2)*(2.70158*e-1.70158)},backOut:function(e){e-=1;return Math.pow(e,2)*(2.70158*e+1.70158)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?Math.pow(e,2)*((1+t)*e-t)/2:(e-=2,(Math.pow(e,2)*((1+t)*e+t)+2)/2)},elasticIn:function(e){if(0===e)return 0;if(1==e)return 1;return e-=1,-1*Math.pow(2,10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)},elasticOut:function(e){if(0===e)return 0;if(1==e)return 1;return Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1},elasticInOut:function(e){if(0===e)return 0;if(2==(e*=2))return 1;var t=.3*1.5,i=t/4;return e<1?(--e,Math.pow(2,10*e)*Math.sin((e-i)*(2*Math.PI)/t)*-.5):(--e,Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/t)*.5+1)},bounceIn:function(e){return 1-hui.ease.bounceOut(1-e)},bounceOut:function(e){var t=7.5625,i=2.75,e=e<1/i?t*Math.pow(e,2):e<2/i?(e-=1.5/i,t*Math.pow(e,2)+.75):e<2.5/i?(e-=2.25/i,t*Math.pow(e,2)+.9375):(e-=2.625/i,t*Math.pow(e,2)+.984375);return e},bounceInOut:function(e){return e<.5?hui.ease.bounceIn(2*e)/2:hui.ease.bounceOut(2*e-1)/2+.5}},Date.now||(Date.now=function(){return(new Date).getTime()}),hui.on(function(){hui.define("hui.animation",hui.animation)}),hui=window.hui||{},hui.Color=function(e){if(this.ok=!1,hui.isArray(e)&&3==e.length&&(this.r=e[0],this.g=e[1],this.b=e[2]),!hui.isBlank(e)&&hui.isString(e)){for(var t in e=(e=(e="#"==e.charAt(0)?e.substr(1,6):e).replace(/ /g,"")).toLowerCase(),hui.Color.table)e==t&&(e=hui.Color.table[t]);for(var i=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^rgb\((\d{1,3})%,\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,process:function(e){return[Math.round(parseInt(e[1])/100*255),Math.round(parseInt(e[2])/100*255),Math.round(parseInt(e[3])/100*255)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],n=0;n<i.length;n++){var s=i[n].re,h=i[n].process,s=s.exec(e);if(s){s=h(s);this.r=s[0],this.g=s[1],this.b=s[2],this.ok=!0;break}}this.r=this.r<0||isNaN(this.r)?0:255<this.r?255:this.r,this.g=this.g<0||isNaN(this.g)?0:255<this.g?255:this.g,this.b=this.b<0||isNaN(this.b)?0:255<this.b?255:this.b}},hui.Color.prototype={r:0,g:0,b:0,toRGB:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},isDefined:function(){return!(void 0===this.r||void 0===this.g||void 0===this.b)},toHex:function(){if(!this.isDefined())return null;var e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return"#"+(e=1==e.length?"0"+e:e)+(t=1==t.length?"0"+t:t)+(i=1==i.length?"0"+i:i)}},hui.Color.table={white:"ffffff",black:"000000",red:"ff0000",green:"00ff00",blue:"0000ff"},hui.Color.hex2rgb=function(e){if(hui.isBlank(e))return null;if(3==(e="#"==e[0]?e.substr(1):e).length){var t=e;e="";for(var t=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(t).slice(1),i=0;i<3;i++)e+=t[i]+t[i]}var n=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(e).slice(1);return{r:parseInt(n[0],16),g:parseInt(n[1],16),b:parseInt(n[2],16)}},hui.Color.hsv2rgb=function(e,t,i){var n,s,h,u,o,a,l;return l=0===t?a=o=255*i:(h=i*(1-t),l=i*(1-t*((u=6*(e/360))-(e=Math.floor(u)))),u=i*(1-t*(1-(u-e))),l=0===e?(n=i,s=u,h):1===e?(n=l,s=i,h):2==e?(n=h,s=i,u):3==e?(n=h,s=l,i):4==e?(n=u,s=h,i):(n=i,s=h,l),o=Math.round(255*n),a=Math.round(255*s),Math.round(255*l)),new Array(o,a,l)},hui.Color.rgb2hsv=function(e,t,i){e/=255,t/=255,i/=255;var n,s=Math.min(Math.min(e,t),i),h=Math.max(Math.max(e,t),i),u=h;return h==s?n=0:h==e?n=(t-i)/(h-s)*60%360:h==t?n=(i-e)/(h-s)*60+120:h==i&&(n=(e-t)/(h-s)*60+240),n<0&&(n+=360),h=0===h?0:1-s/h,[Math.round(n),Math.round(100*h),Math.round(100*u)]},hui.Color.rgb2hex=function(e){for(var t="#",i=0;i<3;i++){var n=parseInt(e[i]).toString(16);t+=n=n.length<2?"0"+n:n}return t},hui.on(function(){hui.define("hui.Color",hui.Color)}),function(e,s,l){var h=s.getElementsByTagName("head")[0],r={},d={},c={},p={},u=!1,m="push",t="DOMContentLoaded",o="readyState",i="addEventListener",a="onreadystatechange",f=function(e,t){for(var i=0,n=e.length;i<n;++i)if(!t(e[i]))return u;return 1};function g(e,t){f(e,function(e){return!t(e)})}!s[o]&&s[i]&&(s[i](t,function e(){s.removeEventListener(t,e,u),s[o]="complete"},u),s[o]="loading");function v(e,t,i){e=e[m]?e:[e];var n=t&&t.call,s=n?t:i,h=n?e.join(""):t,u=e.length;function o(e){return e.call?e():r[e]}function a(){if(!--u)for(var e in r[h]=1,s&&s(),c)f(e.split("|"),o)&&!g(c[e],o)&&(c[e]=[])}return l(function(){g(e,function(e){return p[e]?(h&&(d[h]=1),void a()):(p[e]=1,h&&(d[h]=1),void b(v.path?v.path+e+".js":e,a))})},0),v}function b(e,t){var i=s.createElement("script"),n=u;i.onload=i.onerror=i[a]=function(){i[o]&&!/^c|loade/.test(i[o])||n||(i.onload=i[a]=null,n=1,t())},i.async=1,i.src=e,h.insertBefore(i,h.firstChild)}v.get=b,v.ready=function(e,t,i){e=e[m]?e:[e];var n=[];return g(e,function(e){r[e]||n[m](e)}),f(e,function(e){return r[e]})?t():(e=e.join("|"),c[e]=c[e]||[],c[e][m](t),i&&i(n)),v},e.hui.require=v}(this,document,setTimeout),hui.parallax={_listeners:[],_init:function(){this._listening||(this._listening=!0,hui.listen(window,"scroll",this._scroll.bind(this)),hui.listen(window,"resize",this._resize.bind(this)),hui.onReady(this._resize.bind(this)))},_resize:function(){for(var e=this._listeners.length-1;0<=e;e--){var t=this._listeners[e];t.$resize&&t.$resize(hui.window.getViewWidth(),hui.window.getViewHeight())}this._scroll()},_scroll:function(){for(var e=hui.window.getScrollTop(),t=hui.window.getViewHeight(),i=this._listeners.length-1;0<=i;i--){var n,s,h=this._listeners[i];h.$scroll&&(h.debug&&!h.debugElement&&(h.debugElement=hui.build("div",{style:"position: absolute; border-top: 1px solid red; left: 0; right: 0;",parent:document.body})),h.element?(n=hui.position.getTop(h.element),s=((n+=h.element.clientHeight/2)-e)/t,h.debugElement&&(h.debugElement.style.top=n+"px",h.debugElement.innerHTML="<span>"+s+"</span>"),h.$scroll(s)):(s=(e-h.min)/(h.max-h.min),s=hui.between(0,s,1),h._latest!==s&&(h.$scroll(s),h._latest=s)))}},listen:function(e){this._listeners.push(e),this._init()}},hui.on(function(){hui.define("hui.parallax",hui.parallax)}),hui.store={isSupported:function(){try{return hui.isDefined(window.localStorage)}catch(e){return!1}},set:function(e,t){this.isSupported()&&localStorage.setItem(e,t)},get:function(e){return this.isSupported()?localStorage.getItem(e):null},setObject:function(e,t){this.set(e,hui.string.toJSON(t))},getObject:function(e){return hui.string.fromJSON(this.get(e))}},hui=window.hui||{},hui.cookie={set:function(e,t,i){var n=i?((n=new Date).setTime(n.getTime()+24*i*60*60*1e3),"; expires="+n.toGMTString()):"";document.cookie=e+"="+t+n+"; path=/"},get:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var s=i[n];" "==s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return null},clear:function(e){this.set(e,"",-1)}},hui.xml={parse:function(e){try{if(window.DOMParser){var t,i=(t=(new DOMParser).parseFromString(e,"text/xml")).getElementsByTagName("parsererror");if(0<i.length&&i[0].textContent)return hui.log(i[0].textContent),null}else(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e)}catch(e){return null}return t},serialize:function(t){try{return(new XMLSerializer).serializeToString(t)}catch(e){try{return t.xml}catch(e){}}return null}},hui.Preloader=function(e){this.options=e||{},this.delegate={},this.images=[],this.loaded=0},hui.Preloader.prototype={addImages:function(e){if("object"==typeof e)for(var t=0;t<e.length;t++)this.images.push(e[t]);else this.images.push(e)},setDelegate:function(e){this.delegate=e},load:function(e){e=e||0;var t=this;this.obs=[];function i(){t._imageChanged(this.huiPreloaderIndex,"imageDidLoad")}function n(){t._imageChanged(this.huiPreloaderIndex,"imageDidGiveError")}function s(){t._imageChanged(this.huiPreloaderIndex,"imageDidAbort")}for(var h=e;h<this.images.length+e;h++){var u=h;u>=this.images.length&&(u-=this.images.length);var o=new Image;o.huiPreloaderIndex=u,o.onload=i,o.onerror=n,o.onabort=s,o.src=(this.options.context||"")+this.images[u],this.obs.push(o)}},_imageChanged:function(e,t){this.loaded++,this.delegate[t]&&this.delegate[t](this.loaded,this.images.length,e),this.loaded==this.images.length&&this.delegate.allImagesDidLoad&&this.delegate.allImagesDidLoad()}},Date.parseFunctions={count:0},Date.parseRegexes=[],Date.formatFunctions={count:0},Date.prototype.dateFormat=function(e){return null==Date.formatFunctions[e]&&Date.createNewFormat(e),this[Date.formatFunctions[e]]()},Date.createNewFormat=function(format){var funcName="format"+Date.formatFunctions.count++;Date.formatFunctions[format]=funcName;for(var code="Date.prototype."+funcName+" = function(){return ",special=!1,ch="",i=0;i<format.length;++i)ch=format.charAt(i),special||"\\"!=ch?special?(special=!1,code+="'"+Date.escape(ch)+"' + "):code+=Date.getFormatCode(ch):special=!0;eval(code.substring(0,code.length-3)+";}")},Date.getFormatCode=function(e){switch(e){case"d":return"Date.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"Date.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"Date.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"Date.leftPad(this.getHours(), 2, '0') + ";case"i":return"Date.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"Date.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+Date.escape(e)+"' + "}},Date.parseDate=function(e,t){null==Date.parseFunctions[t]&&Date.createParser(t);t=Date.parseFunctions[t];return Date[t](e)},Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++,regexNum=Date.parseRegexes.length,currentGroup=1;Date.parseFunctions[format]=funcName;for(var code="Date."+funcName+" = function(input){\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {",regex="",special=!1,ch="",i=0;i<format.length;++i){var obj,ch=format.charAt(i);special||"\\"!=ch?special?(special=!1,regex+=Date.escape(ch)):(obj=Date.formatCodeToRegex(ch,currentGroup),currentGroup+=obj.g,regex+=obj.s,obj.g&&obj.c&&(code+=obj.c)):special=!0}code+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}",Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$"),eval(code)},Date.formatCodeToRegex=function(e,t){switch(e){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+t+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:0,c:null,s:"(?:\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+t+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+t+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+t+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+t+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+t+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+t+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+t+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+t+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+t+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+t+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:Date.escape(e)}}},Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},Date.prototype.getGMTOffset=function(){return(0<this.getTimezoneOffset()?"-":"+")+Date.leftPad(Math.floor(this.getTimezoneOffset()/60),2,"0")+Date.leftPad(this.getTimezoneOffset()%60,2,"0")},Date.prototype.getDayOfYear=function(){var e=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var t=0;t<this.getMonth();++t)e+=Date.daysInMonth[t];return e+this.getDate()-1},Date.prototype.getWeekOfYear=function(){var e=this.getDayOfYear()+(5-this.getDay()),t=5-new Date(this.getFullYear(),0,1).getDay();return parseInt(Date.leftPad((e-t)/7+1,2,"0"))},Date.prototype.isLeapYear=function(){var e=this.getFullYear();return 0==(3&e)&&(e%100||e%400==0&&e)},Date.prototype.getFirstDayOfMonth=function(){var e=(this.getDay()-(this.getDate()-1))%7;return e<0?7+e:e},Date.prototype.getLastDayOfMonth=function(){var e=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return e<0?7+e:e},Date.prototype.getDaysInMonth=function(){return Date.daysInMonth[1]=this.isLeapYear()?29:28,Date.daysInMonth[this.getMonth()]},Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},Date.escape=function(e){return e.replace(/('|\\)/g,"\\$1")},Date.leftPad=function(e,t,i){var n=new String(e);for(null==i&&(i=" ");n.length<t;)n=i+n;return n},Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.y2kYear=50,Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"},hui=window.hui||{},hui.ui=hui.ui||{},hui.ui.domReady=!1,hui.ui.context=void 0,hui.ui.language=void 0,hui.ui.objects={},hui.ui.delegates=[],hui.ui.state="default",hui.ui.latestObjectIndex=0,hui.ui.latestIndex=500,hui.ui.latestPanelIndex=1e3,hui.ui.latestAlertIndex=1500,hui.ui.latestTopIndex=2e3,hui.ui.toolTips={},hui.ui.confirmOverlays={},hui.ui.delayedUntilReady=[],hui.ui.texts={request_error:{en:"An error occurred on the server",da:"Der skete en fejl pÃ¥ serveren"},continue:{en:"Continue",da:"FortsÃ¦t"},reload_page:{en:"Reload page",da:"IndÃ¦s siden igen"},access_denied:{en:"Access denied, maybe you are nolonger logged in",da:"Adgang nÃ¦gtet, du er mÃ¥ske ikke lÃ¦ngere logget ind"}},hui.ui.getContext=function(){var e;return void 0===this.context&&(e=hui.find("*[data-hui-context]"),this.context=e?e.getAttribute("data-hui-context"):"/"),this.context},hui.ui.getURL=function(e){var t=hui.ui.getContext();return"/"===e.substring(0,1)&&(e=e.substring(1)),(t="/"===t.substring(t.length-1)?t.substring(0,t.length-1):t)+"/hui/"+e},hui.ui.get=function(e){if(e)return e.element?e:hui.ui.objects[e]},hui.ui.is=function(e,t){return t.prototype.isPrototypeOf(e)},hui.ui.onReady=function(e){if(hui.ui.domReady)return e();hui.browser.gecko&&hui.string.endsWith(document.baseURI,"xml")?window.setTimeout(e,1e3):hui.ui.delayedUntilReady.push(e)},hui.ui._frameLoaded=function(e){hui.ui.tellGlobalListeners(this,"frameLoaded",e)},hui.ui._resize=function(){hui.ui.reLayout(),window.clearTimeout(this._delayedResize),hui.ui._resizeFirst||(this._delayedResize=window.setTimeout(hui.ui._afterResize,500))},hui.ui._afterResize=function(){hui.onDraw(function(){for(var e in hui.ui.tellGlobalListeners(hui.ui,"$afterResize"),hui.ui.objects){e=hui.ui.objects[e];e.$$draw&&e.$$draw()}})},hui.ui.confirmOverlay=function(e){var t,i=(i=e.element)||document.body;e.widget&&(i=e.widget.getElement()),hui.ui.confirmOverlays[i]?(t=hui.ui.confirmOverlays[i]).clear():(t=hui.ui.Overlay.create({modal:!0}),hui.ui.confirmOverlays[i]=t),e.text&&t.addText(hui.ui.getTranslated(e.text));var n=hui.ui.Button.create({text:hui.ui.getTranslated(e.okText)||"OK",highlighted:"true"});n.click(function(){e.onOk?e.onOk():e.$ok&&e.$ok(),t.hide()}),t.add(n);n=hui.ui.Button.create({text:hui.ui.getTranslated(e.cancelText)||"Cancel"});n.onClick(function(){e.onCancel?e.onCancel():e.$cancel&&e.$cancel(),t.hide()}),t.add(n),t.show({element:i})},hui.ui.destroy=function(e){if(e.getAccessories)for(var t=e.getAccessories(),i=0;i<t.length;i++)hui.ui.destroy(t[i]);delete hui.ui.objects[e.name],e.detach();e=e.getElement();e&&(hui.dom.remove(e),hui.ui.destroyDescendants(e))},hui.ui.destroyDescendants=function(e){for(var t=hui.ui.getDescendants(e),i=0;i<t.length;i++)hui.ui.destroy(t[i])},hui.ui.remove=function(e){hui.ui.destroy(e),hui.ui.destroyDescendants(e),e.element&&hui.dom.remove(e.element)},hui.ui.getAncestors=function(e){var t=[],i=e.element;if(i)for(var n=i.parentNode;n;){for(var s in hui.ui.objects)(e=hui.ui.objects[s]).element===n&&t.push(e);n=n.parentNode}return t},hui.ui.getDescendants=function(e){var t=[];if(e){e=e.getElement?e.getElement():e;if(e){var i,n=e.getElementsByTagName("*"),s=[];for(i in hui.ui.objects)s.push(hui.ui.objects[i]);for(var h=0;h<n.length;h++)for(var u=0;u<s.length;u++)n[h]==s[u].element&&t.push(s[u])}}return t},hui.ui.getAncestor=function(e,t){for(var i=hui.ui.getAncestors(e),n=0;n<i.length;n++)if(hui.cls.has(i[n].getElement(),t))return i[n];return null},hui.ui.getComponents=function(e){var t,i=[],n=hui.ui.objects;for(t in n)e(n[t])&&i.push(n[t]);return i},hui.ui.changeState=function(e){if(hui.ui.state!==e){var t,i,n=hui.ui.objects;for(t in n)(i=n[t]).options&&i.options.state&&(i.options.state==e?i.show():i.hide());hui.ui.state=e,this.reLayout()}},hui.ui.reLayout=function(){for(var e=hui.ui.getDescendants(document.body),t=0;t<e.length;t++){var i=e[t];i.$$layout&&i.$$layout()}},hui.ui.nextPanelIndex=function(){return hui.ui.latestPanelIndex++,hui.ui.latestPanelIndex},hui.ui.nextAlertIndex=function(){return hui.ui.latestAlertIndex++,hui.ui.latestAlertIndex},hui.ui.nextTopIndex=function(){return hui.ui.latestTopIndex++,hui.ui.latestTopIndex},hui.ui.showCurtain=function(e){var t=e.widget;t.curtain||(t.curtain=hui.build("div",{style:"position:fixed;top:0;left:0;bottom:0;right:0"}),(hui.find(".hui_body",document.body)||document.body).appendChild(t.curtain),hui.listen(t.curtain,"click",function(){t.$curtainWasClicked&&t.$curtainWasClicked()}));var i=t.curtain,n=e.color||"#000";e.transparent?n="none":"auto"==e.color&&("transparent"!=(n=hui.style.get(document.body,"background-color"))&&"rgba(0, 0, 0, 0)"!=n||(n="#fff")),i.style.backgroundColor=n,i.style.zIndex=e.zIndex,e.transparent?i.style.display="block":(hui.style.setOpacity(i,0),i.style.display="block",hui.animate(i,"opacity",.7,1e3,{ease:hui.ease.slowFastSlow}))},hui.ui.hideCurtain=function(e){e.curtain&&hui.animate(e.curtain,"opacity",0,200,{hideOnComplete:!0})},hui.ui.getText=function(e){var t=this.texts[e];return t?t[this.language]||t.en:e},hui.ui.getTranslated=function(e){if(!hui.isDefined(e)||hui.isString(e)||"number"==typeof e)return e;var t,i=hui.ui.getLanguage();if(e[i])return e[i];if(e.null)return e.null;for(t in e)return e[t]},hui.ui.getLanguage=function(){return hui.ui.language||document.documentElement&&document.documentElement.lang||"en"},hui.ui.confirm=function(e){hui.ui.Alert.confirm(e)},hui.ui.alert=function(e){hui.ui.Alert.alert(e)},hui.ui.showMessage=function(e){var t;"string"==typeof e&&(e={text:e}),window.clearTimeout(hui.ui.messageDelayTimer),e.delay?hui.ui.messageDelayTimer=window.setTimeout(function(){e.delay=null,hui.ui.showMessage(e)},e.delay):(hui.ui.message||(hui.ui.message=hui.build("div.hui_message",{parent:document.body,style:{opacity:0}})),t=hui.ui.getTranslated(e.text)||"",hui.cls.set(hui.ui.message,"hui-is-busy",e.busy),hui.cls.set(hui.ui.message,"hui-is-success",e.success),hui.cls.set(hui.ui.message,"hui-is-failure",e.failure),hui.dom.setText(hui.ui.message,t),hui.ui.message.style.width="",hui.ui.message.style.left="0",hui.ui.message.style.display="block",t=hui.ui.message.offsetWidth,hui.ui.message.style.left="50%",t>hui.window.getViewWidth()?(hui.ui.message.style.width="80%",hui.ui.message.style.marginLeft="-40%"):hui.ui.message.style.marginLeft=hui.ui.message.offsetWidth/-2+"px",hui.ui.message.style.marginTop=hui.ui.message.offsetHeight/-2+"px",hui.ui.message.style.zIndex=hui.ui.nextTopIndex(),hui.browser.opacity&&hui.animate(hui.ui.message,"opacity",1,300),window.clearTimeout(hui.ui.messageTimer),e.duration&&(hui.ui.messageTimer=window.setTimeout(hui.ui.hideMessage,e.duration)))},hui.ui.msg=hui.ui.showMessage,hui.ui.msg.success=function(e){e=hui.override({success:!0,duration:2e3},e),hui.ui.msg(e)},hui.ui.msg.fail=function(e){e=hui.override({failure:!0,duration:3e3},e),hui.ui.msg(e)},hui.ui.hideMessage=function(){window.clearTimeout(hui.ui.messageDelayTimer),hui.ui.message&&(hui.browser.opacity?hui.animate(hui.ui.message,"opacity",0,300,{hideOnComplete:!0}):hui.ui.message.style.display="none")},hui.ui.showToolTip=function(e){var t=e.key||"common",i=hui.ui.toolTips[t];i||(i=hui.build("div",{class:"hui_tooltip",style:"display:none;",html:"<div><div></div></div>",parent:document.body}),hui.ui.toolTips[t]=i),i.onclick=function(){hui.ui.hideToolTip(e)};var n=hui.get(e.element),t=hui.position.get(n);hui.dom.setText(i.getElementsByTagName("div")[1],e.text),"none"==i.style.display&&hui.browser.opacity&&hui.style.setOpacity(i,0),hui.style.set(i,{display:"block",zIndex:hui.ui.nextTopIndex()}),hui.style.set(i,{left:t.left-i.clientWidth+4+"px",top:t.top+2-i.clientHeight/2+n.clientHeight/2+"px"}),hui.browser.opacity&&hui.animate(i,"opacity",1,300)},hui.ui.hideToolTip=function(e){e=e&&e.key||"common",e=hui.ui.toolTips[e];e&&(hui.browser.msie?e.style.display="none":hui.animate(e,"opacity",0,300,{hideOnComplete:!0}))},hui.ui.getElement=function(e){return hui.dom.isElement(e)?e:e.getElement?e.getElement():null},hui.ui.isWithin=function(e,t){e=hui.event(e);var i=hui.position.get(t),n=t.offsetWidth,s=t.offsetHeight,t=e.getLeft(),e=e.getTop();return t>i.left&&t<i.left+n&&e>i.top&&e<i.top+s},hui.ui.getIconUrl=function(e,t){return hui.ui.getURL("icons/"+e+t+".png")},hui.ui.createIcon=function(e,t,i){i=hui.build(i||"span",{class:"hui_icon hui_icon_"+t});return hui.ui.setIconImage(i,e,t),i},hui.ui.setIconImage=function(e,t,i){32==i||16==i||64==i?e.setAttribute("style",hui.ui.getIconStyle(t,i)):e.setAttribute("style","background-image: url("+hui.ui.getIconUrl(t,i)+");")},hui.ui.getIconStyle=function(e,t){return"background-image: url("+hui.ui.getIconUrl(e,t)+"); background-image: -webkit-image-set(url("+hui.ui.getIconUrl(e,t)+") 1x,url("+hui.ui.getIconUrl(e,t+"x2")+") 2x); background-size: "+t+"px;"},hui.ui.addFocusClass=function(e){var t=e.classElement||e.element,i=e.class;hui.listen(e.element,"focus",function(){hui.cls.add(t,i)}),hui.listen(e.element,"blur",function(){hui.cls.remove(t,i)})},hui.ui.stress=function(e){e=hui.ui.getElement(e);hui.effect.wiggle({element:e,duration:1e3})},hui.ui.positionAtElement=function(e,t,i){i=i||{},e=hui.get(e),t=hui.get(t);var n=hui.style.get(e,"display");"none"==n&&hui.style.set(e,{visibility:"hidden",display:"block"});var s=hui.position.getLeft(t),h=hui.position.getTop(t),u=i.vertical||null;i.horizontal&&"right"==i.horizontal&&(s=s+t.clientWidth-e.clientWidth),"topOutside"==u?h-=e.clientHeight:"bottomOutside"==u&&(h+=t.clientHeight),s+=i.left||0,h+=i.top||0,hui.style.set(e,{left:s+"px",top:h+"px"}),"none"==n&&hui.style.set(e,{visibility:"visible",display:"none"})},hui.ui.extend=function(e,t){void 0!==t&&(e.options&&(e.options=hui.override(e.options,t)),e.element=hui.get(t.element),e.name=t.name),e.name||(hui.ui.latestObjectIndex++,e.name="unnamed"+hui.ui.latestObjectIndex),hui.ui.registerComponent(e),e.delegates=[],e.listen=function(e){return hui.array.add(this.delegates,e),this},e.unListen=function(e){hui.array.remove(this.delegates,e)},e.clearListeners=function(){this.delegates=[]},e.fire=function(e,t,i){return hui.ui.callDelegates(this,e,t,i)},e.fireValueChange=function(){e.fire("valueChanged",e.value),hui.ui.firePropertyChange(e,"value",e.value),hui.ui.callAncestors(e,"childValueChanged",e.value)},e.fireProperty=function(e,t){hui.ui.firePropertyChange(this,e,t)},e.fireSizeChange=function(){hui.ui.callAncestors(e,"$$childSizeChanged")},e.addTo=function(e){return e.add(this),this},e.getElement||(e.getElement=function(){return this.element}),e.detach||(e.detach=function(){}),e.destroy||(e.destroy=function(){hui.ui.destroy(this)}),e.valueForProperty||(e.valueForProperty=function(e){return this[e]}),e.nodes&&e.element&&(e.nodes=hui.collect(e.nodes,e.element))},hui.ui.make=function(t){function e(e){e.element||(e.element=t.$build(e)),hui.ui.Component.call(this,e);var n=this;hui.each(t.$events,function(e,t){var i=n.nodes[e];hui.each(t,function(e,t){hui.isString(t)?hui.on(i,e,function(e){hui.stop(e),n.fire(t.substring(0,t.length-1))}):hui.on(i,e,t.bind(n))})}),this.$init&&this.$init(e),this.$attach&&this.$attach()}var i=["create"],n={};for(p in t)t.hasOwnProperty(p)&&-1==i.indexOf(p)&&(n[p]=t[p]);e.prototype=n,hui.extend(e,hui.ui.Component),hui.ui[t.name]=e,hui.define("hui.ui."+t.name,e)},hui.ui.registerComponent=function(e){hui.ui.objects[e.name]&&hui.log("Widget replaced: "+e.name,hui.ui.objects[e.name]),hui.ui.objects[e.name]=e},hui.ui.callAncestors=function(e,t,i,n){void 0===i&&(i=e);for(var s=hui.ui.getAncestors(e),h=0;h<s.length;h++)s[h][t]&&s[h][t](i,n)},hui.ui.callDescendants=function(e,t,i,n){void 0===i&&(i=e),"$"!==t[0]&&(t="$"+t);for(var s=hui.ui.getDescendants(e),h=0;h<s.length;h++)s[h][t]&&s[h][t](i,n)},hui.ui.callVisible=function(e){hui.ui.callDescendants(e,"$visibilityChanged")},hui.ui.listen=function(e){hui.ui.domReady&&e.$ready&&e.$ready(),hui.ui.delegates.push(e)},hui.ui.unListen=function(e){hui.array.remove(hui.ui.delegates,e)},hui.ui.tell=function(e){(e=hui.isString(e)?{name:e}:e).target||hui.ui.tellGlobalListeners(window,e.name)},hui.ui.callDelegates=function(e,t,i,n){var s;if(void 0===i&&(i=e),e.delegates)for(var h=0;h<e.delegates.length;h++){var u,o=e.delegates[h],a="$"+t+"$"+e.name;e.name&&o[a]?u=o[a](i,n):o["$"+t]&&(u=o["$"+t](i,n)),void 0===s&&void 0!==u&&(s=u)}var l=hui.ui.tellGlobalListeners(e,t,i,n);return s=void 0===s&&void 0!==l?l:s},hui.ui.tellContainers=function(e,t){if(window.parent!=window)try{return window.parent.hui.ui._tellContainers(e,t)}catch(e){window.console&&console.error(e)}},hui.ui._tellContainers=function(e,t){var i=hui.ui.tellGlobalListeners({},e,t);if(window.parent!=window)try{i=window.parent.hui.ui._tellContainers(e,t)||i}catch(e){window.console&&console.error(e)}return i},hui.ui.tellGlobalListeners=function(e,t,i,n){var s;void 0===i&&(i=e);for(var h=0;h<hui.ui.delegates.length;h++){var u,o=hui.ui.delegates[h];e.name&&o["$"+t+"$"+e.name]?u=o["$"+t+"$"+e.name](i,n):o["$"+t]&&(u=o["$"+t](i,n)),void 0===s&&void 0!==u&&void 0!==u&&(s=u)}return s},hui.ui.resolveImageUrl=function(e,t,i,n){for(var s=0;s<e.delegates.length;s++)if(e.delegates[s].$resolveImageUrl)return e.delegates[s].$resolveImageUrl(t,i,n);for(var h=0;h<hui.ui.delegates.length;h++){var u=hui.ui.delegates[h];if(u.$resolveImageUrl)return u.$resolveImageUrl(t,i,n)}return null},hui.ui.include=function(t){hui.ui.request({url:t.url,$text:function(e){e=hui.build("div",{html:e,parent:document.body});hui.dom.runScripts(e),t.$success()}})},hui.ui.firePropertyChange=function(e,t,i){hui.ui.callDelegates(e,"propertyChanged",{property:t,value:i})},hui.ui.bind=function(e,t){if(hui.isString(e)&&"@"==e.charAt(0)){var i=e.substring(1).split("."),n=hui.ui.get(i[0]);if(!n)return void hui.log("Unable to bind to "+e);var s=i.slice(1).join(".");return n.listen({$propertyChanged:function(e){e.property==s&&t(e.value)}}),n.valueForProperty(s)}return e},hui.ui.handleRequestError=function(e){hui.log("General request error received"),hui.ui.tellGlobalListeners(e||this,"requestError")||hui.ui.confirmOverlay({element:document.body,text:hui.ui.getText("request_error"),okText:hui.ui.getText("reload_page"),cancelText:hui.ui.getText("continue"),onOk:function(){document.location.reload()}})},hui.ui.handleForbidden=function(e){hui.log("General access denied received"),hui.ui.tellGlobalListeners(e||this,"accessDenied")||hui.ui.confirmOverlay({element:document.body,text:hui.ui.getText("access_denied"),okText:hui.ui.getText("reload_page"),cancelText:hui.ui.getText("continue"),onOk:function(){document.location.reload()}})},hui.ui.request=function(n){if((n=hui.override({method:"post",parameters:{}},n)).json)for(var e in n.json)n.parameters[e]=hui.string.toJSON(n.json[e]);var i=n.$success,s=n.$object,h=n.$text,u=n.$xml,o=n.$failure,t=n.$forbidden,a=n.message;n.$success=function(e){var t;a&&(a.success?hui.ui.msg({text:a.success,success:!0,duration:a.duration||2e3}):a.start&&hui.ui.hideMessage()),"string"==typeof i?hui.request.isXMLResponse(e)?hui.ui.callDelegates(e,"success$"+i):(t=0<e.responseText.replace(/^\s+|\s+$/g,"").length?hui.string.fromJSON(e.responseText):"",hui.ui.callDelegates(t,"success$"+i)):u&&hui.request.isXMLResponse(e)?u(e.responseXML):s?(t=0<e.responseText.replace(/^\s+|\s+$/g,"").length?hui.string.fromJSON(e.responseText):null,s(t)):"function"==typeof i?i(e):h&&h(e.responseText)},n.$failure=function(e){var t,i;"string"==typeof o?hui.ui.callDelegates(e,"failure$"+o):"function"==typeof o?("application/json"==(i=(i=e.getResponseHeader("Content-Type"))&&i.split(";")[0].trim())&&(t=hui.string.fromJSON(e.responseText)),o(e,t)):(n.message&&n.message.start&&hui.ui.hideMessage(),hui.ui.handleRequestError())},n.$exception=n.$exception||function(e,t){throw hui.log(e),hui.log(t),e},n.$forbidden=function(e){n.message&&n.message.start&&hui.ui.hideMessage(),t?t(e):(n.$failure(e),hui.ui.handleForbidden())},n.message&&n.message.start&&hui.ui.msg({text:n.message.start,busy:!0,delay:n.message.delay}),hui.request(n)},hui.ui.require=function(e,t){for(var i=e.length-1;0<=i;i--)e[i]=hui.ui.getURL("js/"+e[i]+".js");hui.require(e,t)},hui.on(function(){hui.listen(window,"resize",hui.ui._resize),hui.ui.reLayout(),hui.ui.domReady=!0,window.parent&&window.parent.hui&&window.parent.hui.ui&&window.parent.hui.ui._frameLoaded(window);for(var e=0;e<hui.ui.delayedUntilReady.length;e++)hui.ui.delayedUntilReady[e]();hui.ui.tellGlobalListeners(this,"ready"),hui.define("hui.ui",hui.ui)}),hui.ui.Component=function(e){this.name=(e=e||{}).name,this.state=hui.override({},this.state),this.name||(hui.ui.latestObjectIndex++,this.name="unnamed"+hui.ui.latestObjectIndex),this.element=hui.get(e.element),this.delegates=[],this.nodes?this.nodes=hui.collect(this.nodes,this.element):this.nodes=[],this.nodes.root=this.element,e.listen&&this.listen(e.listen),hui.ui.registerComponent(this)},hui.ui.Component.prototype={listen:function(e){this.delegates.push(e)},on:function(e){this.delegates.push(e)},fire:function(e,t,i){return hui.ui.callDelegates(this,e,t,i)},getElement:function(){return this.element},destroy:function(){hui.ui.destroy(this)},detach:function(){},valueForProperty:function(e){return this[e]},fireValueChange:function(){this.fire("valueChanged",this.value),hui.ui.firePropertyChange(this,"value",this.value),hui.ui.callAncestors(this,"childValueChanged",this.value)},fireSizeChange:function(){hui.ui.callAncestors(this,"$$childSizeChanged")},change:function(e){var t={};for(key in e)e.hasOwnProperty(key)&&this.state.hasOwnProperty(key)&&this.state[key]!==e[key]&&(this.state[key]=e[key],t[key]=e[key]);t!={}&&this.draw&&this.draw(t)}},hui.component=function(e,i){hui.ui[e]=function(e){for(key in e=e||{},hui.ui.Component.call(this,e),this.init&&this.init(e),this.change(e),this.attach&&this.attach(),this)"!"==key[0]&&"function"==typeof this[key]&&function(t,i){hui.listen(t.element,i.substr(1),function(e){e=hui.event(e),t[i](e)})}(this,key)};var n=hui.ui[e];if(n.create=function(e){var t={element:i.create()};hui.extend(t,e),e.testName&&t.element.setAttribute("data-test",e.testName);t=new n(t);return t.change(e),t},n.prototype=i,hui.extend(n.prototype,hui.ui.Component.prototype),i.with)for(var t=0;t<i.with.length;t++){var s=hui.component[i.with[t]];for(prop in s)"function"==typeof s[prop]&&(n.prototype[prop]=s[prop]);if(s.state)for(prop in s.state)void 0===n.prototype.state[prop]&&(n.prototype.state[prop]=s.state[prop])}},hui.component.value={state:{value:void 0},setValue:function(e){this.change({value:e})},getValue:function(){return this.state.value},tellValueChange:function(){var e=this.state.value;hui.ui.callAncestors(this,"childValueChanged",e),this.fire("valueChanged",e),hui.ui.firePropertyChange(this,"value",e)}},hui.component.enabled={state:{enabled:!0},setEnabled:function(e){this.change({enabled:!!e})},isEnabled:function(){return!!this.state.enabled}},hui.component.key={state:{key:void 0},getKey:function(){return this.state.key}},hui.component.size={state:{size:"regular"},getSize:function(){return this.state.size},setSize:function(e){this.change({size:e})}},hui.ui.Source=function(e){this.options=hui.override({url:null,parameters:[],lazy:!1},e),this.name=e.name,this.data=null,this.parameters=[];for(var t=0;t<this.options.parameters.length;t++){var i=this.options.parameters[t];this.parameters.push({key:i.key,value:i.value,separate:i.separate})}hui.ui.extend(this),e.delegate&&this.listen(e.delegate),this.initial=!0,this.busy=!1,hui.ui.onReady(this._init.bind(this))},hui.ui.Source.prototype={_init:function(){var i=this;hui.each(this.parameters,function(t){var e=hui.ui.bind(t.value,function(e){i.changeParameter(t.key,e)});t.value=i._convertValue(e)}),this.options.lazy||this.refresh()},_convertValue:function(e){return e&&e.getTime?e.getTime():e},refreshFirst:function(){this.initial&&this.refresh()},refreshLater:function(){window.clearTimeout(this.paramDelay),this.paramDelay=window.setTimeout(function(){this.refresh()}.bind(this),100)},refresh:function(){this.options.delay<1?this._refresh():(window.clearTimeout(this._refreshDelay),this._refreshDelay=window.setTimeout(this._refresh.bind(this),this.options.delay))},_refresh:function(){if(0!==this.delegates.length){for(var e=0===this.delegates.length,t=0;t<this.delegates.length;t++)var i=this.delegates[t],e=!i.$sourceShouldRefresh||(e||i.$sourceShouldRefresh());if(e)if(this.busy)this.pendingRefresh=!0;else{this.initial=!1,this.pendingRefresh=!1;var n=this;if(this.options.url){for(var s=[],h=0;h<this.parameters.length;h++){var u=this.parameters[h];if(hui.isArray(u.value)&&u.separate)for(var o=0;o<u.value.length;o++)s.push({name:u.key,value:u.value[o]});else s.push({name:u.key,value:u.value})}this.busy=!0,hui.ui.callDelegates(this,"sourceIsBusy"),this.transport=hui.request({method:"POST",url:this.options.url,parameters:s,$success:this._parse.bind(this),$exception:function(e,t){hui.log("Exception while loading source..."),hui.log(e),n._end()},$forbidden:function(){hui.ui.handleForbidden(n),hui.ui.callDelegates(n,"sourceFailed"),n._end()},$failure:function(e){hui.log("sourceFailed"),hui.ui.callDelegates(n,"sourceFailed"),n._end()}})}}}},_end:function(){this.busy=!1,hui.ui.callDelegates(this,"sourceIsNotBusy"),this.pendingRefresh&&this.refresh()},_parse:function(e){var t;hui.request.isXMLResponse(e)?this._parseXML(e.responseXML):(t=null,0<e.responseText.replace(/^\s+|\s+$/g,"").length&&(t=hui.string.fromJSON(e.responseText)),this.fire("objectsLoaded",t)),this._end()},_parseXML:function(e){var t=e.documentElement.tagName;"items"==t||"options"==t?(this.data=this._parseItems(e),this.fire("optionsLoaded",this.data)):"list"==t?this.fire("listLoaded",e):"articles"==t&&this.fire("articlesLoaded",e)},_parseItems:function(e){var t=e.documentElement,e=[];return this._parseSubItems(t,e),e},_parseSubItems:function(e,t){for(var i=e.childNodes,n=0;n<i.length;n++){var s,h=i[n];1==h.nodeType&&"title"==h.nodeName?t.push({title:h.getAttribute("title"),type:"title"}):1!=h.nodeType||"item"!=h.nodeName&&"option"!=h.nodeName||(this._parseSubItems(h,s=[]),t.push({text:h.getAttribute("text"),title:h.getAttribute("title"),value:h.getAttribute("value"),icon:h.getAttribute("icon"),kind:h.getAttribute("kind"),badge:h.getAttribute("badge"),children:s}))}},addParameter:function(t){this.parameters.push(t);var e=hui.ui.bind(t.value,function(e){this.changeParameter(t.key,e)}.bind(this));t.value=this._convertValue(e)},setParameter:function(e,t){t=this._convertValue(t);for(var i=0;i<this.parameters.length;i++){var n=this.parameters[i];if(n.key==e)return void(n.value=t)}this.parameters.push({key:e,value:t})},changeParameter:function(e,t){t=this._convertValue(t);for(var i=0;i<this.parameters.length;i++){var n=this.parameters[i];n.key==e&&(n.value=t)}this.refreshLater()}},hui.ui.callDelegatesDrop=function(e,t){for(var i=0;i<hui.ui.delegates.length;i++)hui.ui.delegates[i]["$drop$"+e.kind+"$"+t.kind]&&hui.ui.delegates[i]["$drop$"+e.kind+"$"+t.kind](e,t)},hui.ui.getDragProxy=function(){return hui.ui.dragProxy||(hui.ui.dragProxy=hui.build("div",{class:"hui_dragproxy",style:"display:none"}),document.body.appendChild(hui.ui.dragProxy)),hui.ui.dragProxy},hui.ui.startDrag=function(e,t,i){e=new hui.Event(e);var n=t.dragDropInfo;hui.ui.dropTypes=hui.ui.findDropTypes(n),hui.ui.dropTypes&&(t=hui.ui.getDragProxy(),hui.listen(document.body,"mousemove",hui.ui.dragListener),hui.listen(document.body,"mouseup",hui.ui.dragEndListener),(hui.ui.dragInfo=n).icon&&(t.style.backgroundImage="url("+hui.ui.getIconUrl(n.icon,16)+")"),hui.ui.startDragPos={top:e.getTop(),left:e.getLeft()},t.innerHTML=n.title?"<span>"+hui.string.escape(n.title)+"</span>":"###",hui.ui.dragging=!0,hui.selection.enable(!1))},hui.ui.findDropTypes=function(e){for(var t=hui.ui,i=null,n=0;n<t.delegates.length;n++)if(t.delegates[n].dragDrop)for(var s=0;s<t.delegates[n].dragDrop.length;s++){var h=t.delegates[n].dragDrop[s];h.drag==e.kind&&((i=null===i?{}:i)[h.drop]={})}return i},hui.ui.dragListener=function(e){e=new hui.Event(e),hui.ui.dragProxy.style.left=e.getLeft()+10+"px",hui.ui.dragProxy.style.top=e.getTop()+"px",hui.ui.dragProxy.style.display="block";e=hui.ui.findDropTarget(e.getElement());return e&&hui.ui.dropTypes[e.dragDropInfo.kind]?(hui.ui.latestDropTarget&&hui.cls.remove(hui.ui.latestDropTarget,"hui_drop"),hui.cls.add(e,"hui_drop"),hui.ui.latestDropTarget=e):hui.ui.latestDropTarget&&(hui.cls.remove(hui.ui.latestDropTarget,"hui_drop"),hui.ui.latestDropTarget=null),!1},hui.ui.findDropTarget=function(e){for(;e;){if(e.dragDropInfo)return e;e=e.parentNode}return null},hui.ui.dragEndListener=function(e){hui.unListen(document.body,"mousemove",hui.ui.dragListener),hui.unListen(document.body,"mouseup",hui.ui.dragEndListener),hui.ui.dragging=!1,hui.ui.latestDropTarget?(hui.cls.remove(hui.ui.latestDropTarget,"hui_drop"),hui.ui.callDelegatesDrop(hui.ui.dragInfo,hui.ui.latestDropTarget.dragDropInfo),hui.ui.dragProxy.style.display="none"):(hui.animate(hui.ui.dragProxy,"left",hui.ui.startDragPos.left+10+"px",200,{ease:hui.ease.fastSlow}),hui.animate(hui.ui.dragProxy,"top",hui.ui.startDragPos.top-5+"px",200,{ease:hui.ease.fastSlow,hideOnComplete:!0})),hui.ui.latestDropTarget=null,hui.selection.enable(!1)},hui.ui.dropOverListener=function(e){hui.ui.dragging},hui.ui.dropOutListener=function(e){hui.ui.dragging},hui.ui.Window=function(e){this.element=hui.get(e.element),this.name=e.name,this.close=hui.get.firstByClass(this.element,"hui_window_close"),this.titlebar=hui.get.firstByClass(this.element,"hui_window_titlebar"),this.title=hui.get.firstByClass(this.titlebar,"hui_window_title"),this.content=hui.get.firstByClass(this.element,"hui_window_body"),this.front=hui.get.firstByClass(this.element,"hui_window_front"),this.back=hui.get.firstByClass(this.element,"hui_window_back"),this.back&&hui.effect.makeFlippable({container:this.element,front:this.front,back:this.back}),this.visible=!1,hui.ui.extend(this),this._addBehavior(),e.listener&&this.listen(e.listener)},hui.ui.Window.create=function(e){var t='<div class="hui_window_front">'+((e=hui.override({title:"Window",close:!0},e)).close?'<div class="hui_window_close"></div>':"")+'<div class="hui_window_titlebar">';e.icon&&(t+='<span class="hui_window_icon" style="background-image: url('+hui.ui.getIconUrl(e.icon,16)+')"></span>'),t+='<span class="hui_window_title">'+hui.ui.getTranslated(e.title)+'</span></div><div class="hui_window_body" style="'+(e.width?"width:"+e.width+"px;":"")+(e.height?"height:"+e.height+"px;":"")+(e.padding?"padding:"+e.padding+"px;":"")+'"></div></div>';var i="hui_window"+(e.variant?" hui_window_"+e.variant:"");return"dark"==e.variant&&(i+=" hui_context_dark"),e.element=hui.build("div",{class:i,html:t,parent:e.parent||document.body}),"dark"==e.variant&&hui.cls.add(e.element,"hui_context_dark"),new hui.ui.Window(e)},hui.ui.Window.prototype={_addBehavior:function(){var e=this;this.close&&(hui.listen(this.close,"click",function(e){this.hide(),this.fire("userClosedWindow"),this.fire("close")}.bind(this)),hui.listen(this.close,"mousedown",hui.stop)),hui.drag.register({touch:!0,window:this.element.ownerDocument.defaultView,element:this.titlebar,$before:this._onDragStart.bind(this),$startMove:this._onBeforeMove.bind(this),$move:this._onMove.bind(this),$endMove:this._onAfterMove.bind(this)}),hui.listen(this.element,"mousedown",function(){e.element.style.zIndex=hui.ui.nextPanelIndex()})},setTitle:function(e){hui.dom.setText(this.title,hui.ui.getTranslated(e))},_positionInView:function(){var e=hui.window.getScrollTop(),t=hui.position.getTop(this.element);(t<e||t+this.element.clientHeight>hui.window.getViewHeight()+e)&&hui.animate({node:this.element,css:{top:e+40+"px"},duration:500,ease:hui.ease.slowFastSlow})},show:function(e){if(this.visible)return this._positionInView(),void(this.element.style.zIndex=hui.ui.nextPanelIndex());e=e||{},hui.style.set(this.element,{zIndex:hui.ui.nextPanelIndex(),visibility:"hidden",display:"block"});var t=this.element.clientWidth;hui.style.set(this.element,{width:t+"px",visibility:"visible"}),e.avoid?hui.position.place({insideViewPort:!0,target:{element:e.avoid,vertical:.5,horizontal:1},source:{element:this.element,vertical:.5,horizontal:0}}):(this.element.style.top?this._positionInView():this.element.style.top=hui.window.getScrollTop()+40+"px",this.element.style.left||(this.element.style.left=Math.round((hui.window.getViewWidth()-t)/2)+"px")),hui.browser.opacity&&hui.animate(this.element,"opacity",1,0),this.visible=!0,hui.ui.callVisible(this)},toggle:function(e){this.visible?this.hide():this.show(e)},hide:function(){this.visible&&(hui.browser.opacity?hui.animate(this.element,"opacity",0,100,{$complete:function(){this.element.style.display="none",hui.ui.callVisible(this)}.bind(this)}):(this.element.style.display="none",hui.ui.callVisible(this)),this.visible=!1)},add:function(e){e.getElement?this.content.appendChild(e.getElement()):this.content.appendChild(e)},addToBack:function(e){this.back||(this.back=hui.build("div",{className:"hui_window_back"}),this.element.insertBefore(this.back,this.front),hui.effect.makeFlippable({container:this.element,front:this.front,back:this.back})),this.back.appendChild(hui.ui.getElement(e))},setVariant:function(e){hui.cls.remove(this.element,"hui_window_dark"),hui.cls.remove(this.element,"hui_window_light"),hui.cls.remove(this.element,"hui_window_news"),"dark"!=e&&"light"!=e&&"news"!=e||hui.cls.add(this.element,"hui_window_"+e),hui.cls.set(this.element,"hui_context_dark","dark"==e)},flip:function(){this.back&&(this.back.style.minHeight=this.element.clientHeight+"px",hui.effect.flip({element:this.element}))},setBusy:function(i){window.clearTimeout(this._busyTimer),!1!==i?this._busyTimer=window.setTimeout(function(){var e=this._busyCurtain;e||(e=this._busyCurtain=hui.build("div",{class:"hui_window_busy",parentFirst:this.content}),hui.browser.msie&&hui.cls.add(e,"hui_window_busy-legacy"));var t=hui.isString(i)?hui.string.escape(i):"";e.innerHTML='<span class="hui_window_busy_text">'+t+"</span>",e.style.display=""}.bind(this),300):this._busyCurtain&&(this._busyCurtain.style.display="none")},move:function(e){hui.style.set(this.element,{top:e.top+"px",left:e.left+"px"})},_onDragStart:function(e){this.element.style.zIndex=hui.ui.nextPanelIndex()},_onBeforeMove:function(e){e=hui.event(e);var t=hui.position.get(this.element);this.dragState={left:e.getLeft()-t.left,top:e.getTop()-t.top},this.element.style.right="auto",hui.cls.add(this.element,"hui_window_dragging")},_onMove:function(e){var t=e.getTop()-this.dragState.top,e=e.getLeft()-this.dragState.left;this.element.style.top=Math.max(t,0)+"px",this.element.style.left=Math.max(e,0)+"px"},_onAfterMove:function(){hui.ui.callDescendants(this,"$$parentMoved"),hui.cls.remove(this.element,"hui_window_dragging")}},hui.define&&hui.define("hui.Window",hui.Window),hui.ui.Form=function(e){this.options=e,hui.ui.extend(this,e),this.addBehavior(),e.listener&&this.listen(e.listener),e.listen&&this.listen(e.listen)},hui.ui.Form.create=function(e){var t={class:"hui_form"};return(e=e||{}).action&&(t.action=e.action),e.method&&(t.method=e.method),e.element=hui.build("form",t),new hui.ui.Form(e)},hui.ui.Form.prototype={addBehavior:function(){this.element.onsubmit=function(){return!1}},submit:function(){this.fire("submit")},getValues:function(){for(var e={},t=hui.ui.getDescendants(this),i=0;i<t.length;i++){var n=t[i];n.options&&n.options.key&&n.getValue?e[n.options.key]=n.getValue():n.getKey&&n.getKey()&&n.getValue?e[n.getKey()]=n.getValue():n.name&&n.getValue&&(e[n.name]=n.getValue())}return e},setValues:function(e){if(hui.isDefined(e))for(var t=hui.ui.getDescendants(this),i=0;i<t.length;i++){var n=(n=t[i]).getKey&&n.getKey()?n.getKey():n.options?n.options.key||n.options.name:void 0;n&&void 0!==e[n]&&t[i].setValue(e[n])}},focus:function(e){for(var t=hui.ui.getDescendants(this),i=0;i<t.length;i++)if(t[i].focus&&(!e||t[i].options&&t[i].options.key==e||t[i].name==e))return void t[i].focus()},reset:function(){for(var e=hui.ui.getDescendants(this),t=0;t<e.length;t++)e[t].reset&&e[t].reset()},add:function(e){this.element.appendChild(e.getElement())},createGroup:function(e){e=hui.ui.Form.Group.create(e);return this.add(e),e},buildGroup:function(e,t){var n=this.createGroup(e);return hui.each(t,function(e){var t,i;hui.ui.Form[e.type]?(t=hui.ui.Form[e.type].create(e.options),i=n.add(t,e.label)):hui.ui[e.type]&&(t=hui.ui[e.type].create(e.options),i=n.add(t,e.label)),e.extra?hui.each(e.extra,function(e){i.add(e)}):hui.log("buildGroup: Unable to find type: "+e.type)}),n},createButtons:function(e){e=hui.ui.Buttons.create(e);return this.add(e),e},childValueChanged:function(e){this.fire("valuesChanged",this.getValues())},show:function(){this.element.style.display=""},hide:function(){this.element.style.display="none"}},hui.ui.Form.Group=function(e){this.name=e.name,this.element=hui.get(e.element),this.tableMode="table"==this.element.nodeName.toLowerCase(),this.options=hui.override({above:!0,large:!1},e),hui.ui.extend(this)},hui.ui.Form.Group.create=function(e){var t;return(e=hui.override({above:!0},e)).above?t=hui.build("div",{class:"hui_form_fields hui_form_fields_above"}):(t=hui.build("table.hui_form_fields")).appendChild(hui.build("tbody")),e.element=t,new hui.ui.Form.Group(e)},hui.ui.Form.Group.prototype={add:function(e,t){if(this.tableMode){var i=hui.build("tr",{class:"hui_form_field"});hui.find("tbody",this.element).appendChild(i);var n,s=hui.build("td");return t&&(t=hui.ui.getTranslated(t),n=hui.build("th",{parent:i}),hui.build("label",{className:"hui_form_field_label",text:t,parent:n})),s.appendChild(e.getElement()),i.appendChild(s),new hui.ui.Form.Field({element:i})}i=hui.build("div.hui_form_field");return this.options.large&&hui.cls.add(i,"hui-large"),t&&(t=hui.ui.getTranslated(t),hui.build("label",{className:"hui_form_field_label",text:t,parent:i})),i.appendChild(e.getElement()),this.element.appendChild(i),new hui.ui.Form.Field({element:i})}},hui.ui.Form.Fields=hui.ui.Form.Group,hui.ui.Form.Field=function(e){this.name=e.name,this.element=hui.get(e.element),hui.ui.extend(this)},hui.ui.Form.Field.prototype={setVisible:function(e){this.element.style.display=e?"":"none"},add:function(e){this.element.appendChild(e.element)}},hui.ui.List=function(e){this.options=hui.override({url:null,source:null,selectable:!0,indent:null,selectMany:!1,rememberSelection:!1},e),this.element=hui.get(e.element),this.name=e.name,this.options.source&&this.options.source.listen(this),this.url=e.url,this.table=hui.get.firstByTag(this.element,"table"),this.head=hui.get.firstByTag(this.element,"thead"),this.body=hui.get.firstByTag(this.element,"tbody"),this.columns=[],this.rows=[],this.selected=[],this.checked=[],this.navigation=hui.get.firstByClass(this.element,"hui_list_navigation"),this.count=hui.get.firstByClass(this.navigation,"hui_list_count"),this.windowPage=hui.get.firstByClass(this.navigation,"window_page"),this.windowPageBody=hui.get.firstByClass(this.navigation,"window_page_body"),this.parameters={},this.sortKey=null,this.sortDirection=null,this.window={size:null,page:0,total:0},e.windowSize&&(this.window.size=e.windowSize),hui.ui.extend(this),e.dropFiles&&this._addDrop(),this._attach(),this.url&&this.refresh()},hui.ui.List.create=function(e){var t="hui_list";return(e=e||{}).variant&&(t+=" hui_list_"+e.variant),e.element=hui.build("div",{class:t,html:'<div class="hui_list_spinner"></div><div class="hui_list_navigation"><div class="hui_list_selection window_page"><div><div class="window_page_body"></div></div></div><span class="hui_list_count"></span></div><div class="hui_list_body"'+(0<e.maxHeight?' style="max-height: '+e.maxHeight+'px; overflow: auto;"':"")+'><table class="hui_list_table"><thead><tr></tr></thead><tbody></tbody></table></div>'}),new hui.ui.List(e)},hui.ui.List.prototype={_attach:function(){hui.on(this.element,"click",this._onClick.bind(this)),hui.on(this.element,"dblclick",this._onDblClick.bind(this))},_onClick:function(e){var t,i,n;this.busy||(t=(e=hui.event(e)).findByClass("hui_is_action"))&&(i=(i=t.getAttribute("data"))&&hui.string.fromJSON(i),n=null,(e=hui.closest("tr",t))&&(e=parseInt(e.getAttribute("data-index"),10),n=this.rows[e]),this.fire("clickIcon",{row:n,data:i,node:t}))},_onDblClick:function(e){this.busy||(!(e=hui.event(e)).closest(".hui_list_row")||e.closest(".hui_is_action")||(e=this.getFirstSelection())&&this.fire("open",e),hui.selection.clear())},_addDrop:function(){hui.drag.listen({element:this.element,hoverClass:"hui_list_drop",$dropFiles:function(e){this.fire("filesDropped",e)}.bind(this),$dropURL:function(e){this.fire("urlDropped",e)}.bind(this)})},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="block",this.refresh()},registerColumn:function(e){this.columns.push(e)},getSelection:function(){return 0<this.selected.length?this._getRowsByIndexes(this.selected):this._getRowsByIndexes(this.checked)},getFirstSelection:function(){var e=this.getSelection();return 0<e.length?e[0]:null},getSelectionSize:function(){return this.selected.length+this.checked.length},getSelectionIds:function(){for(var e=this.getSelection(),t=[],i=0;i<e.length;i++)t.push(e[i].id);return t},_getRowsByIndexes:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.rows[e[i]]);return t},getRows:function(){return this.rows},setParameter:function(e,t){this.parameters[e]=t},loadData:function(e){this.setUrl(e)},setSource:function(e){this.options.source!=e&&(this.options.source&&this.options.source.unListen(this),e.listen(this),(this.options.source=e).refresh())},setUrl:function(e){this.options.source&&(this.options.source.unListen(this),this.options.source=null),this.url=e,this.selected=[],this.checked=[],this.sortKey=null,this.sortDirection=null,this.resetState(),this.refresh()},clear:function(){this._empty(),this.options.source&&this.options.source.unListen(this),this.options.source=null,this.url=null},clearSelection:function(){this._changeSelection([])},_empty:function(){this.selected=[],this.checked=[],this.columns=[],this.rows=[],this.navigation.style.display="none",hui.dom.clear(this.body),hui.dom.clear(this.head)},resetState:function(){this.window={size:null,page:0,total:0},hui.ui.firePropertyChange(this,"window",this.window),hui.ui.firePropertyChange(this,"window.page",this.window.page)},valueForProperty:function(e){if("window.page"==e)return this.window.page;if("sort.key"==e)return this.sortKey;if("sort.direction"==e)return this.sortDirection||"ascending";if("selection.id"!=e)return this[e];e=this.getFirstSelection();return e?e.id:null},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$visibilityChanged:function(){this.options.source&&hui.dom.isVisible(this.element)&&this.options.source.refreshFirst()},refresh:function(){if(this.options.source)this.options.source.refreshLater();else if(this.url){var e,t=this.url;for(e in"number"==typeof this.window.page&&(t+=-1==t.indexOf("?")?"?":"&",t+="windowPage="+this.window.page),this.window.size&&(t+=-1==t.indexOf("?")?"?":"&",t+="windowSize="+this.window.size),this.sortKey&&(t+=-1==t.indexOf("?")?"?":"&",t+="sort="+this.sortKey),this.sortDirection&&(t+=-1==t.indexOf("?")?"?":"&",t+="direction="+this.sortDirection),this.parameters)t+=-1==t.indexOf("?")?"?":"&",t+=e+"="+this.parameters[e];this._setBusy(!0),hui.ui.request({url:t,$object:function(e){this._setBusy(!1),this.$objectsLoaded(e)}.bind(this),$xml:function(e){this._setBusy(!1),this.$listLoaded(e)}.bind(this)})}},sort:function(e){e=this.columns[e].key;e==this.sortKey?(this.sortDirection="ascending"==this.sortDirection?"descending":"ascending",hui.ui.firePropertyChange(this,"sort.direction",this.sortDirection)):hui.ui.firePropertyChange(this,"sort.key",e),this.sortKey=e},_clickHeader:function(e){e=(e=hui.event(e)).findByTag("th");this.sort(e.huiIndex)},$listLoaded:function(e){this._setError(!1);var t,i=0<this.selected.length||0<this.checked.length;this.options.rememberSelection&&(t=this.getSelectionIds()),this.selected=[],this.checked=[],this._parseWindow(e),this._buildNavigation(),hui.dom.clear(this.head),hui.dom.clear(this.body),this.rows=[],this.columns=[],this.checkboxMode="true"===e.documentElement.getAttribute("checkboxes");var n="true"===e.documentElement.getAttribute("ordering"),s=document.createElement("tr"),h=e.getElementsByTagName("sort");this.sortKey=null,this.sortDirection=null,0<h.length&&(this.sortKey=h[0].getAttribute("key"),this.sortDirection=h[0].getAttribute("direction")),this.checkboxMode&&(h=hui.build("th",{className:"list_check",parent:s}),hui.build("a",{className:"list_check_all",parent:h}),hui.listen(h,"click",this._checkAll.bind(this))),n&&hui.build("th",{class:"hui_list_order_header",parent:s});for(var u=e.getElementsByTagName("header"),o=0;o<u.length;o++){var a="",l=document.createElement("th"),r=u[o].getAttribute("width"),d=u[o].getAttribute("key"),c="true"==u[o].getAttribute("sortable");r&&""!==r&&(l.style.width=r+"%"),u[o].getAttribute("align")&&(l.style.textAlign=u[o].getAttribute("align")),c&&(l.huiIndex=o,hui.on(l,"click",this._clickHeader,this),a+="sortable"),this.sortKey&&d==this.sortKey&&(a+=" sort_"+this.sortDirection),l.className=a;a=document.createElement("span");l.appendChild(a),a.appendChild(document.createTextNode(u[o].getAttribute("title")||"")),s.appendChild(l),this.columns.push({key:d,sortable:c,width:r})}this.head.appendChild(s);var p=document.createDocumentFragment(),m=e.getElementsByTagName("row");for(o=0;o<m.length;o++){var f,g=m[o].getElementsByTagName("cell"),v=document.createElement("tr");v.className="hui_list_row",v.setAttribute("data-index",o),this.checkboxMode&&(f=hui.build("td",{parent:v,className:"hui_list_checkbox"}),hui.build("a",{className:"hui_list_checkbox",parent:f})),n&&(f=hui.build("td",{parent:v,className:"hui_list_order"}),hui.build("a",{className:"hui_list_order_handler",parent:f}));for(var b=m[o].getAttribute("icon"),_=m[o].getAttribute("title"),y=m[o].getAttribute("level"),w=0;w<g.length;w++)f=document.createElement("td"),"false"==g[w].getAttribute("wrap")&&(f.style.whiteSpace="nowrap"),g[w].getAttribute("vertical-align")&&(f.style.verticalAlign=g[w].getAttribute("vertical-align")),g[w].getAttribute("width")&&(f.style.width=g[w].getAttribute("width")+"%"),g[w].getAttribute("align")&&(f.style.textAlign=g[w].getAttribute("align")),g[w].getAttribute("class")&&hui.cls.add(f,g[w].getAttribute("class")),"true"==g[w].getAttribute("dimmed")&&(f.className="hui_list_dimmed"),0===w&&1<y?f.style.paddingLeft=16*(parseInt(y)-1)+5+"px":0===w&&this.options.indent&&(f.style.paddingLeft=this.options.indent+"px"),this._parseCell(g[w],f),v.appendChild(f),_=_||hui.dom.getText(g[w]),b=b||g[w].getAttribute("icon");var x={id:m[o].getAttribute("id"),kind:m[o].getAttribute("kind"),icon:b,title:_,index:o,data:this._getData(m[o])};v.dragDropInfo=x,this._addRowBehavior(v,o),p.appendChild(v),this.rows.push(x)}this.body.appendChild(p),this._setEmpty(0===m.length),this.options.rememberSelection?this._applyPreviousSelection(t):(this.fire("selectionReset"),i&&this.fire("select",null)),this.fireSizeChange()},_applyPreviousSelection:function(e){for(var t=[],i=0;i<e.length;i++)for(var n=0;n<this.rows.length;n++)this.rows[n].id===e[i]&&t.push(n);this._changeSelection(t)},_parseCell:function(e,t){var i=e.getAttribute("variant");i&&(t=hui.build("div",{parent:t,className:"hui_list_cell_"+i}));i=e.getAttribute("icon");i&&(t.appendChild(hui.ui.createIcon(i,16)),t=hui.build("div",{parent:t,style:"margin-left: 21px; padding-top: 1px;"}));for(var n=0;n<e.childNodes.length;n++){var s=e.childNodes[n];if(hui.dom.isDefinedText(s))hui.dom.addText(t,s.nodeValue);else if(hui.dom.isElement(s,"break"))t.appendChild(document.createElement("br"));else if(hui.dom.isElement(s,"icon")){var h=s.getAttribute("size")||16,u=hui.ui.createIcon(s.getAttribute("icon"),h);hui.cls.add(u,"hui_list_icon"),s.getAttribute("hint")&&u.setAttribute("title",s.getAttribute("hint")),"true"==s.getAttribute("action")&&hui.cls.add(u,"hui_is_action");h=s.getAttribute("data");h&&u.setAttribute("data",h),"true"===s.getAttribute("revealing")&&hui.cls.add(u,"hui_list_revealing"),t.appendChild(u)}else if(hui.dom.isElement(s,"symbol")){u=hui.build("span",{class:"hui_symbol hui_list_symbol hui_symbol-"+s.getAttribute("name"),parent:t});"true"==s.getAttribute("action")&&hui.cls.add(u,"hui_is_action")}else if(hui.dom.isElement(s,"line")){var o=hui.build("p",{class:"hui_list_line"});"true"==s.getAttribute("dimmed")&&hui.cls.add(o,"hui_list_dimmed"),"true"==s.getAttribute("minor")&&hui.cls.add(o,"hui_list_minor"),"true"==s.getAttribute("mini")&&hui.cls.add(o,"hui_list_mini"),s.getAttribute("class")&&hui.cls.add(o,s.getAttribute("class")),s.getAttribute("top")&&(o.style.paddingTop=s.getAttribute("top")+"px"),t.appendChild(o),this._parseCell(s,o)}else if(hui.dom.isElement(s,"object")){o=hui.build("div",{class:"hui_list_object"});s.getAttribute("icon")&&o.appendChild(hui.ui.createIcon(s.getAttribute("icon"),16)),s.firstChild&&3===s.firstChild.nodeType&&0<s.firstChild.nodeValue.length&&hui.dom.addText(o,s.firstChild.nodeValue),t.appendChild(o)}else if(hui.dom.isElement(s,"icons")){var a=hui.build("span",{class:"hui_list_icons"});s.getAttribute("left")&&(a.style.marginLeft=s.getAttribute("left")+"px"),this._parseCell(s,a),t.appendChild(a)}else if(hui.dom.isElement(s,"button")){var l=hui.ui.Button.create({text:s.getAttribute("text"),small:!0,rounded:!0,data:this._getData(s)});l.click(this._buttonClick.bind(this)),t.appendChild(l.getElement())}else if(hui.dom.isElement(s,"wrap"))hui.browser.wordbreak?(hui.cls.add(t,"hui_list_wrap"),hui.dom.addText(t,hui.dom.getText(s))):hui.dom.addText(t,this._wrap(hui.dom.getText(s)));else if(hui.dom.isElement(s,"delete"))this._parseCell(s,hui.build("del",{parent:t}));else if(hui.dom.isElement(s,"strong"))this._parseCell(s,hui.build("strong",{parent:t}));else if(hui.dom.isElement(s,"badge"))this._parseCell(s,hui.build("span",{className:"hui_list_badge",parent:t}));else if(hui.dom.isElement(s,"progress")){a=hui.build("span",{className:"hui_list_progress",parent:t}),l=Math.round(100*parseFloat(s.getAttribute("value")));hui.build("span",{style:{width:l+"%"},parent:a}),this._parseCell(s,a)}else if(hui.dom.isElement(s,"html"))for(var r=0;r<s.childNodes.length;r++){var d=s.childNodes[r].cloneNode(!0);d.namespaceURI=s.namespaceURI,t.appendChild(d)}}},$objectsLoaded:function(e){var t=0<this.selected.length||0<this.checked.length;this._setError(!1),null==e||(e.constructor==Array?this.setObjects(e):this.setData(e)),this.fire("selectionReset"),t&&this.fire("select"),this.fireSizeChange()},$sourceIsBusy:function(){this._setBusy(!0)},$sourceIsNotBusy:function(){this._setBusy(!1)},$sourceFailed:function(){hui.log("The source failed!"),this._setError(!0)},_setError:function(e){hui.cls.set(this.element,"hui_list_error",e)},_setBusy:function(e){var t;this.busy=e,window.clearTimeout(this.busytimer),e?(t=this.element,this.busytimer=window.setTimeout(function(){hui.cls.add(t,"hui_list_busy"),"hui_overflow"==t.parentNode.className&&hui.cls.add(t,"hui_list_busy_large")},300)):(hui.cls.remove(this.element,"hui_list_busy"),"hui_overflow"==this.element.parentNode.className&&hui.cls.remove(this.element,"hui_list_busy_large"))},_setEmpty:function(e){var t=hui.get.firstByClass(this.element,"hui_list_empty");t&&(t.style.display=e?"block":"")},_wrap:function(e){for(var t="",i=0,n=0;n<e.length;n++)" "===e[n]||"-"===e[n]?i=0:i++,t+=e[n],10<i&&(t+="â€‹",i=0);return t},_getData:function(e){e=e.getAttribute("data");return e?hui.string.fromJSON(e):null},_buttonClick:function(e){var t=hui.closest("tr",e.getElement()),t=this.rows[parseInt(t.getAttribute("data-index"),10)];this.fire("clickButton",{row:t,button:e})},_parseWindow:function(e){var e=e.getElementsByTagName("window");0<e.length?(e=e[0],this.window.total=parseInt(e.getAttribute("total")),this.window.size=parseInt(e.getAttribute("size")),this.window.page=parseInt(e.getAttribute("page"))):(this.window.total=0,this.window.size=0,this.window.page=0)},_buildNavigation:function(){var e=0<this.window.size?Math.ceil(this.window.total/this.window.size):0;if(e<2)this.navigation.style.display="none";else{this.navigation.style.display="block";var t=this.window.page*this.window.size+1;hui.dom.setText(this.count,t+"-"+Math.min((this.window.page+1)*this.window.size,this.window.total)+" / "+this.window.total);var i=this.windowPageBody;if(i.innerHTML="",e<2)this.windowPage.style.display="none";else{for(var n=this._buildPages(e,this.window.page),s=0;s<n.length;s++){var h,u=n[s];""===u?i.appendChild(hui.build("span",{text:"Â·"})):((h=document.createElement("a")).appendChild(document.createTextNode(u+1)),h.setAttribute("data-index",u),hui.on(h,"mousedown",this._onPageClick,this),u==this.window.page&&(h.className="hui_list_selected"),i.appendChild(h))}this.windowPage.style.display="block"}}},_buildPages:function(e,t){for(var i=[],n=!1,s=0;s<e;s++)n=s<1||e-2<s||Math.abs(t-s)<5?(i.push(s),!1):(n||i.push(""),!0);return i},setData:function(e){this.selected=[],this.checked=[];var t=e.window||{};this.window.total=t.total||0,this.window.size=t.size||0,this.window.page=t.page||0,this._buildNavigation(),this._buildHeaders(e.headers),this._buildRows(e.rows),this._setEmpty(!e.rows||0===e.rows.length)},_buildHeaders:function(e){hui.dom.clear(this.head),this.columns=[];var n=hui.build("tr",{parent:this.head});hui.each(e,function(e,t){var i=hui.build("th");e.width&&(i.style.width=e.width+"%"),e.sortable&&(hui.listen(i,"click",function(){this.sort(t)}.bind(this)),hui.cls.add(i,"sortable")),i.appendChild(hui.build("span",{text:e.title})),n.appendChild(i),this.columns.push(e)}.bind(this))},_buildRows:function(e){var u=this;hui.dom.clear(this.body),this.rows=[],e&&hui.each(e,function(e,t){var i=hui.build("tr.hui_list_row"),n=e.icon,s=e.title;hui.each(e.cells,function(e){var t=hui.build("td");e.icon&&(t.appendChild(hui.ui.createIcon(e.icon,16)),n=n||e.icon),e.text&&(t.appendChild(document.createTextNode(e.text)),s=s||e.text),i.appendChild(t)}),u.body.appendChild(i);var h={id:e.id,kind:e.kind,icon:n,title:s,index:t};i.dragDropInfo=h,u.rows.push({id:e.id,kind:e.kind,icon:n,title:s,index:t,data:e.data}),this._addRowBehavior(i,t)}.bind(this))},setObjects:function(e){e=e||[],this.selected=[],this.checked=[],hui.dom.clear(this.body),this.rows=[];for(var t=0;t<e.length;t++){for(var i=hui.build("tr.hui_list_row"),n=e[t],s=null,h=0;h<this.columns.length;h++){var u=hui.build("td");if(this.builder)u.appendChild(this.builder.buildColumn(this.columns[h],n));else{var o=n[this.columns[h].key]||"";if(hui.isArray(o))for(var a=0;a<o.length;a++)o[a].constructor==Object?u.appendChild(this._createObject(o[a])):u.appendChild(hui.build("div",{text:o}));else o.constructor==Object?u.appendChild(this._createObject(o[h])):(hui.dom.addText(u,o),s=null===s?o:s)}i.appendChild(u)}var l={id:n.id,kind:n.kind,title:s};i.dragDropInfo=l,this.body.appendChild(i),this._addRowBehavior(i,t),this.rows.push(n)}},_createObject:function(e){var t=hui.build("div",{class:"hui_list_object"});return e.icon&&t.appendChild(hui.ui.createIcon(e.icon,16)),hui.dom.addText(t,e.text||e.name||""),t},_addRowBehavior:function(i,n){var s=this;i.onmousedown=function(e){if(!s.busy){var t=hui.event(e);if(!t.findByClass("hui_list_icon_action")){if(!t.findByClass("hui_list_checkbox"))return s._onRowDown(n,t),hui.ui.startDrag&&hui.ui.startDrag(e,i),!1;s._toggleChecked(n)}}}},_checkAll:function(){for(var e=0;e<this.rows.length;e++)hui.array.flip(this.checked,e);this._drawChecks(),this._changeSelection([])},_toggleChecked:function(e){hui.array.flip(this.checked,e),this._drawChecks(),this._changeSelection([])},_drawChecks:function(){for(var e=this.body.getElementsByTagName("tr"),t=0;t<e.length;t++)hui.cls.set(e[t],"hui_list_checked",hui.array.contains(this.checked,t))},_clearChecked:function(){this.checked=[],this._drawChecks(),this.fire("checkedReset")},_changeSelection:function(e){for(var t=this.body.getElementsByTagName("tr"),i=0;i<this.selected.length;i++)hui.cls.remove(t[this.selected[i]],"hui_list_selected");for(i=0;i<e.length;i++)hui.cls.add(t[e[i]],"hui_list_selected");0<(this.selected=e).length?(this.fire("select",this.rows[e[0]]),hui.ui.firePropertyChange(this,"selection.id",this.rows[e[0]].id),this._clearChecked()):this.fire("select")},_onRowDown:function(e,t){this.options.selectable&&(this.checked=[],t.metaKey&&this.options.selectMany?(t=this.selected.slice(0),hui.array.flip(t,e),this._changeSelection(t)):this._changeSelection([e]))},_onPageClick:function(e){var t=hui.event(e).getElement(),e=parseInt(t.getAttribute("data-index"));this.window.page=e,hui.ui.firePropertyChange(this,"window",this.window),hui.ui.firePropertyChange(this,"window.page",this.window.page);for(var i=this.windowPageBody.getElementsByTagName("a"),n=i.length-1;0<=n;n--)i[n].className=i[n]==t?"hui_list_selected":""}},hui.ui.Tabs=function(e){this.name=(e=e||{}).name,this.element=hui.get(e.element),this.activeTab=-1;hui.get.firstByClass(this.element,"hui_tabs_bar");this.bar=hui.find(".hui_tabs_bar",this.element),this.tabs=hui.findAll(".hui_tabs_tab",this.element),this.contents=hui.findAll(".hui_tabs_body",this.element),this._attach(),hui.ui.extend(this)},hui.ui.Tabs.create=function(e){var t=(e=e||{}).element=hui.build("div",{class:"hui_tabs"});e.small&&hui.cls.add(t,"hui_tabs-small");t=hui.build("div",{class:"hui_tabs_bar",parent:t});return e.centered&&hui.cls.add(t,"hui_tabs_bar-centered"),new hui.ui.Tabs(e)},hui.ui.Tabs.prototype={_attach:function(){for(var e=0;e<this.tabs.length;e++)this._attachTab(this.tabs[e],e)},_attachTab:function(e,t){hui.listen(e,"click",function(){this._clickTab(t)}.bind(this))},_clickTab:function(e){this.activeTab=e,this._update(),hui.ui.callVisible(this)},_update:function(){for(var e=0;e<this.tabs.length;e++)hui.cls.set(this.tabs[e],"hui-is-selected",e==this.activeTab),hui.cls.set(this.contents[e],"hui-is-selected",e==this.activeTab)},createTab:function(e){e=e||{};var t=hui.build("a.hui_tabs_tab",{text:e.title,parent:this.bar});this._attachTab(t,this.tabs.length),this.tabs.push(t);var i=e.element=hui.build("div",{class:"hui_tabs_body"});return 0<e.padding&&(i.style.padding=e.padding+"px"),this.contents.push(i),this.element.appendChild(i),-1==this.activeTab&&(this.activeTab=0,hui.cls.add(t,"hui-is-selected"),hui.cls.add(i,"hui-is-selected")),new hui.ui.Tab(e)}},hui.ui.Tab=function(e){this.name=e.name,this.element=hui.get(e.element)},hui.ui.Tab.prototype={add:function(e){e.getElement?this.element.appendChild(e.getElement()):this.element.appendChild(e)}},hui.ui.ObjectList=function(e){this.options=hui.override({key:null},e),this.name=e.name,this.element=hui.get(e.element),this.body=hui.get.firstByTag(this.element,"tbody"),this.template=[],this.objects=[],hui.ui.extend(this)},hui.ui.ObjectList.create=function(e){var t=(e=e||{}).element=hui.build("table",{class:"hui_objectlist",cellpadding:"0",cellspacing:"0"});if(e.template){for(var i="<thead><tr>",n=0;n<e.template.length;n++)i+="<th>"+(e.template[n].label||"")+"</th>";t.innerHTML=i+="</tr></thead>"}hui.build("tbody",{parent:t});var s=new hui.ui.ObjectList(e);return e.template&&hui.each(e.template,function(e){s.registerTemplateItem(new hui.ui.ObjectList.Text(e.key))}),s},hui.ui.ObjectList.prototype={ignite:function(){this.addObject({})},addObject:function(e,t){var i;0===this.objects.length||t?(i=new hui.ui.ObjectList.Object(this.objects.length,e,this),this.objects.push(i),this.body.appendChild(i.getElement())):(t=this.objects[this.objects.length-1],hui.array.remove(this.objects,t),i=new hui.ui.ObjectList.Object(t.index,e,this),t.index++,this.objects.push(i),this.objects.push(t),this.body.insertBefore(i.getElement(),t.getElement()))},reset:function(){for(var e=0;e<this.objects.length;e++){var t=this.objects[e].getElement();t.parentNode?t.parentNode.removeChild(t):(hui.log("no parent for..."),hui.log(t))}this.objects=[],this.addObject({})},addObjects:function(e){for(var t=0;t<e.length;t++)this.addObject(e[t])},setObjects:function(e){this.reset(),this.addObjects(e)},getObjects:function(e){for(var t=[],i=0;i<this.objects.length-1;i++)t.push(this.objects[i].getData());return t},getValue:function(){return this.getObjects()},setValue:function(e){this.setObjects(e)},registerTemplateItem:function(e){this.template.push(e)},objectDidChange:function(e){e.index>=this.objects.length-1&&this.addObject({},!0)}},hui.ui.ObjectList.Object=function(e,t,i){this.data=t,this.index=e,this.list=i,this.fields=[]},hui.ui.ObjectList.Object.prototype={getElement:function(){if(!this.element){this.element=document.createElement("tr");for(var e=0;e<this.list.template.length;e++){var t=this.list.template[e],i=t.clone();(i.object=this).fields.push(i);var n=document.createElement("td");0===e&&(n.className="first"),n.appendChild(i.getElement()),i.setValue(this.data[t.key]),this.element.appendChild(n)}}return this.element},valueDidChange:function(){this.list.objectDidChange(this)},getData:function(){for(var e=this.data,t=0;t<this.fields.length;t++)e[this.fields[t].key]=this.fields[t].getValue();return e}},hui.ui.ObjectList.Text=function(e){this.key=e,this.value=null},hui.ui.ObjectList.Text.prototype={clone:function(){return new hui.ui.ObjectList.Text(this.key)},getElement:function(){var e=hui.build("input",{class:"hui_textinput"});return this.wrapper=new hui.ui.Input({element:e}),this.wrapper.listen(this),e},$valueChanged:function(e){this.value=e,this.object.valueDidChange()},getValue:function(){return this.value},setValue:function(e){this.value=e,this.wrapper.setValue(e)}},hui.ui.ObjectList.Select=function(e){this.key=e,this.value=null,this.options=[]},hui.ui.ObjectList.Select.prototype={clone:function(){var e=new hui.ui.ObjectList.Select(this.key);return e.options=this.options,e},getElement:function(){this.select=hui.build("select");for(var e=0;e<this.options.length;e++)this.select.options[this.select.options.length]=new Option(this.options[e].label,this.options[e].value);var t=this;return this.select.onchange=function(){t.object.valueDidChange()},this.select},getValue:function(){return this.select.value},setValue:function(e){this.select.value=e},addOption:function(e,t){this.options.push({value:e,label:t})}},hui.ui.DropDown=function(e){this.options=hui.override({placeholder:null,url:null,source:null,focus:!1},e),this.name=e.name;this.element=hui.get(e.element);this.items=e.items||[],this.index=-1,this.value=hui.isDefined(this.options.value)?this.options.value:null,this.dirty=!0,this.busy=!1,hui.ui.extend(this),e.listener&&this.listen(e.listener),this._attach(),this._updateIndex(),this._updateUI(),this.options.url?this.options.source=new hui.ui.Source({url:this.options.url,delegate:this}):this.options.source&&this.options.source.listen(this)},hui.ui.DropDown.create=function(e){var t="hui_dropdown";(e=e||{}).variant&&(t+=" hui_dropdown-"+e.variant),e.element=hui.build("a",{class:t,href:"#",html:'<span class="hui_dropdown_text"></span>'});t=new hui.ui.DropDown(e);return e.items&&t.setItems(e.items),t},hui.ui.DropDown.prototype={nodes:{text:".hui_dropdown_text"},_attach:function(){hui.listen(this.element,"click",this._click.bind(this)),hui.listen(this.element,"blur",this._hideSelector.bind(this)),hui.listen(this.element,"keydown",this._keyDown.bind(this)),this.options.focus||hui.listen(this.element,"mousedown",function(e){hui.stop(e)})},_updateIndex:function(){this.index=-1;for(var e=0;e<this.items.length;e++)this.items[e].value==this.value&&(this.index=e)},_updateUI:function(){var e=this.items[this.index];if(this.nodes.text.innerHTML="",e?(e=e.label||e.title||e.text||"",hui.dom.addText(this.nodes.text,e)):this.options.placeholder&&this.nodes.text.appendChild(hui.build("span",{class:"hui_dropdown_placeholder",text:hui.string.escape(this.options.placeholder)})),this.selector)for(var t=hui.findAll(".hui_dropdown_option",this.selector),i=0;i<t.length;i++)hui.cls.set(t[i],"hui_selected",this.index==i)},_click:function(e){this.busy||(hui.stop(e),this._selectorVisible?this._hideSelector():(this._showSelector(),this._hider=function(e){(e=hui.event(e)).isDescendantOf(this.element)||this._hideSelector()}.bind(this),hui.listen(document.body,"mousedown",this._hider)))},_showSelector:function(){this._buildSelector();var e,t,i,n=this.element,s=this.selector;this.options.focus&&n.focus(),this.items&&((i=hui.window.getViewHeight())<200?(e=hui.position.getLeft(this.element),hui.style.set(this.selector,{left:e+"px",top:"5px"})):(e=hui.window.getScrollTop(),t=hui.position.getScrollOffset(this.element).top,hui.position.place({target:{element:this.element,vertical:1,horizontal:0},source:{element:this.selector,vertical:0,horizontal:0},top:e-t})),hui.style.set(s,{visibility:"hidden",display:"block",width:""}),t=Math.min(i-hui.position.getTop(s)-5,200),i=Math.max(n.clientWidth-5,100,s.clientWidth+20),n=hui.window.getViewWidth()-hui.position.getLeft(n)-20,i=Math.min(i,n),hui.style.set(s,{visibility:"visible",width:i+"px",zIndex:hui.ui.nextTopIndex(),maxHeight:t+"px"}),this._selectorVisible=!0)},_hideSelector:function(){hui.unListen(document.body,"mousedown",this._hider),this.selector&&(this.selector.style.display="none",this._selectorVisible=!1)},_keyDown:function(e){this.busy||0!==this.items.length&&(40==e.keyCode?(hui.stop(e),this.index>=this.items.length-1?this.value=this.items[0].value:this.value=this.items[this.index+1].value,this._updateIndex(),this._updateUI(),this._fireChange()):38==e.keyCode&&(hui.stop(e),0<this.index?this.index--:this.index=this.items.length-1,this.value=this.items[this.index].value,this._updateUI(),this._fireChange()))},selectFirst:function(){0<this.items.length&&this.setValue(this.items[0].value)},getValue:function(){return this.value},setValue:function(e){this.value=e,this._updateIndex(),this._updateUI()},reset:function(){this.setValue(null)},refresh:function(){this.options.source&&this.options.source.refresh()},stress:function(){hui.ui.stress(this)},focus:function(){try{this.element.focus()}catch(e){}},getItem:function(){return 0<=this.index?this.items[this.index]:0},addItem:function(e){this.items.push(e),this.dirty=!0,this._updateIndex(),this._updateUI()},setItems:function(e){this.items=e,this.dirty=!0,this.index=-1,this._updateIndex(),this._updateUI()},$optionsLoaded:function(e){this.setItems(e)},$sourceIsBusy:function(){this.busy=!0,hui.style.setOpacity(this.element,.5)},$sourceIsNotBusy:function(){this.busy=!1,hui.style.setOpacity(this.element,1)},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$visibilityChanged:function(){hui.dom.isVisible(this.element)?this.options.source&&this.options.source.refreshFirst():this._hideSelector()},_buildSelector:function(){var n;this.dirty&&this.items&&(this.selector?this.selector.innerHTML="":(this.selector=hui.build("div",{class:"hui_dropdown_options"}),document.body.appendChild(this.selector),hui.listen(this.selector,"mousedown",function(e){hui.stop(e)})),n=this,hui.each(this.items,function(t,i){var e=hui.build("span",{class:"hui_dropdown_option",text:t.label||t.title||t.text||""});hui.listen(e,"mousedown",function(e){hui.stop(e),n._itemClicked(t,i),hui.listenOnce(document.body,"mouseup",function(e){hui.stop(e)})}),i==n.index&&hui.cls.add(e,"hui_selected"),n.selector.appendChild(e)}),this.dirty=!1)},_itemClicked:function(e,t){this.index=t;var i=this.value!=this.items[t].value;this.value=this.items[t].value,this._updateUI(),this._hideSelector(),i&&this._fireChange()},_fireChange:function(){hui.ui.callAncestors(this,"childValueChanged",this.value),this.fire("valueChanged",this.value),hui.ui.firePropertyChange(this,"value",this.value)},detach:function(){this.selector&&hui.dom.remove(this.selector)}},hui.ui.Alert=function(e){this.options=hui.override({modal:!1},e),this.element=hui.get(e.element),this.name=e.name,this.body=hui.get.firstByClass(this.element,"hui_alert_body"),this.content=hui.get.firstByClass(this.element,"hui_alert_content"),this.emotion=this.options.emotion,this.title=hui.get.firstByTag(this.element,"h1"),hui.ui.extend(this)},hui.ui.Alert.create=function(e){var t=(e=hui.override({text:"",emotion:null,title:null},e)).element=hui.build("div",{class:"hui_alert"}),i=hui.build("div",{class:"hui_alert_body",parent:t});hui.build("div",{class:"hui_alert_content",parent:i}),document.body.appendChild(t);t=new hui.ui.Alert(e);return e.emotion&&t.setEmotion(e.emotion),e.title&&t.setTitle(e.title),e.text&&t.setText(e.text),t},hui.ui.Alert.prototype={show:function(){var e=hui.ui.nextAlertIndex();this.options.modal&&(hui.ui.showCurtain({widget:this,zIndex:e}),e++),this.element.style.zIndex=e,this.element.style.transform="scale(0.5)",this.element.style.display="block",this.element.style.top=hui.window.getScrollTop()+100+"px",hui.animate(this.element,"opacity",1,200),hui.animate(this.element,"transform","scale(1)",600,{ease:hui.ease.elastic})},hide:function(){hui.animate(this.element,"opacity",0,100,{hideOnComplete:!0}),hui.animate(this.element,"margin-top","0px",100),hui.ui.hideCurtain(this)},setTitle:function(e){this.title||(this.title=hui.build("h1",{parent:this.content})),hui.dom.setText(this.title,hui.ui.getTranslated(e))},setText:function(e){this.text||(this.text=hui.build("p",{parent:this.content})),hui.dom.setText(this.text,hui.ui.getTranslated(e))},setEmotion:function(e){this.emotion&&hui.cls.remove(this.body,this.emotion),this.emotion=e,hui.cls.add(this.body,e)},update:function(e){this.setTitle((e=e||{}).title||null),this.setText(e.text||null),this.setEmotion(e.emotion||null)},addButton:function(e){this.buttons||(this.buttons=hui.ui.Buttons.create({align:"right"}),this.body.appendChild(this.buttons.element)),this.buttons.add(e)}},hui.ui.Alert.confirm=function(e){e.name||(e.name="huiConfirm");var t,i,n=hui.ui.get(e.name);n?(n.update(e),(t=hui.ui.get(name+"_ok")).setText(e.ok||"OK"),t.setHighlighted("ok"==e.highlighted),t.clearListeners(),hui.ui.get(name+"_cancel").setText(e.ok||"Cancel"),hui.ui.get(name+"_cancel").setHighlighted("cancel"==e.highlighted),e.cancel&&hui.ui.get(name+"_cancel").setText(e.cancel)):(n=hui.ui.Alert.create(e),(i=hui.ui.Button.create({name:name+"_cancel",text:e.cancel||"Cancel",highlighted:"cancel"===e.highlighted})).listen({$click:function(){n.hide(),e.onCancel&&e.onCancel(),hui.ui.callDelegates(n,"cancel")}}),n.addButton(i),t=hui.ui.Button.create({name:name+"_ok",text:e.ok||"OK",highlighted:"ok"===e.highlighted}),n.addButton(t)),t.listen({$click:function(){n.hide(),e.onOK&&e.onOK(),hui.ui.callDelegates(n,"ok")}}),n.show()},hui.ui.Alert.alert=function(e){this.alertBox?this.alertBox.update(e):(this.alertBox=hui.ui.Alert.create(e),this.alertBoxButton=hui.ui.Button.create({name:"huiAlertBoxButton",text:"OK"}),this.alertBoxButton.listen({$click$huiAlertBoxButton:function(){hui.ui.Alert.alertBox.hide(),e.onOK&&e.onOK()}}),this.alertBox.addButton(this.alertBoxButton)),this.alertBoxButton.setText(e.button||"OK"),this.alertBox.show()},hui=window.hui||{},hui.ui=hui.ui||{},hui.ui.Button=function(e){this.options=e,this.name=e.name,this.element=hui.get(e.element),this.enabled=!hui.cls.has(this.element,"hui_button_disabled"),hui.ui.extend(this),this._attach(),e.listener&&this.listen(e.listener),e.listen&&this.listen(e.listen)},hui.ui.Button.create=function(e){var t="hui_button";(e=hui.override({text:"",highlighted:!1,enabled:!0},e)).variant&&(t+=" hui-"+e.variant),e.small&&(t+=" hui-small"),e.mini&&(t+=" hui-mini"),e.tiny&&(t+=" hui-tiny"),e.large&&(t+=" hui-large"),e.highlighted&&(t+=" hui-highlighted"),e.enabled||(t+=" hui-disabled");var i=e.text?hui.ui.getTranslated(e.text):null;e.title&&(i=hui.ui.getTranslated(e.title));var n=e.element=hui.build("a",{class:t,href:"#"});return e.testName&&n.setAttribute("data-test",e.testName),e.icon&&(t=hui.build("span",{parent:n,class:"hui_button_icon",style:"background-image:url("+hui.ui.getIconUrl(e.icon,16)+")"}),i||hui.cls.add(t,"hui_button_icon_notext")),i&&hui.dom.addText(n,i),new hui.ui.Button(e)},hui.ui.Button.prototype={_attach:function(){var t=this;hui.listen(this.element,"mousedown",function(e){hui.stop(e)}),hui.listen(this.element,"click",function(e){hui.stop(e),t._onClick(e)})},_onClick:function(e){var t;this.enabled?(t=!1,e&&(t=hui.event(e).altKey),this.options.confirm&&!t?hui.ui.confirmOverlay({widget:this,text:this.options.confirm.text,okText:this.options.confirm.okText,cancelText:this.options.confirm.cancelText,onOk:this._fireClick.bind(this)}):this._fireClick()):this.element.blur()},_fireClick:function(){var e;this.fire("click",this),this.options.submit&&((e=hui.ui.getAncestor(this,"hui_form"))?e.submit():hui.log("No form found to submit"))},click:function(e){if(e)return this.listen({$click:e}),this;this._onClick()},focus:function(){this.element.focus()},onClick:function(e){this.listen({$click:e})},setEnabled:function(e){this.enabled=e,this._updateUI()},enable:function(){this.setEnabled(!0)},disable:function(){this.setEnabled(!1)},setHighlighted:function(e){hui.cls.set(this.element,"hui-highlighted",e)},_updateUI:function(){hui.cls.set(this.element,"hui-disabled",!this.enabled)},setText:function(e){hui.dom.setText(this.element,hui.ui.getTranslated(e))},getData:function(){return this.options.data},getRole:function(){return this.options.role}},hui.ui.Buttons=function(e){this.name=e.name,this.element=hui.get(e.element),hui.ui.extend(this)},hui.ui.Buttons.create=function(e){var t=(e=hui.override({top:0},e)).element=hui.build("div",{class:"hui_buttons"});return"right"===e.align&&hui.cls.add(t,"hui_buttons-right"),"center"===e.align&&hui.cls.add(t,"hui_buttons-center"),0<e.top&&(t.style.paddingTop=e.top+"px"),new hui.ui.Buttons(e)},hui.ui.Buttons.prototype={add:function(e){return this.element.appendChild(e.element),this}},hui.on(["hui.ui"],function(){hui.define("hui.ui.Button",hui.ui.Button)}),hui.ui.Selection=function(e){if(this.options=hui.override({value:null},e),this.element=hui.get(e.element),this.name=e.name,this.items=[],this.subItems=[],this.busy=0,this.selection=null,e.items&&0<e.items.length){for(var t=0;t<e.items.length;t++){var i=e.items[t];this.items.push(i);var n=hui.get(i.id);i.element=n,this.addItemBehavior(n,i)}this.selection=this._getSelectionWithValue(this.options.value),this._updateUI()}else null!==this.options.value&&(this.selection={value:this.options.value});hui.ui.extend(this)},hui.ui.Selection.create=function(e){var t=(e=hui.override({width:0},e)).element=hui.build("div",{class:"hui_selection"});return 0<e.width&&(t.style.width=e.width+"px"),new hui.ui.Selection(e)},hui.ui.Selection.prototype={getValue:function(){return this.selection},valueForProperty:function(e){return"value"===e?this.selection?this.selection.value:null:"kind"===e?this.selection?this.selection.kind:null:void 0},setValue:function(e){e=this._getSelectionWithValue(e);null===e?this.selection=null:(this.selection=e,this.kind=e.kind),this._updateUI(),this.fireChange()},_getSelectionWithValue:function(e){for(var t=0;t<this.items.length;t++)if(this.items[t].value==e)return this.items[t];for(t=0;t<this.subItems.length;t++)for(var i=this.subItems[t].items,n=0;n<i.length;n++)if(i[n].value==e)return i[n];return null},selectFirst:function(){var e=0;if(e<this.items.length)this.changeSelection(this.items[e]);else for(e=0;e<this.subItems.length;e++){var t=this.subItems[e].items,i=0;if(i<t.length)return void this.changeSelection(t[i])}},reset:function(){this.setValue(null)},addItems:function(e){e.element=hui.build("div",{parent:this.element});e=new hui.ui.Selection.Items(e);(e.parent=this).subItems.push(e)},_updateUI:function(){for(var e=0;e<this.items.length;e++)hui.cls.set(this.items[e].element,"hui_selected",this.isSelection(this.items[e]));for(e=0;e<this.subItems.length;e++)this.subItems[e]._updateUI()},changeSelection:function(e){for(var t=0;t<this.subItems.length;t++)this.subItems[t].selectionChanged(this.selection,e);this.selection=e,this._updateUI(),this.fireChange()},fireChange:function(){this.fire("select",this.selection),this.fireProperty("value",this.selection?this.selection.value:null),this.fireProperty("kind",this.selection?this.selection.kind:null);for(var e=0;e<this.subItems.length;e++)this.subItems[e].parentValueChanged()},registerItems:function(e){(e.parent=this).subItems.push(e)},addItemBehavior:function(e,t){hui.listen(e,"click",function(){this.itemWasClicked(t)}.bind(this)),hui.listen(e,"dblclick",function(e){hui.stop(e),hui.selection.clear(),this._onDoubleClick(t)}.bind(this)),e.dragDropInfo=t},setObjects:function(e){this.items=[],hui.each(e,function(t){this.items.push(t);var e=hui.build("div",{class:"hui_selection_item"});t.element=e,this.element.appendChild(e);var i=hui.build("span",{class:"hui_selection_label",text:t.title||t.text||""});t.icon&&e.appendChild(hui.ui.createIcon(t.icon,16)),e.appendChild(i),hui.listen(e,"click",function(){this.itemWasClicked(t)}.bind(this)),hui.listen(e,"dblclick",function(e){hui.stop(e),this._onDoubleClick(t)}.bind(this))}.bind(this)),this.fireSizeChange()},isSelection:function(e){if(null===this.selection)return!1;var t=e.value==this.selection.value;return t=this.selection.kind?t&&e.kind==this.selection.kind:t},itemWasClicked:function(e){0<this.busy||this.changeSelection(e)},_onDoubleClick:function(e){0<this.busy||this.fire("open",e)},_setBusy:function(e){var t;this.busy+=e?1:-1,window.clearTimeout(this.busytimer),0<this.busy?(t=this.element,this.busytimer=window.setTimeout(function(){hui.cls.add(t,"hui_selection_busy")},300)):(hui.cls.remove(this.element,"hui_selection_busy"),this.fire("loaded"))},_checkValue:function(){this.selection&&(this._getSelectionWithValue(this.selection.value)||(hui.log("Value not found: "+this.selection.value),this.busy?hui.log("Will not select first since im still busy"):this.selectFirst()))},show:function(){this.element.style.display=""},hide:function(){this.element.style.display="none"}},hui.ui.Selection.Items=function(e){this.options=hui.override({source:null},e),this.element=hui.get(e.element),this.title=hui.get(this.element.id+"_title"),this.name=e.name,this.disclosed={},this.parent=null,this.items=[],hui.ui.extend(this),this.options.source&&this.options.source.listen(this)},hui.ui.Selection.Items.prototype={refresh:function(){this.options.source&&this.options.source.refresh()},setOptions:function(e){this.$optionsLoaded(e)},$objectsLoaded:function(e){this.$optionsLoaded(e)},$optionsLoaded:function(e){this.items=[],this.element.innerHTML="",this.buildLevel(this.element,e,0,!0),this.title&&(this.title.style.display=0<this.items.length?"block":"none"),this.parent._updateUI(),this.parent._checkValue(),this.fireSizeChange()},$sourceIsBusy:function(){this.parent._setBusy(!0)},$sourceIsNotBusy:function(){this.parent._setBusy(!1)},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$visibilityChanged:function(){hui.dom.isVisible(this.element)&&this.options.source&&this.options.source.refreshFirst()},buildLevel:function(e,t,l,i){var r,d;t&&(r=this.isHierarchy(t),d=hui.build("div",{class:"hui_selection_level",style:i?"display:block":"display:none",parent:e}),hui.each(t,function(t){var e,i,n,s,h,u,o,a=t.text||t.title||"";"title"!=t.type?(e=t.children&&0<t.children.length,s=16*l+6,(!r&&0<l||r&&!e)&&(s+=13),(i=hui.build("div",{class:"hui_selection_item"})).style.paddingLeft=s+"px",t.badge&&i.appendChild(hui.build("strong",{class:"hui_selection_badge",text:t.badge})),s=!1,r&&e&&(s=(n=this).disclosed[t.value],u=this.disclosed[t.value]?"hui_disclosure hui_disclosure_open":"hui_disclosure",h=hui.build("span",{class:u,parent:i}),hui.listen(h,"click",function(e){hui.stop(e),n.toggle(h,t)})),(u=hui.ui.callDelegates(this.parent,"render",t))?i.appendChild(u):(o=hui.build("span",{class:"hui_selection_label",text:a}),t.icon&&i.appendChild(hui.ui.createIcon(t.icon,16)),i.appendChild(o)),hui.listen(i,"click",function(e){this.parent.itemWasClicked(t)}.bind(this)),hui.listen(i,"dblclick",function(e){hui.stop(e),hui.selection.clear(),this.parent._onDoubleClick(t)}.bind(this)),d.appendChild(i),o={title:a,icon:t.icon,badge:t.badge,kind:t.kind,element:i,value:t.value},i.dragDropInfo=o,this.items.push(o),this.buildLevel(d,t.children,l+1,s)):hui.build("div",{class:"hui_selection_title",html:"<span>"+a+"</span>",parent:d})}.bind(this)))},toggle:function(e,t){hui.cls.has(e,"hui_disclosure_open")?(this.disclosed[t.value]=!1,hui.get.next(e.parentNode).style.display="none",hui.cls.remove(e,"hui_disclosure_open")):(this.disclosed[t.value]=!0,hui.get.next(e.parentNode).style.display="block",hui.cls.add(e,"hui_disclosure_open")),this.parent.fireSizeChange()},isHierarchy:function(e){if(!e)return!1;for(var t=0;t<e.length;t++)if(null!==e[t]&&e[t].children&&0<e[t].children.length)return!0;return!1},getValue:function(){if(null===this.parent.selection)return null;for(var e=0;e<this.items.length;e++)if(this.items[e].value==this.parent.selection.value)return this.items[e];return null},_updateUI:function(){for(var e=0;e<this.items.length;e++)hui.cls.set(this.items[e].element,"hui_selected",this.parent.isSelection(this.items[e]))},selectionChanged:function(e,t){for(var i=0;i<this.items.length;i++)if(this.items[i].value==t.value)return void this.fireProperty("value",t.value);this.fireProperty("value",null)},parentValueChanged:function(){for(var e=0;e<this.items.length;e++)if(this.parent.isSelection(this.items[e]))return void this.fireProperty("value",this.items[e].value);this.fireProperty("value",null)}},hui.ui.Toolbar=function(e){this.element=hui.get(e.element),this.name=e.name,hui.ui.extend(this)},hui.ui.Toolbar.create=function(e){var t=(e=e||{}).element=hui.build("div.hui_toolbar");return!1===e.labels&&hui.cls.add(t,"hui_toolbar-nolabels"),e.variant&&hui.cls.add(t,"hui_toolbar-"+e.variant),new hui.ui.Toolbar(e)},hui.ui.Toolbar.prototype={add:function(e){this.element.appendChild(e.getElement())},addDivider:function(){this.element.appendChild(hui.build("span.hui_toolbar_divider"))},setSelection:function(e){for(var t=hui.ui.getDescendants(this),i=0;i<t.length;i++){var n=t[i];n.setSelected&&n.setSelected(n.key==e)}},getByKey:function(e){for(var t=hui.ui.getDescendants(this),i=0;i<t.length;i++){var n=t[i];if(n.key==e)return n}}},hui.ui.Toolbar.Icon=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,this.key=e.key,this.enabled=!hui.cls.has(this.element,"hui_toolbar_icon_disabled"),this.element.tabIndex=this.enabled?0:-1,this.icon=hui.get.firstByClass(this.element,"hui_icon"),hui.ui.extend(this),e.listener&&this.listen(e.listener),this._attach()},hui.ui.Toolbar.Icon.create=function(e){var t=e.element=hui.build("a.hui_toolbar_icon"),i=hui.build("span.hui_icon",{parent:t});return hui.ui.setIconImage(i,e.icon,32),e.overlay&&hui.build("span.hui_icon_overlay",{parent:i,style:"background-image: url("+hui.ui.getIconUrl("overlay/"+e.overlay,32)+")"}),hui.build("span.hui_toolbar_icon_text",{text:e.title||e.text,parent:t}),new hui.ui.Toolbar.Icon(e)},hui.ui.Toolbar.Icon.prototype={_attach:function(){var e=this;this.element.onclick=function(){e._click()}},setEnabled:function(e){this.enabled=e,this.element.tabIndex=e?0:-1,hui.cls.set(this.element,"hui_toolbar_icon_disabled",!this.enabled)},disable:function(){this.setEnabled(!1)},enable:function(){this.setEnabled(!0)},setOverlay:function(e){var t=hui.get.firstByClass(this.element,"hui_icon_overlay");t&&!e?t.style.backgroundImage="":t&&e?t.style.backgroundImage="url('"+hui.ui.getIconUrl("overlay/"+e,32)+"')":e&&(t=hui.get.firstByClass(this.element,"hui_icon"),hui.build("span",{class:"hui_icon_overlay",parent:t,style:"background-image: url("+hui.ui.getIconUrl("overlay/"+e,32)+")"}))},setBadge:function(e){var t=hui.get.firstByClass(this.element,"hui_icon_badge");t||hui.isBlank(e)?hui.isBlank(e)&&t?hui.dom.remove(t):t&&hui.dom.setText(t,e):hui.build("span",{class:"hui_icon_badge",parent:hui.get.firstByClass(this.element,"hui_icon"),text:e})},setLabel:function(e){var t=hui.get.firstByClass(this.element,"hui_toolbar_icon_text");hui.dom.setText(t,e)},setIcon:function(e){var t=hui.get.firstByClass(this.element,"hui_icon");hui.ui.setIconImage(t,e,32)},setSelected:function(e){e&&this.element.blur(),hui.cls.set(this.element,"hui_toolbar_icon_selected",e)},_click:function(){this.enabled&&(this.options.confirm?hui.ui.confirmOverlay({widget:this,text:this.options.confirm.text,okText:this.options.confirm.okText,cancelText:this.options.confirm.cancelText,onOk:this._fireClick.bind(this)}):this._fireClick())},_fireClick:function(){this.fire("toolbarIconWasClicked"),this.fire("click")}},hui.ui.Toolbar.More=function(e){this.element=hui.get(e.element),this.name=e.name,this.button=hui.get.firstByClass(this.element,"hui_toolbar_more_toggle"),hui.listen(this.button,"click",this.toggle.bind(this)),hui.ui.extend(this)},hui.ui.Toolbar.More.prototype={toggle:function(){hui.cls.toggle(this.element,"hui_is_expanded")}},hui.ui.ImageInput=function(e){this.name=e.name,this.options=hui.override({width:48,height:48},e),this.element=hui.get(e.element),this.value=null,hui.ui.extend(this),this._attach()},hui.ui.ImageInput.prototype={_attach:function(){hui.listen(this.element,"click",this._showPicker.bind(this)),hui.listen(hui.get.firstByTag(this.element,"a"),"click",this._clear.bind(this))},setObject:function(e){this.value=e,this._updateUI()},getObject:function(){return this.value},getValue:function(){return this.value},setValue:function(e){this.setObject(e)},_clear:function(e){hui.stop(e),this.reset(),this._fireChange()},reset:function(){this.value=null,this._updateUI()},_updateUI:function(){var e;hui.cls.set(this.element,"hui_imageinput_full",null!==this.value),null===this.value?this.element.style.backgroundImage="":(e=hui.ui.resolveImageUrl(this,this.value,this.options.width,this.options.height),this.element.style.backgroundImage="url("+e+")")},_showFinder:function(){this.finder||(this.finder=hui.ui.Finder.create(this.options.finder),this.finder.listen({$select:function(e){this.setObject(e),this._fireChange(),this.finder.hide()}.bind(this)})),this.finder.show()},_showPicker:function(){this.options.finder&&this._showFinder()},$visibilityChanged:function(){this.finder&&!hui.dom.isVisible(this.element)&&this.finder.hide()},_fireChange:function(){this.fireValueChange()}},hui.ui.BoundPanel=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,this.visible=!1,this.content=hui.get.firstByClass(this.element,"hui_boundpanel_content"),this.arrow=hui.get.firstByClass(this.element,"hui_boundpanel_arrow"),this.arrowWide=37,this.arrowNarrow=18,"light"==e.variant&&(this.arrowWide=23,this.arrowNarrow=12),hui.ui.extend(this)},hui.ui.BoundPanel.create=function(e){var t='<div class="hui_boundpanel_arrow"></div><div class="hui_boundpanel_content" style="';return(e=hui.override({name:null,top:0,left:0,width:null,padding:null,modal:!1,hideOnClick:!1},e)).width&&(t+="width:"+e.width+"px;"),e.padding&&(t+="padding:"+e.padding+"px;"),t+='"></div>',e.element=hui.build("div",{class:e.variant?"hui_boundpanel hui_boundpanel-"+e.variant:"hui_boundpanel",style:"display:none;zIndex:"+hui.ui.nextPanelIndex()+";top:"+e.top+"px;left:"+e.left+"px",html:t,parent:document.body}),new hui.ui.BoundPanel(e)},hui.ui.BoundPanel.prototype={toggle:function(){this.visible?this.hide():this.show()},show:function(e){var t,e=(e=e||{}).target||this.options.target;e&&(e.nodeName?this.position(e):this.position(hui.ui.get(e))),this.visible?this.element.style.zIndex=hui.ui.nextPanelIndex():(hui.browser.opacity&&hui.style.setOpacity(this.element,0),"left"==this.relativePosition?(t=!1,this.element.style.marginLeft="20px"):"right"==this.relativePosition?(t=!1,this.element.style.marginLeft="-20px"):"top"==this.relativePosition?(t=!0,this.element.style.marginTop="20px"):"bottom"==this.relativePosition&&(t=!0,this.element.style.marginTop="-20px"),this.element.style.visibility="visible",this.element.style.display="block",e=hui.ui.nextPanelIndex(),this.element.style.zIndex=e,hui.ui.callVisible(this),hui.browser.opacity&&hui.animate(this.element,"opacity",1,300,{ease:hui.ease.fastSlow}),hui.animate(this.element,t?"margin-top":"margin-left","0px",300,{ease:hui.ease.fastSlow}),this.visible=!0,this.options.modal&&hui.ui.showCurtain({widget:this,zIndex:e-1,transparent:"transparent"==this.options.modal,color:"auto"}),this.options.hideOnClick&&(this.hideListener=hui.listen(document.body,"click",function(e){hui.ui.isWithin(e,this.element)||this.hide()}.bind(this))))},$curtainWasClicked:function(){hui.ui.hideCurtain(this),this.hide()},hide:function(){this.visible&&(hui.browser.opacity?hui.animate(this.element,"opacity",0,100,{ease:hui.ease.slowFast,$complete:function(){this.element.style.display="none",hui.ui.callVisible(this)}.bind(this)}):(this.element.style.display="none",hui.ui.callVisible(this)),this.options.modal&&hui.ui.hideCurtain(this),this.visible=!1,hui.unListen(document.body,"click",this.hideListener))},isVisible:function(){return this.visible},add:function(e){e.getElement?this.content.appendChild(e.getElement()):this.content.appendChild(e)},clear:function(){hui.ui.destroyDescendants(this.content),this.content.innerHTML=""},addSpace:function(e){this.add(hui.build("div",{style:"font-size:0px;height:"+e+"px"}))},_getDimensions:function(){var e,t;return"none"==this.element.style.display?(this.element.style.visibility="hidden",this.element.style.display="block",e=this.element.clientWidth,t=this.element.clientHeight,this.element.style.display="none",this.element.style.visibility=""):(e=this.element.clientWidth,t=this.element.clientHeight),{width:e,height:t}},$$childSizeChanged:function(){this._rePosition()},$$layout:function(){this._rePosition()},_rePosition:function(){this._latest&&this.position(this._latest)},position:function(e){var t;(this._latest=e).getElement?g=e.getElement():e.element?(g=e.element,t=e.position):e.rect?(t=e.position,g={offsetWidth:e.rect.width,offsetHeight:e.rect.height},a={left:e.rect.left,top:e.rect.top},l={left:0,top:0}):g=hui.get(e);var i,n,s,h,u,o,a=a||{left:hui.position.getLeft(g),top:hui.position.getTop(g)},l=l||hui.position.getScrollOffset(g),r=hui.window.getScrollLeft(),d=hui.window.getScrollTop(),c=a.left-r+hui.window.getScrollLeft(),p=g.clientWidth||g.offsetWidth,m=g.clientHeight||g.offsetHeight,f=this._getDimensions(),e=document.body.clientWidth,r=hui.window.getViewHeight(),g=(a.top-d-(l.top-d))/r;(g="vertical"==t?.5<g?.9:.1:g)<=.1?(this.relativePosition="top",this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_top",n=(this.options.variant,-1*this.arrowNarrow),i=c+p/2-(s=Math.min(e-f.width-2,Math.max(3,c+p/2-f.width/2)))-this.arrowNarrow,h=a.top+m+8-(l.top-d)):.9<=g?(this.relativePosition="bottom",this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_bottom",n="light"==this.options.variant?f.height-1:f.height,i=c+p/2-(s=Math.min(e-f.width-3,Math.max(3,c+p/2-f.width/2)))-this.arrowNarrow,h=a.top-f.height-5-(l.top-d)):(c+p/2)/e<.5?(this.relativePosition="left",s=c+p+10,this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_left",h=a.top+(m-f.height)/2,h-=l.top-d,u=d+3,o=d+(r-f.height)-3,h=Math.min(Math.max(h,u),o),n=a.top-h,n-=l.top-d,n-=this.arrowWide/2,n+=m/2,"light"==this.options.variant?(i=-12,n+=2):i=-18):(this.relativePosition="right",s=c-f.width-10,this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_right",h=a.top+(m-f.height)/2,h-=l.top-d,u=d+3,o=d+(r-f.height)-3,h=Math.min(Math.max(h,u),o),n=a.top-h,n-=l.top-d,n-=this.arrowWide/2,n+=m/2,"light"==this.options.variant?(i=f.width,n+=2):i=f.width),this.arrow.style.marginTop=n+"px",this.arrow.style.marginLeft=i+"px",this.visible?(hui.animate(this.element,"top",h+"px",500,{ease:hui.ease.fastSlow}),hui.animate(this.element,"left",s+"px",500,{ease:hui.ease.fastSlow})):(this.element.style.top=h+"px",this.element.style.left=s+"px")},detach:function(){hui.ui.hideCurtain(this)}},hui.ui.ImageViewer=function(e){this.options=hui.override({maxWidth:800,maxHeight:600,perimeter:100,sizeSnap:100,margin:0,ease:hui.ease.slowFastSlow,easeEnd:hui.ease.bounce,easeAuto:hui.ease.slowFastSlow,easeReturn:hui.ease.cubicInOut,transition:400,transitionEnd:1e3,transitionReturn:300,images:[]},e),this.element=hui.get(e.element),this.box=this.options.box,this.dirty=!1,this.width=600,this.height=460,this.index=0,this.position=0,this.playing=!1,this.name=e.name,this.images=e.images||[],hui.ui.extend(this),this.box.listen(this),this._attach(),this._attachDrag(),e.listener&&this.listen(e.listener)},hui.ui.ImageViewer.create=function(e){var t=(e=e||{}).element=hui.build("div",{class:"hui_imageviewer",html:'<div class="hui_imageviewer_viewer"><div class="hui_imageviewer_inner_viewer"></div></div><div class="hui_imageviewer_text"></div><div class="hui_imageviewer_status"></div><div class="hui_imageviewer_controller"><div><div><a class="hui_imageviewer_previous"></a><a class="hui_imageviewer_play"></a><a class="hui_imageviewer_next"></a><a class="hui_imageviewer_close"></a></div></div></div>'}),i=e.box=hui.ui.Box.create({variant:"plain",absolute:!0,modal:!0,closable:!0});return i.add(t),i.addToDocument(),new hui.ui.ImageViewer(e)},hui.ui.ImageViewer.prototype={nodes:{viewer:".hui_imageviewer_viewer",innerViewer:".hui_imageviewer_inner_viewer",status:".hui_imageviewer_status",text:".hui_imageviewer_text",previous:".hui_imageviewer_previous",controller:".hui_imageviewer_controller",next:".hui_imageviewer_next",play:".hui_imageviewer_play",close:".hui_imageviewer_close"},_attach:function(){var t=this;this.nodes.next.onclick=function(){t.next(!0)},this.nodes.previous.onclick=function(){t.previous(!0)},this.nodes.play.onclick=function(){t.playOrPause()},this.nodes.close.onclick=this.hide.bind(this),this._timer=function(){t.next(!1)},this._keyListener=function(e){(e=hui.event(e)).escapeKey?t.hide():t.zoomed||(e.rightKey?t.next(!0):e.leftKey?t.previous(!0):e.returnKey&&t.playOrPause())},hui.listen(this.nodes.viewer,"mousemove",this._onMouseMove.bind(this)),hui.listen(this.nodes.controller,"mouseover",function(){t.overController=!0}),hui.listen(this.nodes.controller,"mouseout",function(){t.overController=!1}),hui.listen(this.nodes.viewer,"mouseout",function(e){hui.ui.isWithin(e,this.nodes.viewer)||t._hideController()}.bind(this))},_draw:function(e){hui.browser.webkit?this.nodes.innerViewer.style.webkitTransform="translate3d("+this.position+"px,0,0)":this.nodes.innerViewer.style.marginLeft=this.position+"px"},_attachDrag:function(){var t=0,i=0,n=0,s=(this.nodes.viewer,this.nodes.innerViewer,0);hui.drag.register({touch:!0,element:this.nodes.innerViewer,onBeforeMove:function(e){t=e.getLeft(),n=this.position,s=(this.images.length-1)*this.width*-1}.bind(this),onMove:function(e){i=e.getLeft();e=n-(t-i);(e=0<e?-80*(Math.exp(-.013*e)-1):e)<s&&(e=80*(Math.exp(.013*(e-s))-1)+s),this.position=e,this._draw()}.bind(this),onAfterMove:function(){var e=t-i<0?Math.floor:Math.ceil;this.index=e(-1*this.position/this.width);e=this.images.length-1;this.index==this.images.length?this.index=0:this.index<0?this.index=this.images.length-1:e=1,this._goToImage(!0,e,!1,!0)}.bind(this),onNotMoved:this._zoom.bind(this)})},_onMouseMove:function(){window.clearTimeout(this.ctrlHider),this._shouldShowController()&&(this.ctrlHider=window.setTimeout(this._hideController.bind(this),2e3),hui.browser.opacity?hui.effect.fadeIn({element:this.nodes.controller,duration:200}):this.nodes.controller.style.display="block")},_hideController:function(){this.overController||(hui.browser.opacity?hui.effect.fadeOut({element:this.nodes.controller,duration:500}):this.nodes.controller.style.display="none")},_getLargestSize:function(e,t){return hui.fit(t,e,{upscale:!1})},_calculateSize:function(){var e=this.options.sizeSnap,t=hui.window.getViewWidth()-this.options.perimeter,t=Math.floor(t/e)*e;t=Math.min(t,this.options.maxWidth);var i=hui.window.getViewHeight()-this.options.perimeter,i=Math.floor(i/e)*e;i=Math.min(i,this.options.maxHeight);for(var n=0,s=0,h=0;h<this.images.length;h++)var u=this._getLargestSize({width:t,height:i},this.images[h]),n=Math.max(n,u.width),s=Math.max(s,u.height);i=Math.floor(Math.min(i,s)),(t=Math.floor(Math.min(t,n)))==this.width&&i==this.height||(this.width=t,this.height=i,this.dirty=!0)},_updateUI:function(){if(this.dirty){this.nodes.innerViewer.innerHTML="";for(var e=0;e<this.images.length;e++){var t=hui.build("div",{class:"hui_imageviewer_image"});hui.style.set(t,{width:this.width+this.options.margin+"px",height:this.height-1+"px"}),this.nodes.innerViewer.appendChild(t)}this.nodes.controller.style.display=this._shouldShowController()?"block":"none",this.dirty=!1,this._preload()}},_shouldShowController:function(){return 1<this.images.length},_goToImage:function(e,t,i,n){var s,h,u=this.position,o=this.position=this.index*(this.width+this.options.margin)*-1;e?(n?(s=200*t,h=hui.ease.fastSlow,h=hui.ease.quadOut):1<t?(s=Math.min(t*this.options.transitionReturn,2e3),h=this.options.easeReturn):(h=(t=0===this.index||this.index==this.images.length-1)?this.options.easeEnd:this.options.ease,i||(h=this.options.easeAuto),s=t?this.options.transitionEnd:this.options.transition),hui.animate({node:this.nodes.innerViewer,css:{marginLeft:o+"px"},duration:s,ease:h,$render:function(e,t){this.position=u+(o-u)*t,this._draw()}.bind(this)})):this._draw(),this._drawText()},_drawText:function(){var e=this.images[this.index].text;e?(this.nodes.text.innerHTML=e,this.nodes.text.style.display="block"):(this.nodes.text.innerHTML="",this.nodes.text.style.display="none")},showById:function(e){for(var t=0;t<this.images.length;t++)if(this.images[t].id==e){this.show(t);break}},show:function(e){this.index=e||0,this._calculateSize(),this._updateUI();e=this.options.margin;hui.style.set(this.element,{width:this.width+e+"px",height:this.height+2*e-1+"px"}),hui.style.set(this.nodes.viewer,{width:this.width+e+"px",height:this.height-1+"px"}),hui.style.set(this.nodes.innerViewer,{width:(this.width+e)*this.images.length+"px",height:this.height-1+"px"}),hui.style.set(this.nodes.controller,{marginLeft:(this.width-160)/2+.5*e+"px",display:"none"}),this.box.show(),this._goToImage(!1,0,!1),hui.listen(document,"keydown",this._keyListener),this.visible=!0,this._setHash(!0)},_setHash:function(e){},_onHashChange:function(){this._changing||(this._changing=!0,hui.location.hasHash("imageviewer")&&!this.visible?this.show():!hui.location.hasHash("imageviewer")&&this.visible&&this.hide(),this._changing=!1)},hide:function(){this._hide()},_hide:function(){this.pause(),this.box.hide(),this._endZoom(),hui.unListen(document,"keydown",this._keyListener),this.visible=!1,this._setHash(!1)},$boxCurtainWasClicked:function(){this.hide()},$boxWasClosed:function(){this.hide()},clearImages:function(){this.images=[],this.dirty=!0},addImages:function(e){for(var t=0;t<e.length;t++)this.addImage(e[t])},addImage:function(e){this.images.push(e),this.dirty=!0},play:function(){this.interval||(this.interval=window.setInterval(this._timer,6e3)),this.next(!1),this.playing=!0,this.nodes.play.className="hui_imageviewer_pause"},pause:function(){window.clearInterval(this.interval),this.interval=null,this.nodes.play.className="hui_imageviewer_play",this.playing=!1},playOrPause:function(){this.playing?this.pause():this.play()},_resetPlay:function(){this.playing&&(window.clearInterval(this.interval),this.interval=window.setInterval(this._timer,6e3))},previous:function(e){var t=1;this.index--,this.index<0&&(this.index=this.images.length-1,t=this.images.length-1),this._goToImage(!0,t,e),this._resetPlay()},next:function(e){var t=1;this.index++,this.index==this.images.length&&(this.index=0,t=this.images.length-1),this._goToImage(!0,t,e),this._resetPlay()},_preload:function(){var e=new hui.Preloader;e.addImages(hui.ui.getURL("gfx/imageviewer_controls.png"));var t=this;e.setDelegate({allImagesDidLoad:function(){t._preloadImages()}}),e.load()},_preloadImages:function(){var e=new hui.Preloader;e.setDelegate(this);for(var t=0;t<this.images.length;t++){var i=hui.ui.resolveImageUrl(this,this.images[t],this.width,this.height);null!==i&&e.addImages(i)}this.nodes.status.innerHTML="0%",this.nodes.status.style.display="",e.load(this.index)},allImagesDidLoad:function(){this.nodes.status.style.display="none"},imageDidLoad:function(e,t,i){this.nodes.status.innerHTML=Math.round(e/t*100)+"%";t=(t=hui.ui.resolveImageUrl(this,this.images[i],this.width,this.height)).replace(/&amp;/g,"&");this.nodes.innerViewer.childNodes[i].style.backgroundImage="url('"+t+"')",hui.cls.set(this.nodes.innerViewer.childNodes[i],"hui_imageviewer_image_abort",!1),hui.cls.set(this.nodes.innerViewer.childNodes[i],"hui_imageviewer_image_error",!1)},imageDidGiveError:function(e,t,i){hui.cls.set(this.nodes.innerViewer.childNodes[i],"hui_imageviewer_image_error",!0)},imageDidAbort:function(e,t,i){hui.cls.set(this.nodes.innerViewer.childNodes[i],"hui_imageviewer_image_abort",!0)},zoomed:!1,_zoom:function(e){var t,i,n=this.images[this.index];n.width<=this.width&&n.height<=this.height||(this.zoomer||(this.zoomer=hui.build("div",{class:"hui_imageviewer_zoomer",style:"width:"+this.nodes.viewer.clientWidth+"px;height:"+this.nodes.viewer.clientHeight+"px"}),this.element.insertBefore(this.zoomer,hui.dom.firstChild(this.element)),hui.listen(this.zoomer,"mousemove",this._onZoomMove.bind(this)),hui.listen(this.zoomer,"click",this._endZoom.bind(this))),this._hideController(),this.pause(),t=this._getLargestSize({width:2e3,height:2e3},n),i=hui.ui.resolveImageUrl(this,n,t.width,t.height),n=Math.max(0,Math.round((this.nodes.viewer.clientHeight-t.height)/2)),this.zoomer.innerHTML='<div style="width:'+t.width+"px;height:"+t.height+'px; margin: 0 auto;"><img src="'+i+'" style="margin-top: '+n+'px" /></div>',this.zoomer.style.display="block",this.zoomInfo={width:t.width,height:t.height},this._onZoomMove(e),this.zoomed=!0)},_onZoomMove:function(e){var t,i;this.zoomInfo&&(i=hui.position.get(this.zoomer),t=((e=new hui.Event(e)).getLeft()-i.left)/this.zoomer.clientWidth*(this.zoomInfo.width-this.zoomer.clientWidth),i=(e.getTop()-i.top)/this.zoomer.clientHeight*(this.zoomInfo.height-this.zoomer.clientHeight),this.zoomer.scrollLeft=t,this.zoomer.scrollTop=i)},_endZoom:function(){this.zoomer&&(this.zoomer.style.display="none",this.zoomed=!1)}},hui.define("hui.ui.ImageViewer",hui.ui.ImageViewer),hui.ui.Picker=function(e){e=this.options=hui.override({itemWidth:100,itemHeight:150,itemsVisible:null,shadow:!0,valueProperty:"value"},e),this.element=hui.get(e.element),this.name=e.name,this.container=hui.get.firstByClass(this.element,"hui_picker_container"),this.content=hui.get.firstByClass(this.element,"hui_picker_content"),this.title=hui.get.firstByClass(this.element,"hui_picker_title"),this.pages=[],this.objects=[],this.selected=null,this.value=null,this._addBehavior(),hui.ui.extend(this)},hui.ui.Picker.create=function(e){return(e=hui.override({shadow:!0},e)).element=hui.build("div",{class:"hui_picker",html:hui.when(e.title,'<div class="hui_picker_title">'+e.title+"</div>")+'<div class="hui_picker_container"><div class="hui_picker_content"></div></div><div class="hui_picker_pages"></div>'}),e.shadow&&hui.cls.add(e.element,"hui_picker_shadow"),new hui.ui.Picker(e)},hui.ui.Picker.prototype={_addBehavior:function(){hui.drag.register({element:this.element,onBeforeMove:this._onBeforeMove.bind(this),onMove:this._onMove.bind(this),onAfterMove:this._onAfterMove.bind(this)}),hui.listen(this.element,"click",this._onClick.bind(this))},_onClick:function(e){this.dragging||(e=(e=hui.event(e)).findByClass("hui_picker_page"))&&this.goToPage(parseInt(e.getAttribute("data-index")))},goToPage:function(e){e=Math.round(this.container.clientWidth*e),e=Math.min(e,this.content.clientWidth-this.container.clientWidth);this._scrollTo(e,hui.ease.fastSlow)},setObjects:function(e){this.selected=null,this.objects=e||[],this._updateUI()},setValue:function(e){this.value=e,this._updateSelection()},getValue:function(){return this.value},reset:function(){this.value=null,this._updateSelection()},_updateUI:function(){var e,n=this;this.content.innerHTML="",this.container.scrollLeft=0,e=this.options.itemsVisible?this.options.itemsVisible*(this.options.itemWidth+14):this.container.clientWidth,hui.style.set(this.container,{width:e+"px",height:this.options.itemHeight+14+"px"}),hui.style.set(this.content,{width:this.objects.length*(this.options.itemWidth+14)+"px",height:this.options.itemHeight+14+"px"}),hui.each(this.objects,function(e,t){var i=hui.build("div",{class:"hui_picker_item",title:e.title,html:'<div style="width:'+n.options.itemWidth+"px;height:"+n.options.itemHeight+"px; overflow: hidden; background-image:url('"+e.image+"')\"><strong>"+hui.string.escape(e.title)+"</strong></div>",parent:n.content});null!==n.value&&e[n.options.valueProperty]==n.value&&hui.cls.add(i,"hui_picker_item_selected"),hui.listen(i,"mouseup",function(){n._onItemClick(e[n.options.valueProperty])})}),this._updatePages()},_updatePages:function(){var e=this.container.clientWidth;if(e){var t=Math.ceil(this.content.clientWidth/e),i=hui.get.firstByClass(this.element,"hui_picker_pages");if(hui.dom.clear(i),!(t<2))for(var n=1;n<=t;n++)hui.build("a",{parent:i,text:n,className:"hui_picker_page"+hui.when(1==n," hui_picker_page_selected"),"data-index":n-1})}},_updateSelection:function(){for(var e=this.content.childNodes,t=0;t<e.length;t++)hui.cls.set(e[t],"hui_picker_item_selected",null!==this.value&&this.objects[t][this.options.valueProperty]==this.value)},_onItemClick:function(e){this.dragging||this.value!=e&&(this.value=e,this._updateSelection(),this.fire("select",e))},_onBeforeMove:function(e){this.dragX=e.getLeft(),this.dragScroll=this.container.scrollLeft,this.dragging=!0},_onMove:function(e){this.container.scrollLeft=this.dragX-e.getLeft()+this.dragScroll},_onAfterMove:function(e){var t=this.options.itemWidth+14,t=Math.round(this.container.scrollLeft/t)*t;this._scrollTo(t),this.dragging=!1},_scrollTo:function(e,t){t=t||hui.ease.bounceOut,hui.animate(this.container,"scrollLeft",e,500,{ease:t,onComplete:this._updatePager.bind(this)})},_updatePager:function(){for(var e=Math.ceil(this.container.scrollLeft/this.container.clientWidth),t=hui.get.byClass(this.element,"hui_picker_page"),i=0;i<t.length;i++)hui.cls.set(t[i],"hui_picker_page_selected",e==i)},$visibilityChanged:function(){var e;hui.dom.isVisible(this.element)&&(this.container.style.display="none",e=this.options.itemsVisible?this.options.itemsVisible*(this.options.itemWidth+14):this.container.parentNode.clientWidth,e=Math.max(e,0),hui.style.set(this.container,{width:e+"px",display:"block"}),this._updatePages())}},hui.ui.Menu=function(e){this.options=hui.override({autoHide:!1,parentElement:null},e),this.element=hui.get(e.element),this.name=e.name,this.value=null,this.subMenus=[],this.visible=!1,hui.ui.extend(this),this._addBehavior()},hui.ui.Menu.create=function(e){(e=e||{}).element=hui.build("div",{class:"hui_menu"});var t=new hui.ui.Menu(e);return document.body.appendChild(e.element),t},hui.ui.Menu.prototype={_addBehavior:function(){var e;this.hider=function(){this.hide(),this.fire("cancel")}.bind(this),this.options.autoHide&&(e=function(e){hui.ui.isWithin(e,this.element)||this.options.parentElement&&hui.ui.isWithin(e,this.options.parentElement)||this._isSubMenuVisible()||this.hide()}.bind(this),hui.listen(this.element,"mouseout",e),this.options.parentElement&&hui.listen(this.options.parentElement,"mouseout",e))},addDivider:function(){hui.build("div",{class:"hui_menu_divider",parent:this.element})},addItem:function(t){var i,n=this,s=hui.build("div",{class:"hui_menu_item",text:t.title||t.text});hui.listen(s,"click",function(e){hui.stop(e),n._onItemClick(t.value)}),t.children&&0<t.children.length&&((i=hui.ui.Menu.create({autoHide:!0,parentElement:s})).addItems(t.children),hui.listen(s,"mouseover",function(e){i.showAtElement(s,e,"horizontal")}),n.subMenus.push(i),hui.cls.add(s,"hui_menu_item_children"),i.listen({$select:function(e){n.hide(),n.fire("select",e)}})),this.element.appendChild(s)},addItems:function(e){for(var t=0;t<e.length;t++)null===e[t]?this.addDivider():this.addItem(e[t])},getValue:function(){return this.value},_onItemClick:function(e){this.value=e,this.fire("itemWasClicked",e),this.fire("select",e),this.hide()},showAtPointer:function(e){(e=hui.event(e)).stop(),this.showAtPoint({top:e.getTop(),left:e.getLeft()})},showAtElement:function(e,t,i){(t=hui.event(t)).stop(),e=hui.get(e);t=hui.position.get(e);"horizontal"==i?t.left+=e.clientWidth:"vertical"==i&&(t.top+=e.clientHeight),this.showAtPoint(t)},showAtPoint:function(e){var t=hui.window.getViewWidth(),i=hui.window.getViewHeight(),n=hui.window.getScrollTop(),s=hui.window.getScrollLeft();this.visible||hui.style.set(this.element,{display:"block",visibility:"hidden",opacity:0});var h=this.element.clientWidth,u=this.element.clientHeight,s=Math.min(e.left,t-h-26+s),n=Math.max(0,Math.min(e.top,i-u-20+n));hui.style.set(this.element,{top:n+"px",left:s+"px",visibility:"visible",zIndex:hui.ui.nextTopIndex()}),this.element.style.width||(this.element.style.width=h+6+"px"),this.visible||(hui.style.set(this.element,{opacity:1}),this._addHider(),this.visible=!0)},hide:function(e){if(this.visible){this.element.style.display="none",this._removeHider();for(var t=0;t<this.subMenus.length;t++)this.subMenus[t].hide();this.visible=!1,this.fire("hide")}},isVisible:function(){return this.visible},_isSubMenuVisible:function(){for(var e=0;e<this.subMenus.length;e++)if(this.subMenus[e].visible)return!0;return!1},_addHider:function(){hui.listen(document.body,"click",this.hider)},_removeHider:function(){hui.unListen(document.body,"click",this.hider)}},hui.ui.Overlay=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,this.icons={},this.visible=!1,hui.ui.extend(this),this._addBehavior()},hui.ui.Overlay.create=function(e){var t="hui_overlay"+((e=e||{}).variant?" hui_overlay_"+e.variant:"");e.variant||(t+=" hui_context_dark");t=e.element=hui.build("div",{className:t,style:"display:none"});return document.body.appendChild(t),new hui.ui.Overlay(e)},hui.ui.Overlay.prototype={_addBehavior:function(){},addIcon:function(t,e){var i=this,n=hui.build("div",{className:"hui_overlay_icon"});hui.ui.setIconImage(n,e,32),hui.listen(n,"click",function(e){i._iconWasClicked(t,e)}),this.icons[t]=n,this.element.appendChild(n)},addText:function(e){this.element.appendChild(hui.build("span",{class:"hui_overlay_text",text:e}))},add:function(e){this.element.appendChild(e.getElement())},hideIcons:function(e){for(var t=0;t<e.length;t++)this.icons[e[t]].style.display="none"},showIcons:function(e){for(var t=0;t<e.length;t++)this.icons[e[t]].style.display=""},_iconWasClicked:function(e,t){hui.ui.callDelegates(this,"iconWasClicked",e,t)},showAtElement:function(e,t){t=t||{},hui.ui.positionAtElement(this.element,e,t),t.autoHide&&this._autoHide(e),this.visible||(hui.browser.msie?this.element.style.display="block":(hui.style.set(this.element,{display:"block",opacity:0}),hui.animate(this.element,"opacity",1,150)),t=void 0===t.zIndex?t.zIndex:hui.ui.nextAlertIndex(),this.options.modal?(this.element.style.zIndex=hui.ui.nextAlertIndex(),hui.ui.showCurtain({widget:this,zIndex:t})):this.element.style.zIndex=t,this.visible=!0)},_autoHide:function(t){hui.cls.add(t,"hui_overlay_bound"),hui.unListen(document.body,"mousemove",this._hider),this._hider=function(e){if(!hui.ui.isWithin(e,t)&&!hui.ui.isWithin(e,this.element))try{hui.unListen(document.body,"mousemove",this._hider),hui.cls.remove(t,"hui_overlay_bound"),this.hide()}catch(e){hui.log("unable to stop listening: document="+document)}}.bind(this),hui.listen(document.body,"mousemove",this._hider)},show:function(e){e=e||{},this.visible||hui.style.set(this.element,{display:"block",visibility:"hidden"}),e.element&&hui.position.place({source:{element:this.element,vertical:0,horizontal:.5},target:{element:e.element,vertical:.5,horizontal:.5},insideViewPort:!0,viewPortMargin:9}),e.autoHide&&e.element&&this._autoHide(e.element),this.visible||(hui.effect.bounceIn({element:this.element}),this.visible=!0,this.options.modal&&(e=hui.ui.nextAlertIndex(),this.element.style.zIndex=e+1,hui.ui.showCurtain({widget:this,zIndex:e,color:"auto"})))},$curtainWasClicked:function(){this.hide()},hide:function(){hui.ui.hideCurtain(this),this.element.style.display="none",this.visible=!1},clear:function(){hui.ui.destroyDescendants(this.element),this.element.innerHTML=""}},hui.ui.Upload=function(e){this.options=hui.override({url:"",parameters:{},multiple:!1,maxSize:"20480",types:"*.*",fieldName:"file",chooseButton:"Choose files..."},e),this.element=hui.get(e.element),this.itemContainer=hui.get.firstByClass(this.element,"hui_upload_items"),this.status=hui.get.firstByClass(this.element,"hui_upload_status"),this.placeholder=hui.get.firstByClass(this.element,"hui_upload_placeholder"),this.name=e.name,this.items=[],this.busy=!1,this._chooseImplementation(),hui.ui.extend(this),this._addBehavior()},hui.ui.Upload.implementations=["HTML5","Frame","Flash"],hui.ui.Upload.nameIndex=0,hui.ui.Upload.create=function(e){return(e=e||{}).element=hui.build("div",{class:"hui_upload",html:'<div class="hui_upload_items"></div><div class="hui_upload_status"></div>'+(e.placeholder?'<div class="hui_upload_placeholder"><span class="hui_upload_icon"></span>'+(e.placeholder.title?"<h2>"+hui.string.escape(hui.ui.getTranslated(e.placeholder.title))+"</h2>":"")+(e.placeholder.text?"<p>"+hui.string.escape(hui.ui.getTranslated(e.placeholder.text))+"</p>":"")+"</div>":"")}),new hui.ui.Upload(e)},hui.ui.Upload.prototype={setParameter:function(e,t){this.options.parameters[e]=t,this.impl.setParameter&&this.impl.setParameter(e,t)},clear:function(){for(var e=0;e<this.items.length;e++)this.items[e]&&this.items[e].remove();this.items=[],this.itemContainer.style.display="none",this.status.style.display="none",this.placeholder&&(this.placeholder.style.display="block")},addDropTarget:function(t){t.element&&hui.drag.listen({element:t.element,hoverClass:t.hoverClass,$dropFiles:function(e){t.$drop&&t.$drop(),this._transferFiles(e)}.bind(this)})},uploadFiles:function(e){this._transferFiles(e)},_chooseImplementation:function(){var e=hui.ui.Upload.implementations;this.options.implementation&&e.splice(0,0,this.options.implementation);for(var t=0;t<e.length;t++){var i=hui.ui.Upload[e[t]],n=i.support();if(n.supported){if(!this.options.multiple){this.impl=new i(this),hui.log("Selected impl (single): "+e[t]);break}if(this.options.multiple&&n.multiple){this.impl=new i(this),hui.log("Selected impl (multiple): "+e[t]);break}}}this.impl||(hui.log("No implementation found, using frame"),this.impl=new hui.ui.Upload.Frame(this))},_addBehavior:function(){this.impl.initialize?hui.ui.onReady(function(){this.impl.initialize(),hui.drag.listen({element:this.element,hoverClass:"hui_upload_drop",$dropFiles:this._transferFiles.bind(this)})}.bind(this)):alert(this.impl)},_transferFiles:function(e){if(0<e.length)if(this.options.multiple)for(var t=0;t<e.length;t++){var i=e[t];this._transferFile(i)}else this._transferFile(e[0])},_transferFile:function(e){hui.log(e);var i=this.$_addItem({name:e.name,size:e.size});hui.request({method:"post",file:e,url:this.options.url,parameters:this.options.parameters,$progress:function(e,t){i.updateProgress(e,t)},$load:function(){hui.log("transferFile: load")},$abort:function(){this.$_itemFail(i),i.setError("Afbrudt")}.bind(this),$success:function(e){hui.log("transferFile: success"),i.data.request=e,this.$_itemSuccess(i)}.bind(this),$failure:function(){hui.log("transferFile: fail"),this.$_itemFail(i)}.bind(this)})},$_addItem:function(e){return this.busy||(this.fire("uploadDidStartQueue"),this.status.style.display="block",this._setWidgetEnabled(!1),this.busy=!0),this._addItem(e)},$_itemSuccess:function(e){var t,i,n=hui.get.firstByClass(this.itemContainer,"hui_upload_item_success");e.setProgress(1),e.setSuccess(),this.fire("uploadDidComplete",e.getInfo()),this._checkQueue(),(null!==n||1<this.items.length)&&!!e.element.nextSibling&&(null===n||n!=e.element.nextSibling)&&(t=e.element.parentNode,i=e.element.clientHeight,hui.animate({node:e.element,css:{height:"0px"},ease:hui.ease.slowFastSlow,duration:500,onComplete:function(){t.removeChild(e.element),n?t.insertBefore(e.element,n):t.appendChild(e.element),hui.animate({node:e.element,css:{height:i+"px"},ease:hui.ease.slowFastSlow,duration:200})}}))},$_itemFail:function(e){e.setError("Upload af filen fejlede!"),this.fire("uploadDidFail",e.getInfo()),this._checkQueue()},$_getButtonContainer:function(){var e,t=hui.build("span",{class:"hui_upload_button"});return this.options.widget?((e=hui.ui.get(this.options.widget)).element.parentNode.insertBefore(t,e.element),e.element.parentNode.removeChild(e.element),t.appendChild(e.element)):(t.innerHTML='<a href="javascript:void(0);" class="hui_button"><span><span>'+hui.string.escape(hui.ui.getTranslated(this.options.chooseButton))+"</span></span></a>",this.element.appendChild(t)),t},_setWidgetEnabled:function(e){var t;!this.options.widget||(t=hui.ui.get(this.options.widget))&&t.setEnabled&&t.setEnabled(e)},_checkQueue:function(){for(var e=0;e<this.items.length;e++)if(!this.items[e].isFinished())return;this.busy=!1,this._setWidgetEnabled(!0),this.fire("uploadDidCompleteQueue")},_addItem:function(e){var t=e.index;void 0===t&&(t=this.items.length,e.index=t);e=new hui.ui.Upload.Item(e,4<t);this.items[t]=e;t=hui.get.firstByClass(this.itemContainer,"hui_upload_item_success");return t?this.itemContainer.insertBefore(e.element,t):this.itemContainer.appendChild(e.element),this.itemContainer.style.display="block",this.placeholder&&(this.placeholder.style.display="none"),e}},hui.ui.Upload.Item=function(e,t){this.data=e,this.rearrange=t,this.element=hui.build("div",{className:"hui_upload_item"}),this.element.appendChild(hui.ui.createIcon("file/generic",32)),this.content=hui.build("div",{className:"hui_upload_item_content",parent:this.element}),this.progress=hui.ui.ProgressBar.create({small:!0}),this.content.appendChild(this.progress.getElement());t=hui.build("p",{parent:this.content});this.info=hui.build("strong",{parent:t}),this.status=hui.build("em",{parent:t}),e.name&&hui.dom.setText(this.info,e.name),this.finished=!1,this.error=!1},hui.ui.Upload.Item.prototype={getInfo:function(){return this.data},isFinished:function(){return this.finished},setError:function(e){this._setStatus(e||hui.ui.getTranslated({en:"Error",da:"Fejl"})),hui.cls.add(this.element,"hui_upload_item_error"),this.progress.hide(),this.progress.setValue(0),this.finished=!0},setSuccess:function(e){this._setStatus(hui.ui.getTranslated({en:"Complete",da:"FÃ¦rdig"})),this.progress.setValue(1),this.finished=!0,hui.cls.add(this.element,"hui_upload_item_success")},updateProgress:function(e,t){return this.setProgress(e/t),this},setProgress:function(e){return this._setStatus(hui.ui.getTranslated({en:"Transfering",da:"OverfÃ¸rer"})),this.progress.setValue(Math.min(.9999,e)),this},setWaiting:function(){return this._setStatus("Venter"),this.progress.setWaiting(),this},hide:function(){this.element.hide()},remove:function(){hui.dom.remove(this.element)},_setStatus:function(e){this._status!==e&&(hui.dom.setText(this.status,e),this._status=e)}},hui.ui.Upload._nameIndex=0,hui.ui.Upload._buildForm=function(e){var t=e.options;hui.ui.Upload._nameIndex++;e="hui_upload_"+hui.ui.Upload._nameIndex;hui.log("Frame: name="+e);var i=hui.build("form");if(i.setAttribute("action",t.url||""),i.setAttribute("method","post"),i.setAttribute("enctype","multipart/form-data"),i.setAttribute("encoding","multipart/form-data"),i.setAttribute("target",e),t.parameters)for(var n in t.parameters){var s=hui.build("input",{type:"hidden",name:n});s.value=t.parameters[n],i.appendChild(s)}return i},hui.ui.Upload.Frame=function(e){this.parent=e},hui.ui.Upload.Frame.support=function(){return{supported:!0,multiple:!1}},hui.ui.Upload.Frame.prototype={initialize:function(){var e=this.parent.options,t=this.form=hui.ui.Upload._buildForm(this.parent),i=t.getAttribute("target"),i=this.iframe=hui.build("iframe",{name:i,id:i,src:hui.ui.getURL("html/blank.html"),style:"display:none"});this.parent.element.appendChild(i);var n=this;hui.listen(i,"load",function(){n._uploadComplete()}),this.fileInput=hui.build("input",{type:"file",name:e.fieldName}),hui.listen(this.fileInput,"change",this._onSubmit.bind(this)),t.appendChild(this.fileInput);e=hui.build("span",{class:"hui_upload_button_input"});e.appendChild(t);t=this.parent.$_getButtonContainer();t.insertBefore(e,t.firstChild)},setParameter:function(e,t){for(var i=this.form.getElementsByTagName("input"),n=0;n<i.length;n++)if(i[n].name==e)return void(i[n].value=t);hui.build("input",{type:"hidden",name:e,value:t,parent:this.form})},_rebuildParameters:function(){hui.browser.msie&&hui.each(this.parent.options.parameters,function(e,t){this.form[e].value=t}.bind(this))},_rebuildFileInput:function(){var e=this.parent.options,t=this.fileInput;this.fileInput=hui.build("input",{type:"file",name:e.fieldName}),hui.listen(this.fileInput,"change",this._onSubmit.bind(this)),hui.dom.replaceNode(t,this.fileInput),hui.log("Frame: input replaced")},_getFileName:function(){return this.fileInput.value.split("\\").pop()},_onSubmit:function(){this.form.style.display="none",this.uploading=!0,this._rebuildParameters(),this.form.submit(),this.item=this.parent.$_addItem({name:this._getFileName()}),this.item.setWaiting(),this._rebuildFileInput(),hui.log("Frame: Upload started:"+this.uploading)},_uploadComplete:function(){var e,t;hui.log("complete:"+this.uploading+" / "+this.parent.name),this.uploading&&(this.uploading=!1,e=this._isSuccessResponse(),hui.log("Frame: Upload complete: success="+e),(t=this.item)&&(e?(this.parent.$_itemSuccess(t),hui.log("Frame: Upload succeeded")):(this.parent.$_itemFail(t),hui.log("Frame: Upload failed!"))),this.iframe.src=hui.ui.getURL("html/blank.html"),this.form.style.display="block",this.form.reset())},_isSuccessResponse:function(){return-1!==hui.frame.getDocument(this.iframe).body.innerHTML.indexOf("SUCCESS")}},hui.ui.Upload.HTML5=function(e){this.parent=e},hui.ui.Upload.HTML5.support=function(){var e=void 0!==window.File&&(hui.browser.webkit||hui.browser.gecko||hui.browser.msie10||hui.browser.msie11);return hui.log("HTML5: supported="+e),{supported:e,multiple:!0}},hui.ui.Upload.HTML5.prototype={initialize:function(){var e=this.parent.options,t=hui.build("span",{class:"hui_upload_button_input"});this.form=hui.build("form",{style:"display: inline-block; margin:0;",parent:t});var i={type:"file",name:e.fieldName,parent:this.form};e.multiple&&(i.multiple="multiple"),this.fileInput=hui.build("input",i);i=this.parent.$_getButtonContainer();i.insertBefore(t,i.firstChild),hui.listen(this.fileInput,"change",this._submit.bind(this))},_submit:function(e){var t=this.fileInput.files;this.parent._transferFiles(t),this._resetInput()},_resetInput:function(){this.form.reset()}},hui.ui.ProgressBar=function(e){this.element=hui.get(e.element),this.name=e.name,this.WAITING=e.small?"hui_progressbar_small_waiting":"hui_progressbar_waiting",this.COMPLETE=e.small?"hui_progressbar_small_complete":"hui_progressbar_complete",this.options=e||{},this.indicator=hui.get.firstByTag(this.element,"div"),hui.ui.extend(this)},hui.ui.ProgressBar.create=function(e){return((e=e||{}).element=hui.build("div",{class:e.small?"hui_progressbar hui_progressbar_small":"hui_progressbar"})).appendChild(document.createElement("div")),new hui.ui.ProgressBar(e)},hui.ui.ProgressBar.prototype={setValue:function(e){var t=this.element;this.waiting&&hui.cls.remove(t,this.WAITING),hui.cls.set(t,this.COMPLETE,1==e),hui.animate(this.indicator,"width",100*e+"%",200)},setWaiting:function(){this.waiting=!0,this.indicator.style.width=0,hui.cls.add(this.element,this.WAITING)},reset:function(){var e=this.element;this.waiting&&hui.cls.remove(e,this.WAITING),hui.cls.remove(e,this.COMPLETE),this.indicator.style.width="0%"},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="block"}},hui.ui.Gallery=function(e){this.options=e||{},this.name=e.name,this.element=hui.get(e.element),this.body=hui.get.firstByClass(this.element,"hui_gallery_body"),this.objects=[],this.nodes=[],this.selected=[],this.width=100,this.height=100,this.revealing=!1,hui.ui.extend(this),e.dropFiles&&this._addDrop(),this.options.source&&this.options.source.listen(this),this.element.parentNode&&hui.cls.has(this.element.parentNode,"hui_overflow")&&(this.revealing=!0,hui.listen(this.element.parentNode,"scroll",this._reveal.bind(this)))},hui.ui.Gallery.create=function(e){return(e=e||{}).element=hui.build("div",{class:"hui_gallery",html:'<div class="hui_gallery_progress"></div><div class="hui_gallery_body"></div>'}),new hui.ui.Gallery(e)},hui.ui.Gallery.prototype={_addDrop:function(){hui.drag.listen({element:this.element,hoverClass:"hui_gallery_drop",$dropFiles:function(e){this.fire("filesDropped",e)}.bind(this),$dropURL:function(e){this.fire("urlDropped",e)}.bind(this)})},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="",this.options.source&&this.options.source.refresh()},setSize:function(e){this.width=e,this.height=e;for(var t=0;t<this.nodes.length;t++){var i=this.nodes[t];i.style.width=e+"px",i.style.height=e+"px"}this.maxRevealed=0,clearTimeout(this._timer),this._timer=setTimeout(function(){for(var e=0;e<this.nodes.length;e++)this.nodes[e].revealed=!1;this._reveal()}.bind(this),500)},reRender:function(){this._render()},setObjects:function(e){this.selected=[],this.objects=e,this._render(),this.fire("selectionReset")},getObjects:function(){return this.objects},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$objectsLoaded:function(e){this.setObjects(e)},$optionsLoaded:function(e){this.setObjects(e)},_render:function(){this.nodes=[],this.maxRevealed=0,this.body.innerHTML="",hui.each(this.objects,function(e,t){var i=0;!this.revealing&&e.height<e.width&&(i=(this.height-this.height*e.height/e.width)/2);hui.build("img",{style:"margin:"+i+"px auto 0px"});var n=hui.build("div",{class:"hui_gallery_item",style:"width:"+this.width+"px; height:"+this.height+"px"});this.revealing||(n.style.backgroundImage="url("+this._resolveImageUrl(e)+")"),hui.listen(n,"click",function(e){this._itemClicked(t,e)}.bind(this)),n.dragDropInfo={kind:"image",icon:"common/image",id:e.id,title:e.name||e.title},n.onmousedown=function(e){return hui.ui.startDrag(e,n),!1},hui.listen(n,"dblclick",function(){this._onItemDoubleClick(t)}.bind(this)),this.body.appendChild(n),this.nodes.push(n)}.bind(this)),this._reveal(),this.fireSizeChange()},_reveal:function(){if(this.revealing){var e=this.element.parentNode,t=e.scrollTop+e.clientHeight;if(!(t<=this.maxRevealed)){this.maxRevealed=t;for(var i=0,n=this.nodes.length;i<n;i++){var s=this.nodes[i];s.revealed||(s.offsetTop<t?this._load(s,this.objects[i]):hui.cls.add(s,"hui_is_pending"))}}}},_load:function(e,t){hui.cls.add(e,"hui_is_loading");var i=this._resolveImageUrl(t),t=new Image;t.onload=function(){e.className="hui_gallery_item",hui.cls.remove(e,"hui_is_pending"),hui.cls.remove(e,"hui_is_loading"),e.style.backgroundImage="url("+i+")"},t.onerror=function(){hui.cls.remove(e,"hui_is_loading"),hui.cls.add(e,"hui_is_error")},t.src=i,e.revealed=!0},_updateUI:function(){for(var e=this.selected,t=0;t<this.nodes.length;t++)hui.cls.set(this.nodes[t],"hui_gallery_item_selected",hui.array.contains(e,t))},_resolveImageUrl:function(e){return hui.ui.callDelegates(this,"buildImageUrl",{item:e,width:this.width,height:this.height})||hui.ui.resolveImageUrl(this,e,this.width,this.height)},_itemClicked:function(e,t){this.busy||((t=hui.event(t)).metaKey?hui.array.flip(this.selected,e):this.selected=[e],this.fire("select",this.selected),this._updateUI())},isOneSelection:function(){return 1==this.selected.length},getSelectionSize:function(){return this.selected.length},getSelection:function(){for(var e=[],t=0;t<this.selected.length;t++){var i=this.objects[this.selected[t]];i&&e.push(i)}return e},getSelectionIds:function(){for(var e=[],t=0;t<this.selected.length;t++){var i=this.objects[this.selected[t]];i&&e.push(i.id)}return e},getFirstSelection:function(){return 0<this.selected.length?this.objects[this.selected[0]]:null},_onItemDoubleClick:function(e){this.busy||(this.fire("itemOpened",this.objects[e]),this.fire("open",this.objects[e]))},setSource:function(e){this.options.source!=e&&(this.options.source&&this.options.source.unListen(this),e.listen(this),(this.options.source=e).refresh())},$sourceIsBusy:function(){this._setBusy(!0)},$sourceIsNotBusy:function(){this._setBusy(!1)},$visibilityChanged:function(){hui.dom.isVisible(this.element)&&(this.options.source&&this.options.source.refreshFirst(),this._reveal())},$$layout:function(){0<this.nodes.length&&this._reveal()},_setBusy:function(e){var t;this.busy=e,window.clearTimeout(this.busytimer),e?(t=this.element,this.busytimer=window.setTimeout(function(){hui.cls.add(t,"hui_gallery_busy")},300)):hui.cls.remove(this.element,"hui_gallery_busy")}},hui.ui.Calendar=function(e){this.name=e.name,this.options=hui.override({startHour:7,endHour:24},e),this.element=hui.get(e.element),this.head=hui.get.firstByTag(this.element,"thead"),this.body=hui.get.firstByTag(this.element,"tbody"),this.date=new Date,hui.ui.extend(this),this.buildUI(),this.updateUI(),this.options.source&&this.options.source.listen(this)},hui.ui.Calendar.prototype={show:function(){this.element.style.display="block",this.options.source&&this.options.source.refresh()},hide:function(){this.element.style.display="none"},getFirstDay:function(){var e=new Date(this.date.getTime());return e.setDate(e.getDate()-e.getDay()+1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e},getLastDay:function(){var e=new Date(this.date.getTime());return e.setDate(e.getDate()-e.getDay()+7),e.setHours(23),e.setMinutes(59),e.setSeconds(59),e},clearEvents:function(){this.events=[];for(var e=hui.get.byClass(this.element,"hui_calendar_event"),t=0;t<e.length;t++)hui.dom.remove(e[t]);this.hideEventViewer()},$objectsLoaded:function(e){try{this.setEvents(e)}catch(e){hui.log(e)}},$sourceIsBusy:function(){this.setBusy(!0)},$sourceShouldRefresh:function(){return"none"!=this.element.style.display},setEvents:function(e){e=e||[];for(var t=0;t<e.length;t++){var i=e[t];"object"!=typeof i.startTime&&(i.startTime=new Date(1e3*parseInt(i.startTime))),"object"!=typeof i.endTime&&(i.endTime=new Date(1e3*parseInt(i.endTime)))}this.setBusy(!1),this.clearEvents(),this.events=e;var s=this,h=40*(this.options.endHour-this.options.startHour),u=this.getFirstDay().getWeekOfYear(),o=this.getFirstDay().getYear();hui.each(this.events,function(e){var t,i,n=hui.get.byClass(s.body,"hui_calendar_day")[e.startTime.getDay()-1];n&&e.startTime.getWeekOfYear()==u&&e.startTime.getYear()==o&&(t=hui.build("div",{class:"hui_calendar_event",parent:n}),i=40*((60*e.startTime.getHours()+e.startTime.getMinutes())/60-s.options.startHour)-1,n=(e.endTime.getTime()-e.startTime.getTime())/1e3/60/60*40+1,n=Math.min(h-i,n),hui.style.set(t,{marginTop:i+"px",height:n+"px",visibility:"hidden"}),n=hui.build("div",{parent:t}),hui.build("p",{class:"hui_calendar_event_time",text:e.startTime.dateFormat("H:i"),parent:n}),hui.build("p",{class:"hui_calendar_event_text",text:e.text,parent:n}),e.location&&hui.build("p",{class:"hui_calendar_event_location",text:e.location,parent:n}),window.setTimeout(function(){hui.effect.bounceIn({element:t})},200*Math.random()),hui.listen(t,"click",function(){s.eventWasClicked(t)}))})},eventWasClicked:function(e){this.showEvent(e)},setBusy:function(e){hui.cls.set(this.element,"hui_calendar_busy",e)},updateUI:function(){for(var e=this.getFirstDay(),t=hui.get.byClass(this.head,"day"),i=0;i<t.length;i++){var n=new Date(e.getTime());n.setDate(n.getDate()+i),hui.dom.setText(t[i],n.dateFormat("l \\d. d M"))}},buildUI:function(){var e=hui.get.firstByClass(this.element,"hui_calendar_bar");this.toolbar=hui.ui.Toolbar.create({labels:!1}),e.appendChild(this.toolbar.getElement());e=hui.ui.Button.create({name:"huiCalendarPrevious",text:"",icon:"monochrome/previous"});e.listen(this),this.toolbar.add(e);e=hui.ui.Button.create({name:"huiCalendarToday",text:"Idag"});e.click(function(){this.setDate(new Date)}.bind(this)),this.toolbar.add(e);e=hui.ui.Button.create({name:"huiCalendarNext",text:"",icon:"monochrome/next"});e.listen(this),this.toolbar.add(e),this.datePickerButton=hui.ui.Button.create({name:"huiCalendarDatePicker",text:"VÃ¦lg dato..."}),this.datePickerButton.listen(this),this.toolbar.add(this.datePickerButton);for(var t=hui.get.firstByClass(this.body,"hui_calendar_day"),i=this.options.startHour;i<=this.options.endHour;i++){var n=hui.build("div",{class:"hui_calendar_time",html:"<span><em>"+i+":00</em></span>"});i==this.options.startHour&&hui.cls.add(n,"hui_calendar_time_first"),i==this.options.endHour&&hui.cls.add(n,"hui_calendar_time_last"),t.appendChild(n)}},$click$huiCalendarPrevious:function(){var e=new Date(this.date.getTime());e.setDate(this.date.getDate()-7),this.setDate(e)},$click$huiCalendarNext:function(){var e=new Date(this.date.getTime());e.setDate(this.date.getDate()+7),this.setDate(e)},setDate:function(e){this.date=new Date(e.getTime()),this.updateUI(),this.refresh(),this.datePicker&&this.datePicker.setValue(this.date)},$click$huiCalendarDatePicker:function(){this.showDatePicker()},refresh:function(){this.clearEvents(),this.setBusy(!0);var e={startTime:this.getFirstDay(),endTime:this.getLastDay()};this.fire("calendarSpanChanged",e),hui.ui.firePropertyChange(this,"startTime",this.getFirstDay()),hui.ui.firePropertyChange(this,"endTime",this.getLastDay())},valueForProperty:function(e){return"startTime"==e?this.getFirstDay():"endTime"==e?this.getLastDay():this[e]},showDatePicker:function(){var e;this.datePickerPanel||(this.datePickerPanel=hui.ui.BoundPanel.create(),this.datePicker=hui.ui.DatePicker.create({name:"huiCalendarDatePicker",value:this.date}),this.datePicker.listen(this),this.datePickerPanel.add(this.datePicker),this.datePickerPanel.addSpace(3),(e=hui.ui.Button.create({name:"huiCalendarDatePickerClose",text:"Luk",small:!0,rounded:!0})).listen(this),this.datePickerPanel.add(e)),this.datePickerPanel.position(this.datePickerButton.getElement()),this.datePickerPanel.show()},$click$huiCalendarDatePickerClose:function(){this.datePickerPanel.hide()},$dateChanged$huiCalendarDatePicker:function(e){this.setDate(e)},showEvent:function(e){var t;this.eventViewerPanel||(this.eventViewerPanel=hui.ui.BoundPanel.create({width:270,padding:3}),this.eventInfo=hui.ui.InfoView.create(null,{height:240,clickObjects:!0}),this.eventViewerPanel.add(this.eventInfo),this.eventViewerPanel.addSpace(5),(t=hui.ui.Button.create({name:"huiCalendarEventClose",text:"Luk"})).listen(this),this.eventViewerPanel.add(t)),this.eventInfo.clear(),this.eventInfo.setBusy(!0),this.eventViewerPanel.position(e),this.eventViewerPanel.show(),hui.ui.callDelegates(this,"requestEventInfo")},updateEventInfo:function(e,t){this.eventInfo.setBusy(!1),this.eventInfo.update(t)},$click$huiCalendarEventClose:function(){this.hideEventViewer()},hideEventViewer:function(){this.eventViewerPanel&&this.eventViewerPanel.hide()}},hui.ui.DatePicker=function(e){this.name=e.name,this.element=hui.get(e.element),this.options={},hui.override(this.options,e),this.cells=[],this.title=hui.get.firstByTag(this.element,"strong"),this.today=new Date,this.value=this.options.value?new Date(this.options.value.getTime()):new Date,this.viewDate=new Date(this.value.getTime()),this.viewDate.setDate(1),hui.ui.extend(this),this._addBehavior(),this._updateUI()},hui.ui.DatePicker.create=function(e){for(var t=e.element=hui.build("div",{class:"hui_datepicker",html:'<div class="hui_datepicker_header"><a class="hui_datepicker_next"></a><a class="hui_datepicker_previous"></a><strong></strong></div>'}),i=hui.build("table",{parent:t}),t=hui.build("thead",{parent:i}),n=hui.build("tr",{parent:t}),s=0;s<7;s++)n.appendChild(hui.build("th",{text:Date.dayNames[s].substring(0,3)}));for(var h=hui.build("tbody",{parent:i}),u=0;u<6;u++)for(var o=hui.build("tr",{parent:h}),a=0;a<7;a++)hui.build("td",{parent:o});return new hui.ui.DatePicker(e)},hui.ui.DatePicker.prototype={_addBehavior:function(){var i=this;this.cells=hui.findAll("td",this.element),hui.each(this.cells,function(e,t){hui.listen(e,"mousedown",function(e){hui.stop(e),i._selectCell(t)})});var e=hui.get.firstByClass(this.element,"hui_datepicker_next"),t=hui.get.firstByClass(this.element,"hui_datepicker_previous");hui.listen(e,"mousedown",function(e){hui.stop(e),i.next()}),hui.listen(t,"mousedown",function(e){hui.stop(e),i.previous()})},setValue:function(e){e=e||new Date,this.value=new Date(e.getTime()),this.viewDate=new Date(e.getTime()),this.viewDate.setDate(1),this._updateUI()},_updateUI:function(){hui.dom.setText(this.title,this.viewDate.dateFormat("F Y"));for(var e=this.value.getFullYear()==this.viewDate.getFullYear(),t=this.viewDate.getMonth(),i=0;i<this.cells.length;i++){var n=this._indexToDate(i),s=this.cells[i];n.getMonth()<t||n.getMonth()>t?s.className="hui_datepicker_dimmed":s.className="",n.getDate()==this.value.getDate()&&n.getMonth()==this.value.getMonth()&&e&&hui.cls.add(s,"hui_datepicker_selected"),n.getDate()==this.today.getDate()&&n.getMonth()==this.today.getMonth()&&n.getFullYear()==this.today.getFullYear()&&hui.cls.add(s,"hui_datepicker_today"),hui.dom.setText(s,n.getDate())}},_getPreviousMonth:function(){var e=new Date(this.viewDate.getTime());return e.setMonth(e.getMonth()-1),e},_getNextMonth:function(){var e=new Date(this.viewDate.getTime());return e.setMonth(e.getMonth()+1),e},previous:function(){this.viewDate=this._getPreviousMonth(),this._updateUI()},next:function(){this.viewDate=this._getNextMonth(),this._updateUI()},_selectCell:function(e){this.value=this._indexToDate(e),this.viewDate=new Date(this.value.getTime()),this.viewDate.setDate(1),this._updateUI(),hui.ui.callDelegates(this,"dateChanged",this.value)},_indexToDate:function(e){var t,i=this.viewDate.getDay(),n=this.viewDate.getDaysInMonth(),s=this._getPreviousMonth().getDaysInMonth();return e<i?(t=this._getPreviousMonth()).setDate(s-i+e+1):i+n-1<e?(t=this._getPreviousMonth()).setDate(e-i-n+1):(t=new Date(this.viewDate.getTime())).setDate(e+1-i),t}},Date.monthNames=["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],Date.dayNames=["S","M","T","O","T","F","L"],hui.ui.Layout=function(e){this.name=e.name,this.options=e||{},this.element=hui.get(e.element),hui.ui.extend(this)},hui.ui.Layout.create=function(e){return(e=hui.override({text:"",highlighted:!1,enabled:!0},e)).element=hui.dom.parse('<table class="hui_layout"><tbody class="hui_layout"><tr class="hui_layout_middle"><td class="hui_layout_middle"><table class="hui_layout_middle"><tr><td class="hui_layout_left hui_context_sidebar"><div class="hui_layout_left"></div></td><td class="hui_layout_center"></td></tr></table></td></tr></tbody></table>'),new hui.ui.Layout(e)},hui.ui.Layout.prototype={addToLeft:function(e){hui.get.firstByClass(this.element,"hui_layout_left").appendChild(e.element)},addToCenter:function(e){hui.get.firstByClass(this.element,"hui_layout_center").appendChild(e.element)},$$layout:function(){var e,t,i;!hui.browser.gecko||(e=hui.get.firstByClass(this.element,"hui_layout_center"))&&(e.style.height="100%"),(window.navigator.userAgent.indexOf("AppleWebKit/536")||hui.browser.msie7||hui.browser.msie8||hui.browser.msie9)&&hui.dom.isVisible(this.element)&&(void 0===this.diff&&(e=hui.get.firstByClass(this.element,"hui_layout_top"),t=hui.get.firstByTag(e,"*").clientHeight,i=0,!(e=hui.get.firstByTag(hui.get.firstByTag(this.element,"tfoot"),"td"))||(e=hui.get.firstByTag(e,"*"))&&(i=e.clientHeight),t+=hui.position.getTop(this.element),this.diff=i+t,this.element.parentNode!==document.body&&(this.diff+=15)),i=hui.get.firstByTag(this.element,"tbody"),t=hui.get.firstByTag(i,"td"),i=hui.window.getViewHeight()-this.diff+5,t.style.height=i+"px")}},function(t){hui.ui.Dock=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,t.call(this,e),this._attach()},hui.ui.Dock.prototype={nodes:{iframe:".hui_dock_frame",resizer:".hui_dock_sidebar_line",sidebar:".hui_dock_sidebar",main:".hui_dock_main"},_attach:function(){hui.browser.msie&&hui.cls.add(this.element,"hui-is-legacy"),hui.ui.listen({$frameLoaded:function(e){e==hui.frame.getWindow(this.nodes.iframe)&&this._setBusy(!1)}.bind(this)}),hui.listen(this.nodes.iframe,"load",this._load.bind(this)),this.nodes.resizer&&hui.drag.register({element:this.nodes.resizer,onStart:function(){this.hasDragged=!1,hui.cls.add(this.element,"hui-is-resizing")}.bind(this),onMove:function(e){e=e.getLeft();this._updateSidebarWidth(e=e<10?10:e),this.hasDragged||hui.cls.remove(this.element,"hui-is-collapsed"),this.hasDragged=!0}.bind(this),onEnd:function(){this.hasDragged?10==this.latestWidth?this.collapse():this.latestExpandedWidth=this.latestWidth:this.toggle(),hui.cls.remove(this.element,"hui-is-resizing"),hui.ui.callVisible(this),hui.ui.reLayout()}.bind(this)})},_updateSidebarWidth:function(e){this.latestWidth=e,this.nodes.sidebar.style.width=e-1+"px",this.nodes.main.style.left=e+"px",this.nodes.resizer.style.left=e-5+"px"},setUrl:function(e){this._setBusy(!0),hui.frame.getDocument(this.nodes.iframe).location.href=e},collapse:function(){hui.cls.add(this.element,"hui-is-collapsed"),this._updateSidebarWidth(10),hui.ui.callVisible(this)},expand:function(){hui.cls.remove(this.element,"hui-is-collapsed"),this._updateSidebarWidth(this.latestExpandedWidth||200),hui.ui.callVisible(this)},toggle:function(){hui.cls.has(this.element,"hui-is-collapsed")?this.expand():this.collapse()},_load:function(){this._setBusy(!1)},_setBusy:function(e){hui.cls.set(this.element,"hui-is-busy",e)}},hui.extend(hui.ui.Dock,t),hui.define("hui.ui.Dock",hui.ui.Dock)}(hui.ui.Component),hui.ui.Box=function(e){this.options=hui.override({},e),this.name=e.name,this.element=hui.get(e.element),this.visible=!this.options.absolute,hui.ui.extend(this),this.nodes.close&&hui.listen(this.nodes.close,"click",this._close.bind(this))},hui.ui.Box.create=function(e){var t=(e=e||{}).variant||"standard",i=e.closable?'<a class="hui_box_close hui_box_close_'+t+'" href="#"></a>':"";return e.title&&(i+='<div class="hui_box_header"><strong class="hui_box_title">'+hui.string.escape(hui.ui.getTranslated(e.title))+"</strong></div>"),i+='<div class="hui_box_body" style="'+(e.padding?"padding: "+e.padding+"px;":"")+(e.width?"width: "+e.width+"px;":"")+'"></div>',e.element=hui.build("div",{class:"hui_box hui_box_"+t,html:i,style:e.width?e.width+"px":null}),e.absolute&&hui.cls.add(e.element,"hui_box_absolute"),new hui.ui.Box(e)},hui.ui.Box.prototype={nodes:{body:".hui_box_body",close:".hui_box_close"},_close:function(e){hui.stop(e),this.hide(),this.fire("boxWasClosed"),this.fire("close")},shake:function(){hui.effect.shake({element:this.element})},addToDocument:function(){document.body.appendChild(this.element)},add:function(e){var t=this.nodes.body;e.getElement?t.appendChild(e.getElement()):t.appendChild(e)},show:function(){var e,t,i=this.element;this.options.modal&&(t=hui.ui.nextPanelIndex(),i.style.zIndex=t+1,hui.ui.showCurtain({widget:this,zIndex:t})),this.options.absolute?(hui.style.set(i,{display:"block",visibility:"hidden"}),e=i.clientWidth,t=(hui.window.getViewHeight()-i.clientHeight)/2+hui.window.getScrollTop(),hui.style.set(i,{marginLeft:e/-2+"px",top:t+"px",display:"block",visibility:"visible"})):i.style.display="block",this.visible=!0,hui.ui.callVisible(this)},isVisible:function(){return this.visible},$$layout:function(){var e,t,i;this.options.absolute&&this.visible&&(t=(e=this.element).clientWidth,i=(hui.window.getViewHeight()-e.clientHeight)/2+hui.window.getScrollTop(),hui.style.set(e,{marginLeft:t/-2+"px",top:i+"px"}))},hide:function(){hui.ui.hideCurtain(this),this.element.style.display="none",this.visible=!1,hui.ui.callVisible(this)},$curtainWasClicked:function(){this.fire("boxCurtainWasClicked"),this.options.curtainCloses&&this._close()}},hui.ui.Wizard=function(e){this.options=e||{},this.element=hui.get(e.element),this.name=e.name,this.container=hui.get.firstByClass(this.element,"hui_wizard_steps"),this.steps=hui.get.byClass(this.element,"hui_wizard_step"),this.anchors=hui.get.byClass(this.element,"hui_wizard_selection"),this.selected=0,hui.ui.extend(this),this._addBehavior()},hui.ui.Wizard.prototype={_addBehavior:function(){var i=this;hui.each(this.anchors,function(e,t){hui.listen(e,"mousedown",function(e){hui.stop(e),i.goToStep(t)}),hui.listen(e,"click",function(e){hui.stop(e)})})},getStep:function(){return this.selected},goToStep:function(e){var t=this.container;t.style.height=t.clientHeight+"px",hui.cls.remove(this.anchors[this.selected],"hui_selected"),this.steps[this.selected].style.display="none",hui.cls.add(this.anchors[e],"hui_selected"),this.steps[e].style.display="block",this.selected=e,hui.animate(t,"height",this.steps[e].clientHeight+"px",500,{ease:hui.ease.slowFastSlow,onComplete:function(){t.style.height=""}}),hui.ui.callVisible(this),this.fire("stepChanged",this.selected)},isFirst:function(){return 0===this.selected},isLast:function(){return this.selected==this.steps.length-1},next:function(){this.selected<this.steps.length-1&&this.goToStep(this.selected+1)},previous:function(){0<this.selected&&this.goToStep(this.selected-1)}},hui.ui.Input=function(e){this.options=hui.override({placeholderElement:null,validator:null},e);var t=this.element=hui.get(e.element);this.element.setAttribute("autocomplete","off"),this.value=this._validate(this.element.value),this.isPassword="password"==this.element.type,this.name=e.name,hui.ui.extend(this),this._addBehavior(),this.options.placeholderElement&&""!==this.value&&hui.style.set(this.options.placeholderElement,{opacity:0,display:"none"}),this._checkPlaceholder();try{t==document.activeElement&&this._onFocus()}catch(e){}},hui.ui.Input.prototype={_addBehavior:function(){var e=this.element,t=this.options.placeholderElement;hui.listen(e,"keyup",this._onKeyUp.bind(this)),hui.listen(e,"blur",this._onBlur.bind(this)),t&&(hui.listen(e,"focus",this._onFocus.bind(this)),hui.listen(e,"blur",this._checkPlaceholder.bind(this)),t&&(t.style.cursor="text",hui.listen(t,"mousedown",this.focus.bind(this)),hui.listen(t,"click",this.focus.bind(this)))),"submit"==e.type&&hui.listen(e,"click",function(e){this.fire("click",e)}.bind(this))},_onFocus:function(){var e=this.element,t=this.options.placeholderElement;t&&""===e.value&&hui.style.set(t,{opacity:0,display:"none"})},_validate:function(e){var t=this.options.validator;return t?(t=t.validate(e),hui.cls.set(this.element,"hui_invalid",!t.valid),t.value):e},_checkPlaceholder:function(){this.options.placeholderElement&&""===this.value&&hui.effect.fadeIn({element:this.options.placeholderElement,duration:200}),this.isPassword&&!hui.browser.msie&&(this.element.type="password")},_onKeyUp:function(){var e,t;this.value!==this.element.value&&(t=(e=this._validate(this.element.value))!==this.value,this.value=e,t&&this.fire("valueChanged",this.value))},_onBlur:function(){hui.cls.remove(this.element,"hui_invalid"),this.element.value=this.value||""},getValue:function(){return this.value},setValue:function(e){this.element.value=e=null==e?"":e,this.value=this._validate(e)},isEmpty:function(){return""===this.value},isBlank:function(){return hui.isBlank(this.value)},focus:function(){this.element.focus()},setError:function(e){var t=!!e;hui.cls.set(this.element,"hui_field_error",t),"string"==typeof e&&hui.ui.showToolTip({text:e,element:this.element,key:this.name}),t||hui.ui.hideToolTip({key:this.name})}},hui.ui.InfoView=function(e){this.options=hui.override({clickObjects:!1},e),this.element=hui.get(e.element),this.body=hui.get.firstByTag(this.element,"tbody"),this.name=e.name,hui.ui.extend(this)},hui.ui.InfoView.create=function(e){var t=(e=e||{}).element=hui.build("div",{class:"hui_infoview",html:"<table><tbody></tbody></table>"});return e.height&&hui.style.set(t,{height:e.height+"px",overflow:"auto",overflowX:"hidden"}),e.margin&&(t.style.margin=e.margin+"px"),new hui.ui.InfoView(e)},hui.ui.InfoView.prototype={addHeader:function(e){var t=hui.build("tr",{parent:this.body});hui.build("th",{class:"hui_infoview_header",colspan:"2",text:e,parent:t})},addProperty:function(e,t){var i=hui.build("tr",{parent:this.body});hui.build("th",{parent:i,text:e}),hui.build("td",{parent:i,text:t})},addObjects:function(e,t){var i,n,s;t&&0!==t.length&&((i=hui.build("tr",{parent:this.body})).appendChild(hui.build("th",{text:e})),n=hui.build("td",{parent:i}),s=this.options.clickObjects,hui.each(t,function(e){var t=hui.build("div",{text:e.title,parent:n});s&&(hui.cls.add(t,"hui_infoview_click"),hui.listen(t,"click",function(){hui.ui.callDelegates(this,"objectWasClicked",e)}))}))},setBusy:function(e){hui.cls.set(this,element,"hui_infoview_busy",e)},clear:function(){hui.dom.clear(this.body)},update:function(e){this.clear();for(var t=0;t<e.length;t++)switch(e[t].type){case"header":this.addHeader(e[t].value);break;case"property":this.addProperty(e[t].label,e[t].value);break;case"objects":this.addObjects(e[t].label,e[t].value)}}},hui.ui.Overflow=function(e){this.options=e,this.element=hui.get(e.element),this.body=hui.find(".hui_overflow_body",this.element),this.name=e.name,hui.ui.extend(this),this._attach()},hui.ui.Overflow.create=function(e){var t={html:'<div class="hui_overflow_body"></div>'};return(e=e||{}).height&&(t.style={height:e.height+"px"}),e.element=hui.build("div.hui_overflow",t),new hui.ui.Overflow(e)},hui.ui.Overflow.prototype={_attach:function(){hui.listen(this.body,"scroll",this._checkShadows.bind(this))},_checkShadows:function(){hui.browser.msie||(hui.cls.set(this.element,"hui-is-top",0<this.body.scrollTop),hui.cls.set(this.element,"hui-is-bottom",0<this.body.scrollHeight-this.body.scrollTop-this.body.clientHeight))},show:function(){this.element.style.display="",hui.ui.callVisible(this)},hide:function(){this.element.style.display="none",hui.ui.callVisible(this)},add:function(e){return this.body.appendChild(e.getElement?e.getElement():e),this},$$childSizeChanged:function(){this._checkShadows()},$$layout:function(){this.options.dynamic&&(this.element.style.height=hui.position.getRemainingHeight(this.element)+"px"),this._checkShadows()},$visibilityChanged:function(){hui.dom.isVisible(this.element)&&this.$$layout()}},hui.on(["hui.ui"],function(){hui.ui.SearchField=function(e){this.options=hui.override({expandedWidth:null},e),this.element=hui.get(e.element),this.name=e.name,this.field=hui.get.firstByTag(this.element,"input"),this.value=this.field.value,this.adaptive=hui.cls.has(this.element,"hui_searchfield-adaptive"),this.initialWidth=null,hui.ui.extend(this),this._addBehavior(),""!==this.value&&this._updateClass()},hui.ui.SearchField.create=function(e){return(e=e||{}).element=hui.build("span",{class:e.adaptive?"hui_searchfield hui_searchfield-adaptive":"hui_searchfield",html:'<span class="hui_searchfield_placeholder"></span><a href="javascript:void(0);" class="hui_searchfield_reset"></a><input class="hui_searchfield_input" type="text"/>'}),new hui.ui.SearchField(e)},hui.ui.SearchField.prototype={_addBehavior:function(){var t=this;hui.listen(this.field,"keyup",this._onKeyUp.bind(this));var i,e=hui.get.firstByTag(this.element,"a");e.tabIndex=-1,hui.browser.ipad?(i=function(){t.field.focus()},hui.listen(hui.get.firstByTag(this.element,"em"),"click",i)):(i=function(){t.field.focus(),t.field.select()},hui.listen(this.element,"mousedown",i),hui.listen(this.element,"mouseup",i),hui.listen(hui.get.firstByTag(this.element,"em"),"mousedown",i)),hui.listen(e,"mousedown",function(e){hui.stop(e),t.reset(),i()}),hui.listen(this.field,"focus",this._onFocus.bind(this)),hui.listen(this.field,"blur",this._onBlur.bind(this))},_onFocus:function(){this.focused=!0,this._updateClass(),0<this.options.expandedWidth&&(null===this.initialWidth&&(this.initialWidth=parseInt(hui.style.get(this.element,"width"))),hui.animate(this.element,"width",this.options.expandedWidth+"px",500,{ease:hui.ease.slowFastSlow}))},_onBlur:function(){this.focused=!1,this._updateClass(),null!==this.initialWidth&&hui.animate(this.element,"width",this.initialWidth+"px",500,{ease:hui.ease.slowFastSlow,delay:100})},_onKeyUp:function(e){this._fieldChanged(),13===e.keyCode&&this.fire("submit")},focus:function(){this.field.focus()},setValue:function(e){this.field.value=null==e?"":e,this._fieldChanged()},getValue:function(){return this.field.value},isEmpty:function(){return""===this.field.value},isBlank:function(){return hui.isBlank(this.field.value)},reset:function(){this.field.value="",this._fieldChanged()},_updateClass:function(){var e="hui_searchfield";this.adaptive&&(e+=" hui_searchfield-adaptive"),this.focused&&(e+=" hui_searchfield-focus"),""!==this.value&&(e+=" hui_searchfield-dirty"),this.element.className=e},_fieldChanged:function(){this.field.value!=this.value&&(this.value=this.field.value,this._updateClass(),this.fireValueChange())}},hui.define("hui.ui.SearchField",hui.ui.SearchField)}),hui.ui.Fragment=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,hui.ui.extend(this)},hui.ui.Fragment.prototype={show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},setVisible:function(e){this.element.style.display=e?"block":"none",hui.ui.callVisible(this)},setHTML:function(e){this.clear(),this.element.innerHTML=e,hui.dom.runScripts(this.element),this.fireSizeChange()},setContent:function(e){this.clear(),this.add(e)},clear:function(){hui.ui.destroyDescendants(this.element),this.element.innerHTML=""},add:function(e){this.element.appendChild(e.element||e),this.fireSizeChange()}},hui.ui.LocationPicker=function(e){this.name=(e=e||{}).name,this.options=e.options||{},this.element=hui.get(e.element),this.backendLoaded=void 0!==window.google&&void 0!==window.google.maps,this.defered=[],hui.ui.extend(this)},hui.ui.LocationPicker.prototype={show:function(t){var e,i,n,s;this.panel||(e=this.panel=hui.ui.BoundPanel.create({width:302,modal:!0}),i=hui.build("div",{style:"width:300px;height:300px;border:1px solid #bbb;"}),e.add(i),n=hui.ui.Buttons.create({align:"right",top:5}),(s=hui.ui.Button.create({text:{en:"Close",da:"Luk"},small:!0})).listen({$click:function(){e.hide()}}),e.add(n.add(s)),hui.style.set(e.element,{left:"-10000px",top:"-10000px",display:""}),this._whenReady(function(){var e={zoom:15,mapTypeId:google.maps.MapTypeId.TERRAIN};this.defaultCenter=new google.maps.LatLng(57.0465,9.9185),this.map=new google.maps.Map(i,e),google.maps.event.addListener(this.map,"click",function(e){e={latitude:e.latLng.lat(),longitude:e.latLng.lng()};this.setLocation(e),this.fire("locationChanged",e)}.bind(this)),this.setLocation(t.location)}.bind(this))),t.node&&this.panel.position(t.node),this.panel.show()},_whenReady:function(e){this.backendLoaded?e():(this.defered.push(e),this.loadingBackend||(this.loadingBackend=!0,window.huiLocationPickerReady=function(){this.loadingBackend=!1,this.backendLoaded=!0,hui.log("Google maps loaded!");for(var e=0;e<this.defered.length;e++)this.defered[e]();window.huiLocationPickerReady=null}.bind(this),hui.log("Loading google maps..."),hui.require(document.location.protocol+"//maps.google.com/maps/api/js?callback=huiLocationPickerReady&key=AIzaSyD-kxdnmiDp7Vs9U4oK_iL9UfaRJgbWF8w")))},setLocation:function(e){this._whenReady(function(){if(hui.log("Setting location..."),!e&&this.marker)return this.marker.setMap(null),void this.map.setCenter(this.defaultCenter);e=this._buildLatLng(e),this.marker?(this.marker.setPosition(e),this.marker.setMap(this.map)):this.marker=new google.maps.Marker({position:e,map:this.map}),this.map.setCenter(e)}.bind(this))},_buildLatLng:function(e){return e=e||{latitude:57.0465,longitude:9.9185},new google.maps.LatLng(e.latitude,e.longitude)}},hui.ui.Bar=function(e){this.options=hui.override({},e),this.name=e.name,this.element=hui.get(e.element),this.visible=!hui.cls.has(this.element,"hui_bar-absolute")&&"none"!=this.element.style.display,this.body=hui.get.firstByClass(this.element,"hui_bar_left"),hui.ui.extend(this)},hui.ui.Bar.create=function(e){var t="hui_bar";return(e=e||{}).variant&&(t+=" hui_bar-"+e.variant),e.absolute&&(t+=" hui_bar-absolute"),e.element=hui.build("div",{class:t}),hui.build("div",{class:"hui_bar_left",parent:e.element}),new hui.ui.Bar(e)},hui.ui.Bar.prototype={addToDocument:function(){document.body.appendChild(this.element)},add:function(e){this.body.appendChild(e.getElement())},addDivider:function(){hui.build("span",{class:"hui_bar_divider",parent:this.body})},addToRight:function(e){this._getRight().appendChild(e.getElement())},placeAbove:function(e){e.getElement&&(e=e.getElement()),hui.position.place({source:{element:this.element,vertical:1,horizontal:0},target:{element:e,vertical:0,horizontal:0}}),this.element.style.zIndex=hui.ui.nextTopIndex()},setVisible:function(e){this.visible!==e&&(e?this.show():this.hide())},show:function(){this.visible||(this.options.absolute?this.element.style.visibility="visible":(this.element.style.display="",hui.ui.reLayout()),this.visible=!0,hui.ui.callVisible(this))},hide:function(){this.visible&&(this.options.absolute?this.element.style.visibility="hidden":(this.element.style.display="none",hui.ui.reLayout()),this.visible=!1,hui.ui.callVisible(this))},_getRight:function(){return this.right||(this.right=hui.find(".hui_bar_right",this.element),this.right||(this.right=hui.build("div",{class:"hui_bar_right",parent:this.element}))),this.right},select:function(e){var t=hui.ui.getDescendants(this);hui.log(t);for(var i=0;i<t.length;i++){var n=t[i];n.getKey&&n.setSelected&&n.setSelected(n.getKey()==e)}},$clickButton:function(e){this.fire("clickButton",e)}},hui.ui.Bar.Button=function(e){this.options=hui.override({},e),this.name=e.name,this.element=hui.get(e.element),hui.listen(this.element,"click",this._click.bind(this)),hui.listen(this.element,"mousedown",this._mousedown.bind(this)),hui.listen(this.element,"mouseup",hui.stop),hui.ui.extend(this)},hui.ui.Bar.Button.create=function(e){var t=(e=e||{}).element=hui.build("a",{class:"hui_bar_button"});return e.icon&&t.appendChild(hui.ui.createIcon(e.icon,16)),new hui.ui.Bar.Button(e)},hui.ui.Bar.Button.prototype={_mousedown:function(e){this.fire("mousedown"),this.options.stopEvents&&hui.stop(e)},_click:function(e){this.fire("click"),this.options.stopEvents&&hui.stop(e),hui.ui.callAncestors(this,"$clickButton")},setSelected:function(e){hui.cls.set(this.element,"hui_bar_button-selected",e)},getKey:function(){return this.options.key}},hui.ui.Bar.Text=function(e){this.options=hui.override({},e),this.name=e.name,this.element=hui.get(e.element),hui.ui.extend(this)},hui.ui.Bar.Text.prototype={setText:function(e){hui.dom.setText(this.element,hui.ui.getTranslated(e))}},hui.ui.IFrame=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,hui.ui.extend(this)},hui.ui.IFrame.prototype={setUrl:function(e){this.element.setAttribute("src",e)},clear:function(){this.setUrl("about:blank")},getDocument:function(){return hui.frame.getDocument(this.element)},getWindow:function(){return hui.frame.getWindow(this.element)},reload:function(){this.getWindow().location.reload()},show:function(){this.element.style.display=""},hide:function(){this.element.style.display="none"}},hui.ui.VideoPlayer=function(e){this.options=e,this.element=hui.get(e.element),this.placeholder=hui.get.firstByTag(this.element,"div"),this.name=e.name,this.state={duration:0,time:0,loaded:0},this.handlers=[hui.ui.VideoPlayer.HTML5,hui.ui.VideoPlayer.QuickTime,hui.ui.VideoPlayer.Embedded],this.handler=null,hui.ui.extend(this),this.options.video&&(this.placeholder?hui.listen(this.placeholder,"click",function(){this.setVideo(this.options.video)}.bind(this)):hui.ui.onReady(function(){this.setVideo(this.options.video)}.bind(this)))},hui.ui.VideoPlayer.prototype={setVideo:function(e){this.placeholder&&(this.placeholder.style.display="none"),this.handler=this.getHandler(e),this.element.appendChild(this.handler.element),this.handler.showController()&&this.buildController()},getHandler:function(e){for(var t=0;t<this.handlers.length;t++){var i=this.handlers[t];if(i.isSupported(e))return new i(e,this)}},buildController:function(){var e=hui.build("div",{class:"hui_videoplayer_controller",parent:this.element});this.playButton=hui.build("a",{href:"#",class:"hui_videoplayer_playpause",text:"wait!",parent:e}),hui.listen(this.playButton,"click",this.playPause.bind(this)),this.status=hui.build("span",{class:"hui_videoplayer_status",parent:e})},onCanPlay:function(){this.playButton.update("Play")},onLoad:function(){this.state.loaded=this.state.duration,this.updateStatus()},onDurationChange:function(e){this.state.duration=e,this.updateStatus()},onTimeChange:function(e){this.state.time=e,this.updateStatus()},onLoadProgressChange:function(e){this.state.loaded=e,this.updateStatus()},playPause:function(){this.handler.isPlaying()?this.pause():this.play()},play:function(){this.handler.play()},pause:function(){this.handler.pause()},updateStatus:function(){this.status.innerHTML=this.state.time+" / "+this.state.duration+" / "+this.state.loaded}},hui.ui.VideoPlayer.HTML5=function(e,t){var i=this.element=hui.build("video",{width:e.width,height:e.height,src:e.src});hui.listen(i,"load",t.onLoad.bind(t)),hui.listen(i,"canplay",t.onCanPlay.bind(t)),hui.listen(i,"durationchange",function(e){t.onDurationChange(i.duration)}),hui.listen(i,"timeupdate",function(){t.onTimeChange(this.element.currentTime)}.bind(this))},hui.ui.VideoPlayer.HTML5.isSupported=function(e){return 528<hui.browser.webkitVersion&&("video/quicktime"===e.type||"video/mp4"===e.type)},hui.ui.VideoPlayer.HTML5.prototype={showController:function(){return!0},pause:function(){this.element.pause()},play:function(){this.element.play()},getTime:function(){return this.element.currentTime},isPlaying:function(){return!this.element.paused}},hui.ui.VideoPlayer.QuickTime=function(e,t){this.player=t;var i=this.element=hui.build("object",{width:e.width,height:e.height,data:e.src,type:"video/quicktime"});i.innerHTML='<param value="false" name="controller"/><param value="true" name="enablejavascript"/><param value="undefined" name="posterframe"/><param value="false" name="showlogo"/><param value="false" name="autostart"/><param value="true" name="cache"/><param value="white" name="bgcolor"/><param value="false" name="aggressivecleanup"/><param value="true" name="saveembedtags"/><param value="true" name="postdomevents"/>',hui.listen(i,"qt_canplay",t.onCanPlay.bind(t)),hui.listen(i,"qt_load",t.onLoad.bind(t)),hui.listen(i,"qt_progress",function(){t.onLoadProgressChange(i.GetMaxTimeLoaded()/3e3)}),hui.listen(i,"qt_durationchange",function(e){t.onDurationChange(i.GetDuration()/3e3)}),hui.listen(i,"qt_timechanged",function(){t.onTimeChange(i.GetTime())})},hui.ui.VideoPlayer.QuickTime.isSupported=function(e){return void 0===e.html},hui.ui.VideoPlayer.QuickTime.prototype={showController:function(){return!0},pause:function(){window.clearInterval(this.observer),this.element.Stop()},play:function(){this.element.Play(),this.observer=window.setInterval(this.observeVideo.bind(this),100)},observeVideo:function(){this.player.onTimeChange(this.element.GetTime()/3e3)},getTime:function(){return this.element.GetTime()},isPlaying:function(){return 0!==this.element.GetRate()}},hui.ui.VideoPlayer.Embedded=function(e,t){this.element=hui.build("div",{width:e.width,height:e.height,html:e.html})},hui.ui.VideoPlayer.Embedded.isSupported=function(e){return void 0!==e.html},hui.ui.VideoPlayer.Embedded.prototype={showController:function(){return!1},pause:function(){},play:function(){},getTime:function(){},isPlaying:function(){}},hui.ui.Segmented=function(e){this.options=hui.override({value:null,allowNull:!1},e),this.element=hui.get(e.element),this.name=e.name,this.value=this.options.value,this.state={enabled:!0,visible:!0},hui.ui.extend(this),hui.listen(this.element,"click",this._click.bind(this))},hui.ui.Segmented.create=function(e){var t=e.element=hui.build("span",{class:"hui_segmented hui_segmented-standard"});if(e.items)for(var i=0;i<e.items.length;i++){var n=e.items[i],s=hui.build("a.hui_segmented_item",{parent:t,href:"#",rel:n.value});n.icon&&s.appendChild(hui.ui.createIcon(n.icon,16)),n.text&&hui.build("span",{class:"hui_segmented_text",text:n.text,parent:s}),void 0!==e.value&&e.value==n.value&&hui.cls.add(s,"hui-is-selected")}return new hui.ui.Segmented(e)},hui.ui.Segmented.prototype={_click:function(e){if((e=new hui.Event(e)).stop(),this.state.enabled){var t=e.findByTag("a");if(t){for(var i=!1,e=t.getAttribute("rel"),n=hui.get.byClass(this.element,"hui-is-selected"),s=0;s<n.length;s++)hui.cls.remove(n[s],"hui-is-selected");e===this.value&&this.options.allowNull?(i=!0,this.value=null):(hui.cls.add(t,"hui-is-selected"),i=this.value!==e,this.value=e),i&&this.fireValueChange()}}},_draw:function(){var e=this.state,t=this.element;hui.cls.set(t,"hui-is-disabled",!e.enabled),t.style.display=e.visible?"":"none"},setEnabled:function(e){this.state.enabled=e,this._draw()},setVisible:function(e){this.state.visible=e,this._draw()},setValue:function(e){void 0===e&&(e=null);var t=this.element.getElementsByTagName("a");this.value=null;for(var i=0;i<t.length;i++)t[i].getAttribute("rel")===e?(hui.cls.add(t[i],"hui-is-selected"),this.value=e):hui.cls.remove(t[i],"hui-is-selected")},getValue:function(){return this.value}},hui.ui.Flash={fullVersion:void 0,getMajorVersion:function(){var e=this.getFullVersion();if(null==e)return null;e=(e+"").match(/[0-9]+/gi);return 0<e.length?parseInt(e[0]):null},getFullVersion:function(){if(void 0!==this.fullVersion)return this.fullVersion;var e,t,i,n,s=null;return navigator.plugins&&0<navigator.plugins.length?(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"])&&(i=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",t=(n=(e=navigator.plugins["Shockwave Flash"+i].description.split(" "))[2].split("."))[0],i=n[1],"d"==(n=""===(n=e[3])?e[4]:n)[0]?n=n.substring(1):"r"==n[0]&&0<(n=n.substring(1)).indexOf("d")&&(n=n.substring(0,n.indexOf("d"))),s=t+"."+i+"."+n):-1!=navigator.userAgent.toLowerCase().indexOf("webtv/2.6")?s=4:-1!=navigator.userAgent.toLowerCase().indexOf("webtv/2.5")?s=3:-1!=navigator.userAgent.toLowerCase().indexOf("webtv")?s=2:hui.browser.msie&&(s=this.getActiveXVersion()),this.fullVersion=s},getActiveXVersion:function(){var t,e;try{t=(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")).GetVariable("$version")}catch(e){}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),t="WIN 6,0,21,0",e.AllowScriptAccess="always",t=e.GetVariable("$version")}catch(e){}if(!t)try{t=(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3")).GetVariable("$version")}catch(e){}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),t="WIN 3,0,18,0"}catch(e){}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),t="WIN 2,0,0,11"}catch(e){t=-1}return t}},hui.ui.Link=function(e){this.options=e,this.name=e.name,this.element=hui.get(e.element),hui.ui.extend(this),this.addBehavior()},hui.ui.Link.prototype={addBehavior:function(){var t=this;hui.listen(this.element,"click",function(e){hui.stop(e),window.setTimeout(function(){t.fire("click")})})}},hui.ui.Links=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,hui.ui.extend(this),this.items=[],this.addBehavior(),this.selectedIndex=null,this.inputs={}},hui.ui.Links.prototype={addBehavior:function(){hui.listen(this.element,"click",this.onClick.bind(this)),hui.listen(this.element,"dblclick",this.onDblClick.bind(this))},reset:function(){this.setValue([])},setValue:function(e){this.items=e,this.selectedIndex=null,this.build()},getValue:function(){return this.items},onDblClick:function(e){e=new hui.Event(e),hui.selection.clear(),e.stop(e);var t=this.selectAndGetRow(e),e={text:t.text};e[t.kind]=t.value,this.editedLink=t;t=this.getEditWindow();this.editForm.reset(),this.editForm.setValues(e),t.show()},onClick:function(e){(e=new hui.Event(e)).stop();var t,i=e.getElement();hui.cls.has(i,"hui_links_remove")?(t=e.findByClass("hui_links_row"),hui.ui.confirmOverlay({element:i,text:"Vil du fjerne linket?",okText:"Ja, fjern",cancelText:"Annuller",onOk:function(){this.items.splice(t.hui_index,1),this.selectedIndex===t.hui_index&&(this.selectedIndex=null),this.build()}.bind(this)})):this.selectAndGetRow(e)},selectAndGetRow:function(e){var t=e.findByClass("hui_links_row");if(t){var i=t.hui_index;return null!==this.selectedIndex&&(e=hui.get.byClass(this.element,"hui_links_row")[this.selectedIndex],hui.cls.remove(e,"hui_links_row_selected")),this.selectedIndex=i,hui.cls.add(t,"hui_links_row_selected"),this.items[i]}},build:function(){var e,t,i,n,s=this.list||hui.get.firstByClass(this.element,"hui_links_list");for(s.innerHTML="",e=0;e<this.items.length;e++)n=this.items[e],(t=hui.build("div",{class:"hui_links_row"})).hui_index=e,t.appendChild(hui.ui.createIcon(n.icon,16)),i=hui.build("div",{class:"hui_links_text",text:n.text}),t.appendChild(i),n=hui.build("div",{class:"hui_links_info",text:hui.string.wrap(n.info)}),t.appendChild(n),n=hui.ui.createIcon("monochrome/delete",16),hui.cls.add(n,"hui_links_remove"),t.appendChild(n),s.appendChild(t)},addLink:function(){this.editedLink=null,this.getEditWindow().show(),this.editForm.reset(),this.editForm.focus()},getEditWindow:function(){var e,t,i,n,s;return this.editWindow||(e=this.editWindow=hui.ui.Window.create({title:"Link",width:300,padding:10}),i=(t=this.editForm=hui.ui.Form.create()).buildGroup({above:!1},[{label:"Tekst",type:"TextInput",options:{key:"text"}}]),n=hui.ui.TextInput.create({key:"url"}),i.add(n,"URL"),this.inputs.url=n,n=hui.ui.TextInput.create({key:"email"}),i.add(n,"E-mail"),this.inputs.email=n,page=hui.ui.DropDown.create({key:"page",source:this.options.pageSource}),i.add(page,"Side"),this.inputs.page=page,file=hui.ui.DropDown.create({key:"file",source:this.options.fileSource}),i.add(file,"Fil"),this.inputs.file=file,s=this,hui.each(this.inputs,function(e,t){t.listen({$valueChanged:function(){s.changeType(e)}})}),t.createButtons().add(hui.ui.Button.create({text:"Gem",submit:!0,highlighted:!0})),this.editForm.listen({$submit:this.saveLink.bind(this)}),e.add(t),this.options.pageSource&&this.options.pageSource.refresh(),this.options.fileSource&&this.options.fileSource.refresh()),this.editWindow},saveLink:function(){var e=this.editForm.getValues(),t=this.valuesToLink(e),e=this.editedLink;e?hui.override(e,t):this.items.push(t),this.build(),this.editForm.reset(),this.editWindow.hide(),this.editedLink=null},valuesToLink:function(e){var t={};return t.text=e.text,""!==e.email?(t.kind="email",t.value=e.email,t.info=e.email,t.icon="monochrome/email"):""!==e.url?(t.kind="url",t.value=e.url,t.info=e.url,t.icon="monochrome/globe"):hui.isDefined(e.page)?(t.kind="page",t.value=e.page,t.info=this.inputs.page.getItem().title,t.icon="common/page"):hui.isDefined(e.file)&&(t.kind="file",t.value=e.file,t.info=this.inputs.file.getItem().title,t.icon="monochrome/file"),t},changeType:function(i){hui.each(this.inputs,function(e,t){e!=i&&t.setValue()})}},hui.ui.MarkupEditor=function(e){this.name=e.name,this.options=e=hui.override({debug:!1,value:"",autoHideToolbar:!0},e),e.replace&&(e.replace=hui.get(e.replace),e.element=hui.build("div",{class:"hui_markupeditor "+e.replace.className}),e.replace.parentNode.insertBefore(e.element,e.replace),e.replace.style.display="none",e.value=this.options.replace.innerHTML),this.ready=!1,this.pending=[],this.element=hui.get(e.element),hui.browser.msie?this.impl=hui.ui.MarkupEditor.MSIE:this.impl=hui.ui.MarkupEditor.webkit,this.impl.initialize({element:this.element,controller:this,$ready:this._ready.bind(this)}),e.value&&this.setValue(e.value),hui.ui.extend(this)},hui.ui.MarkupEditor.create=function(e){return(e=e||{}).element=hui.build("div",{className:"hui_markupeditor"}),new hui.ui.MarkupEditor(e)},hui.ui.MarkupEditor.prototype={_ready:function(){this.ready=!0;for(var e=0;e<this.pending.length;e++)this.pending[e]()},implFocused:function(){this._showBar()},implBlurred:function(){this.bar.hide(),this.fire("blur")},implValueChanged:function(){this._valueChanged()},implSelectionChanged:function(){this.options.linkDelegate&&this.options.linkDelegate.$cancel(),this._highlightNode(null),this.temporaryLink=null,this._valueChanged(),this._refreshInfoWindow(),this.bar&&this.bar.setBlock(this._getFirstBlock())},_getFirstBlock:function(){for(var e=this.impl.getPath(),t=["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE"],i=e.length-1;0<=i;i--){var n=e[i].tagName;if(-1!==t.indexOf(n))return e[i]}return null},detach:function(){this.options.replace&&(this.options.replace.style.display="");for(var e=["_infoWindow","impl"],t=e.length-1;0<=t;t--)this[e[t]]&&this[e[t]].destroy()},getAccessories:function(){return[this.colorPicker,this.bar].filter(function(e){})},getValue:function(){return this.impl.getHTML()},setValue:function(e){this._whenReady(function(){this.impl.setHTML(e)}.bind(this))},focus:function(){this._whenReady(this.impl.focus.bind(this.impl))},_whenReady:function(e){this.ready?e():this.pending.push(e)},_showBar:function(){this.bar||(this.bar=new hui.ui.MarkupEditor.Bar({$clickButton:this._buttonClicked.bind(this),$changeBlock:this._changeBlock.bind(this)})),this.bar.show(this)},_buttonClicked:function(e){this.impl.saveSelection(),"color"==e.key?this._showColorPicker():"addLink"==e.key?this._showLinkEditor():"align"==e.key?this.impl.align(e.value):"clear"==e.key?this.impl.removeFormat():"info"==e.key?this._toggleInfoWindow():this.impl.format(e),this._valueChanged(),this._refreshInfoWindow(),this.impl.restoreSelection(),this.impl._selectionChanged()},_changeBlock:function(e){var t=this._getFirstBlock();t&&(t=hui.dom.changeTag(t,e),this.impl.selectNode(t))},_showColorPicker:function(){var e;this.colorPicker||(this.colorPicker=hui.ui.Window.create({title:{en:"Color",da:"Farve"}}),(e=hui.ui.ColorPicker.create()).listen(this),this.colorPicker.add(e),this.colorPicker.listen({$userClosedWindow:function(){this.impl.restoreSelection()}.bind(this)})),this.colorPicker.show({avoid:this.element})},_highlightNode:function(e){this._highlightedNode&&hui.cls.remove(this._highlightedNode,"hui_markupeditor_highlighted"),(this._highlightedNode=e)&&hui.cls.add(e,"hui_markupeditor_highlighted")},_showLinkEditor:function(){var e,t;this.temporaryLink=this.impl.getOrCreateLink(),this._highlightNode(this.temporaryLink),this.options.linkDelegate?this.options.linkDelegate.$editLink({node:this.temporaryLink,$changed:function(){this._highlightNode(null),this.temporaryLink=null,this._valueChanged()}.bind(this),$cancel:function(){this._highlightNode(null),this.temporaryLink=null,this._valueChanged()}.bind(this),$remove:function(){this.impl._unWrap(this.temporaryLink),this.impl._selectionChanged()}.bind(this)}):this.linkEditor||(this.linkEditor=hui.ui.Window.create({padding:5,width:300}),this.linkForm=hui.ui.Form.create(),this.linkEditor.add(this.linkForm),this.linkForm.buildGroup({},[{type:"TextInput",options:{key:"url",label:"Address:"}}]),e=this.linkForm.createButtons(),t=hui.ui.Button.create({text:"OK",submit:!0}),this.linkForm.listen({$submit:this._updateLink.bind(this)}),e.add(t)),this.linkEditor&&(this.linkForm.setValues({url:this.temporaryLink.href}),this.linkEditor.show({avoid:this.element}),this.linkForm.focus())},_updateLink:function(){var e=this.linkForm.getValues();this.temporaryLink.href=e.url,this.linkForm.reset(),this.temporaryLink=null,this.linkEditor.hide(),this._valueChanged()},_valueChanged:function(){this.fire("valueChanged",this.impl.getHTML()),this._refreshInfoWindow()},_toggleInfoWindow:function(){this._infoWindow||(this._infoWindow=new hui.ui.MarkupEditor.Info({editor:this})),this._infoWindow.toggle(),this._refreshInfoWindow()},_refreshInfoWindow:function(){this._infoWindow&&this._infoWindow.updatePath(this.impl.getPath())},$colorWasSelected:function(e){this.impl.restoreSelection(function(){this.impl.colorize(e),this._valueChanged()}.bind(this))},$$parentMoved:function(){this.bar&&this.bar.place(this)}},hui.ui.MarkupEditor.Bar=function(e){this.options=e,this._initialize(),hui.ui.extend(this)},hui.ui.MarkupEditor.Bar.prototype={_initialize:function(){this.bar=hui.ui.Bar.create({absolute:!0,variant:"mini",small:!0});var e=this.blockSelector=hui.ui.DropDown.create({focus:!1,variant:"bar_mini",items:[{value:"h1",text:"Header 1"},{value:"h2",text:"Header 2"},{value:"h3",text:"Header 3"},{value:"h4",text:"Header 4"},{value:"h5",text:"Header 5"},{value:"h6",text:"Header 6"},{value:"p",text:"Paragraph"},{value:"div",text:"Division"},{value:"blockquote",text:"Blockquote"}]});this.bar.add(e),e.listen({$valueChanged:function(e){this.options.$changeBlock(e)}.bind(this)}),hui.each([{key:"bold",icon:"edit/text_bold"},{key:"italic",icon:"edit/text_italic"},{divider:!0},{key:"color",icon:"common/color"},{key:"addLink",icon:"monochrome/link"},{divider:!0},{key:"align",value:"left",icon:"edit/text_align_left"},{key:"align",value:"center",icon:"edit/text_align_center"},{key:"align",value:"right",icon:"edit/text_align_right"},{key:"align",value:"justify",icon:"edit/text_align_justify"},{divider:!0},{key:"clear",icon:"edit/clear"},{key:"info",icon:"monochrome/info"}],function(e){var t;e.divider?this.bar.addDivider():((t=new hui.ui.Bar.Button.create({icon:e.icon,stopEvents:!0})).listen({$mousedown:function(){this.options.$clickButton(e)}.bind(this)}),this.bar.add(t))}.bind(this)),this.bar.addToDocument()},show:function(e){this.bar.placeAbove(e),this.bar.show()},place:function(e){this.bar.placeAbove(e)},hide:function(){this.bar.hide()},setBlock:function(e){e&&this.blockSelector.setValue(e.tagName.toLowerCase())},getAccessories:function(){return[this.bar]}},hui.ui.MarkupEditor.Info=function(e){this.options=e,this._initialize()},hui.ui.MarkupEditor.Info.prototype={_initialize:function(){this._window=hui.ui.Window.create({title:"Info",width:400}),this._css=hui.ui.CodeInput.create(),this._css.listen({$valueChanged:function(e){this.tag&&this.tag.setAttribute("style",e)}.bind(this)}),this._window.add(this._css),this._path=hui.build("div",{class:"hui_markupeditor_path"}),this._window.add(this._path)},toggle:function(){this._window.toggle({avoid:this.options.editor.element})},updatePath:function(e){for(var t="",i=e.length-1;0<=i;i--)t+='<a data-index="'+i+'" href="javascript://">'+e[i].tagName+"</a> ";this._path.innerHTML=t,this.tag=e[0],this._css.setValue(this.tag?this.tag.getAttribute("style"):"")},destroy:function(){this._window.destroy()}},hui.ui.MarkupEditor.webkit={path:[],initialize:function(e){this.element=e.element,hui.style.set(this.element,e.controller.options.style),this.element.style.overflow="auto",this.element.contentEditable=!0;var t=this.controller=e.controller;hui.listen(this.element,"focus",function(){t.implFocused()}),hui.listen(this.element,"blur",function(){t.implBlurred()}),hui.listen(this.element,"keyup",this._change.bind(this)),hui.listen(this.element,"mouseup",this._change.bind(this)),e.$ready()},saveSelection:function(){},restoreSelection:function(e){e&&e()},focus:function(){this.element.focus(),this._selectionChanged(),this.controller.implFocused()},format:function(e){"strong"==e.key||"em"==e.key?this._wrapInTag(e.key):"insert-table"==e.key?this._insertHTML("<table><tbody><tr><td>Lorem ipsum dolor</td><td>Lorem ipsum dolor</td></tr></tbody></table>"):(document.execCommand(e.key,null,e.value),"B"==(e=this._getSelectedNode()).tagName?(e=hui.dom.changeTag(e,"strong"),this.selectNode(e)):"I"==e.tagName&&(e=hui.dom.changeTag(e,"em"),this.selectNode(e)),this.controller._valueChanged()),this._selectionChanged()},selectNode:function(e){window.getSelection().selectAllChildren(e),this._selectionChanged()},getOrCreateLink:function(){var e=this._getSelectedNode();return e&&"a"==e.tagName.toLowerCase()?e:(document.execCommand("createLink",null,"#"),this._selectionChanged(),this._getSelectedNode())},_getSelectedNode:function(){var e=window.getSelection().getRangeAt(0).commonAncestorContainer;return e=!hui.dom.isElement(e)?e.parentNode:e},colorize:function(e){document.execCommand("forecolor",null,e);var t=this._getSelectedNode();"FONT"==t.tagName&&((t=hui.dom.changeTag(t,"span")).style.color=e,t.removeAttribute("color"),window.getSelection().selectAllChildren(t)),this._selectionChanged()},align:function(e){document.execCommand({center:"justifycenter",justify:"justifyfull",left:"justifyleft",right:"justifyright"}[e],null,null),this._updateInlinePanel()},_change:function(){this.controller.implValueChanged(),this._selectionChanged()},_wrapInTag:function(e){var t,i,n=window.getSelection();n.rangeCount<1||(i=(t=n.getRangeAt(0)).commonAncestorContainer,(i=!hui.dom.isElement(i)?i.parentNode:i).tagName.toLowerCase()==e?this._unWrap(i):(e=document.createElement(e),t.surroundContents(e),n.selectAllChildren(e)),this._selectionChanged())},_getInlineTag:function(){window.getSelection().rangeCount},removeLink:function(e){this._unWrap(e),this._selectionChanged()},_unWrap:function(e){for(var t=e.childNodes,i=0;i<t.length;i++)e.parentNode.insertBefore(t[i],e);e.parentNode.removeChild(e)},_insertHTML:function(e){document.execCommand("inserthtml",null,e)},_getAncestor:function(){var e=window.getSelection();if(e.rangeCount<1)return null;e=e.getRangeAt(0).commonAncestorContainer;return e=!hui.dom.isElement(e)?e.parentNode:e},_buildInlinePanel:function(){this._inlinePanel=hui.ui.BoundPanel.create({variant:"light"});var e=hui.build("div",{class:"hui_markupeditor_inlinepanel",html:'<a href="javascript://" data="bold"><strong>Bold</strong></a><a href="javascript://" data="italic"><em>Italic</em></a>'});hui.listen(e,"mousedown",function(e){(e=hui.event(e)).stop();e=e.findByTag("a");e&&(this.saveSelection(),this.format({key:e.getAttribute("data")}),this.restoreSelection(),this._selectionChanged())}.bind(this)),this._inlinePanel.add(e)},_updateInlinePanel:function(){var e=window.getSelection();this._inlinePanel||this._buildInlinePanel(),!(e.rangeCount<1)&&(e=e.getRangeAt(0)).startOffset!=e.endOffset?0<(e=e.getClientRects()).length&&(e=e[0],this._inlinePanel.position({rect:e,position:"vertical"}),this._inlinePanel.show()):this._inlinePanel.hide()},_selectionChanged:function(){var e=window.getSelection(),t=this._hash(e),i=e.anchorNode?e.anchorNode.parentNode:null,e=this._latestSelection;if(!e||i!=e.node||e.hash!=t){this._latestSelection={node:i,hash:t};for(var n=[],s=this._getAncestor();s&&s!==this.element;)n.push(s),s=s.parentNode;this.path=n,this.controller.implSelectionChanged(),this._updateInlinePanel()}},_storeSelection:function(e){},_hash:function(e){return e.anchorOffset+":"+e.baseOffset+":"+e.extentOffset},removeFormat:function(){document.execCommand("removeFormat",null,null),this._selectionChanged()},setHTML:function(e){this.element.innerHTML=e},getHTML:function(){return hui.ui.MarkupEditor.util.clean(this.element).innerHTML},getPath:function(){return this.path},destroy:function(){this._inlinePanel&&this._inlinePanel.destroy()}},hui.ui.MarkupEditor.MSIE={initialize:function(e){this.element=e.element,this.iframe=hui.build("iframe",{style:"display:block; width: 100%; border: 0;",parent:this.element}),hui.listen(this.iframe,"load",function(){this._load(),e.$ready()}.bind(this)),this.controller=e.controller},saveSelection:function(){this.savedRange=this.document.selection.createRange()},restoreSelection:function(e){window.setTimeout(function(){this.body.focus(),this.savedRange.select(),e&&e()}.bind(this))},_load:function(){this.document=hui.frame.getDocument(this.iframe),this.body=this.document.body,this.body.contentEditable=!0,hui.listen(this.body,"keyup",this._keyUp.bind(this)),hui.listen(this.body,"mouseup",this._mouseUp.bind(this))},_keyUp:function(){this.controller.implValueChanged(),this.saveSelection()},_mouseUp:function(){this.saveSelection()},focus:function(){this.body.focus(),this.controller.implFocused()},align:function(e){this.document.execCommand({center:"justifycenter",justify:"justifyfull",left:"justifyleft",right:"justifyright"}[e],null,null)},format:function(e){"strong"==e.key||"em"==e.key?this._wrapInTag(e.key):"insert-table"==e.key?this._insertHTML("<table><tbody><tr><td>Lorem ipsum dolor</td><td>Lorem ipsum dolor</td></tr></tbody></table>"):this.document.execCommand(e.key,null,null)},removeFormat:function(){this.document.execCommand("removeFormat",null,null)},colorize:function(e){this.document.execCommand("forecolor",null,e),this.restoreSelection()},_wrapInTag:function(e){document.execCommand("inserthtml",null,"<"+e+">"+hui.string.escape(hui.selection.getText())+"</"+e+">")},_insertHTML:function(e){document.execCommand("inserthtml",null,e)},setHTML:function(e){this.body.innerHTML=e},getHTML:function(){return hui.ui.MarkupEditor.util.clean(this.body).innerHTML},getPath:function(){return[]},destroy:function(){}},hui.ui.MarkupEditor.util={clean:function(e){e=e.cloneNode(!0);this.replaceNodes(e,{b:"strong",i:"em",font:"span"});for(var t=hui.get.byClass(e,"Apple-style-span"),i=t.length-1;0<=i;i--)t[i].removeAttribute("class");return this.convertAttributesToStyle(e),e},replaceNodes:function(e,t){for(var i in t)for(var n=e.getElementsByTagName(i),s=n.length-1;0<=s;s--){var h=n[s],u=document.createElement(t[i]),o=n[s].getAttribute("color");o&&(u.style.color=o),hui.dom.replaceNode(h,u);for(var a=h.childNodes,l=0;l<a.length;l++){var r=h.removeChild(a[l]);u.appendChild(r)}}},convertAttributesToStyle:function(e){for(var t=e.getElementsByTagName("*"),i=0;i<t.length;i++){var n=t[i],s=n.getAttribute("align");s&&(n.style.textAlign=s,n.removeAttribute("align"))}}},hui.ui.ColorPicker=function(e){this.options=e||{},this.name=e.name,this.element=hui.get(e.element),this.color=null,this.buttons=[],this.preview=hui.get.firstByClass(this.element,"hui_colorpicker_preview"),this.pages=hui.get.byClass(this.element,"hui_colorpicker_page"),this.input=hui.get.firstByTag(this.element,"input"),this.wheel1=this.pages[0],this.wheel2=this.pages[1],this.wheel3=this.pages[2],this.swatches=this.pages[3],hui.ui.extend(this),e.listener&&this.listen(e.listener),this.addBehavior(),this.buildData()},hui.ui.ColorPicker.create=function(e){for(var t,i,n,s="",h=0;h<360;h+=30){for(n=.05;n<=1;n+=.15)t=hui.Color.hsv2rgb(h,n,1),i=hui.Color.rgb2hex(t),s+='<a style="background: rgb('+t[0]+","+t[1]+","+t[2]+')" rel="'+i+'"></a>';for(n=1;.2<=n;n-=.15)t=hui.Color.hsv2rgb(h,1,n),i=hui.Color.rgb2hex(t),s+='<a style="background: rgb('+t[0]+","+t[1]+","+t[2]+')" rel="'+i+'"></a>'}for(n=255;0<=n;n-=21.25)i=hui.Color.rgb2hex([n,n,n]),s+='<a style="background: rgb('+Math.round(n)+","+Math.round(n)+","+Math.round(n)+')" rel="'+i+'"></a>';return(e=e||{}).element=hui.build("div",{class:"hui_colorpicker",html:'<div class="hui_bar hui_bar-window_mini"><div class="hui_bar_left"><a class="hui_bar_button hui_bar_button-selected" href="javascript:void(0)" rel="0"><span class="hui_icon_16" style="'+hui.ui.getIconStyle("colorpicker/wheel_pastels",16)+'"></span></a><a class="hui_bar_button" href="javascript:void(0)" rel="1"><span class="hui_icon_16" style="'+hui.ui.getIconStyle("colorpicker/wheel_brightness",16)+'"></span></a><a class="hui_bar_button" href="javascript:void(0)" rel="2"><span class="hui_icon_16" style="'+hui.ui.getIconStyle("colorpicker/wheel_saturated",16)+'"></span></a><a class="hui_bar_button" href="javascript:void(0)" rel="3"><span class="hui_icon_16" style="'+hui.ui.getIconStyle("colorpicker/swatches",16)+'"></span></a></div><div class="hui_bar_right"><input class="hui_colorpicker"/></div></div><div class="hui_colorpicker_pages"><div class="hui_colorpicker_page hui_colorpicker_wheel1"></div><div class="hui_colorpicker_page hui_colorpicker_wheel2"></div><div class="hui_colorpicker_page hui_colorpicker_wheel3"></div><div class="hui_colorpicker_page hui_colorpicker_swatches">'+s+'</div></div><div class="hui_colorpicker_preview"></div>'}),new hui.ui.ColorPicker(e)},hui.ui.ColorPicker.prototype={addBehavior:function(){for(var e=hui.get.byClass(this.element,"hui_bar_button"),t=0;t<e.length;t++){var i=new hui.ui.Bar.Button({element:e[t]});i.listen(this),this.buttons.push(i)}hui.listen(this.element,"click",this._click.bind(this)),hui.listen(this.wheel1,"mousemove",this._hoverWheel1.bind(this)),hui.listen(this.wheel1,"click",this._pickColor.bind(this)),hui.listen(this.wheel2,"mousemove",this._hoverWheel2.bind(this)),hui.listen(this.wheel2,"click",this._pickColor.bind(this)),hui.listen(this.wheel3,"mousemove",this._hoverWheel3.bind(this)),hui.listen(this.wheel3,"click",this._pickColor.bind(this)),hui.listen(this.element,"mousedown",function(e){hui.stop(e)}),hui.listen(this.swatches,"mousemove",function(e){e=hui.event(e),this._hoverColor(e.element.getAttribute("rel"))}.bind(this)),hui.listen(this.swatches,"click",this._pickColor.bind(this))},$click:function(e){for(var t=parseInt(e.element.getAttribute("rel")),i=this.pages.length-1;0<=i;i--)this.pages[i].style.display=i==t?"block":"none";for(i=0;i<this.buttons.length;i++)this.buttons[i].setSelected(this.buttons[i]==e)},_click:function(e){(e=hui.event(e)).stop();e=e.findByTag("input");e&&e.focus()},_pickColor:function(e){hui.stop(e),this.fire("colorWasSelected",this.color)},_hoverColor:function(e){this.preview.style.background=e,this.color=e,this.fire("colorWasHovered",this.color),this.input.value=e},buildData:function(){var e=[];e[0]=new Array(0,1,0),e[1]=new Array(-1,0,0),e[2]=new Array(0,0,1),e[3]=new Array(0,-1,0),e[4]=new Array(1,0,0),e[5]=new Array(0,0,-1),e[6]=new Array(255,1,1);for(var t=new Array(360),i=0;i<6;i++)for(var n=0;n<60;n++){t[60*i+n]=new Array(3);for(var s=0;s<3;s++)t[60*i+n][s]=e[6][s],e[6][s]+=4*e[i][s]}this.colorArray=t},_hoverWheel1:function(e){e=hui.event(e);var t=hui.position.get(this.wheel1),i=4*(e.getLeft()-t.left),n=4*(e.getTop()-t.top),s=2*((r=n-512)<0?0:1)+((l=i-512)<0?0:1),h=new Array(-180,360,180,0),u=Math.abs(l),e=Math.abs(r),t=45*e/u;u<e&&(t=90-45*u/e);var o,a=Math.floor(Math.abs(h[s]-t)),l=Math.abs(i-512),r=Math.abs(n-512),d=Math.sqrt(l*l+r*r);if(512==i&512==n)o="000000";else{for(var c=0,p=0;p<3;p++){var m=this.colorArray[a][p]*d/256;256<d&&(m+=Math.floor(d-256)),255<m&&(m=255),c=256*c+Math.floor(m)}o=c.toString(16)}for(;o.length<6;)o="0"+o;this._hoverColor("#"+o)},_hoverWheel2:function(e){var t,i,n;e=hui.event(e);var s=hui.position.get(this.wheel2),h=e.getLeft()-s.left,u=e.getTop()-s.top;256<u||(e=h-128,s=128-u,u=(h=Math.sqrt(e*e+s*s))/128,0===h?(n=i=0,t=new Array(0,0,0)):(h=Math.acos(e/h),h=360*(0<=s?h:2*Math.PI-h)/(2*Math.PI),1<u?(t=new Array(255,255,255),n=i=1):t=(n=.5<=u?(i=1-2*(u-.5),1):(i=1,2*u),hui.Color.hsv2rgb(h,i,n))),this._hoverColor(hui.Color.rgb2hex(t)))},_hoverWheel3:function(e){var t,i;e=hui.event(e);var n=hui.position.get(this.wheel3),s=e.getLeft()-n.left,h=e.getTop()-n.top;256<h||(e=s-128,n=128-h,h=(s=Math.sqrt(e*e+n*n))/128,0===s?(i=0,t=new Array(0,0,0)):(s=Math.acos(e/s),s=360*(0<=n?s:2*Math.PI-s)/(2*Math.PI),1<h?(t=new Array(255,255,255),i=1):(i=1,t=hui.Color.hsv2rgb(s,h,i))),this._hoverColor(hui.Color.rgb2hex(t)))}},hui.ui.LocationInput=function(e){this.options=hui.override({value:null},e),this.name=e.name,this.element=hui.get(e.element),this.chooser=hui.get.firstByTag(this.element,"a"),this.latField=new hui.ui.Input({element:hui.get.firstByTag(this.element,"input"),validator:new hui.ui.NumberValidator({min:-90,max:90,allowNull:!0})}),this.latField.listen(this),this.lngField=new hui.ui.Input({element:this.element.getElementsByTagName("input")[1],validator:new hui.ui.NumberValidator({min:-180,max:180,allowNull:!0})}),this.lngField.listen(this),this.value=this.options.value,hui.ui.extend(this),this.setValue(this.value),this._addBehavior()},hui.ui.LocationInput.create=function(e){return(e=e||{}).element=hui.build("span",{class:"hui_locationinput",html:'<span class="hui_locationinput_latitude"><span><input autocomplete="off"></span></span><span class="hui_locationinput_longitude"><span><input autocomplete="off"></span></span><a class="hui_locationinput_picker" href="javascript://"></a>'}),new hui.ui.LocationInput(e)},hui.ui.LocationInput.prototype={_addBehavior:function(){hui.listen(this.chooser,"click",this._showPicker.bind(this)),hui.ui.addFocusClass({element:this.latField.element,classElement:this.element,class:"hui_locationinput-focused"}),hui.ui.addFocusClass({element:this.lngField.element,classElement:this.element,class:"hui_locationinput-focused"})},reset:function(){this.setValue()},getValue:function(){return this.value},setValue:function(e){e?(this.latField.setValue(e.latitude),this.lngField.setValue(e.longitude),this.value=e):(this.latField.setValue(),this.lngField.setValue(),this.value=null),this._updatePicker()},_updatePicker:function(){this.picker&&this.picker.setLocation(this.value)},_showPicker:function(){this.picker||(this.picker=new hui.ui.LocationPicker,this.picker.listen(this)),this.picker.show({node:this.chooser,location:this.value})},$locationChanged:function(e){this.setValue(e),this.fire("valueChanged",this.value),hui.ui.callAncestors(this,"childValueChanged",this.value)},$valueChanged:function(){var e=this.latField.getValue(),t=this.lngField.getValue();this.value=null===e||null===t?null:{latitude:e,longitude:t},this._updatePicker(),this.fire("valueChanged",this.value),hui.ui.callAncestors(this,"childValueChanged",this.value)}},hui.ui.StyleLength=function(e){this.options=hui.override({value:null,min:0,max:1e3,units:["px","pt","em","%"],initialValue:null,defaultUnit:"px",allowNull:!1},e),this.name=e.name;e=this.element=hui.get(e.element);this.input=hui.get.firstByTag(e,"input");e=e.getElementsByTagName("a");this.up=e[0],this.down=e[1],this.value=this.parseValue(this.options.value),hui.ui.extend(this),this._addBehavior()},hui.ui.StyleLength.create=function(e){return e.element=hui.build("span",{class:"hui_style_length hui_numberinput",html:'<input class="hui_textinput" type="text"/><a class="hui_numberinput_up"></a><a class="hui_numberinput_down"></a>'}),new hui.ui.StyleLength(e)},hui.ui.StyleLength.prototype={_addBehavior:function(){this.element;hui.listen(this.input,"blur",this._onBlur.bind(this)),hui.listen(this.input,"keyup",this.keyEvent.bind(this)),hui.listen(this.up,"mousedown",this._upEvent.bind(this)),hui.listen(this.down,"mousedown",this._downEvent.bind(this))},parseValue:function(e){if(null==e)return null;var t=parseFloat(e,10);if(isNaN(t))return null;for(var i={number:t,unit:this.options.defaultUnit},n=0;n<this.options.units.length;n++){var s=this.options.units[n];if(-1!=e.indexOf(s)){i.unit=s;break}}return i.number=Math.max(this.options.min,Math.min(this.options.max,i.number)),i},_onBlur:function(){this._updateInput()},keyEvent:function(e){38==(e=e||window.event).keyCode?(hui.stop(e),this._upEvent()):40==e.keyCode?this._downEvent():this._checkAndSetValue(this.parseValue(this.input.value))},_updateInput:function(){this.input.value=this.getValue()},_checkAndSetValue:function(e){var t=this.value,i=!1;null===t&&null===e||null!==t&&null!==e&&t.number===e.number&&t.unit===e.unit||(i=!0),this.value=e,i&&(hui.ui.callAncestors(this,"childValueChanged",this.input.value),this.fire("valueChanged",this.getValue()))},_setInitialValue:function(){!this.value&&this.options.initialValue&&this.setValue(this.options.initialValue)},_downEvent:function(){this._setInitialValue(),this.value?this._checkAndSetValue({number:Math.max(this.options.min,this.value.number-1),unit:this.value.unit}):this._checkAndSetValue({number:this.options.min,unit:this.options.defaultUnit}),this._updateInput()},_upEvent:function(){this._setInitialValue(),this.value?this._checkAndSetValue({number:Math.min(this.options.max,this.value.number+1),unit:this.value.unit}):this._checkAndSetValue({number:this.options.min+1,unit:this.options.defaultUnit}),this._updateInput()},setInitialValue:function(e){this.options.initialValue=e},getValue:function(){return this.value?this.value.number+this.value.unit:""},setValue:function(e){this.value=this.parseValue(e),this._updateInput()},focus:function(){try{this.input.focus()}catch(e){}},reset:function(){this.setValue("")}},hui.ui.DateTimeInput=function(e){this.inputFormats=["d-m-Y","d/m-Y","d/m/Y","d-m-Y H:i:s","d/m-Y H:i:s","d/m/Y H:i:s","d-m-Y H:i","d/m-Y H:i","d/m/Y H:i","d-m-Y H","d/m-Y H","d/m/Y H","d-m","d/m","d","Y","m-d-Y","m-d","m/d"],this.outputFormat="d-m-Y H:i:s",this.name=e.name,this.element=hui.get(e.element),this.input=hui.get.firstByTag(this.element,"input"),this.options=hui.override({returnType:null,allowNull:!0,value:null},e),this.value=this.options.value,hui.ui.extend(this),this._addBehavior(),this._updateUI()},hui.ui.DateTimeInput.create=function(e){e=e||{};var t=hui.build("span",{class:"hui_datetime"});return hui.build("input",{class:"hui_textinput",parent:t}),hui.build("a",{class:"hui_datetime_selector",href:"#",tabIndex:"-1",parent:t}),e.element=t,new hui.ui.DateTimeInput(e)},hui.ui.DateTimeInput.prototype={_addBehavior:function(){hui.listen(this.input,"blur",this._onBlur.bind(this)),hui.listen(this.input,"keyup",this._parse.bind(this)),hui.listen(this.input,"focus",this._onFocus.bind(this));var e=hui.get.firstByTag(this.element,"a");hui.listen(e,"mousedown",hui.stop),hui.listen(e,"click",this._onClickIcon.bind(this))},_onClickIcon:function(e){hui.stop(e),this.input.focus(),this._showPicker()},focus:function(){try{this.input.focus()}catch(e){}},reset:function(){this.setValue("")},setValue:function(e){e?e.constructor==Date?this.value=e:(this.value=new Date,this.value.setTime(1e3*parseInt(e))):this.value=null,this._updateUI()},_parse:function(){for(var e=this.value?this.value.getTime():0,t=this.input.value,i=null,n=0;n<this.inputFormats.length&&null===i;n++)i=Date.parseDate(t,this.inputFormats[n]);!this.options.allowNull&&null===i||(this.value=i),this.datePicker&&this.datePicker.setValue(this.value),e!=(this.value?this.value.getTime():0)&&(hui.ui.callAncestors(this,"childValueChanged",this.value),this.fire("valueChanged",this.value))},_check:function(){this._parse(),this._updateUI()},getValue:function(){return null!==this.value&&"seconds"==this.options.returnType?Math.round(this.value.getTime()/1e3):this.value},_updateUI:function(){this.value?this.input.value=this.value.dateFormat(this.outputFormat):this.input.value=""},_onBlur:function(){this._check(),this.panel&&this.panel.hide(),this.datePickerPanel&&this.datePickerPanel.hide()},_onFocus:function(){this._showPanel()},_showPanel:function(){var e;this.panel||(this.panel=hui.ui.BoundPanel.create({variant:"light"}),(e=hui.ui.Buttons.create({align:"center"})).add(hui.ui.Button.create({text:"Idag",small:!0,variant:"light",listener:{$click:this.goToday.bind(this)}})),e.add(hui.ui.Button.create({text:"+ dag",small:!0,variant:"light",listener:{$click:function(){this.addDays(1)}.bind(this)}})),e.add(hui.ui.Button.create({text:"+ uge",small:!0,variant:"light",listener:{$click:function(){this.addDays(7)}.bind(this)}})),e.add(hui.ui.Button.create({text:"12:00",small:!0,variant:"light",listener:{$click:function(){this.setHour(12)}.bind(this)}})),e.add(hui.ui.Button.create({text:"00:00",small:!0,variant:"light",listener:{$click:function(){this.setHour(0)}.bind(this)}})),this.panel.add(e)),this.panel.position({element:this.element,position:"vertical"}),this.panel.show()},goToday:function(){var e=this._getValueOrNowCopy(),t=new Date;e.setDate(t.getDate()),e.setMonth(t.getMonth()),e.setFullYear(t.getFullYear()),this.setValue(e)},addDays:function(e){var t=this._getValueOrNowCopy();t.setDate(t.getDate()+e),this.setValue(t)},setHour:function(e){var t=this._getValueOrNowCopy();t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setHours(e),this.setValue(t)},_getValueOrNowCopy:function(){return null===this.value?new Date:new Date(this.value.getTime())},_showPicker:function(){this.panel&&this.panel.hide(),this.datePickerPanel||(this.datePickerPanel=hui.ui.BoundPanel.create({variant:"light"}),this.datePicker=hui.ui.DatePicker.create({value:this.value}),this.datePicker.listen({$dateChanged:function(e){this.setValue(e)}.bind(this)}),this.datePickerPanel.add(this.datePicker)),this.datePicker.setValue(this.value),this.datePickerPanel.position(this.element),this.datePickerPanel.show()},$$parentMoved:function(){this.datePickerPanel&&this.datePickerPanel.isVisible()&&(this.datePickerPanel.position(this.element),this.datePickerPanel.show()),this.panel&&this.panel.isVisible()&&(this.panel.position({element:this.element,position:"vertical"}),this.panel.show())},$visibilityChanged:function(){this.datePickerPanel&&this.datePickerPanel.hide(),this.panel&&this.panel.hide()}},hui.ui.TokenField=function(e){this.options=hui.override({key:null},e),this.element=hui.get(e.element),this.name=e.name,this.value=[""],hui.ui.extend(this),this._updateUI()},hui.ui.TokenField.create=function(e){return(e=e||{}).element=hui.build("div",{class:"hui_tokenfield"}),new hui.ui.TokenField(e)},hui.ui.TokenField.prototype={setValue:function(e){this.value=e||[],this.value.push(""),this._updateUI()},reset:function(){this.value=[""],this._updateUI()},getValue:function(){var t=[];return hui.each(this.value,function(e){0<(e=hui.string.trim(e)).length&&t.push(e)}),t},_updateUI:function(){this.element.innerHTML="",hui.each(this.value,function(e,t){var i=hui.build("input",{class:"hui_textinput",parent:this.element,style:{width:"50px"}});this.options.width&&(i.style.width=this.options.width+"px"),i.value=e,hui.listen(i,"keyup",function(){this._inputChanged(i,t)}.bind(this))}.bind(this))},_inputChanged:function(e,t){t==this.value.length-1&&e.value!=this.value[t]&&this._addField(),this.value[t]=e.value,hui.animate({node:e,css:{width:Math.min(Math.max(7*e.value.length+3,50),150)+"px"},duration:200})},$visibilityChanged:function(){hui.dom.isVisible(this.element)&&this.$$layout()},$$layout:function(){for(var e=hui.findAll("input",this.element),t=0;t<e.length;t++)e[t].style.width=Math.min(Math.max(7*e[t].value.length+3,50),150)+"px"},_addField:function(){var e=hui.build("input",{class:"hui_textinput",style:{width:"50px"}});this.options.width&&(e.style.width=this.options.width+"px");var t=this.value.length;this.value.push(""),this.element.appendChild(e);var i=this;hui.listen(e,"keyup",function(){i._inputChanged(e,t)})}},hui.component("Checkbox",{with:["value","enabled","key","size"],state:{text:void 0},nodes:{label:".hui_checkbox_label"},create:function(e){return hui.build("a.hui_checkbox",{href:"#",html:'<span class="hui_checkbox_button"></span>'})},init:function(e){hui.ui.addFocusClass({element:this.element,class:"hui_checkbox_focused"})},"!click":function(e){e.prevent(),this.isEnabled()&&(this.element.focus(),this.setValue(!this.getValue()),this.tellValueChange())},draw:function(e){"value"in e&&hui.cls.set(this.element,"hui_checkbox_selected",this.getValue()),"enabled"in e&&hui.cls.set(this.element,"hui_checkbox-disabled",!this.isEnabled()),"text"in e&&this._drawText(),"size"in e&&hui.cls.set(this.element,"hui-large","large"==this.state.size)},_drawText:function(){this.state.text&&!this.nodes.label?this.nodes.label=hui.build("span.hui_checkbox_label",{parent:this.element,text:hui.ui.getTranslated(this.state.text)}):!this.state.text&&this.nodes.label?(hui.dom.remove(this.nodes.label),this.nodes.label=void 0):hui.dom.setText(this.nodes.label,hui.ui.getTranslated(this.state.text))},setText:function(e){this.change({text:e})},reset:function(){this.setValue(!1)}}),hui.ui.Checkboxes=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,this.items=e.items||[],this.subItems=[],this.values=e.values||e.value||[],hui.ui.extend(this),this._addBehavior(),this._updateUI(),e.url&&new hui.ui.Source({url:e.url,delegate:this})},hui.ui.Checkboxes.create=function(t){return t.element=hui.build("div",{class:t.vertical?"hui_checkboxes hui_checkboxes_vertical":"hui_checkboxes"}),t.items&&hui.each(t.items,function(e){e=hui.build("a",{class:"hui_checkbox",href:"#",html:'<span class="hui_checkbox_button"></span><span class="hui_checkbox_label">'+hui.string.escape(e.title)+"</span>"});hui.ui.addFocusClass({element:e,class:"hui_checkbox_focused"}),t.element.appendChild(e)}),new hui.ui.Checkboxes(t)},hui.ui.Checkboxes.prototype={_addBehavior:function(){var e=hui.get.byClass(this.element,"hui_checkbox");hui.each(e,function(e,t){hui.ui.addFocusClass({element:e,class:"hui_checkbox_focused"}),hui.listen(e,"click",function(e){hui.stop(e),this.flipValue(this.items[t].value)}.bind(this))}.bind(this))},getValue:function(){return this.values},_checkValues:function(){for(var e=[],t=0;t<this.values.length;t++){for(var i=this.values[t],n=!1,s=0;s<this.items.length;s++)n=n||this.items[s].value===i;for(s=0;s<this.subItems.length;s++)n=n||this.subItems[s]._hasValue(i);n&&e.push(i)}this.values=e},setValue:function(e){this.values=e,this._checkValues(),this._updateUI()},flipValue:function(e){hui.array.flip(this.values,e),this._checkValues(),this._updateUI(),this.fire("valueChanged",this.values),hui.ui.callAncestors(this,"childValueChanged",this.values)},_updateUI:function(){for(var e,t=0;t<this.subItems.length;t++)this.subItems[t]._updateUI();var i=hui.get.byClass(this.element,"hui_checkbox");for(t=0;t<this.items.length;t++)e=this.items[t],e=hui.array.contains(this.values,e.value),hui.cls.set(i[t],"hui_checkbox_selected",e)},refresh:function(){for(var e=0;e<this.subItems.length;e++)this.subItems[e].refresh()},reset:function(){this.setValues([])},setValues:function(e){this.setValue(e)},getValues:function(){return this.values},registerItem:function(e){parseInt(e.value)==e.value&&(e.value=parseInt(e.value)),this.items.push(e)},registerItems:function(e){(e.parent=this).subItems.push(e)},$optionsLoaded:function(e){hui.each(e,function(t){var e=hui.build("a",{class:"hui_checkbox",href:"#",html:'<span class="hui_checkbox_button"></span><span class="hui_checkbox_label">'+hui.string.escape(t.title)+"</span>"});hui.listen(e,"click",function(e){hui.stop(e),this.flipValue(t.value)}.bind(this)),hui.ui.addFocusClass({element:e,class:"hui_checkbox_focused"}),this.element.appendChild(e),this.items.push(t)}.bind(this)),this._checkValues(),this._updateUI()}},hui.ui.Checkboxes.Items=function(e){this.element=hui.get(e.element),this.name=e.name,this.parent=null,this.options=e,this.checkboxes=[],hui.ui.extend(this),this.options.source&&this.options.source.listen(this)},hui.ui.Checkboxes.Items.prototype={refresh:function(){this.options.source&&this.options.source.refresh()},$optionsLoaded:function(e){this.checkboxes=[],this.element.innerHTML="";var n=this;hui.each(e,function(e){var t={text:e.title||e.text,value:hui.intOrString(e.value)},i=t.element=hui.build("a",{class:"hui_checkbox",href:"#",html:'<span class="hui_checkbox_button"></span><span class="hui_checkbox_label">'+hui.string.escape(t.text)+"</span>"});hui.listen(i,"click",function(e){hui.stop(e),i.focus(),n._onItemClick(t)}),hui.ui.addFocusClass({element:i,class:"hui_checkbox_focused"}),n.element.appendChild(i),n.checkboxes.push(t)}),this.parent._checkValues(),this._updateUI()},$objectsLoaded:function(e){this.$optionsLoaded(e)},_onItemClick:function(e){this.parent.flipValue(e.value)},_updateUI:function(){for(var e=0;e<this.checkboxes.length;e++){var t=this.checkboxes[e],i=hui.array.indexOf(this.parent.values,t.value);hui.cls.set(t.element,"hui_checkbox_selected",-1!=i)}},_hasValue:function(e){for(var t=0;t<this.checkboxes.length;t++)if(this.checkboxes[t].value==e)return!0;return!1}},hui.ui.Radiobuttons=function(e){this.options=e,this.element=hui.get(e.element),this.name=e.name,this.radios=[],this.value=e.value,this.defaultValue=this.value,this.enabled=!0,hui.ui.extend(this)},hui.ui.Radiobuttons.prototype={updateUI:function(){for(var e=0;e<this.radios.length;e++){var t=this.radios[e];hui.cls.set(hui.get(t.id),"hui_radiobutton_selected",t.value==this.value)}},setValue:function(e){this.value=e,this.updateUI()},getValue:function(){return this.enabled?this.value:null},reset:function(){this.setValue(this.defaultValue)},setEnabled:function(e){this.enabled=!!e,hui.cls.set(this.element,"hui_radiobuttons_disabled",!this.enabled)},registerRadiobutton:function(e){this.radios.push(e);var t=hui.get(e.id),i=this;t.onclick=function(){i.enabled&&(i.setValue(e.value),i.fire("valueChanged",e.value),hui.ui.callAncestors(i,"childValueChanged",e.value))}}},hui.ui.NumberInput=function(e){this.options=hui.override({min:0,max:void 0,value:null,tickSize:1,decimals:0,allowNull:!1},e),this.name=e.name;e=this.element=hui.get(e.element);this.input=hui.get.firstByTag(e,"input"),this.up=hui.get.firstByClass(e,"hui_numberinput_up"),this.down=hui.get.firstByClass(e,"hui_numberinput_down"),hui.isString(this.options.value)?this.value=parseInt(this.options.value,10):this.value=this.options.value,isNaN(this.value)&&(this.value=null),hui.ui.extend(this),this._addBehavior()},hui.ui.NumberInput.create=function(e){return e.element=hui.build("span",{class:"hui_numberinput",html:'<input class="hui_textinput" type="text" value="'+(void 0!==e.value?e.value:"0")+'"/><a class="hui_numberinput_up"></a><a class="hui_numberinput_down"></a>'}),new hui.ui.NumberInput(e)},hui.ui.NumberInput.prototype={_addBehavior:function(){this.element;hui.listen(this.input,"focus",this._onFocus.bind(this)),hui.listen(this.input,"blur",this._onBlur.bind(this)),hui.listen(this.input,"keyup",this._onKey.bind(this)),hui.listen(this.up,"mousedown",this.upEvent.bind(this)),hui.listen(this.down,"mousedown",this.downEvent.bind(this))},_onBlur:function(){this._updateField(),this.sliderPanel&&this.sliderPanel.hide()},_onFocus:function(){this._showSlider(),this._updateSlider()},_onKey:function(e){38==(e=e||window.event).keyCode?(hui.stop(e),this.upEvent()):40==e.keyCode?this.downEvent():(e=parseFloat(this.input.value,10),isNaN(e)?this._setLocalValue(null,!0):this._setLocalValue(e,!0))},downEvent:function(e){hui.stop(e),null===this.value?this._setLocalValue(this.options.min,!0):this._setLocalValue(this.value-this.options.tickSize,!0),this._updateField()},upEvent:function(e){hui.stop(e),this._setLocalValue(this.value+this.options.tickSize,!0),this._updateField()},focus:function(){try{this.input.focus()}catch(e){}},getValue:function(){return this.value},setValue:function(e){null==e?this._setLocalValue(null,!1):(e=parseFloat(e,10),isNaN(e)||this._setLocalValue(e,!1)),this._updateField()},_updateField:function(){this.input.value=null===this.value||void 0===this.value?"":this.value},_setLocalValue:function(e,t){var i=this.value;null===e||void 0===e&&this.options.allowNull?this.value=null:(e=this._getValueWithinRange(e),this.value=this._round(e)),t&&i!==this.value&&this.fireValueChange(),this._updateSlider()},_round:function(e){var t;return void 0!==this.options.decimals&&(t=Math.pow(10,this.options.decimals),e=Math.round(e*t)/t),e},reset:function(){this.options.allowNull?this.value=null:this.value=this._getValueWithinRange(0),this._updateField()},_getValueWithinRange:function(e){return hui.isDefined(this.options.min)&&(e=Math.max(e,this.options.min)),e=hui.isDefined(this.options.max)?Math.min(e,this.options.max):e},_onSliderChange:function(e){e=this.options.min+(this.options.max-this.options.min)*e;this._setLocalValue(e,!0),this._updateField()},_showSlider:function(){void 0!==this.options.min&&void 0!==this.options.max&&(this.sliderPanel||(this.sliderPanel=hui.ui.BoundPanel.create({variant:"light"}),this.slider=hui.ui.Slider.create({width:200}),this.slider.element.style.margin="0 3px",this.slider.listen({$valueChanged:this._onSliderChange.bind(this)}),this.sliderPanel.add(this.slider)),this.sliderPanel.position({element:this.element,position:"vertical"}),this.sliderPanel.show())},_updateSlider:function(){this.slider&&this.slider.setValue((this.value-this.options.min)/(this.options.max-this.options.min))},$$parentMoved:function(){this.sliderPanel&&this.sliderPanel.isVisible()&&(this.sliderPanel.position({element:this.element,position:"vertical"}),this.sliderPanel.show())}},hui.ui.TextInput=function(e){this.options=hui.override({key:null,lines:1,maxHeight:100,animateUserChange:!0,submitOnEnter:null},e),this.element=hui.get(e.element),this.name=e.name,hui.ui.extend(this),this.input=this.element,this.multiline="textarea"==this.input.tagName.toLowerCase(),this.placeholder=hui.get.firstByClass(this.element,"hui_field_placeholder"),this.value=this.input.value,this.modified=!1,this._attach()},hui.ui.TextInput.create=function(e){var t;return 1<(e=hui.override({lines:1},e)).lines||e.multiline?t=hui.build("textarea",{class:"hui_textinput",rows:e.lines}):(t=hui.build("input",{class:"hui_textinput"}),e.secret&&t.setAttribute("type","password")),e.testName&&t.setAttribute("data-test",e.testName),e.large&&hui.cls.add(t,"hui-large"),void 0!==e.value&&(t.value=e.value),e.element=t,new hui.ui.TextInput(e)},hui.ui.TextInput.prototype={_attach:function(){var e;!this.placeholder&&"password"!=this.input.type||(e=this,hui.ui.onReady(function(){window.setTimeout(function(){e.value=e.input.value,e._updateClass()},500)})),hui.ui.addFocusClass({element:this.input,classElement:this.element,class:"hui_field_focused",widget:this}),hui.listen(this.input,"keyup",this._onKeyUp.bind(this)),hui.listen(this.input,"keydown",this._onKeyDown.bind(this)),hui.listen(this.input,"input",this._onKeyUp.bind(this)),hui.listen(this.input,"change",this._onChange.bind(this));var t=this.element.getElementsByTagName("em")[0];t&&(this._updateClass(),hui.listen(t,"mousedown",function(){window.setTimeout(function(){this.input.focus(),this.input.select()}.bind(this))}.bind(this)),hui.listen(t,"mouseup",function(){this.input.focus(),this.input.select()}.bind(this)))},_updateClass:function(){hui.cls.set(this.element,"hui_field_dirty",0<this.value.length)},_onKeyDown:function(e){13===e.keyCode&&(this.multiline&&!e.ctrlKey&&!e.metaKey||(hui.stop(e),this.fire("submit"),(e=hui.ui.getAncestor(this,"hui_form"))&&e.submit()))},_onChange:function(e){this._onKeyUp(e)},_onKeyUp:function(e){this.input.value!=this.value&&(this.value=this.input.value,this._updateClass(),this._expand(this.options.animateUserChange),hui.ui.callAncestors(this,"childValueChanged",this.input.value),this.fire("valueChanged",this.input.value),this.modified=!0)},focus:function(){try{this.input.focus()}catch(e){}},select:function(){try{this.input.focus(),this.input.select()}catch(e){}},reset:function(){this.setValue("")},isModified:function(){return this.modified},stress:function(){hui.ui.stress(this)},setValue:function(e){this.value=e=null==e?"":e,this.input.value=e,this._expand(this.options.animateValueChange),this.modified=!1},getValue:function(){return this.input.value},isEmpty:function(){return""===this.input.value},isBlank:function(){return hui.isBlank(this.input.value)},setError:function(e){var t=!!e;hui.cls.set(this.element,"hui_field_error",t),"string"==typeof e&&hui.ui.showToolTip({text:e,element:this.element,key:this.name}),t||hui.ui.hideToolTip({key:this.name})},$visibilityChanged:function(){hui.dom.isVisible(this.element)&&window.setTimeout(this._expand.bind(this))},_expand:function(e){var t;this.multiline&&hui.dom.isVisible(this.element)&&(t=this._getTextAreaHeight(this.input),t=Math.min(t,this.options.maxHeight),e?hui.animate({node:this.input,duration:300,css:{height:t+"px"},ease:hui.ease.slowFastSlow}):this.input.style.height=t+"px")},_getTextAreaHeight:function(e){var t=(t=this.textAreaDummy)||(this.textAreaDummy=hui.build("div.hui_textinput_dummy",{parent:document.body})),i=e.value;return"\n"===i[i.length-1]&&(i+="x"),i=hui.string.escape(i).replace(/\n/g,"<br/>"),t.innerHTML=i,t.style.width=e.clientWidth+"px",t.clientHeight+2}},hui.ui.Rendering=function(e){this.options=hui.override({clickObjects:!1},e),this.element=hui.get(e.element),this.name=e.name,hui.ui.extend(this)},hui.ui.Rendering.prototype={_click:function(e){hui.event(e)},setContent:function(e){this.element.innerHTML=e}},hui.on(["hui.ui"],function(){hui.ui.make({name:"Icon",$init:function(e){this.visible=!1,this.icon=e.icon,this.labeled=!1},$build:function(e){return hui.ui.createIcon(e.icon,e.size,"span")},$events:{root:{click:function(){this.fire("click")}}},setSize:function(e){var t=hui.find("span",this.element)||this.element;this.size=e,hui.ui.setIconImage(t,this.icon,e),t.className="hui_icon hui_icon_"+e,hui.cls.has(this.element,"hui_icon_labeled")&&(this.element.className="hui_icon_labeled hui_icon_labeled_"+e)}})}),hui.ui.ColorInput=function(e){this.options=hui.override({value:null},e),this.name=e.name,this.element=hui.get(e.element),this.button=hui.get.firstByTag(this.element,"a"),this.input=new hui.ui.Input({element:hui.get.firstByTag(this.element,"input"),validator:{validate:function(e){return{valid:!0,value:e=hui.isBlank(e)?"":new hui.Color(e).toHex()}}}}),this.input.listen({$valueChanged:this._onInputChange.bind(this)}),this.value=null,hui.ui.extend(this),this.setValue(this.options.value),this._addBehavior()},hui.ui.ColorInput.create=function(e){(e=e||{}).element=hui.build("span",{class:"hui_colorinput",html:'<input class="hui_textinput" type="text" value=""/><a tabindex="-1" class="hui_colorinput_color" href="javascript://"></a>'});return new hui.ui.ColorInput(e)},hui.ui.ColorInput.prototype={_addBehavior:function(){hui.listen(this.button,"click",this._onButtonClick.bind(this))},_syncInput:function(){this.input.setValue(this.value)},_syncColorButton:function(){this.button.innerHTML=this.value?"":"?",this.button.style.backgroundColor=this.value||""},_onInputChange:function(e){var t=e!=this.value;this.value=e,this._syncColorButton(),t&&this._fireChange()},_fireChange:function(){hui.ui.callAncestors(this,"childValueChanged",this.value),this.fire("valueChanged",this.value)},_onBlur:function(){hui.Color.parse(this.value)},_onButtonClick:function(){hui.window.getViewHeight()<200?this.fire("clickPicker",this.value):(this.panel||(this.panel=hui.ui.BoundPanel.create({modal:!0}),this.picker=hui.ui.ColorPicker.create(),this.picker.listen(this),this.panel.add(this.picker)),this.panel.position(this.button),this.panel.show())},$colorWasSelected:function(e){this.panel.hide(),this.setValue(e),this._fireChange()},getValue:function(){return this.value},setValue:function(e){this.value=hui.isBlank(e)?e:new hui.Color(e).toHex(),this._syncInput(),this._syncColorButton()},focus:function(){try{this.input.focus()}catch(e){}},reset:function(){this.setValue("")},getAccessories:function(){return this.panel?[this.panel]:[]}},hui.ui.Columns=function(e){this.name=e.name,this.options=e||{},this.element=hui.get(e.element),this.body=hui.get.firstByTag(this.element,"tr"),hui.ui.extend(this)},hui.ui.Columns.create=function(e){return(e=e||{}).flexible=!0,e.element=hui.build("table",{class:"hui_columns",html:"<tbody><tr></tr></tbody>"}),new hui.ui.Columns(e)},hui.ui.Columns.prototype={$$layout:function(){if(!this.options.flexible){this.element.style.height=hui.position.getRemainingHeight(this.element)+"px";for(var e=hui.get.children(this.element),t=0,i=0;i<e.length;i++){var n=e[i],s=this.element.clientWidth/e.length;n.style.width=s+"px",n.style.position="absolute",n.style.marginLeft=t+"px",n.style.height=this.element.clientHeight+"px",t+=s}}},addToColumn:function(e,t){this._ensureColumn(e).appendChild(t.getElement())},setColumnStyle:function(e,t){e=this._ensureColumn(e);hui.style.set(e,t)},setColumnWidth:function(e,t){this._ensureColumn(e).style.width=t+"px"},_ensureColumn:function(e){for(var t=hui.get.children(this.body).length-1;t<e;t++)this.body.appendChild(hui.build("td",{class:"hui_columns_column"}));return hui.get.children(this.body)[e]}},hui.ui.Finder=function(e){this.options=hui.override({title:"Finder",selection:{},list:{}},e),this.name=e.name,this.uploader=null,hui.ui.extend(this),e.listener&&this.listen(e.listener)},hui.ui.Finder.create=function(e){return new hui.ui.Finder(e)},hui.ui.Finder.prototype={show:function(){this.window?this.list&&this.list.refresh():this._build(),this.window.show()},hide:function(){this.window&&this.window.hide()},clear:function(){this.list.clearSelection()},_build:function(){var t=this.window=hui.ui.Window.create({title:this.options.title,icon:"common/search",width:600,height:400});if(t.listen({$userClosedWindow:function(){this.fire("cancel")}.bind(this)}),this.options.url)return t.setBusy(!0),void hui.ui.request({url:this.options.url,$object:function(e){hui.override(this.options,e),e.title&&t.setTitle(e.title),t.setBusy(!1),this._buildBody()}.bind(this)});this._buildBody()},_buildBody:function(){var e=this.options,t=hui.ui.Structure.create();this.window.add(t);var i=hui.ui.Overflow.create({dynamic:!0});t.addLeft(i);var n,s,h=this.list=hui.ui.List.create();this.list.listen({$select:this._selectionChanged.bind(this)}),(e.search||e.gallery)&&(s=hui.ui.Bar.create({variant:"layout"}),t.addCenter(s),e.search&&((n=hui.ui.SearchField.create({expandedWidth:200})).listen({$valueChanged:function(){h.resetState()}}),s.addToRight(n)));var u=hui.ui.Overflow.create({dynamic:!0});t.addCenter(u),u.add(this.list),this.selection=hui.ui.Selection.create({value:e.selection.value}),this.selection.listen({$select:function(){h.resetState()}});t=new hui.ui.Source({url:e.selection.url});this.selection.addItems({source:t}),i.add(this.selection);var o=[];e.list.url&&(o=[{key:"windowSize",value:10},{key:"windowPage",value:"@"+h.name+".window.page"},{key:"direction",value:"@"+h.name+".sort.direction"},{key:"sort",value:"@"+h.name+".sort.key"}]),e.selection.parameter&&o.push({key:e.selection.parameter||"text",value:"@"+this.selection.name+".value"}),e.selection.kindParameter&&o.push({key:e.selection.kindParameter||"text",value:"@"+this.selection.name+".kind"}),e.search&&n&&o.push({key:e.search.parameter||"text",value:"@"+n.name+".value"}),e.list.pageParameter&&o.push({key:e.list.pageParameter,value:"@"+h.name+".window.page"});var a,l,r=e.list.source;if(r)for(var d=0;d<o.length;d++)r.addParameter(o[d]);e.list.url&&(r=new hui.ui.Source({url:e.list.url,parameters:o})),this.list.setSource(r),e.gallery&&((l=hui.ui.Segmented.create({value:"gallery",items:[{icon:"view/list",value:"list"},{icon:"view/gallery",value:"gallery"}]})).listen({$valueChanged:this.changeView.bind(this)}),s.add(l),l=new hui.ui.Source({url:e.gallery.url,parameters:o}),a=this.gallery=hui.ui.Gallery.create({source:l}),this.list.hide(),u.add(a),a.listen({$select:function(e){this.fire("select",a.getFirstSelection())}.bind(this)}),l.refresh()),e.upload&&hui.ui.Upload.HTML5.support().supported&&((l=hui.ui.Button.create({text:"Add...",small:!0})).listen({$click:this._showUpload.bind(this)}),s.add(l)),e.creation&&s.add(hui.ui.Button.create({text:e.creation.button||"Add...",small:!0,listen:{$click:this._showCreation.bind(this)}})),t.refresh(),hui.ui.reLayout()},changeView:function(e){"gallery"==e?(this.list.hide(),this.gallery.show()):(this.list.show(),this.gallery.hide())},_selectionChanged:function(){var e=this.list.getFirstSelection();e&&this.fire("select",e)},_showUpload:function(e){var t,i;this.uploadPanel||(t=this.options.upload,i=this.uploadPanel=hui.ui.BoundPanel.create({padding:5,width:300,modal:!0}),this.uploader=hui.ui.Upload.create({url:t.url,placeholder:t.placeholder,chooseButton:{en:"Choose file...",da:"VÃ¦lg fil..."}}),this.uploader.listen({$uploadDidComplete:function(e){this._uploadSuccess(hui.string.fromJSON(e.request.responseText))}.bind(this)}),i.add(this.uploader)),this.uploadPanel.show({target:e})},_uploadSuccess:function(e){this.uploadPanel.hide(),this.fire("select",e)},_showCreation:function(e){var t,i,n;this._createPanel||((t=this._createForm=hui.ui.Form.create({listen:{$submit:this._create.bind(this)}})).buildGroup({above:!0},this.options.creation.formula),(i=this._createPanel=hui.ui.BoundPanel.create({padding:10,width:300,modal:!0})).add(t),(n=hui.ui.Buttons.create()).add(hui.ui.Button.create({text:"Cancel",listen:{$click:function(){t.reset(),i.hide()}}})),n.add(hui.ui.Button.create({text:"Create",highlighted:!0,submit:!0})),t.add(n)),this._createPanel.show({target:e}),this._createForm.focus()},_create:function(e){var t=this._createForm.getValues();this._createForm.reset(),this._createPanel.hide(),this.window.setBusy(!0);var i=this;hui.ui.request({url:this.options.creation.url,parameters:t,$object:function(e){i.fire("select",e)},$failure:function(){},$finally:function(){i.window.setBusy(!1)}})}},window.define&&define("hui.ui.Finder",hui.ui.Finder),hui.ui.Structure=function(e){this.name=e.name,this.options=e||{},this.element=hui.get(e.element),hui.ui.extend(this)},hui.ui.Structure.create=function(e){return(e=hui.override({},e)).element=hui.dom.parse('<div class="hui_structure"><div class="hui_structure_middle"><div class="hui_structure_left hui_context_sidebar"></div><div class="hui_structure_center"></div></div></div>'),new hui.ui.Structure(e)},hui.ui.Structure.prototype={addLeft:function(e){hui.get.firstByClass(this.element,"hui_structure_left").appendChild(e.element)},addCenter:function(e){hui.get.firstByClass(this.element,"hui_structure_center").appendChild(e.element)},$$layout:function(){var e=hui.get.firstByClass(this.element,"hui_structure_top"),t=hui.get.firstByClass(this.element,"hui_structure_bottom"),i=hui.get.firstByClass(this.element,"hui_structure_middle");i&&(i.style.top=(e?e.clientHeight+2:0)+"px",i.style.bottom=(t?t.clientHeight+2:0)+"px")}},hui.ui.Slider=function(e){this.options=hui.override({value:0,min:0,max:1},e),this.name=e.name,this.element=hui.get(e.element),this.handler=hui.get.firstByTag(e.element,"a"),hui.ui.extend(this),this.position=0,this.value=0,this.setValue(this.options.value),this._addBehavior()},hui.ui.Slider.create=function(e){var t=(e=hui.override({},e)).element=hui.build("span",{class:"hui_slider",html:'<a href="javascript://" class="hui_slider_knob"></a><span class="hui_slider_bar"></span>'});return e.width&&(t.style.width=e.width+"px"),new hui.ui.Slider(e)},hui.ui.Slider.prototype={_addBehavior:function(){hui.drag.register({element:this.handler,onBeforeMove:this._onBeforeMove.bind(this),onMove:this._onMove.bind(this),onAfterMove:this._onAfterMove.bind(this)})},_onBeforeMove:function(e){this.dragging=!0;var t=hui.position.get(this.handler);this.dragInfo={left:hui.position.getLeft(this.element),diff:e.getLeft()-t.left,max:this.element.clientWidth-this.handler.clientWidth-5},hui.cls.add(document.body,"hui_slider-grabbing"),hui.cls.add(this.handler,"hui_slider-grabbing")},_onMove:function(e){e=e.getLeft()-this.dragInfo.left;e-=this.dragInfo.diff,e=Math.max(e,5),e=Math.min(e,this.dragInfo.max),this.handler.style.left=e+"px",this._setPosition((e-5)/(this.dragInfo.max-5))},_onAfterMove:function(){this.dragging=!1,hui.cls.remove(document.body,"hui_slider-grabbing"),hui.cls.remove(this.handler,"hui_slider-grabbing"),this.fire("valueChangedEnd",this.position)},_setPosition:function(e){this.position=e,this.fire("valueChanged",e)},setValue:function(e){var t=Math.max(0,Math.min(e,1)),e=this.element.clientWidth-10-this.handler.clientWidth;this.dragging||hui.animate({node:this.handler,css:{left:t*e+5+"px"},duration:200,ease:hui.ease.fastSlow}),this.position=this.value=t}},hui.ui.CodeInput=function(e){this.options=hui.override({},e),this.name=e.name;var t=this.element=hui.get(e.element);this.textarea=hui.get.firstByTag(t,"textarea"),e.value&&(this.textarea.value=e.value),this.value=this.textarea.value,hui.ui.extend(this),this._addBehavior()},hui.ui.CodeInput.create=function(e){return(e=e||{}).element=hui.build("div",{class:"hui_codeinput",html:'<textarea class="hui_codeinput_input" spellcheck="false"></textarea>'}),e.height&&(e.element.style.height=hui.style.length(e.height)),new hui.ui.CodeInput(e)},hui.ui.CodeInput.prototype={_addBehavior:function(){hui.listen(this.textarea,"keydown",this._onKeyDown.bind(this)),hui.listen(this.textarea,"keyup",this._onKeyUp.bind(this))},getValue:function(){return this.textarea.value},setValue:function(e){this.textarea.value=e,this.value=e},addLine:function(e){""===this.value?this.setValue(e):this.setValue(this.value+"\n"+e)},reset:function(){this.setValue("")},_onKeyUp:function(){this.textarea.value!==this.value&&(this.value=this.textarea.value,this.fireValueChange())},_onKeyDown:function(e){var t,i,n=String.fromCharCode(9),s=window.event||e,h=s.target||s.srcElement||s.which,u=h.scrollTop;if(9==(s.keyCode||s.charCode||s.which)&&!s.ctrlKey&&!s.altKey)if(h.setSelectionRange){s.preventDefault();var o,a=h.selectionStart,l=h.selectionEnd;if(a!=l&&-1!=h.value.slice(a,l).indexOf("\n")){0<a&&(a=h.value.slice(0,a).lastIndexOf("\n")+1);var r=h.value.slice(0,a),d=h.value.slice(a,l),e=h.value.slice(l,h.value.length);if(s.shiftKey){for(t=d.split("\n"),i=0;i<t.length;i++)t[i].slice(0,1)!=n&&" "!=t[i].slice(0,1)||(t[i]=t[i].slice(1,t[i].length));d=t.join("\n"),h.value=r.concat(d,e),h.selectionStart=a,h.selectionEnd=r.length+d.length}else d=d.replace(/\n/g,"\n"+n),r=r.concat(n),h.value=r.concat(d,e),h.selectionStart=a,h.selectionEnd=l+n.length*d.split("\n").length}else s.shiftKey?(o=(d=h.value.slice(0,a)).slice(d.length-1,d.length))!=n&&" "!=o||(h.value=d.slice(0,d.length-1).concat(h.value.slice(a,h.value.length)),h.selectionStart=a-1,h.selectionEnd=l-1):(h.value=h.value.slice(0,a).concat(n).concat(h.value.slice(a,h.value.length)),a==l?h.selectionStart=h.selectionEnd=a+n.length:(h.selectionStart=a+n.length,h.selectionEnd=l+n.length))}else{s.returnValue=!1;var c,p,a=document.selection.createRange(),l=document.body.createTextRange();if(l.moveToElementText(h),l.setEndPoint("EndToStart",a),0===a.text.length||-1===a.text.indexOf("\n"))s.shiftKey?(o=l.text.slice(l.text.length-1,l.text.length))!=n&&" "!=o||(l.text=l.text.slice(0,l.text.length-1),a.setEndPoint("StartToEnd",l)):((c=h.value.slice(l.text.length,l.text.length+1))!=a.text.slice(0,1)&&(l.text=l.text.concat(c)),l.text=l.text.concat(n)),(c=document.body.createTextRange()).setEndPoint("StartToEnd",l),c.setEndPoint("EndToEnd",a),c.select();else{if(s.shiftKey){for(t=a.text.split("\r\n"),h.value.slice(l.text.length,l.text.length+2)==a.text.slice(0,2)&&-1!=(p=l.text.lastIndexOf("\r\n".concat(n)))&&(l.text=l.text.slice(0,p+2).concat(l.text.slice(p+3,l.text.length))),i=0;i<t.length;i++)(o=0<t[i].length&&t[i].slice(0,1))!=n&&" "!=o||(t[i]=t[i].slice(1,t[i].length));a.text=t.join("\r\n")}else 0<l.text.length?h.value.slice(l.text.length,l.text.length+2)!=a.text.slice(0,2)?a.text=n.concat(a.text.split("\r\n").join("\r\n".concat(n))):(p=l.text.slice(0,void 0).lastIndexOf("\r\n")+2,l.text=l.text.slice(0,p).concat(n,l.text.slice(p,l.text.length)),a.text=a.text.split("\r\n").join("\r\n".concat(n))):a.text=n.concat(a.text).split("\r\n").join("\r\n".concat(n));(c=document.body.createTextRange()).setEndPoint("StartToEnd",l),c.setEndPoint("EndToEnd",a),c.select()}}h.scrollTop=u}},hui.ui.LinkInput=function(e){var t=this.element=hui.get(e.element);this.options=hui.override({types:[]},e),this.types=this.options.types,this.name=e.name,this.value=e.value,this.input=new hui.ui.Input({element:hui.get.firstByTag(t,"input")}),this.input.listen({$valueChanged:this._onInputChange.bind(this)}),this.object=hui.get.firstByClass(t,"hui_linkinput_object"),this.dropdown=new hui.ui.DropDown({element:hui.get.firstByClass(t,"hui_dropdown"),value:"none",items:this._buildDropDownOptions(),listener:{$valueChanged:this._onDropDownChange.bind(this)}}),hui.ui.extend(this),this._addBehavior()},hui.ui.LinkInput.prototype={_addBehavior:function(){},_buildDropDownOptions:function(){for(var e=[{value:"none",text:"Intet link"}],t=0;t<this.options.types.length;t++){var i=this.options.types[t];e.push({value:i.key,text:i.label})}return e},_getType:function(e){for(var t=0;t<this.types.length;t++)if(this.types[t].key==e)return this.types[t]},_onInputChange:function(e){this.value={type:this.dropdown.getValue(),value:e},this._updateUI(),this.fireValueChange()},_onDropDownChange:function(e){this._closeAllFinders();var t=this._getType(e);t?(this.input.element.style.display=t.finderOptions?"none":"",this.object.style.display=t.finderOptions?"":"none",t.finderOptions?(t._finder||(t._finder=hui.ui.Finder.create(t.finderOptions),t._finder.listen({$select:function(e){this._selectObject(t,e)}.bind(this)})),t._finder.show(),this.value={type:e,value:null}):(this.input.focus(),this.input.setValue(""),this.value={type:e,value:""}),this._updateUI(),this.fireValueChange()):this.input.element.style.display=this.object.style.display="none"},_closeAllFinders:function(){for(var e=0;e<this.types.length;e++)this.types[e]._finder&&this.types[e]._finder.hide()},_selectObject:function(e,t){this.value={type:e.key,value:t},this._updateUI(),this._closeAllFinders(),this.fireValueChange()},_updateUI:function(){var e,t,i,n=this.value;hui.isDefined(n)?(e=this._getType(n.type))&&(this.dropdown.setValue(n.type),this.input.element.style.display=e.finderOptions?"none":"",this.object.style.display=e.finderOptions?"":"none",e.finderOptions?(t=hui.get.firstByClass(this.element,"hui_linkinput_title"),i=hui.get.firstByClass(this.element,"hui_linkinput_icon"),n.value?(this.object.style.display="",hui.isDefined(n.value.title)?hui.dom.setText(t,hui.string.shorten(n.value.title,40)):(this._setBusy(!0),hui.ui.request({url:e.lookupUrl,parameters:{id:n.value.id},$object:function(e){hui.dom.setText(t,hui.string.shorten(e.title,40)),this._setBusy(!1)}.bind(this),$failure:function(){hui.dom.setText(t,"!!Error"),this._setBusy(!1)}.bind(this)})),i.style.backgroundImage="url('"+hui.ui.getIconUrl(e.icon,16)+"')"):this.object.style.display="none"):this.input.value=n.value):(this.dropdown.setValue("none"),this.input.element.style.display=this.object.style.display="none")},_setBusy:function(e){this.busy=e,hui.cls.set(this.element,"hui_linkinput_busy",e)},getValue:function(){return this.value},setValue:function(e){this.value=e,this._updateUI()},reset:function(){this.setValue(null)}},hui.ui.FontInput=function(e){this.options=hui.override({value:null},e),this.name=e.name,this.element=hui.get(e.element),this.button=hui.get.firstByClass(this.element,"hui_fontinput"),this.dropdown=new hui.ui.DropDown({element:hui.get.firstByClass(this.element,"hui_dropdown"),items:[{text:"",value:""}].concat(hui.ui.FontPicker.fonts),listener:this}),this.value=null,hui.ui.extend(this),this.setValue(this.options.value),this._addBehavior()},hui.ui.FontInput.create=function(e){(e=e||{}).element=hui.build("span",{class:"hui_colorinput",html:'<span class="hui_field_top"><span><span></span></span></span><span class="hui_field_middle"><span class="hui_field_middle"><span class="hui_field_content"><span class="hui_field_singleline"><input type="text" value=""/></span></span></span></span><span class="hui_field_bottom"><span><span></span></span></span><a tabindex="-1" class="hui_colorinput" href="javascript://"></a>'});return new hui.ui.ColorInput(e)},hui.ui.FontInput.prototype={_addBehavior:function(){hui.listen(this.button,"click",this._onButtonClick.bind(this))},_syncInput:function(){this.dropdown.setValue(this.value)},_fireChange:function(){hui.ui.callAncestors(this,"childValueChanged",this.value),this.fire("valueChanged",this.value)},_onBlur:function(){hui.Color.parse(this.value)},_onButtonClick:function(){hui.window.getViewHeight()<200?this.fire("clickPicker",this.value):(this.panel||(this.panel=hui.ui.BoundPanel.create({modal:!0,variant:"light"}),this.picker=hui.ui.FontPicker.create(),this.picker.listen(this),this.panel.add(this.picker)),this.panel.position(this.button),this.panel.show())},$select:function(e){this.panel.hide(),this.setValue(e.value),this._fireChange()},$valueChanged:function(e){this.setValue(e),this._fireChange()},getValue:function(){return this.value},setValue:function(e){this.value=e,this._syncInput(),this.button.style.fontFamily=e},focus:function(){try{this.input.focus()}catch(e){}},reset:function(){this.setValue("")},getAccessories:function(){var e=[];return this.panel&&e.push(this.panel),this.picker&&e.push(this.picker),e}},hui.ui.FontPicker=function(e){this.name=e.name,this.element=hui.get(e.element),this.fonts=e.fonts.concat(e.additionalFonts),this.previews={},this.options=e||{},hui.override(this.options,e),hui.ui.extend(this),this.options.listener&&this.listen(this.options.listener),this._addBehavior()},hui.ui.FontPicker.fonts=[{text:"Verdana",value:"Verdana,sans-serif"},{text:"Tahoma",value:"Tahoma,Geneva,sans-serif"},{text:"Trebuchet",value:"Trebuchet MS,Helvetica,sans-serif"},{text:"Geneva",value:"Geneva,Tahoma,sans-serif"},{text:"Helvetica",value:"Helvetica,Arial,sans-serif"},{text:"Helvetica Neue",value:"Helvetica Neue,Helvetica,Arial,sans-serif"},{text:"Arial",value:"Arial,Helvetica,sans-serif"},{text:"Arial Black",value:"Arial Black,Gadget,Arial,sans-serif"},{text:"Impact",value:"Impact,Charcoal,Arial Black,Gadget,Arial,sans-serif"},{text:"Times New Roman",value:"Times New Roman,Times,serif"},{text:"Times",value:"Times,Times New Roman,serif"},{text:"Book Antiqua",value:"Book Antiqua,Palatino,serif"},{text:"Palatino",value:"Palatino,Book Antiqua,serif"},{text:"Georgia",value:"Georgia,Book Antiqua,Palatino,serif"},{text:"Garamond",value:"Garamond,Times New Roman,Times,serif"},{text:"Comic Sans",value:"Comic Sans MS,cursive"},{text:"Courier New",value:"Courier New,Courier,monospace"},{text:"Courier",value:"Courier,Courier New,monospace"},{text:"Lucida Console",value:"Lucida Console,Monaco,monospace"},{text:"Monaco",value:"Monaco,Lucida Console,monospace"}],hui.ui.FontPicker.create=function(e){for(var t=(e=hui.override({fonts:hui.ui.FontPicker.fonts,additionalFonts:[]},e)).fonts.concat(e.additionalFonts),i=e.element=hui.build("div",{class:"hui_fontpicker"}),n=0;n<t.length;n++){var s=t[n],h=hui.build("div",{parent:i,class:"hui_fontpicker_item",text:s.text,style:"font-family:"+s.value+";"}),s=hui.ui.createIcon("monochrome/info",16,"a");h.appendChild(s),h.huiIndex=n}return new hui.ui.FontPicker(e)},hui.ui.FontPicker.prototype={_addBehavior:function(){hui.listen(this.element,"click",this._onClick.bind(this))},_onClick:function(e){var t=(e=hui.event(e)).findByClass("hui_fontpicker_item");t&&(e=e.findByClass("hui_icon"),t=this.fonts[t.huiIndex],e?this._buildPreview(t):this.fire("select",t))},$visibilityChanged:function(){hui.dom.isVisible(this.element)||hui.each(this.previews,function(e,t){t.hide()})},_buildPreview:function(e){if(this.previews[e.text])this.previews[e.text].show();else{var t,i=hui.build("div",{className:"hui_fontpicker_example",style:"font-family:"+e.value+";"}),n=[100,200,300,"normal",500,600,"bold","bolder"],s=["9pt","10pt","11pt","12pt","13pt","14pt","16px","18pt"],h="<h1>"+e.text+"</h1>";for(h+='<p style="font-size: 12px;">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>',h+="<table>",h+="<thead><tr><th></th>",t=0;t<n.length;t++)h+="<th>"+n[t]+"</th>";for(h+="</tr></thead>",h+="<tbody>",t=0;t<s.length;t++){h+="<tr><th>"+s[t]+"</th>";for(var u=0;u<n.length;u++)h+='<td style="font-weight: '+n[u]+"; font-size:"+s[t]+';">Pack my box with five dozen liquor jugs</td>'}i.innerHTML=h+="</tbody>";var o=hui.ui.Window.create({title:e.text,padding:3});o.add(i),(this.previews[e.text]=o).show()}},getAccessories:function(){return this.previews}},hui.ui.Split=function(e){this.options=hui.override({},e),this.name=e.name,this.element=hui.get(e.element),this.rows=hui.get.children(this.element),this.handles=[],this.sizes=[];for(var t=0;t<this.rows.length;t++)0<t&&this.handles.push(hui.build("div",{class:"hui_split_handle",parent:this.element}));this._buildSizes(),hui.ui.extend(this),this._attach()},hui.ui.Split.prototype={_attach:function(){hui.each(this.handles,function(e){hui.drag.register({element:e,onBeforeMove:function(e){hui.log("before")},onMove:function(e){hui.log("moving")}})})},_buildSizes:function(){for(this.sizes=[],n=0;n<this.rows.length;n++){var e=this.rows[n].getAttribute("data-height");e?this.sizes.push(this._getSize(e)):this.sizes.push(0)}for(var t=0,i=0,n=0;n<this.sizes.length;n++)t+=this.sizes[n],i+=0===this.sizes[n]?1:0;var s=(1-t)/i;for(n=0;n<this.sizes.length;n++)0===this.sizes[n]&&(this.sizes[n]=s)},_getSize:function(e){return-1!=e.indexOf("%")?parseInt(e)/100:parseInt(e)/this.element.clientHeight},$$layout:function(){this._layout()},_getSiblingHeight:function(e){for(var t=e.parentNode.clientHeight,i=e.parentNode.childNodes,n=0;n<i.length;n++){var s=i[n];s!==e&&hui.dom.isElement(i[n])&&"absolute"!=hui.style.get(s,"position")&&(t-=s.offsetHeight)}return t},_layout:function(){for(var e=0,t=hui.position.getRemainingHeight(this.element),i=0;i<this.rows.length;i++){this.rows[i].style.top=e*t+"px";var n=this.sizes[i]*t;i<this.rows.length-1&&(n-=6),this.rows[i].style.height=n+"px",e+=this.sizes[i],i<this.rows.length-1&&(this.handles[i].style.top=e*t+"px")}}},hui.ui.NumberValidator=function(e){hui.override({allowNull:!1,min:0,max:10},e),this.min=e.min,this.max=e.max,this.allowNull=e.allowNull,this.middle=Math.max(Math.min(this.max,0),this.min)},hui.ui.NumberValidator.prototype={validate:function(e){if(hui.isBlank(e)&&this.allowNull)return{valid:!0,value:null};e=parseFloat(e);return isNaN(e)?{valid:!1,value:this.middle}:e<this.min?{valid:!1,value:this.min}:e>this.max?{valid:!1,value:this.max}:{valid:!0,value:e}}},function(t){hui.ui.ObjectInput=function(e){this.options=hui.override({},e),this.key=e.key,this.value=[],e.value&&this.value.push(e.value),"string"==typeof e.finder&&(this.finder=hui.ui.get(e.finder),this.finder.listen({$select:this._found.bind(this)})),this.nodes={text:".hui_objectinput_text",list:".hui_objectinput_list"},this.choose=null,this.remove=null,t.call(this,e),this._attach()},hui.ui.ObjectInput.prototype={_attach:function(){this.choose=new hui.ui.Button({element:hui.get.firstByClass(this.element,"hui_objectinput_choose")}),this.choose.listen({$click:this._choose.bind(this)}),this.remove=new hui.ui.Button({element:hui.get.firstByClass(this.element,"hui_objectinput_remove")}),this.remove.listen({$click:this.reset.bind(this)}),hui.listen(this.nodes.list,"click",this._clickList.bind(this))},_choose:function(){this.finder||(this.finder=hui.ui.Finder.create(this.options.finder),this.finder.listen({$select:this._found.bind(this)})),this.finder.show()},_clickList:function(e){(e=hui.event(e)).stop(),e.findByClass("hui_objectinput_delete")&&(e=e.findByClass("hui_objectinput_object"),e=parseInt(e.getAttribute("data-index"),10),this.value.splice(e,1),this._render())},_found:function(e){this.finder.hide(),this.value.push(e),this._render(),this.fireValueChange()},_render:function(){this.nodes.list.innerHTML="";for(var e=0;e<this.value.length;e++){var t=this.value[e],t=this.fire("render",t)||t,i=hui.build("div",{class:"hui_objectinput_object",parent:this.nodes.list,"data-index":e});t.icon&&i.appendChild(hui.ui.createIcon(t.icon,16)),i.appendChild(hui.build("span",{class:"hui_objectinput_title",text:t.text||t.title}));t=hui.ui.createIcon("monochrome/delete",16,"a");hui.cls.add(t,"hui_objectinput_delete"),t.href="#",i.appendChild(t)}this.remove.setEnabled(!!this.value)},setValue:function(e){this.value=e||[],this._render(),this.fireValueChange()},getValue:function(){return this.value},reset:function(){this.setValue(null)}},hui.extend(hui.ui.ObjectInput,t)}(hui.ui.Component),function(t){hui.ui.Rows=function(e){t.call(this,e),this.rows=[],this._attach()},hui.ui.Rows.prototype={_attach:function(){for(var e=hui.get.children(this.element),t=0;t<e.length;t++){var i=e[t],n=hui.string.fromJSON(i.getAttribute("data"))||{};n.node=i,this.rows.push(n)}},_findSizes:function(e){for(var t=[],i=this.rows.length,n=0,s=0,h=0;h<i;h++){var u=this.rows[h];"content"==u.height?(s+=u=this._getContentHeight(u.node),t.push(u),n++):t.push(null)}for(var o=e-s,a=i-n,l=0;l<t.length;l++)null===t[l]&&(t[l]=1/a*o);this.sizes=t},_getContentHeight:function(e){for(var t=0,i=hui.get.children(e),n=0;n<i.length;n++)t+=i[n].clientHeight;return t},$$childSizeChanged:function(){this.$$layout()},$$layout:function(){var e=this.element.parentNode.clientHeight;this.element.style.height=e+"px",this._findSizes(e);for(var t=this.rows.length,i=0;i<t;i++)this.rows[i].node.style.height=this.sizes[i]+"px"}},hui.extend(hui.ui.Rows,t)}(hui.ui.Component),hui.ui.Pages=function(e){this.options=e||{},this.element=hui.get(e.element),this.name=e.name,this.pages=hui.get.children(this.element),this.index=0,this.fixedHeight=hui.cls.has(this.element,"hui_pages_full"),this.expanded=!1,hui.ui.extend(this)},hui.ui.Pages.create=function(e){return(e=e||{}).element=hui.build("div",{class:"hui_pages"}),new hui.ui.Pages(e)},hui.ui.Pages.prototype={add:function(e){var t=hui.dom.isElement(e)?t:e.element,e=hui.build("div",{class:"hui_pages_page"});e.appendChild(t),this.element.appendChild(e),0<this.pages.length&&(e.style.display="none"),this.pages=hui.get.children(this.element)},next:function(){var e;this.expanded||(e=this.pages[this.index],this.index=this.pages.length<=this.index+1?0:this.index+1,this._transition({hide:e,show:this.pages[this.index]}))},previous:function(){var e;this.expanded||(e=this.pages[this.index],this.index=0===this.index?this.pages.length-1:this.index-1,this._transition({hide:e,show:this.pages[this.index]}))},goTo:function(e){for(var t=0;t<this.pages.length;t++)if(this.pages[t].getAttribute("data-key")==e&&t!=this.index){var i=this.pages[this.index];return this.index=t,void this._transition({hide:i,show:this.pages[t]})}},getPageKey:function(){return this.pages[this.index].getAttribute("data-key")},expand:function(){for(var e=this.pages.length,t=0;t<e;t++)this.expanded?hui.style.set(this.pages[t],{width:"",display:t==this.index?"block":"none",float:""}):hui.style.set(this.pages[t],{width:100/e+"%",display:"block",float:"left",opacity:1});hui.ui.callVisible(this),this.expanded=!this.expanded},_unFocus:function(){var e=document.activeElement;e&&hui.dom.isDescendantOrSelf(e,this.element)&&e.blur()},_transition:function(e){this._unFocus();var t=e.hide,i=e.show,n=this.element;this.fixedHeight?(hui.style.set(t,{position:"absolute",width:n.clientWidth+"px",height:this.element.clientHeight+"px"}),hui.style.set(i,{position:"absolute",display:"block",opacity:0,width:n.clientWidth+"px",height:this.element.clientHeight+"px"})):(hui.style.set(t,{position:"absolute",width:n.clientWidth+"px"}),hui.style.set(i,{position:"absolute",width:n.clientWidth+"px",display:"block",opacity:0}),hui.style.set(n,{height:t.offsetHeight+"px",overflow:"hidden",position:"relative"}),hui.animate({node:n,css:{height:i.offsetHeight+"px"},duration:200,ease:hui.ease.slowFastSlow})),hui.ui.reLayout(),hui.effect.fadeOut({element:t,duration:200,$complete:function(){hui.style.set(t,{width:"",position:"",height:""}),window.setTimeout(function(){t.style.display="none"})}}),hui.effect.fadeIn({element:i,duration:200,$complete:function(){hui.style.set(i,{width:"",position:"",height:""}),this.fixedHeight||hui.style.set(n,{height:"",overflow:"",position:""}),hui.ui.reLayout(),hui.ui.callVisible(this),this.fireSizeChange()}.bind(this)})}},function(t){hui.ui.Panel=function(e){t.call(this,e),this.options=e,this.visible=!1,this._attach(),e.listener&&this.listen(e.listener)},hui.ui.Panel.create=function(e){var t=((e=hui.override({},e)).closable?'<div class="hui_panel_close"></div>':"")+'<div class="hui_panel_arrow"></div><div class="hui_panel_titlebar">';e.icon&&(t+='<span class="hui_icon hui_icon_16 hui_panel_icon" style="background-image: url('+hui.ui.getIconUrl(e.icon,16)+"); background-image: -webkit-image-set(url("+hui.ui.getIconUrl(e.icon,16)+") 1x,url("+hui.ui.getIconUrl(e.icon,"32x2")+') 2x);"></span>'),t+='<span class="hui_panel_title">'+hui.ui.getTranslated(e.title)+'</span></div><div class="hui_panel_body" style="'+(e.width?"width:"+e.width+"px;":"")+(e.height?"height:"+e.height+"px;":"")+(e.padding?"padding:"+e.padding+"px;":"")+'"></div>';var i="hui_panel hui-is-floating"+(e.variant?" hui_panel_"+e.variant:"");return e.title&&(i+=" hui-is-titled"),"dark"==e.variant&&(i+=" hui_context_dark"),e.element=hui.build("div",{class:i,html:t,parent:e.parent||document.body}),new hui.ui.Panel(e)},hui.ui.Panel.prototype={_target:null,nodes:{close:".hui_panel_close",titlebar:".hui_panel_titlebar",title:".hui_panel_title",body:".hui_panel_body",arrow:".hui_panel_arrow"},_attach:function(){this.nodes.close&&(hui.listen(this.nodes.close,"click",function(e){this.hide(),this.fire("close")}.bind(this)),hui.listen(this.nodes.close,"mousedown",function(e){hui.stop(e)})),hui.drag.register({touch:!0,window:this.element.ownerDocument.defaultView,element:this.nodes.titlebar,$before:this._onDragStart.bind(this),$startMove:this._onBeforeMove.bind(this),$move:this._onMove.bind(this),$endMove:this._onAfterMove.bind(this)}),hui.listen(this.element,"mousedown",function(){this.element.style.zIndex=hui.ui.nextPanelIndex()}.bind(this))},_attachHider:function(){var t;this.options.autoHide&&!this._hideListener&&(this._hideListener=hui.on(document.body,"tap",function(e){hui.ui.isWithin(e,this.element)||this._target&&hui.ui.isWithin(e,this._target)||this.hide()}.bind(this))),this._resizeListener||(t=function(){this._adjustSize(),this._positionAtTarget()}.bind(this),this._resizeListener=hui.listen(window,"resize",function(e){this.visible&&hui.onDraw(t)}.bind(this)))},setTitle:function(e){hui.dom.setText(this.nodes.title,hui.ui.getTranslated(e)),hui.cls.set(this.element,"hui-is-titled",!hui.isBlank(e))},_positionInView:function(){var e=hui.window.getScrollTop(),t=hui.position.getTop(this.element);(t<e||t+this.element.clientHeight>hui.window.getViewHeight()+e)&&hui.animate({node:this.element,css:{top:e+40+"px"},duration:500,ease:hui.ease.slowFastSlow})},_ensureInView:function(){var e;!this.visible||this._target||(e=hui.window.getViewWidth()-3)-(hui.position.getLeft(this.element)+this.element.offsetWidth)<0&&(this.element.style.left=e-this.element.offsetWidth+"px")},_adjustSize:function(){var e=hui.window.getViewWidth(),e=this.options.width+40>e;hui.cls.set(this.element,"hui-is-full",e),e||this._ensureInView()},_placeOnTop:function(){this.visible?hui.style.set(this.element,{zIndex:hui.ui.nextPanelIndex()}):hui.style.set(this.element,{zIndex:hui.ui.nextPanelIndex(),visibility:"hidden",display:"block"})},show:function(e){var t=this.element;if(this._target=(e=e||{}).target,this._adjustSize(),this._placeOnTop(),this._target)this.visible?(hui.cls.add(t,"hui-is-animating"),this._positionAtTarget()):(this._positionAtTarget(),hui.style.set(t,{opacity:"0",transform:"scale(0.5)",visibility:"visible"}),setTimeout(function(){hui.cls.add(t,"hui-is-animating")})),hui.cls.add(t,"hui-is-targeted"),this.visible||setTimeout(function(){hui.style.set(t,{opacity:1,transform:"scale(1) "})}),setTimeout(function(){hui.cls.remove(t,"hui-is-animating")},600);else{if(this.visible)return void this._positionInView();hui.style.set(t,{visibility:"visible"}),e.avoid?hui.position.place({insideViewPort:!0,target:{element:e.avoid,vertical:.5,horizontal:1},source:{element:t,vertical:.5,horizontal:0}}):(t.style.top?this._positionInView():t.style.top=hui.window.getScrollTop()+40+"px",t.style.left||(t.style.left=Math.round((hui.window.getViewWidth()-t.clientWidth)/2)+"px")),hui.animate(t,"opacity",1,0)}this.visible=!0,hui.ui.callVisible(this),this._attachHider()},_positionAtTarget:function(){var e,t,i,n,s,h,u,o,a,l;this._target&&(e=this.element.clientWidth,t=this.element.clientHeight,1===(i=this._target).nodeType?(n=hui.position.getScrollOffset(this._target),(i=hui.position.get(this._target)).height=this._target.offsetHeight||this._target.clientHeight,i.width=this._target.offsetWidth||this._target.clientWidth):n={top:0,left:0},s=hui.window.getViewHeight(),h=hui.window.getViewWidth(),u=hui.window.getScrollTop(),o=hui.window.getScrollLeft(),l={above:(i.top-u)/t,below:(s-(i.top-u+i.height))/t,left:(i.left-o)/e,right:(h-(i.left-o+i.width))/e},a={top:0,left:0},"below"==(l=this._getOrientation(l))?(a.top=i.top+i.height+5,a.left=i.left+i.width/2-e/2):"above"==l?(a.top=i.top-t-5,a.left=i.left+i.width/2-e/2):"left"==l?(a.top=i.top+i.height/2-t/2,a.left=i.left-e-5):"right"==l&&(a.top=i.top+i.height/2-t/2,a.left=i.left+i.width+5),a.top-=n.top,a.left-=n.left,a.top=hui.between(5,a.top,u+s-t-5),a.left=hui.between(5,a.left,o+h-e-5),this.nodes.arrow.className="hui_panel_arrow hui_panel_arrow-"+l,"above"==l||"below"==l?hui.style.set(this.nodes.arrow,{left:hui.between(3,i.left-a.left+i.width/2-10,e-3-20)+"px",top:""}):hui.style.set(this.nodes.arrow,{top:hui.between(3,i.top-a.top+i.height/2-10,t-3-20)+"px",left:""}),hui.style.set(this.element,{top:a.top+"px",left:a.left+"px"}))},_getOrientation:function(e){var t,i=0;for(dim in e)e.hasOwnProperty(dim)&&e[dim]>i&&(i=e[dim],t=dim);return t},toggle:function(e){this.visible?this.hide():this.show(e)},isVisible:function(){return this.visible},hide:function(){this.visible&&(this._unFocus(),hui.cls.add(this.element,"hui-is-animating"),this.element.style.opacity="0",setTimeout(function(){hui.cls.remove(this.element,"hui-is-animating"),this.element.style.display="none",hui.ui.callVisible(this)}.bind(this),500),this.visible=!1)},_unFocus:function(){var e=document.activeElement;e&&hui.dom.isDescendantOrSelf(e,this.element)&&e.blur()},clear:function(){hui.ui.destroyDescendants(this.nodes.body),this.nodes.body.innerHTML=""},add:function(e){e.getElement?this.nodes.body.appendChild(e.getElement()):this.nodes.body.appendChild(e),this._positionAtTarget()},setBusy:function(e){if(!1===e)return clearTimeout(this._busyTimer),void(this._busyCurtain&&hui.cls.remove(this._busyCurtain,"hui-is-visible"));var t=this._busyCurtain;t||(t=this._busyCurtain=hui.build("div.hui_panel_busy",{parentFirst:this.nodes.body}),hui.browser.msie&&hui.cls.add(t,"hui_panel_busy-legacy"));e=hui.isString(e)?hui.string.escape(e):"";t.innerHTML='<span class="hui_panel_busy_text">'+e+"</span>",this._busyTimer=setTimeout(function(){hui.cls.add(t,"hui-is-visible")},16)},move:function(e){hui.style.set(this.element,{top:e.top+"px",left:e.left+"px"})},_onDragStart:function(e){this.element.style.zIndex=hui.ui.nextPanelIndex()},_onBeforeMove:function(e){e=hui.event(e);var t=hui.position.get(this.element);this.dragState={left:e.getLeft()-t.left,top:e.getTop()-t.top,maxLeft:hui.window.getViewWidth()-this.element.offsetWidth-3},this.element.style.right="auto",hui.cls.add(this.element,"hui-is-dragging"),hui.cls.remove(this.element,"hui-is-targeted")},_onMove:function(e){var t=e.getTop()-this.dragState.top,e=e.getLeft()-this.dragState.left;this.element.style.top=Math.max(t,3)+"px",this.element.style.left=hui.between(3,e,this.dragState.maxLeft)+"px"},_onAfterMove:function(){hui.ui.callDescendants(this,"$$parentMoved"),hui.cls.remove(this.element,"hui-is-dragging")}},hui.extend(hui.ui.Panel,t),hui.define("hui.ui.Panel",hui.ui.Panel)}(hui.ui.Component),hui.component("Collection",{init:function(e){e.source&&(e.source.listen(this),this.source=e.source),this.selectable=e.selectable,this.selectionClass=e.selectionClass||"hui-is-selected",this.items=[]},nodes:{empty:".hui_collection_empty"},setData:function(e){e=e||[],this.data=[],this._clear(),this.items=[];for(var t=0;t<e.length;t++){var i=e[t];this._renderItem(i,t),this.data.push(i)}0===this.items.length&&this.fire("empty"),this.nodes.empty&&(this.nodes.empty.style.display=this.items.length?"none":"")},_renderItem:function(e,t){var i=(i=hui.ui.callDelegates(this,"render",e))||hui.build("div",{text:e.toString()});hui.cls.add(i,"hui_collection_item"),this.selectable&&hui.cls.set(i,this.selectionClass,this._isSelected(t)),this.items.push(i),this.element.appendChild(i)},_clear:function(){for(var e=0;e<this.items.length;e++)hui.dom.remove(this.items[e])},$objectsLoaded:function(e){this.setData(e)},refresh:function(){this.source&&this.source.refresh()},_isSelected:function(e){return hui.ui.callDelegates(this,"isSelected",this.data[e])},updateSelection:function(){if(this.selectable)for(var e=0;e<this.items.length;e++)hui.cls.set(this.items[e],this.selectionClass,this._isSelected(e))},"!click":function(e){var e=e.closest(".hui_collection_item");e&&(e=this.items.indexOf(e),this.fire("select",{data:this.data[e]}),this.updateSelection())}});