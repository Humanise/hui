var N2i={};function $id(){var C=new Array();for(var B=0;B<arguments.length;B++){var A=arguments[B];if(typeof A=="string"){A=document.getElementById(A)}if(arguments.length==1){return A}C.push(A)}return C}function $class(D,A){var C=($id(A)||document.body).getElementsByTagName("*");var E=[];for(var B=0;B<C.length;B++){if(N2i.hasClass(C[B],D)){E[E.length]=C[B]}}return E}function $firstClass(D,A){var C=($id(A)||document.body).getElementsByTagName("*");for(var B=0;B<C.length;B++){if(N2i.hasClass(C[B],D)){return C[B]}}return null}function $tag(B,A){A=A?$id(A):document.body;return A.getElementsByTagName(B)}function $ani(A,C,D,E,B){if(N2i.Animation){N2i.Animation.get(A).animate(null,D,C,E,B)}}function $get(B,C,A){var D=new N2i.Request(C);D.request(B,A)}if(!Array.prototype.push){Array.prototype.push=function(){var B=this.length;for(var A=0;A<arguments.length;A++){this[B+A]=arguments[A]}return this.length}}N2i.override=function(B,A){if(A){for(prop in A){B[prop]=A[prop]}}return B};N2i.camelize=function(F){var D=F.split("-");if(D.length==1){return D[0]}var B=F.indexOf("-")==0?D[0].charAt(0).toUpperCase()+D[0].substring(1):D[0];for(var C=1,A=D.length;C<A;C++){var E=D[C];B+=E.charAt(0).toUpperCase()+E.substring(1)}return B};N2i.log=function(A){try{console.log(A)}catch(B){}};N2i.escapeHTML=function(B){var C=document.createElement("div");var A=document.createTextNode(B);C.appendChild(A);return C.innerHTML};N2i.create=function(B,A,E,D){var C=document.createElement(B);if(A){for(attribute in A){if(attribute=="class"){C.className=A[attribute]}else{C.setAttribute(attribute,A[attribute])}}}if(E){for(style in E){C.style[style]=E[style]}}if(D){for(property in D){C[property]=D[property]}}return C};N2i.removeChildren=function(C){var B=C.childNodes;for(var A=B.length-1;A>=0;A--){C.removeChild(B[A])}};N2i.ELEMENT_NODE=1;N2i.ATTRIBUTE_NODE=2;N2i.TEXT_NODE=3;N2i.Element={};N2i.Element.removeClassName=N2i.removeClass=function(D,E){D=$id(D);if(!D){return }var B="";var A=D.className.split(/\s+/);for(var C=0;C<A.length;C++){if(A[C]!=E){if(C>0){B+=" "}B+=A[C]}}D.className=B};N2i.Element.hasClassName=N2i.hasClass=function(C,D){C=$id(C);if(!C){return }var A=C.className.split(/\s+/);for(var B=0;B<A.length;B++){if(A[B]==D){return true}}return false};N2i.Element.addClassName=N2i.addClass=function(A,B){A=$id(A);if(!A){return }N2i.Element.removeClassName(A,B);A.className+=" "+B};N2i.toggleClass=function(A,B){if(N2i.hasClass(A,B)){N2i.removeClass(A,B)}else{N2i.addClass(A,B)}};N2i.setClass=function(A,B,C){if(C){N2i.addClass(A,B)}else{N2i.removeClass(A,B)}};N2i.Element.scrollTo=function(A){A=$id(A);window.scrollTo(N2i.Element.getLeft(A),N2i.Element.getTop(A)-20)};N2i.Element.getLeft=N2i.getLeft=function(A){A=$id(A);if(A){xPos=A.offsetLeft;tempEl=A.offsetParent;while(tempEl!=null){xPos+=tempEl.offsetLeft;tempEl=tempEl.offsetParent}return xPos}else{return 0}};N2i.Element.getTop=N2i.getTop=function(A){A=$id(A);if(A){yPos=A.offsetTop;tempEl=A.offsetParent;while(tempEl!=null){yPos+=tempEl.offsetTop;tempEl=tempEl.offsetParent}return yPos}else{return 0}};N2i.Element.getWidth=N2i.getWidth=function(A){A=$id(A);return A.offsetWidth};N2i.Element.getHeight=N2i.getHeight=function(A){A=$id(A);return A.offsetHeight};N2i.Element.getRect=function(A){return{left:N2i.Element.getLeft(A),top:N2i.Element.getTop(A),width:N2i.Element.getWidth(A),height:N2i.Element.getHeight(A)}};N2i.Element.getStyle=N2i.getStyle=function(B,C){B=$id(B);var E=N2i.camelize(C);var D=B.style[E];if(!D){if(document.defaultView&&document.defaultView.getComputedStyle){var A=document.defaultView.getComputedStyle(B,null);D=A?A.getPropertyValue(C):null}else{if(B.currentStyle){D=B.currentStyle[E]}}}if(window.opera&&["left","top","right","bottom"].include(C)){if(N2i.Element.getStyle(B,"position")=="static"){D="auto"}}return D=="auto"?null:D};N2i.setOpacity=function(B,A){if(N2i.isIE()){if(A==1){B.style["filter"]=null}else{B.style["filter"]="alpha(opacity="+(A*100)+")"}}else{B.style["opacity"]=A}};N2i.getDocumentHeight=function(){if(window.scrollMaxY&&window.innerHeight){return window.scrollMaxY+window.innerHeight}else{return Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight)}};N2i.Window=function(){};N2i.Window.getScrollTop=function(){var A,B;if(self.pageYOffset){B=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){B=document.documentElement.scrollTop}else{if(document.body){B=document.body.scrollTop}}}return B};N2i.Window.getScrollLeft=function(){var A;if(self.pageYOffset){A=self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){A=document.documentElement.scrollLeft}else{if(document.body){A=document.body.scrollLeft}}}return A};N2i.Window.getScrollPosition=function(){return{left:N2i.Window.getScrollLeft(),top:N2i.Window.getScrollTop()}};N2i.Window.getInnerHeight=function(){var A;if(self.innerHeight){A=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){A=document.documentElement.clientHeight}else{if(document.body){A=document.body.clientHeight}}}return A};N2i.Window.getInnerWidth=function(){var A;if(self.innerHeight){A=self.innerWidth}else{if(document.documentElement&&document.documentElement.clientHeight){A=document.documentElement.clientWidth}else{if(document.body){A=document.body.clientWidth}}}return A};N2i.Window.getDocumentRect=function(){return{left:0,top:0,width:N2i.Window.getInnerWidth(),height:N2i.Window.getInnerHeight()}};N2i.Event=function(A){if(!A){this.event=window.event}else{this.event=A}};N2i.Event.prototype={mouseLeft:function(){var A=0;if(this.event){if(this.event.pageX){A=this.event.pageX}else{if(this.event.clientX){A=this.event.clientX+document.body.scrollLeft}}}return A},mouseTop:function(){var A=0;if(this.event){if(this.event.pageY){A=this.event.pageY}else{if(this.event.clientY){A=this.event.clientY+document.body.scrollTop}}}return A},getTarget:function(){return this.event.target!=null?this.event.target:this.event.srcElement},isReturnKey:function(){return this.event.keyCode==13},isRightKey:function(){return this.event.keyCode==39},isLeftKey:function(){return this.event.keyCode==37},isEscapeKey:function(){return this.event.keyCode==27},isSpaceKey:function(){N2i.log(this.event.keyCode);return this.event.keyCode==32},stop:function(){}};N2i.Event.addListener=N2i.addListener=function(C,B,D,A){C=$id(C);if(document.addEventListener){if(!A){A=false}else{A=true}C.addEventListener(B,D,A)}else{C.attachEvent("on"+B,D)}};N2i.Event.removeListener=N2i.removeListener=function(C,B,D,A){C=$id(C);if(document.removeEventListener){if(!A){A=false}else{A=true}C.removeEventListener(B,D,A)}else{C.detachEvent("on"+B,D)}};N2i.Event.stop=function(A){if(!A){var A=window.event}A.cancelBubble=true;if(A.stopPropagation){A.stopPropagation()}};N2i.Event.addLoadListener=N2i.addLoadListener=function(A){if(typeof window.addEventListener!="undefined"){window.addEventListener("load",A,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",A,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",A)}else{if(typeof window.onload=="function"){var B=window.onload;window.onload=function(){B();A()}}else{window.onload=A}}}}};N2i.Location={};N2i.Location.getParameter=function(A){var C=N2i.Location.getParameters();for(var B=0;B<C.length;B++){if(C[B].name==A){return C[B].value}}return null};N2i.Location.setParameter=function(A,E){var C=N2i.Location.getParameters();var D=false;for(var B=0;B<C.length;B++){if(C[B].name==A){C[B].value=E;D=true;break}}if(!D){C.push({name:A,value:E})}N2i.Location.setParameters(C)};N2i.Location.setParameters=function(B){var C="";for(var A=0;A<B.length;A++){C+=A==0?"?":"&";C+=B[A].name+"="+B[A].value}document.location.search=C};N2i.Location.getBoolean=function(A){var B=N2i.Location.getParameter(A);return(B=="true"||B=="1")};N2i.Location.getParameters=function(){var B=document.location.search.substring(1).split("&");var A=[];for(var D=0;D<B.length;D++){var E=B[D].split("=");var C=unescape(E[0]).replace(/^\s*|\s*$/g,"");var F=unescape(E[1]).replace(/^\s*|\s*$/g,"");if(C){A.push({name:C,value:F})}}return A};N2i.Request=function(A){this.delegate=A;this.options={method:"GET",async:true}};N2i.Request.prototype.request=function(D,C){N2i.override(this.options,C);this.initTransport();var F=this.transport;var B=this;F.onreadystatechange=function(){try{if(F.readyState==4){if(F.status==200){if(F.responseXML&&F.responseXML.documentElement){if(B.callDelegate("onXML",F.responseXML)){return }}else{if(B.callDelegate("onText",F.responseXML)){return }}B.callDelegate("onSuccess",F)}else{B.callDelegate("onFailure",F)}}}catch(H){N2i.log(H)}};var G=this.options.method.toUpperCase();F.open(G,D,this.options.async);var E=null;var A="";if(G=="POST"&&this.options.parameters){A=this.buildPostBody(this.options.parameters);F.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8");F.setRequestHeader("Content-length",A.length);F.setRequestHeader("Connection","close")}F.send(A)};N2i.Request.prototype.buildPostBody=function(B){if(!B){return null}var A="";for(param in B){if(A.length>0){A+="&"}A+=encodeURIComponent(param)+"="+encodeURIComponent(B[param])}return A};N2i.Request.prototype.callDelegate=function(B,A){if(this.delegate&&this.delegate[B]){this.delegate[B](A);return true}return false};N2i.Request.prototype.initTransport=function(){this.transport=N2i.Request.createTransport()};N2i.Request.createTransport=function(){try{if(window.XMLHttpRequest){var B=new XMLHttpRequest();if(B.readyState==null){B.readyState=1;B.addEventListener("load",function(){B.readyState=4;if(typeof B.onreadystatechange=="function"){B.onreadystatechange()}},false)}return B}else{if(window.ActiveXObject){return N2i.Request.getActiveX()}else{this.delegate.onError(this)}}}catch(A){if(this.delegate.onError){this.delegate.onError(this,A)}}};N2i.Request.getActiveX=function(){var C=["MSXML2","Microsoft","MSXML","MSXML3"];var D;for(var B=0;B<C.length;B++){try{D=new ActiveXObject(C[B]+".XmlHttp");return D}catch(A){}}throw new Error("Could not find an installed XML parser")};N2i.Preloader=function(A){this.options=A||{};this.delegate={};this.images=[];this.loaded=0};N2i.Preloader.prototype={addImages:function(A){if(typeof (A)=="object"){for(var B=0;B<A.length;B++){this.images.push(A[B])}}else{this.images.push(A)}},setDelegate:function(A){this.delegate=A},load:function(){var B=this;this.obs=[];for(var C=0;C<this.images.length;C++){var A=new Image();A.n2iPreloaderIndex=C;A.onload=function(){B.imageChanged(this.n2iPreloaderIndex,"imageDidLoad")};A.onerror=function(){B.imageChanged(this.n2iPreloaderIndex,"imageDidGiveError")};A.onabort=function(){B.imageChanged(this.n2iPreloaderIndex,"imageDidAbort")};A.src=(this.options.context?this.options.context:"")+this.images[C];this.obs.push(A)}},imageChanged:function(A,B){this.loaded++;if(this.delegate[B]){this.delegate[B](this.loaded,this.images.length,A)}if(this.loaded==this.images.length&&this.delegate.allImagesDidLoad){this.delegate.allImagesDidLoad()}}};N2i.trim=function(A){if(!A){return A}return A.replace(/^[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+|[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+$/g,"")};N2i.isEmpty=function(A){if(A==null||typeof (A)=="undefined"){return true}return N2i.trim(A).length==0};N2i.inArray=function(A,C){for(var B=0;B<A.length;B++){if(A[B]==C){return true}}};N2i.flipInArray=function(A,B){if(N2i.inArray(A,B)){N2i.removeFromArray(A,B)}else{A.push(B)}};N2i.removeFromArray=function(A,C){for(var B=A.length-1;B>=0;B--){if(A[B]==C){A.splice(B,1)}}};N2i.addToArray=function(A,C){if(C.constructor==Array){for(var B=0;B<C.length;B++){if(!N2i.inArray(A,C[B])){A.push(C)}}}else{if(!N2i.inArray(A,C)){A.push(C)}}};N2i.isIE=function(){var B=navigator.userAgent;var A=/opera [56789]|opera\/[56789]/i.test(B);var C=!A&&/MSIE/.test(B);return C};N2i.Cookie={set:function(C,D,E){if(E){var B=new Date();B.setTime(B.getTime()+(E*24*60*60*1000));var A="; expires="+B.toGMTString()}else{var A=""}document.cookie=C+"="+D+A+"; path=/"},get:function(B){var D=B+"=";var A=document.cookie.split(";");for(var C=0;C<A.length;C++){var E=A[C];while(E.charAt(0)==" "){E=E.substring(1,E.length)}if(E.indexOf(D)==0){return E.substring(D.length,E.length)}}return null},clear:function(A){this.set(A,"",-1)}};N2i.getFrameDocument=function(A){if(A.contentDocument){return A.contentDocument}else{if(A.contentWindow){return A.contentWindow.document}else{if(A.document){return A.document}else{alert(A.contentDocument)}}}};var Prototype={Version:"1.6.0.2",Browser:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement("div").__proto__&&document.createElement("div").__proto__!==document.createElement("form").__proto__},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(A){return A}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Class={create:function(){var E=null,D=$A(arguments);if(Object.isFunction(D[0])){E=D.shift()}function A(){this.initialize.apply(this,arguments)}Object.extend(A,Class.Methods);A.superclass=E;A.subclasses=[];if(E){var B=function(){};B.prototype=E.prototype;A.prototype=new B;E.subclasses.push(A)}for(var C=0;C<D.length;C++){A.addMethods(D[C])}if(!A.prototype.initialize){A.prototype.initialize=Prototype.emptyFunction}A.prototype.constructor=A;return A}};Class.Methods={addMethods:function(G){var C=this.superclass&&this.superclass.prototype;var B=Object.keys(G);if(!Object.keys({toString:true}).length){B.push("toString","valueOf")}for(var A=0,D=B.length;A<D;A++){var F=B[A],E=G[F];if(C&&Object.isFunction(E)&&E.argumentNames().first()=="$super"){var H=E,E=Object.extend((function(I){return function(){return C[I].apply(this,arguments)}})(F).wrap(H),{valueOf:function(){return H},toString:function(){return H.toString()}})}this.prototype[F]=E}return this}};var Abstract={};Object.extend=function(A,C){for(var B in C){A[B]=C[B]}return A};Object.extend(Object,{inspect:function(A){try{if(Object.isUndefined(A)){return"undefined"}if(A===null){return"null"}return A.inspect?A.inspect():String(A)}catch(B){if(B instanceof RangeError){return"..."}throw B}},toJSON:function(A){var C=typeof A;switch(C){case"undefined":case"function":case"unknown":return ;case"boolean":return A.toString()}if(A===null){return"null"}if(A.toJSON){return A.toJSON()}if(Object.isElement(A)){return }var B=[];for(var E in A){var D=Object.toJSON(A[E]);if(!Object.isUndefined(D)){B.push(E.toJSON()+": "+D)}}return"{"+B.join(", ")+"}"},toQueryString:function(A){return $H(A).toQueryString()},toHTML:function(A){return A&&A.toHTML?A.toHTML():String.interpret(A)},keys:function(A){var B=[];for(var C in A){B.push(C)}return B},values:function(B){var A=[];for(var C in B){A.push(B[C])}return A},clone:function(A){return Object.extend({},A)},isElement:function(A){return A&&A.nodeType==1},isArray:function(A){return A!=null&&typeof A=="object"&&"splice" in A&&"join" in A},isHash:function(A){return A instanceof Hash},isFunction:function(A){return typeof A=="function"},isString:function(A){return typeof A=="string"},isNumber:function(A){return typeof A=="number"},isUndefined:function(A){return typeof A=="undefined"}});Object.extend(Function.prototype,{argumentNames:function(){var A=this.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",").invoke("strip");return A.length==1&&!A[0]?[]:A},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var A=this,C=$A(arguments),B=C.shift();return function(){return A.apply(B,C.concat($A(arguments)))}},bindAsEventListener:function(){var A=this,C=$A(arguments),B=C.shift();return function(D){return A.apply(B,[D||window.event].concat(C))}},curry:function(){if(!arguments.length){return this}var A=this,B=$A(arguments);return function(){return A.apply(this,B.concat($A(arguments)))}},delay:function(){var A=this,B=$A(arguments),C=B.shift()*1000;return window.setTimeout(function(){return A.apply(A,B)},C)},wrap:function(B){var A=this;return function(){return B.apply(this,[A.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var A=this;return this._methodized=function(){return A.apply(null,[this].concat($A(arguments)))}}});Function.prototype.defer=Function.prototype.delay.curry(0.01);Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};var Try={these:function(){var C;for(var B=0,D=arguments.length;B<D;B++){var A=arguments[B];try{C=A();break}catch(E){}}return C}};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(A){return String(A).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(B,A){this.callback=B;this.frequency=A;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return }clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute()}finally{this.currentlyExecuting=false}}}});Object.extend(String,{interpret:function(A){return A==null?"":String(A)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,{gsub:function(E,C){var A="",D=this,B;C=arguments.callee.prepareReplacement(C);while(D.length>0){if(B=D.match(E)){A+=D.slice(0,B.index);A+=String.interpret(C(B));D=D.slice(B.index+B[0].length)}else{A+=D,D=""}}return A},sub:function(C,A,B){A=this.gsub.prepareReplacement(A);B=Object.isUndefined(B)?1:B;return this.gsub(C,function(D){if(--B<0){return D[0]}return A(D)})},scan:function(B,A){this.gsub(B,A);return String(this)},truncate:function(B,A){B=B||30;A=Object.isUndefined(A)?"...":A;return this.length>B?this.slice(0,B-A.length)+A:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var B=new RegExp(Prototype.ScriptFragment,"img");var A=new RegExp(Prototype.ScriptFragment,"im");return(this.match(B)||[]).map(function(C){return(C.match(A)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var A=arguments.callee;A.text.data=this;return A.div.innerHTML},unescapeHTML:function(){var A=new Element("div");A.innerHTML=this.stripTags();return A.childNodes[0]?(A.childNodes.length>1?$A(A.childNodes).inject("",function(B,C){return B+C.nodeValue}):A.childNodes[0].nodeValue):""},toQueryParams:function(B){var A=this.strip().match(/([^?#]*)(#.*)?$/);if(!A){return{}}return A[1].split(B||"&").inject({},function(E,F){if((F=F.split("="))[0]){var C=decodeURIComponent(F.shift());var D=F.length>1?F.join("="):F[0];if(D!=undefined){D=decodeURIComponent(D)}if(C in E){if(!Object.isArray(E[C])){E[C]=[E[C]]}E[C].push(D)}else{E[C]=D}}return E})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(A){return A<1?"":new Array(A+1).join(this)},camelize:function(){var D=this.split("-"),A=D.length;if(A==1){return D[0]}var C=this.charAt(0)=="-"?D[0].charAt(0).toUpperCase()+D[0].substring(1):D[0];for(var B=1;B<A;B++){C+=D[B].charAt(0).toUpperCase()+D[B].substring(1)}return C},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(B){var A=this.gsub(/[\x00-\x1f\\]/,function(C){var D=String.specialChar[C[0]];return D?D:"\\u00"+C[0].charCodeAt().toPaddedString(2,16)});if(B){return'"'+A.replace(/"/g,'\\"')+'"'}return"'"+A.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(A){return this.sub(A||Prototype.JSONFilter,"#{1}")},isJSON:function(){var A=this;if(A.blank()){return false}A=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(A)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(A){return this.indexOf(A)>-1},startsWith:function(A){return this.indexOf(A)===0},endsWith:function(A){var B=this.length-A.length;return B>=0&&this.lastIndexOf(A)===B},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(A,B){return new Template(this,B).evaluate(A)}});if(Prototype.Browser.WebKit||Prototype.Browser.IE){Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}})}String.prototype.gsub.prepareReplacement=function(B){if(Object.isFunction(B)){return B}var A=new Template(B);return function(C){return A.evaluate(C)}};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")});with(String.prototype.escapeHTML){div.appendChild(text)}var Template=Class.create({initialize:function(A,B){this.template=A.toString();this.pattern=B||Template.Pattern},evaluate:function(A){if(Object.isFunction(A.toTemplateReplacements)){A=A.toTemplateReplacements()}return this.template.gsub(this.pattern,function(D){if(A==null){return""}var F=D[1]||"";if(F=="\\"){return D[2]}var B=A,G=D[3];var E=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;D=E.exec(G);if(D==null){return F}while(D!=null){var C=D[1].startsWith("[")?D[2].gsub("\\\\]","]"):D[1];B=B[C];if(null==B||""==D[3]){break}G=G.substring("["==D[3]?D[1].length:D[0].length);D=E.exec(G)}return F+String.interpret(B)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable={each:function(C,B){var A=0;C=C.bind(B);try{this._each(function(E){C(E,A++)})}catch(D){if(D!=$break){throw D}}return this},eachSlice:function(D,C,B){C=C?C.bind(B):Prototype.K;var A=-D,E=[],F=this.toArray();while((A+=D)<F.length){E.push(F.slice(A,A+D))}return E.collect(C,B)},all:function(C,B){C=C?C.bind(B):Prototype.K;var A=true;this.each(function(E,D){A=A&&!!C(E,D);if(!A){throw $break}});return A},any:function(C,B){C=C?C.bind(B):Prototype.K;var A=false;this.each(function(E,D){if(A=!!C(E,D)){throw $break}});return A},collect:function(C,B){C=C?C.bind(B):Prototype.K;var A=[];this.each(function(E,D){A.push(C(E,D))});return A},detect:function(C,B){C=C.bind(B);var A;this.each(function(E,D){if(C(E,D)){A=E;throw $break}});return A},findAll:function(C,B){C=C.bind(B);var A=[];this.each(function(E,D){if(C(E,D)){A.push(E)}});return A},grep:function(D,C,B){C=C?C.bind(B):Prototype.K;var A=[];if(Object.isString(D)){D=new RegExp(D)}this.each(function(F,E){if(D.match(F)){A.push(C(F,E))}});return A},include:function(A){if(Object.isFunction(this.indexOf)){if(this.indexOf(A)!=-1){return true}}var B=false;this.each(function(C){if(C==A){B=true;throw $break}});return B},inGroupsOf:function(B,A){A=Object.isUndefined(A)?null:A;return this.eachSlice(B,function(C){while(C.length<B){C.push(A)}return C})},inject:function(A,C,B){C=C.bind(B);this.each(function(E,D){A=C(A,E,D)});return A},invoke:function(B){var A=$A(arguments).slice(1);return this.map(function(C){return C[B].apply(C,A)})},max:function(C,B){C=C?C.bind(B):Prototype.K;var A;this.each(function(E,D){E=C(E,D);if(A==null||E>=A){A=E}});return A},min:function(C,B){C=C?C.bind(B):Prototype.K;var A;this.each(function(E,D){E=C(E,D);if(A==null||E<A){A=E}});return A},partition:function(D,B){D=D?D.bind(B):Prototype.K;var C=[],A=[];this.each(function(F,E){(D(F,E)?C:A).push(F)});return[C,A]},pluck:function(B){var A=[];this.each(function(C){A.push(C[B])});return A},reject:function(C,B){C=C.bind(B);var A=[];this.each(function(E,D){if(!C(E,D)){A.push(E)}});return A},sortBy:function(B,A){B=B.bind(A);return this.map(function(D,C){return{value:D,criteria:B(D,C)}}).sort(function(F,E){var D=F.criteria,C=E.criteria;return D<C?-1:D>C?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var B=Prototype.K,A=$A(arguments);if(Object.isFunction(A.last())){B=A.pop()}var C=[this].concat(A).map($A);return this.map(function(E,D){return B(C.pluck(D))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(C){if(!C){return[]}if(C.toArray){return C.toArray()}var B=C.length||0,A=new Array(B);while(B--){A[B]=C[B]}return A}if(Prototype.Browser.WebKit){$A=function(C){if(!C){return[]}if(!(Object.isFunction(C)&&C=="[object NodeList]")&&C.toArray){return C.toArray()}var B=C.length||0,A=new Array(B);while(B--){A[B]=C[B]}return A}}Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse){Array.prototype._reverse=Array.prototype.reverse}Object.extend(Array.prototype,{_each:function(B){for(var A=0,C=this.length;A<C;A++){B(this[A])}},clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(A){return A!=null})},flatten:function(){return this.inject([],function(B,A){return B.concat(Object.isArray(A)?A.flatten():[A])})},without:function(){var A=$A(arguments);return this.select(function(B){return !A.include(B)})},reverse:function(A){return(A!==false?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(A){return this.inject([],function(D,C,B){if(0==B||(A?D.last()!=C:!D.include(C))){D.push(C)}return D})},intersect:function(A){return this.uniq().findAll(function(B){return A.detect(function(C){return B===C})})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var A=[];this.each(function(B){var C=Object.toJSON(B);if(!Object.isUndefined(C)){A.push(C)}});return"["+A.join(", ")+"]"}});if(Object.isFunction(Array.prototype.forEach)){Array.prototype._each=Array.prototype.forEach}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(C,A){A||(A=0);var B=this.length;if(A<0){A=B+A}for(;A<B;A++){if(this[A]===C){return A}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(B,A){A=isNaN(A)?this.length:(A<0?this.length+A:A)+1;var C=this.slice(0,A).reverse().indexOf(B);return(C<0)?C:A-C-1}}Array.prototype.toArray=Array.prototype.clone;function $w(A){if(!Object.isString(A)){return[]}A=A.strip();return A?A.split(/\s+/):[]}if(Prototype.Browser.Opera){Array.prototype.concat=function(){var E=[];for(var B=0,C=this.length;B<C;B++){E.push(this[B])}for(var B=0,C=arguments.length;B<C;B++){if(Object.isArray(arguments[B])){for(var A=0,D=arguments[B].length;A<D;A++){E.push(arguments[B][A])}}else{E.push(arguments[B])}}return E}}Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(A){$R(0,this,true).each(A);return this},toPaddedString:function(C,B){var A=this.toString(B||10);return"0".times(C-A.length)+A},toJSON:function(){return isFinite(this)?this.toString():"null"}});$w("abs round ceil floor").each(function(A){Number.prototype[A]=Math[A].methodize()});function $H(A){return new Hash(A)}var Hash=Class.create(Enumerable,(function(){function A(B,C){if(Object.isUndefined(C)){return B}return B+"="+encodeURIComponent(String.interpret(C))}return{initialize:function(B){this._object=Object.isHash(B)?B.toObject():Object.clone(B)},_each:function(C){for(var B in this._object){var D=this._object[B],E=[B,D];E.key=B;E.value=D;C(E)}},set:function(B,C){return this._object[B]=C},get:function(B){return this._object[B]},unset:function(B){var C=this._object[B];delete this._object[B];return C},toObject:function(){return Object.clone(this._object)},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(C){var B=this.detect(function(D){return D.value===C});return B&&B.key},merge:function(B){return this.clone().update(B)},update:function(B){return new Hash(B).inject(this,function(C,D){C.set(D.key,D.value);return C})},toQueryString:function(){return this.map(function(D){var C=encodeURIComponent(D.key),B=D.value;if(B&&typeof B=="object"){if(Object.isArray(B)){return B.map(A.curry(C)).join("&")}}return A(C,B)}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(B){return B.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Object.toJSON(this.toObject())},clone:function(){return new Hash(this)}}})());Hash.prototype.toTemplateReplacements=Hash.prototype.toObject;Hash.from=$H;var ObjectRange=Class.create(Enumerable,{initialize:function(C,A,B){this.start=C;this.end=A;this.exclusive=B},_each:function(A){var B=this.start;while(this.include(B)){A(B);B=B.succ()}},include:function(A){if(A<this.start){return false}if(this.exclusive){return A<this.end}return A<=this.end}});var $R=function(C,A,B){return new ObjectRange(C,A,B)};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(A){this.responders._each(A)},register:function(A){if(!this.include(A)){this.responders.push(A)}},unregister:function(A){this.responders=this.responders.without(A)},dispatch:function(D,B,C,A){this.each(function(E){if(Object.isFunction(E[D])){try{E[D].apply(E,[B,C,A])}catch(F){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(A){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,A||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters)){this.options.parameters=this.options.parameters.toQueryParams()}else{if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,B,A){$super(A);this.transport=Ajax.getTransport();this.request(B)},request:function(B){this.url=B;this.method=this.options.method;var D=Object.clone(this.options.parameters);if(!["get","post"].include(this.method)){D["_method"]=this.method;this.method="post"}this.parameters=D;if(D=Object.toQueryString(D)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+D}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){D+="&_="}}}try{var A=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(A)}Ajax.Responders.dispatch("onCreate",this,A);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||D):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(C){this.dispatchException(C)}},onStateChange:function(){var A=this.transport.readyState;if(A>1&&!((A==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var E={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,"Accept":"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){E["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){E["Connection"]="close"}}if(typeof this.options.requestHeaders=="object"){var C=this.options.requestHeaders;if(Object.isFunction(C.push)){for(var B=0,D=C.length;B<D;B+=2){E[C[B]]=C[B+1]}}else{$H(C).each(function(F){E[F.key]=F.value})}}for(var A in E){this.transport.setRequestHeader(A,E[A])}},success:function(){var A=this.getStatus();return !A||(A>=200&&A<300)},getStatus:function(){try{return this.transport.status||0}catch(A){return 0}},respondToReadyState:function(A){var C=Ajax.Request.Events[A],B=new Ajax.Response(this);if(C=="Complete"){try{this._complete=true;(this.options["on"+B.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(B,B.headerJSON)}catch(D){this.dispatchException(D)}var E=B.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&E&&E.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+C]||Prototype.emptyFunction)(B,B.headerJSON);Ajax.Responders.dispatch("on"+C,this,B,B.headerJSON)}catch(D){this.dispatchException(D)}if(C=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var A=this.url.match(/^\s*https?:\/\/[^\/]*/);return !A||(A[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(A){try{return this.transport.getResponseHeader(A)||null}catch(B){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(A){(this.options.onException||Prototype.emptyFunction)(this,A);Ajax.Responders.dispatch("onException",this,A)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(C){this.request=C;var D=this.transport=C.transport,A=this.readyState=D.readyState;if((A>2&&!Prototype.Browser.IE)||A==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(D.responseText);this.headerJSON=this._getHeaderJSON()}if(A==4){var B=D.responseXML;this.responseXML=Object.isUndefined(B)?null:B;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(A){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(A){return null}},getResponseHeader:function(A){return this.transport.getResponseHeader(A)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var A=this.getHeader("X-JSON");if(!A){return null}A=decodeURIComponent(escape(A));try{return A.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(B){this.request.dispatchException(B)}},_getResponseJSON:function(){var A=this.request.options;if(!A.evalJSON||(A.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(A.sanitizeJSON||!this.request.isSameOrigin())}catch(B){this.request.dispatchException(B)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,A,C,B){this.container={success:(A.success||A),failure:(A.failure||(A.success?null:A))};B=Object.clone(B);var D=B.onComplete;B.onComplete=(function(E,F){this.updateContent(E.responseText);if(Object.isFunction(D)){D(E,F)}}).bind(this);$super(C,B)},updateContent:function(D){var C=this.container[this.success()?"success":"failure"],A=this.options;if(!A.evalScripts){D=D.stripScripts()}if(C=$(C)){if(A.insertion){if(Object.isString(A.insertion)){var B={};B[A.insertion]=D;C.insert(B)}else{A.insertion(C,D)}}else{C.update(D)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,A,C,B){$super(B);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=A;this.url=C;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(A){if(this.options.decay){this.decay=(A.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=A.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(B){if(arguments.length>1){for(var A=0,D=[],C=arguments.length;A<C;A++){D.push($(arguments[A]))}return D}if(Object.isString(B)){B=document.getElementById(B)}return Element.extend(B)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(F,A){var C=[];var E=document.evaluate(F,$(A)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var B=0,D=E.snapshotLength;B<D;B++){C.push(Element.extend(E.snapshotItem(B)))}return C}}if(!window.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(){var A=this.Element;this.Element=function(D,C){C=C||{};D=D.toLowerCase();var B=Element.cache;if(Prototype.Browser.IE&&C.name){D="<"+D+' name="'+C.name+'">';delete C.name;return Element.writeAttribute(document.createElement(D),C)}if(!B[D]){B[D]=Element.extend(document.createElement(D))}return Element.writeAttribute(B[D].cloneNode(false),C)};Object.extend(this.Element,A||{})}).call(window);Element.cache={};Element.Methods={visible:function(A){return $(A).style.display!="none"},toggle:function(A){A=$(A);Element[Element.visible(A)?"hide":"show"](A);return A},hide:function(A){$(A).style.display="none";return A},show:function(A){$(A).style.display="";return A},remove:function(A){A=$(A);A.parentNode.removeChild(A);return A},update:function(A,B){A=$(A);if(B&&B.toElement){B=B.toElement()}if(Object.isElement(B)){return A.update().insert(B)}B=Object.toHTML(B);A.innerHTML=B.stripScripts();B.evalScripts.bind(B).defer();return A},replace:function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement()}else{if(!Object.isElement(C)){C=Object.toHTML(C);var A=B.ownerDocument.createRange();A.selectNode(B);C.evalScripts.bind(C).defer();C=A.createContextualFragment(C.stripScripts())}}B.parentNode.replaceChild(C,B);return B},insert:function(C,E){C=$(C);if(Object.isString(E)||Object.isNumber(E)||Object.isElement(E)||(E&&(E.toElement||E.toHTML))){E={bottom:E}}var D,F,B,G;for(var A in E){D=E[A];A=A.toLowerCase();F=Element._insertionTranslations[A];if(D&&D.toElement){D=D.toElement()}if(Object.isElement(D)){F(C,D);continue}D=Object.toHTML(D);B=((A=="before"||A=="after")?C.parentNode:C).tagName.toUpperCase();G=Element._getContentFromAnonymousElement(B,D.stripScripts());if(A=="top"||A=="after"){G.reverse()}G.each(F.curry(C));D.evalScripts.bind(D).defer()}return C},wrap:function(B,C,A){B=$(B);if(Object.isElement(C)){$(C).writeAttribute(A||{})}else{if(Object.isString(C)){C=new Element(C,A)}else{C=new Element("div",C)}}if(B.parentNode){B.parentNode.replaceChild(C,B)}C.appendChild(B);return C},inspect:function(B){B=$(B);var A="<"+B.tagName.toLowerCase();$H({"id":"id","className":"class"}).each(function(F){var E=F.first(),C=F.last();var D=(B[E]||"").toString();if(D){A+=" "+C+"="+D.inspect(true)}});return A+">"},recursivelyCollect:function(A,C){A=$(A);var B=[];while(A=A[C]){if(A.nodeType==1){B.push(Element.extend(A))}}return B},ancestors:function(A){return $(A).recursivelyCollect("parentNode")},descendants:function(A){return $(A).select("*")},firstDescendant:function(A){A=$(A).firstChild;while(A&&A.nodeType!=1){A=A.nextSibling}return $(A)},immediateDescendants:function(A){if(!(A=$(A).firstChild)){return[]}while(A&&A.nodeType!=1){A=A.nextSibling}if(A){return[A].concat($(A).nextSiblings())}return[]},previousSiblings:function(A){return $(A).recursivelyCollect("previousSibling")},nextSiblings:function(A){return $(A).recursivelyCollect("nextSibling")},siblings:function(A){A=$(A);return A.previousSiblings().reverse().concat(A.nextSiblings())},match:function(B,A){if(Object.isString(A)){A=new Selector(A)}return A.match($(B))},up:function(B,D,A){B=$(B);if(arguments.length==1){return $(B.parentNode)}var C=B.ancestors();return Object.isNumber(D)?C[D]:Selector.findElement(C,D,A)},down:function(B,C,A){B=$(B);if(arguments.length==1){return B.firstDescendant()}return Object.isNumber(C)?B.descendants()[C]:B.select(C)[A||0]},previous:function(B,D,A){B=$(B);if(arguments.length==1){return $(Selector.handlers.previousElementSibling(B))}var C=B.previousSiblings();return Object.isNumber(D)?C[D]:Selector.findElement(C,D,A)},next:function(C,D,B){C=$(C);if(arguments.length==1){return $(Selector.handlers.nextElementSibling(C))}var A=C.nextSiblings();return Object.isNumber(D)?A[D]:Selector.findElement(A,D,B)},select:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B,A)},adjacent:function(){var A=$A(arguments),B=$(A.shift());return Selector.findChildElements(B.parentNode,A).without(B)},identify:function(B){B=$(B);var C=B.readAttribute("id"),A=arguments.callee;if(C){return C}do{C="anonymous_element_"+A.counter++}while($(C));B.writeAttribute("id",C);return C},readAttribute:function(C,A){C=$(C);if(Prototype.Browser.IE){var B=Element._attributeTranslations.read;if(B.values[A]){return B.values[A](C,A)}if(B.names[A]){A=B.names[A]}if(A.include(":")){return(!C.attributes||!C.attributes[A])?null:C.attributes[A].value}}return C.getAttribute(A)},writeAttribute:function(E,C,F){E=$(E);var B={},D=Element._attributeTranslations.write;if(typeof C=="object"){B=C}else{B[C]=Object.isUndefined(F)?true:F}for(var A in B){C=D.names[A]||A;F=B[A];if(D.values[A]){C=D.values[A](E,F)}if(F===false||F===null){E.removeAttribute(C)}else{if(F===true){E.setAttribute(C,C)}else{E.setAttribute(C,F)}}}return E},getHeight:function(A){return $(A).getDimensions().height},getWidth:function(A){return $(A).getDimensions().width},classNames:function(A){return new Element.ClassNames(A)},hasClassName:function(A,B){if(!(A=$(A))){return }var C=A.className;return(C.length>0&&(C==B||new RegExp("(^|\\s)"+B+"(\\s|$)").test(C)))},addClassName:function(A,B){if(!(A=$(A))){return }if(!A.hasClassName(B)){A.className+=(A.className?" ":"")+B}return A},removeClassName:function(A,B){if(!(A=$(A))){return }A.className=A.className.replace(new RegExp("(^|\\s+)"+B+"(\\s+|$)")," ").strip();return A},toggleClassName:function(A,B){if(!(A=$(A))){return }return A[A.hasClassName(B)?"removeClassName":"addClassName"](B)},cleanWhitespace:function(B){B=$(B);var C=B.firstChild;while(C){var A=C.nextSibling;if(C.nodeType==3&&!/\S/.test(C.nodeValue)){B.removeChild(C)}C=A}return B},empty:function(A){return $(A).innerHTML.blank()},descendantOf:function(D,C){D=$(D),C=$(C);var F=C;if(D.compareDocumentPosition){return(D.compareDocumentPosition(C)&8)===8}if(D.sourceIndex&&!Prototype.Browser.Opera){var E=D.sourceIndex,B=C.sourceIndex,A=C.nextSibling;if(!A){do{C=C.parentNode}while(!(A=C.nextSibling)&&C.parentNode)}if(A&&A.sourceIndex){return(E>B&&E<A.sourceIndex)}}while(D=D.parentNode){if(D==F){return true}}return false},scrollTo:function(A){A=$(A);var B=A.cumulativeOffset();window.scrollTo(B[0],B[1]);return A},getStyle:function(B,C){B=$(B);C=C=="float"?"cssFloat":C.camelize();var D=B.style[C];if(!D){var A=document.defaultView.getComputedStyle(B,null);D=A?A[C]:null}if(C=="opacity"){return D?parseFloat(D):1}return D=="auto"?null:D},getOpacity:function(A){return $(A).getStyle("opacity")},setStyle:function(B,C){B=$(B);var E=B.style,A;if(Object.isString(C)){B.style.cssText+=";"+C;return C.include("opacity")?B.setOpacity(C.match(/opacity:\s*(\d?\.?\d*)/)[1]):B}for(var D in C){if(D=="opacity"){B.setOpacity(C[D])}else{E[(D=="float"||D=="cssFloat")?(Object.isUndefined(E.styleFloat)?"cssFloat":"styleFloat"):D]=C[D]}}return B},setOpacity:function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;return A},getDimensions:function(C){C=$(C);var G=$(C).getStyle("display");if(G!="none"&&G!=null){return{width:C.offsetWidth,height:C.offsetHeight}}var B=C.style;var F=B.visibility;var D=B.position;var A=B.display;B.visibility="hidden";B.position="absolute";B.display="block";var H=C.clientWidth;var E=C.clientHeight;B.display=A;B.position=D;B.visibility=F;return{width:H,height:E}},makePositioned:function(A){A=$(A);var B=Element.getStyle(A,"position");if(B=="static"||!B){A._madePositioned=true;A.style.position="relative";if(window.opera){A.style.top=0;A.style.left=0}}return A},undoPositioned:function(A){A=$(A);if(A._madePositioned){A._madePositioned=undefined;A.style.position=A.style.top=A.style.left=A.style.bottom=A.style.right=""}return A},makeClipping:function(A){A=$(A);if(A._overflow){return A}A._overflow=Element.getStyle(A,"overflow")||"auto";if(A._overflow!=="hidden"){A.style.overflow="hidden"}return A},undoClipping:function(A){A=$(A);if(!A._overflow){return A}A.style.overflow=A._overflow=="auto"?"":A._overflow;A._overflow=null;return A},cumulativeOffset:function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;B=B.offsetParent}while(B);return Element._returnOffset(C,A)},positionedOffset:function(B){var A=0,D=0;do{A+=B.offsetTop||0;D+=B.offsetLeft||0;B=B.offsetParent;if(B){if(B.tagName=="BODY"){break}var C=Element.getStyle(B,"position");if(C!=="static"){break}}}while(B);return Element._returnOffset(D,A)},absolutize:function(B){B=$(B);if(B.getStyle("position")=="absolute"){return }var D=B.positionedOffset();var F=D[1];var E=D[0];var C=B.clientWidth;var A=B.clientHeight;B._originalLeft=E-parseFloat(B.style.left||0);B._originalTop=F-parseFloat(B.style.top||0);B._originalWidth=B.style.width;B._originalHeight=B.style.height;B.style.position="absolute";B.style.top=F+"px";B.style.left=E+"px";B.style.width=C+"px";B.style.height=A+"px";return B},relativize:function(A){A=$(A);if(A.getStyle("position")=="relative"){return }A.style.position="relative";var C=parseFloat(A.style.top||0)-(A._originalTop||0);var B=parseFloat(A.style.left||0)-(A._originalLeft||0);A.style.top=C+"px";A.style.left=B+"px";A.style.height=A._originalHeight;A.style.width=A._originalWidth;return A},cumulativeScrollOffset:function(B){var A=0,C=0;do{A+=B.scrollTop||0;C+=B.scrollLeft||0;B=B.parentNode}while(B);return Element._returnOffset(C,A)},getOffsetParent:function(A){if(A.offsetParent){return $(A.offsetParent)}if(A==document.body){return $(A)}while((A=A.parentNode)&&A!=document.body){if(Element.getStyle(A,"position")!="static"){return $(A)}}return $(document.body)},viewportOffset:function(D){var A=0,C=0;var B=D;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body&&Element.getStyle(B,"position")=="absolute"){break}}while(B=B.offsetParent);B=D;do{if(!Prototype.Browser.Opera||B.tagName=="BODY"){A-=B.scrollTop||0;C-=B.scrollLeft||0}}while(B=B.parentNode);return Element._returnOffset(C,A)},clonePosition:function(B,D){var A=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});D=$(D);var E=D.viewportOffset();B=$(B);var F=[0,0];var C=null;if(Element.getStyle(B,"position")=="absolute"){C=B.getOffsetParent();F=C.viewportOffset()}if(C==document.body){F[0]-=document.body.offsetLeft;F[1]-=document.body.offsetTop}if(A.setLeft){B.style.left=(E[0]-F[0]+A.offsetLeft)+"px"}if(A.setTop){B.style.top=(E[1]-F[1]+A.offsetTop)+"px"}if(A.setWidth){B.style.width=D.offsetWidth+"px"}if(A.setHeight){B.style.height=D.offsetHeight+"px"}return B}};Element.Methods.identify.counter=1;Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(D,B,C){switch(C){case"left":case"top":case"right":case"bottom":if(D(B,"position")==="static"){return null}case"height":case"width":if(!Element.visible(B)){return null}var E=parseInt(D(B,C),10);if(E!==B["offset"+C.capitalize()]){return E+"px"}var A;if(C==="height"){A=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{A=["border-left-width","padding-left","padding-right","border-right-width"]}return A.inject(E,function(F,G){var H=D(B,G);return H===null?F:F-parseInt(H,10)})+"px";default:return D(B,C)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(C,A,B){if(B==="title"){return A.title}return C(A,B)})}else{if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(C,B){B=$(B);var A=B.getStyle("position");if(A!=="static"){return C(B)}B.setStyle({position:"relative"});var D=C(B);B.setStyle({position:A});return D});$w("positionedOffset viewportOffset").each(function(A){Element.Methods[A]=Element.Methods[A].wrap(function(E,C){C=$(C);var B=C.getStyle("position");if(B!=="static"){return E(C)}var D=C.getOffsetParent();if(D&&D.getStyle("position")==="fixed"){D.setStyle({zoom:1})}C.setStyle({position:"relative"});var F=E(C);C.setStyle({position:B});return F})});Element.Methods.getStyle=function(A,B){A=$(A);B=(B=="float"||B=="cssFloat")?"styleFloat":B.camelize();var C=A.style[B];if(!C&&A.currentStyle){C=A.currentStyle[B]}if(B=="opacity"){if(C=(A.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(C[1]){return parseFloat(C[1])/100}}return 1}if(C=="auto"){if((B=="width"||B=="height")&&(A.getStyle("display")!="none")){return A["offset"+B.capitalize()]+"px"}return null}return C};Element.Methods.setOpacity=function(B,E){function F(G){return G.replace(/alpha\([^\)]*\)/gi,"")}B=$(B);var A=B.currentStyle;if((A&&!A.hasLayout)||(!A&&B.style.zoom=="normal")){B.style.zoom=1}var D=B.getStyle("filter"),C=B.style;if(E==1||E===""){(D=F(D))?C.filter=D:C.removeAttribute("filter");return B}else{if(E<0.00001){E=0}}C.filter=F(D)+"alpha(opacity="+(E*100)+")";return B};Element._attributeTranslations={read:{names:{"class":"className","for":"htmlFor"},values:{_getAttr:function(A,B){return A.getAttribute(B,2)},_getAttrNode:function(A,C){var B=A.getAttributeNode(C);return B?B.value:""},_getEv:function(A,B){B=A.getAttribute(B);return B?B.toString().slice(23,-2):null},_flag:function(A,B){return $(A).hasAttribute(B)?B:null},style:function(A){return A.style.cssText.toLowerCase()},title:function(A){return A.title}}}};Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(A,B){A.checked=!!B},style:function(A,B){A.style.cssText=B?B:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc").each(function(A){Element._attributeTranslations.write.names[A.toLowerCase()]=A;Element._attributeTranslations.has[A.toLowerCase()]=A});(function(A){Object.extend(A,{href:A._getAttr,src:A._getAttr,type:A._getAttr,action:A._getAttrNode,disabled:A._flag,checked:A._flag,readonly:A._flag,multiple:A._flag,onload:A._getEv,onunload:A._getEv,onclick:A._getEv,ondblclick:A._getEv,onmousedown:A._getEv,onmouseup:A._getEv,onmouseover:A._getEv,onmousemove:A._getEv,onmouseout:A._getEv,onfocus:A._getEv,onblur:A._getEv,onkeypress:A._getEv,onkeydown:A._getEv,onkeyup:A._getEv,onsubmit:A._getEv,onreset:A._getEv,onselect:A._getEv,onchange:A._getEv})})(Element._attributeTranslations.read.values)}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1)?0.999999:(B==="")?"":(B<0.00001)?0:B;return A}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;if(B==1){if(A.tagName=="IMG"&&A.width){A.width++;A.width--}else{try{var D=document.createTextNode(" ");A.appendChild(D);A.removeChild(D)}catch(C){}}}return A};Element.Methods.cumulativeOffset=function(B){var A=0,C=0;do{A+=B.offsetTop||0;C+=B.offsetLeft||0;if(B.offsetParent==document.body){if(Element.getStyle(B,"position")=="absolute"){break}}B=B.offsetParent}while(B);return Element._returnOffset(C,A)}}}}}if(Prototype.Browser.IE||Prototype.Browser.Opera){Element.Methods.update=function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement()}if(Object.isElement(C)){return B.update().insert(C)}C=Object.toHTML(C);var A=B.tagName.toUpperCase();if(A in Element._insertionTranslations.tags){$A(B.childNodes).each(function(D){B.removeChild(D)});Element._getContentFromAnonymousElement(A,C.stripScripts()).each(function(D){B.appendChild(D)})}else{B.innerHTML=C.stripScripts()}C.evalScripts.bind(C).defer();return B}}if("outerHTML" in document.createElement("div")){Element.Methods.replace=function(C,E){C=$(C);if(E&&E.toElement){E=E.toElement()}if(Object.isElement(E)){C.parentNode.replaceChild(E,C);return C}E=Object.toHTML(E);var D=C.parentNode,B=D.tagName.toUpperCase();if(Element._insertionTranslations.tags[B]){var F=C.next();var A=Element._getContentFromAnonymousElement(B,E.stripScripts());D.removeChild(C);if(F){A.each(function(G){D.insertBefore(G,F)})}else{A.each(function(G){D.appendChild(G)})}}else{C.outerHTML=E.stripScripts()}E.evalScripts.bind(E).defer();return C}}Element._returnOffset=function(B,C){var A=[B,C];A.left=B;A.top=C;return A};Element._getContentFromAnonymousElement=function(C,B){var D=new Element("div"),A=Element._insertionTranslations.tags[C];if(A){D.innerHTML=A[0]+B+A[1];A[2].times(function(){D=D.firstChild})}else{D.innerHTML=B}return $A(D.childNodes)};Element._insertionTranslations={before:function(A,B){A.parentNode.insertBefore(B,A)},top:function(A,B){A.insertBefore(B,A.firstChild)},bottom:function(A,B){A.appendChild(B)},after:function(A,B){A.parentNode.insertBefore(B,A.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD})}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(A,C){C=Element._attributeTranslations.has[C]||C;var B=$(A).getAttributeNode(C);return B&&B.specified}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div").__proto__){window.HTMLElement={};window.HTMLElement.prototype=document.createElement("div").__proto__;Prototype.BrowserFeatures.ElementExtensions=true}Element.extend=(function(){if(Prototype.BrowserFeatures.SpecificElementExtensions){return Prototype.K}var A={},B=Element.Methods.ByTag;var C=Object.extend(function(F){if(!F||F._extendedByPrototype||F.nodeType!=1||F==window){return F}var D=Object.clone(A),E=F.tagName,H,G;if(B[E]){Object.extend(D,B[E])}for(H in D){G=D[H];if(Object.isFunction(G)&&!(H in F)){F[H]=G.methodize()}}F._extendedByPrototype=Prototype.emptyFunction;return F},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(A,Element.Methods);Object.extend(A,Element.Methods.Simulated)}}});C.refresh();return C})();Element.hasAttribute=function(A,B){if(A.hasAttribute){return A.hasAttribute(B)}return Element.Methods.Simulated.hasAttribute(A,B)};Element.addMethods=function(C){var I=Prototype.BrowserFeatures,D=Element.Methods.ByTag;if(!C){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)})}if(arguments.length==2){var B=C;C=arguments[1]}if(!B){Object.extend(Element.Methods,C||{})}else{if(Object.isArray(B)){B.each(H)}else{H(B)}}function H(F){F=F.toUpperCase();if(!Element.Methods.ByTag[F]){Element.Methods.ByTag[F]={}}Object.extend(Element.Methods.ByTag[F],C)}function A(L,K,F){F=F||false;for(var N in L){var M=L[N];if(!Object.isFunction(M)){continue}if(!F||!(N in K)){K[N]=M.methodize()}}}function E(L){var F;var K={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(K[L]){F="HTML"+K[L]+"Element"}if(window[F]){return window[F]}F="HTML"+L+"Element";if(window[F]){return window[F]}F="HTML"+L.capitalize()+"Element";if(window[F]){return window[F]}window[F]={};window[F].prototype=document.createElement(L).__proto__;return window[F]}if(I.ElementExtensions){A(Element.Methods,HTMLElement.prototype);A(Element.Methods.Simulated,HTMLElement.prototype,true)}if(I.SpecificElementExtensions){for(var J in Element.Methods.ByTag){var G=E(J);if(Object.isUndefined(G)){continue}A(D[J],G.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){var A={};var C=Prototype.Browser;$w("width height").each(function(E){var B=E.capitalize();A[E]=(C.WebKit&&!document.evaluate)?self["inner"+B]:(C.Opera)?document.body["client"+B]:document.documentElement["client"+B]});return A},getWidth:function(){return this.getDimensions().width},getHeight:function(){return this.getDimensions().height},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};var Selector=Class.create({initialize:function(A){this.expression=A.strip();this.compileMatcher()},shouldUseXPath:function(){if(!Prototype.BrowserFeatures.XPath){return false}var A=this.expression;if(Prototype.Browser.WebKit&&(A.include("-of-type")||A.include(":empty"))){return false}if((/(\[[\w-]*?:|:checked)/).test(this.expression)){return false}return true},compileMatcher:function(){if(this.shouldUseXPath()){return this.compileXPathMatcher()}var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return }this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],"");break}}}this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join("\n"));Selector._cache[this.expression]=this.matcher},compileXPathMatcher:function(){var E=this.expression,F=Selector.patterns,B=Selector.xpath,D,A;if(Selector._cache[E]){this.xpath=Selector._cache[E];return }this.matcher=[".//*"];while(E&&D!=E&&(/\S/).test(E)){D=E;for(var C in F){if(A=E.match(F[C])){this.matcher.push(Object.isFunction(B[C])?B[C](A):new Template(B[C]).evaluate(A));E=E.replace(A[0],"");break}}}this.xpath=this.matcher.join("");Selector._cache[this.expression]=this.xpath},findElements:function(A){A=A||document;if(this.xpath){return document._getElementsByXPath(this.xpath,A)}return this.matcher(A)},match:function(H){this.tokens=[];var L=this.expression,A=Selector.patterns,E=Selector.assertions;var B,D,F;while(L&&B!==L&&(/\S/).test(L)){B=L;for(var I in A){D=A[I];if(F=L.match(D)){if(E[I]){this.tokens.push([I,Object.clone(F)]);L=L.replace(F[0],"")}else{return this.findElements(document).include(H)}}}}var K=true,C,J;for(var I=0,G;G=this.tokens[I];I++){C=G[0],J=G[1];if(!Selector.assertions[C](H,J)){K=false;break}}return K},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}});Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(A){if(A[1]=="*"){return""}return"[local-name()='"+A[1].toLowerCase()+"' or local-name()='"+A[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(A){A[1]=A[1].toLowerCase();return new Template("[@#{1}]").evaluate(A)},attr:function(A){A[1]=A[1].toLowerCase();A[3]=A[5]||A[6];return new Template(Selector.xpath.operators[A[2]]).evaluate(A)},pseudo:function(A){var B=Selector.xpath.pseudos[A[1]];if(!B){return""}if(Object.isFunction(B)){return B(A)}return new Template(Selector.xpath.pseudos[A[1]]).evaluate(A)},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]","empty":"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]","checked":"[@checked]","disabled":"[@disabled]","enabled":"[not(@disabled)]","not":function(B){var H=B[6],G=Selector.patterns,A=Selector.xpath,E,C;var F=[];while(H&&E!=H&&(/\S/).test(H)){E=H;for(var D in G){if(B=H.match(G[D])){C=Object.isFunction(A[D])?A[D](B):new Template(A[D]).evaluate(B);F.push("("+C.substring(1,C.length-1)+")");H=H.replace(B[0],"");break}}}return"[not("+F.join(" and ")+")]"},"nth-child":function(A){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",A)},"nth-last-child":function(A){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",A)},"nth-of-type":function(A){return Selector.xpath.pseudos.nth("position() ",A)},"nth-last-of-type":function(A){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",A)},"first-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-of-type"](A)},"last-of-type":function(A){A[6]="1";return Selector.xpath.pseudos["nth-last-of-type"](A)},"only-of-type":function(A){var B=Selector.xpath.pseudos;return B["first-of-type"](A)+B["last-of-type"](A)},nth:function(E,C){var F,G=C[6],B;if(G=="even"){G="2n+0"}if(G=="odd"){G="2n+1"}if(F=G.match(/^(\d+)$/)){return"["+E+"= "+F[1]+"]"}if(F=G.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(F[1]=="-"){F[1]=-1}var D=F[1]?Number(F[1]):1;var A=F[2]?Number(F[2]):0;B="[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(B).evaluate({fragment:E,a:D,b:A})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(A){A[3]=(A[5]||A[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(A)},pseudo:function(A){if(A[6]){A[6]=A[6].replace(/"/g,'\\"')}return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(A)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(A,B){return B[1].toUpperCase()==A.tagName.toUpperCase()},className:function(A,B){return Element.hasClassName(A,B[1])},id:function(A,B){return A.id===B[1]},attrPresence:function(A,B){return Element.hasAttribute(A,B[1])},attr:function(B,C){var A=Element.readAttribute(B,C[1]);return A&&Selector.operators[C[2]](A,C[5]||C[6])}},handlers:{concat:function(B,A){for(var C=0,D;D=A[C];C++){B.push(D)}return B},mark:function(A){var D=Prototype.emptyFunction;for(var B=0,C;C=A[B];B++){C._countedByPrototype=D}return A},unmark:function(A){for(var B=0,C;C=A[B];B++){C._countedByPrototype=undefined}return A},index:function(A,D,G){A._countedByPrototype=Prototype.emptyFunction;if(D){for(var B=A.childNodes,E=B.length-1,C=1;E>=0;E--){var F=B[E];if(F.nodeType==1&&(!G||F._countedByPrototype)){F.nodeIndex=C++}}}else{for(var E=0,C=1,B=A.childNodes;F=B[E];E++){if(F.nodeType==1&&(!G||F._countedByPrototype)){F.nodeIndex=C++}}}},unique:function(B){if(B.length==0){return B}var D=[],E;for(var C=0,A=B.length;C<A;C++){if(!(E=B[C])._countedByPrototype){E._countedByPrototype=Prototype.emptyFunction;D.push(Element.extend(E))}}return Selector.handlers.unmark(D)},descendant:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,E.getElementsByTagName("*"))}return B},child:function(A){var E=Selector.handlers;for(var D=0,C=[],F;F=A[D];D++){for(var B=0,G;G=F.childNodes[B];B++){if(G.nodeType==1&&G.tagName!="!"){C.push(G)}}}return C},adjacent:function(A){for(var C=0,B=[],E;E=A[C];C++){var D=this.nextElementSibling(E);if(D){B.push(D)}}return B},laterSibling:function(A){var D=Selector.handlers;for(var C=0,B=[],E;E=A[C];C++){D.concat(B,Element.nextSiblings(E))}return B},nextElementSibling:function(A){while(A=A.nextSibling){if(A.nodeType==1){return A}}return null},previousElementSibling:function(A){while(A=A.previousSibling){if(A.nodeType==1){return A}}return null},tagName:function(A,H,C,B){var I=C.toUpperCase();var E=[],G=Selector.handlers;if(A){if(B){if(B=="descendant"){for(var F=0,D;D=A[F];F++){G.concat(E,D.getElementsByTagName(C))}return E}else{A=this[B](A)}if(C=="*"){return A}}for(var F=0,D;D=A[F];F++){if(D.tagName.toUpperCase()===I){E.push(D)}}return E}else{return H.getElementsByTagName(C)}},id:function(B,A,H,F){var G=$(H),D=Selector.handlers;if(!G){return[]}if(!B&&A==document){return[G]}if(B){if(F){if(F=="child"){for(var C=0,E;E=B[C];C++){if(G.parentNode==E){return[G]}}}else{if(F=="descendant"){for(var C=0,E;E=B[C];C++){if(Element.descendantOf(G,E)){return[G]}}}else{if(F=="adjacent"){for(var C=0,E;E=B[C];C++){if(Selector.handlers.previousElementSibling(G)==E){return[G]}}}else{B=D[F](B)}}}}for(var C=0,E;E=B[C];C++){if(E==G){return[G]}}return[]}return(G&&Element.descendantOf(G,A))?[G]:[]},className:function(B,A,C,D){if(B&&D){B=this[D](B)}return Selector.handlers.byClassName(B,A,C)},byClassName:function(C,B,F){if(!C){C=Selector.handlers.descendant([B])}var H=" "+F+" ";for(var E=0,D=[],G,A;G=C[E];E++){A=G.className;if(A.length==0){continue}if(A==F||(" "+A+" ").include(H)){D.push(G)}}return D},attrPresence:function(C,B,A,G){if(!C){C=B.getElementsByTagName("*")}if(C&&G){C=this[G](C)}var E=[];for(var D=0,F;F=C[D];D++){if(Element.hasAttribute(F,A)){E.push(F)}}return E},attr:function(A,I,H,J,C,B){if(!A){A=I.getElementsByTagName("*")}if(A&&B){A=this[B](A)}var K=Selector.operators[C],F=[];for(var E=0,D;D=A[E];E++){var G=Element.readAttribute(D,H);if(G===null){continue}if(K(G,J)){F.push(D)}}return F},pseudo:function(B,C,E,A,D){if(B&&D){B=this[D](B)}if(!B){B=A.getElementsByTagName("*")}return Selector.pseudos[C](B,E,A)}},pseudos:{"first-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.previousElementSibling(E)){continue}C.push(E)}return C},"last-child":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(Selector.handlers.nextElementSibling(E)){continue}C.push(E)}return C},"only-child":function(B,G,A){var E=Selector.handlers;for(var D=0,C=[],F;F=B[D];D++){if(!E.previousElementSibling(F)&&!E.nextElementSibling(F)){C.push(F)}}return C},"nth-child":function(B,C,A){return Selector.pseudos.nth(B,C,A)},"nth-last-child":function(B,C,A){return Selector.pseudos.nth(B,C,A,true)},"nth-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,false,true)},"nth-last-of-type":function(B,C,A){return Selector.pseudos.nth(B,C,A,true,true)},"first-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,false,true)},"last-of-type":function(B,C,A){return Selector.pseudos.nth(B,"1",A,true,true)},"only-of-type":function(B,D,A){var C=Selector.pseudos;return C["last-of-type"](C["first-of-type"](B,D,A),D,A)},getIndices:function(B,A,C){if(B==0){return A>0?[A]:[]}return $R(1,C).inject([],function(D,E){if(0==(E-A)%B&&(E-A)/B>=0){D.push(E)}return D})},nth:function(A,L,N,K,C){if(A.length==0){return[]}if(L=="even"){L="2n+0"}if(L=="odd"){L="2n+1"}var J=Selector.handlers,I=[],B=[],E;J.mark(A);for(var H=0,D;D=A[H];H++){if(!D.parentNode._countedByPrototype){J.index(D.parentNode,K,C);B.push(D.parentNode)}}if(L.match(/^\d+$/)){L=Number(L);for(var H=0,D;D=A[H];H++){if(D.nodeIndex==L){I.push(D)}}}else{if(E=L.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(E[1]=="-"){E[1]=-1}var O=E[1]?Number(E[1]):1;var M=E[2]?Number(E[2]):0;var P=Selector.pseudos.getIndices(O,M,A.length);for(var H=0,D,F=P.length;D=A[H];H++){for(var G=0;G<F;G++){if(D.nodeIndex==P[G]){I.push(D)}}}}}J.unmark(A);J.unmark(B);return I},"empty":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.tagName=="!"||(E.firstChild&&!E.innerHTML.match(/^\s*$/))){continue}C.push(E)}return C},"not":function(A,D,I){var G=Selector.handlers,J,C;var H=new Selector(D).findElements(I);G.mark(H);for(var F=0,E=[],B;B=A[F];F++){if(!B._countedByPrototype){E.push(B)}}G.unmark(H);return E},"enabled":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(!E.disabled){C.push(E)}}return C},"disabled":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.disabled){C.push(E)}}return C},"checked":function(B,F,A){for(var D=0,C=[],E;E=B[D];D++){if(E.checked){C.push(E)}}return C}},operators:{"=":function(B,A){return B==A},"!=":function(B,A){return B!=A},"^=":function(B,A){return B.startsWith(A)},"$=":function(B,A){return B.endsWith(A)},"*=":function(B,A){return B.include(A)},"~=":function(B,A){return(" "+B+" ").include(" "+A+" ")},"|=":function(B,A){return("-"+B.toUpperCase()+"-").include("-"+A.toUpperCase()+"-")}},split:function(B){var A=[];B.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(C){A.push(C[1].strip())});return A},matchElements:function(F,G){var E=$$(G),D=Selector.handlers;D.mark(E);for(var C=0,B=[],A;A=F[C];C++){if(A._countedByPrototype){B.push(A)}}D.unmark(E);return B},findElement:function(B,C,A){if(Object.isNumber(C)){A=C;C=false}return Selector.matchElements(B,C||"*")[A||0]},findChildElements:function(E,G){G=Selector.split(G.join(","));var D=[],F=Selector.handlers;for(var C=0,B=G.length,A;C<B;C++){A=new Selector(G[C].strip());F.concat(D,A.findElements(E))}return(B>1)?F.unique(D):D}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(B,A){for(var C=0,D;D=A[C];C++){if(D.tagName!=="!"){B.push(D)}}return B},unmark:function(A){for(var B=0,C;C=A[B];B++){C.removeAttribute("_countedByPrototype")}return A}})}function $$(){return Selector.findChildElements(document,$A(arguments))}var Form={reset:function(A){$(A).reset();return A},serializeElements:function(G,B){if(typeof B!="object"){B={hash:!!B}}else{if(Object.isUndefined(B.hash)){B.hash=true}}var C,F,A=false,E=B.submit;var D=G.inject({},function(H,I){if(!I.disabled&&I.name){C=I.name;F=$(I).getValue();if(F!=null&&(I.type!="submit"||(!A&&E!==false&&(!E||C==E)&&(A=true)))){if(C in H){if(!Object.isArray(H[C])){H[C]=[H[C]]}H[C].push(F)}else{H[C]=F}}}return H});return B.hash?D:Object.toQueryString(D)}};Form.Methods={serialize:function(B,A){return Form.serializeElements(Form.getElements(B),A)},getElements:function(A){return $A($(A).getElementsByTagName("*")).inject([],function(B,C){if(Form.Element.Serializers[C.tagName.toLowerCase()]){B.push(Element.extend(C))}return B})},getInputs:function(G,C,D){G=$(G);var A=G.getElementsByTagName("input");if(!C&&!D){return $A(A).map(Element.extend)}for(var E=0,H=[],F=A.length;E<F;E++){var B=A[E];if((C&&B.type!=C)||(D&&B.name!=D)){continue}H.push(Element.extend(B))}return H},disable:function(A){A=$(A);Form.getElements(A).invoke("disable");return A},enable:function(A){A=$(A);Form.getElements(A).invoke("enable");return A},findFirstElement:function(B){var C=$(B).getElements().findAll(function(D){return"hidden"!=D.type&&!D.disabled});var A=C.findAll(function(D){return D.hasAttribute("tabIndex")&&D.tabIndex>=0}).sortBy(function(D){return D.tabIndex}).first();return A?A:C.find(function(D){return["input","select","textarea"].include(D.tagName.toLowerCase())})},focusFirstElement:function(A){A=$(A);A.findFirstElement().activate();return A},request:function(B,A){B=$(B),A=Object.clone(A||{});var D=A.parameters,C=B.readAttribute("action")||"";if(C.blank()){C=window.location.href}A.parameters=B.serialize(true);if(D){if(Object.isString(D)){D=D.toQueryParams()}Object.extend(A.parameters,D)}if(B.hasAttribute("method")&&!A.method){A.method=B.method}return new Ajax.Request(C,A)}};Form.Element={focus:function(A){$(A).focus();return A},select:function(A){$(A).select();return A}};Form.Element.Methods={serialize:function(A){A=$(A);if(!A.disabled&&A.name){var B=A.getValue();if(B!=undefined){var C={};C[A.name]=B;return Object.toQueryString(C)}}return""},getValue:function(A){A=$(A);var B=A.tagName.toLowerCase();return Form.Element.Serializers[B](A)},setValue:function(A,B){A=$(A);var C=A.tagName.toLowerCase();Form.Element.Serializers[C](A,B);return A},clear:function(A){$(A).value="";return A},present:function(A){return $(A).value!=""},activate:function(A){A=$(A);try{A.focus();if(A.select&&(A.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(A.type))){A.select()}}catch(B){}return A},disable:function(A){A=$(A);A.blur();A.disabled=true;return A},enable:function(A){A=$(A);A.disabled=false;return A}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(A,B){switch(A.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(A,B);default:return Form.Element.Serializers.textarea(A,B)}},inputSelector:function(A,B){if(Object.isUndefined(B)){return A.checked?A.value:null}else{A.checked=!!B}},textarea:function(A,B){if(Object.isUndefined(B)){return A.value}else{A.value=B}},select:function(D,A){if(Object.isUndefined(A)){return this[D.type=="select-one"?"selectOne":"selectMany"](D)}else{var C,F,G=!Object.isArray(A);for(var B=0,E=D.length;B<E;B++){C=D.options[B];F=this.optionValue(C);if(G){if(F==A){C.selected=true;return }}else{C.selected=A.include(F)}}}},selectOne:function(B){var A=B.selectedIndex;return A>=0?this.optionValue(B.options[A]):null},selectMany:function(D){var A,E=D.length;if(!E){return null}for(var C=0,A=[];C<E;C++){var B=D.options[C];if(B.selected){A.push(this.optionValue(B))}}return A},optionValue:function(A){return Element.extend(A).hasAttribute("value")?A.value:A.text}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,A,B,C){$super(C,B);this.element=$(A);this.lastValue=this.getValue()},execute:function(){var A=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(A)?this.lastValue!=A:String(this.lastValue)!=String(A)){this.callback(this.element,A);this.lastValue=A}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(A,B){this.element=$(A);this.callback=B;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var A=this.getValue();if(this.lastValue!=A){this.callback(this.element,A);this.lastValue=A}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(A){if(A.type){switch(A.type.toLowerCase()){case"checkbox":case"radio":Event.observe(A,"click",this.onElementEvent.bind(this));break;default:Event.observe(A,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});if(!window.Event){var Event={}}Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{},relatedTarget:function(B){var A;switch(B.type){case"mouseover":A=B.fromElement;break;case"mouseout":A=B.toElement;break;default:return null}return Element.extend(A)}});Event.Methods=(function(){var A;if(Prototype.Browser.IE){var B={0:1,1:4,2:2};A=function(D,C){return D.button==B[C]}}else{if(Prototype.Browser.WebKit){A=function(D,C){switch(C){case 0:return D.which==1&&!D.metaKey;case 1:return D.which==1&&D.metaKey;default:return false}}}else{A=function(D,C){return D.which?(D.which===C+1):(D.button===C)}}}return{isLeftClick:function(C){return A(C,0)},isMiddleClick:function(C){return A(C,1)},isRightClick:function(C){return A(C,2)},element:function(D){var C=Event.extend(D).target;return Element.extend(C.nodeType==Node.TEXT_NODE?C.parentNode:C)},findElement:function(D,F){var C=Event.element(D);if(!F){return C}var E=[C].concat(C.ancestors());return Selector.findElement(E,F,0)},pointer:function(C){return{x:C.pageX||(C.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)),y:C.pageY||(C.clientY+(document.documentElement.scrollTop||document.body.scrollTop))}},pointerX:function(C){return Event.pointer(C).x},pointerY:function(C){return Event.pointer(C).y},stop:function(C){Event.extend(C);C.preventDefault();C.stopPropagation();C.stopped=true}}})();Event.extend=(function(){var A=Object.keys(Event.Methods).inject({},function(B,C){B[C]=Event.Methods[C].methodize();return B});if(Prototype.Browser.IE){Object.extend(A,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});return function(B){if(!B){return false}if(B._extendedByPrototype){return B}B._extendedByPrototype=Prototype.emptyFunction;var C=Event.pointer(B);Object.extend(B,{target:B.srcElement,relatedTarget:Event.relatedTarget(B),pageX:C.x,pageY:C.y});return Object.extend(B,A)}}else{Event.prototype=Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(Event.prototype,A);return Prototype.K}})();Object.extend(Event,(function(){var B=Event.cache;function C(J){if(J._prototypeEventID){return J._prototypeEventID[0]}arguments.callee.id=arguments.callee.id||1;return J._prototypeEventID=[++arguments.callee.id]}function G(J){if(J&&J.include(":")){return"dataavailable"}return J}function A(J){return B[J]=B[J]||{}}function F(L,J){var K=A(L);return K[J]=K[J]||[]}function H(K,J,L){var O=C(K);var N=F(O,J);if(N.pluck("handler").include(L)){return false}var M=function(P){if(!Event||!Event.extend||(P.eventName&&P.eventName!=J)){return false}Event.extend(P);L.call(K,P)};M.handler=L;N.push(M);return M}function I(M,J,K){var L=F(M,J);return L.find(function(N){return N.handler==K})}function D(M,J,K){var L=A(M);if(!L[J]){return false}L[J]=L[J].without(I(M,J,K))}function E(){for(var K in B){for(var J in B[K]){B[K][J]=null}}}if(window.attachEvent){window.attachEvent("onunload",E)}return{observe:function(L,J,M){L=$(L);var K=G(J);var N=H(L,J,M);if(!N){return L}if(L.addEventListener){L.addEventListener(K,N,false)}else{L.attachEvent("on"+K,N)}return L},stopObserving:function(L,J,M){L=$(L);var O=C(L),K=G(J);if(!M&&J){F(O,J).each(function(P){L.stopObserving(J,P.handler)});return L}else{if(!J){Object.keys(A(O)).each(function(P){L.stopObserving(P)});return L}}var N=I(O,J,M);if(!N){return L}if(L.removeEventListener){L.removeEventListener(K,N,false)}else{L.detachEvent("on"+K,N)}D(O,J,M);return L},fire:function(L,K,J){L=$(L);if(L==document&&document.createEvent&&!L.dispatchEvent){L=document.documentElement}var M;if(document.createEvent){M=document.createEvent("HTMLEvents");M.initEvent("dataavailable",true,true)}else{M=document.createEventObject();M.eventType="ondataavailable"}M.eventName=K;M.memo=J||{};if(document.createEvent){L.dispatchEvent(M)}else{L.fireEvent(M.eventType,M)}return Event.extend(M)}}})());Object.extend(Event,Event.Methods);Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize(),loaded:false});(function(){var B;function A(){if(document.loaded){return }if(B){window.clearInterval(B)}document.fire("dom:loaded");document.loaded=true}if(document.addEventListener){if(Prototype.Browser.WebKit){B=window.setInterval(function(){if(/loaded|complete/.test(document.readyState)){A()}},0);Event.observe(window,"load",A)}else{document.addEventListener("DOMContentLoaded",A,false)}}else{document.write("<script id=__onDOMContentLoaded defer src=//:><\/script>");$("__onDOMContentLoaded").onreadystatechange=function(){if(this.readyState=="complete"){this.onreadystatechange=null;A()}}}})();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(A,B){return Element.insert(A,{before:B})},Top:function(A,B){return Element.insert(A,{top:B})},Bottom:function(A,B){return Element.insert(A,{bottom:B})},After:function(A,B){return Element.insert(A,{after:B})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(B,A,C){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(B,A,C)}this.xcomp=A;this.ycomp=C;this.offset=Element.cumulativeOffset(B);return(C>=this.offset[1]&&C<this.offset[1]+B.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+B.offsetWidth)},withinIncludingScrolloffsets:function(B,A,D){var C=Element.cumulativeScrollOffset(B);this.xcomp=A+C[0]-this.deltaX;this.ycomp=D+C[1]-this.deltaY;this.offset=Element.cumulativeOffset(B);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+B.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+B.offsetWidth)},overlap:function(B,A){if(!B){return 0}if(B=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight}if(B=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(A){Position.prepare();return Element.absolutize(A)},relativize:function(A){Position.prepare();return Element.relativize(A)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(B,C,A){A=A||{};return Element.clonePosition(C,B,A)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(B){function A(C){return C.blank()?null:"[contains(concat(' ', @class, ' '), ' "+C+" ')]"}B.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(C,E){E=E.toString().strip();var D=/\s/.test(E)?$w(E).map(A).join(""):A(E);return D?document._getElementsByXPath(".//*"+D,C):[]}:function(E,F){F=F.toString().strip();var G=[],H=(/\s/.test(F)?$w(F):null);if(!H&&!F){return G}var C=$(E).getElementsByTagName("*");F=" "+F+" ";for(var D=0,J,I;J=C[D];D++){if(J.className&&(I=" "+J.className+" ")&&(I.include(F)||(H&&H.all(function(K){return !K.toString().blank()&&I.include(" "+K+" ")})))){G.push(Element.extend(J))}}return G};return function(D,C){return $(C||document.body).getElementsByClassName(D)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A)},_each:function(A){this.element.className.split(/\s+/).select(function(B){return B.length>0})._each(A)},set:function(A){this.element.className=A},add:function(A){if(this.include(A)){return }this.set($A(this).concat(A).join(" "))},remove:function(A){if(!this.include(A)){return }this.set($A(this).without(A).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);Element.addMethods();var SWFUpload=function(A){this.initSWFUpload(A)};SWFUpload.prototype.initSWFUpload=function(B){try{this.customSettings={};this.settings=B;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(A){delete SWFUpload.instances[this.movieName];throw A}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 Alpha";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(B,A){this.settings[B]=(this.settings[B]==undefined)?A:this.settings[B]};this.ensureDefault("upload_url","");this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id",null);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",function(A){N2i.log(A)});this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+"?swfuploadrnd="+Math.floor(Math.random()*999999999)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){if(this.settings.button_placeholder_id!==""){this.replaceWithFlash()}else{this.appendFlash()}};SWFUpload.prototype.appendFlash=function(){var B,A;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}B=document.getElementsByTagName("body")[0];if(B==undefined){throw"Could not find the 'body' element."}A=document.createElement("div");A.style.width="1px";A.style.height="1px";A.style.overflow="hidden";B.appendChild(A);A.innerHTML=this.getFlashHTML()};SWFUpload.prototype.replaceWithFlash=function(){var A,B;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}A=this.settings.button_placeholder||document.getElementById(this.settings.button_placeholder_id);if(A==undefined){throw"Could not find the placeholder element."}B=document.createElement("div");B.innerHTML=this.getFlashHTML();A.parentNode.replaceChild(B.firstChild,A)};SWFUpload.prototype.getFlashHTML=function(){var A=this.settings.button_image_url===""?true:false;return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',A?"transparent":"window",'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var A=this.buildParamString();return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;params=",encodeURIComponent(A),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var C=this.settings.post_params;var B=[];if(typeof (C)==="object"){for(var A in C){if(C.hasOwnProperty(A)){B.push(encodeURIComponent(A.toString())+"="+encodeURIComponent(C[A].toString()))}}}return B.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.stopUpload();var B=null;try{B=this.getMovieElement()}catch(C){}if(B!=undefined&&B.parentNode!=undefined&&typeof B.parentNode.removeChild==="function"){var A=B.parentNode;if(A!=undefined){A.removeChild(B);if(A.parentNode!=undefined&&typeof A.parentNode.removeChild==="function"){A.parentNode.removeChild(A)}}}SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];delete this.movieElement;delete this.settings;delete this.customSettings;delete this.eventQueue;delete this.movieName;delete window[this.movieName];return true}catch(D){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(B,C,A){if(C==undefined){return(this.settings[B]=A)}else{return(this.settings[B]=C)}};SWFUpload.prototype.getSetting=function(A){if(this.settings[A]!=undefined){return this.settings[A]}return""};SWFUpload.prototype.callFlash=function(C,D){D=D||[];var A=this.getMovieElement();var B;if(typeof A[C]==="function"){if(D.length===0){B=A[C]()}else{if(D.length===1){B=A[C](D[0])}else{if(D.length===2){B=A[C](D[0],D[1])}else{if(D.length===3){B=A[C](D[0],D[1],D[2])}else{throw"Too many arguments"}}}}if(B!=undefined&&typeof B.post==="object"){B=this.unescapeFilePostParams(B)}return B}else{throw"Invalid function name: "+C}};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(A){this.callFlash("StartUpload",[A])};SWFUpload.prototype.cancelUpload=function(A){this.callFlash("CancelUpload",[A])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(A){this.callFlash("SetStats",[A])};SWFUpload.prototype.getFile=function(A){if(typeof (A)==="number"){return this.callFlash("GetFileByIndex",[A])}else{return this.callFlash("GetFile",[A])}};SWFUpload.prototype.addFileParam=function(A,B,C){return this.callFlash("AddFileParam",[A,B,C])};SWFUpload.prototype.removeFileParam=function(A,B){this.callFlash("RemoveFileParam",[A,B])};SWFUpload.prototype.setUploadURL=function(A){this.settings.upload_url=A.toString();this.callFlash("SetUploadURL",[A])};SWFUpload.prototype.setPostParams=function(A){this.settings.post_params=A;this.callFlash("SetPostParams",[A])};SWFUpload.prototype.addPostParam=function(A,B){this.settings.post_params[A]=B;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(A){delete this.settings.post_params[A];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(A,B){this.settings.file_types=A;this.settings.file_types_description=B;this.callFlash("SetFileTypes",[A,B])};SWFUpload.prototype.setFileSizeLimit=function(A){this.settings.file_size_limit=A;this.callFlash("SetFileSizeLimit",[A])};SWFUpload.prototype.setFileUploadLimit=function(A){this.settings.file_upload_limit=A;this.callFlash("SetFileUploadLimit",[A])};SWFUpload.prototype.setFileQueueLimit=function(A){this.settings.file_queue_limit=A;this.callFlash("SetFileQueueLimit",[A])};SWFUpload.prototype.setFilePostName=function(A){this.settings.file_post_name=A;this.callFlash("SetFilePostName",[A])};SWFUpload.prototype.setUseQueryString=function(A){this.settings.use_query_string=A;this.callFlash("SetUseQueryString",[A])};SWFUpload.prototype.setRequeueOnError=function(A){this.settings.requeue_on_error=A;this.callFlash("SetRequeueOnError",[A])};SWFUpload.prototype.setDebugEnabled=function(A){this.settings.debug_enabled=A;this.callFlash("SetDebugEnabled",[A])};SWFUpload.prototype.setButtonImageURL=function(A){if(A==undefined){A=""}this.settings.button_image_url=A;this.callFlash("SetButtonImageURL",[A])};SWFUpload.prototype.setButtonDimensions=function(C,A){this.settings.button_width=C;this.settings.button_height=A;var B=this.getMovieElement();if(B!=undefined){B.style.width=C+"px";B.style.height=A+"px"}this.callFlash("SetButtonDimensions",[C,A])};SWFUpload.prototype.setButtonText=function(A){this.settings.button_text=A;this.callFlash("SetButtonText",[A])};SWFUpload.prototype.setButtonTextPadding=function(B,A){this.settings.button_text_top_padding=A;this.settings.button_text_left_padding=B;this.callFlash("SetButtonTextPadding",[B,A])};SWFUpload.prototype.setButtonTextStyle=function(A){this.settings.button_text_style=A;this.callFlash("SetButtonTextStyle",[A])};SWFUpload.prototype.setButtonDisabled=function(A){this.settings.button_disabled=A;this.callFlash("SetButtonDisabled",[A])};SWFUpload.prototype.setButtonAction=function(A){this.settings.button_action=A;this.callFlash("SetButtonAction",[A])};SWFUpload.prototype.queueEvent=function(B,C){if(C==undefined){C=[]}else{if(!(C instanceof Array)){C=[C]}}var A=this;if(typeof this.settings[B]==="function"){this.eventQueue.push(function(){this.settings[B].apply(this,C)});setTimeout(function(){A.executeNextEvent()},0)}else{if(this.settings[B]!==null){throw"Event handler "+B+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var A=this.eventQueue?this.eventQueue.shift():null;if(typeof (A)==="function"){A.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(C){var E=/[$]([0-9a-f]{4})/i;var F={};var D;if(C!=undefined){for(var A in C.post){if(C.post.hasOwnProperty(A)){D=A;var B;while((B=E.exec(D))!==null){D=D.replace(B[0],String.fromCharCode(parseInt("0x"+B[1],16)))}F[D]=C.post[A]}}C.post=F}return C};SWFUpload.prototype.flashReady=function(){var A=this.getMovieElement();if(typeof A.StartUpload!=="function"){throw"ExternalInterface methods failed to initialize."}if(window[this.movieName]==undefined){window[this.movieName]=A}this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("file_queued_handler",A)};SWFUpload.prototype.fileQueueError=function(A,C,B){A=this.unescapeFilePostParams(A);this.queueEvent("file_queue_error_handler",[A,C,B])};SWFUpload.prototype.fileDialogComplete=function(A,B){this.queueEvent("file_dialog_complete_handler",[A,B])};SWFUpload.prototype.uploadStart=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("return_upload_start_handler",A)};SWFUpload.prototype.returnUploadStart=function(A){var B;if(typeof this.settings.upload_start_handler==="function"){A=this.unescapeFilePostParams(A);B=this.settings.upload_start_handler.call(this,A)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(B===undefined){B=true}B=!!B;this.callFlash("ReturnUploadStart",[B])};SWFUpload.prototype.uploadProgress=function(A,C,B){A=this.unescapeFilePostParams(A);this.queueEvent("upload_progress_handler",[A,C,B])};SWFUpload.prototype.uploadError=function(A,C,B){A=this.unescapeFilePostParams(A);this.queueEvent("upload_error_handler",[A,C,B])};SWFUpload.prototype.uploadSuccess=function(B,A){B=this.unescapeFilePostParams(B);this.queueEvent("upload_success_handler",[B,A])};SWFUpload.prototype.uploadComplete=function(A){A=this.unescapeFilePostParams(A);this.queueEvent("upload_complete_handler",A)};SWFUpload.prototype.debug=function(A){N2i.log(A)};if(!N2i){var N2i={}}N2i.Animation={objects:{},running:false,latestId:0,IE:navigator.userAgent.indexOf("MSIE")!=-1};N2i.Animation.loco=function(A){return Math.sin(3*A*Math.PI-Math.PI/2)*0.5+0.5};N2i.Animation.ease=function(A){return Math.sin(A*Math.PI-Math.PI/2)*0.5+0.5};N2i.Animation.func2=function(A){return(-1*Math.pow((A-1),2))+1};N2i.Animation.fastSlow=function(C){var B=0.5;var A=0.7;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(C,B)),Math.pow(Math.PI,A))+1};N2i.Animation.slowFastSlow=function(C){var B=1.6;var A=1.4;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(C,B)),Math.pow(Math.PI,A))+1};N2i.Animation.elasticIn=function(C){if(C==0){return 0}if(C==1){return 1}var B=0.3;var A=B/4;C=C-1;return -1*Math.pow(2,10*C)*Math.sin((C-A)*(2*Math.PI)/B)};N2i.Animation.backOut=function(B){B=B-1;var A=1.70158;return Math.pow(B,2)*((A+1)*B+A)+1};N2i.Animation.bounce=function(A){if(A<(1/2.75)){return 7.5625*A*A}else{if(A<(2/2.75)){return(7.5625*(A-=(1.5/2.75))*A+0.75)}else{if(A<(2.5/2.75)){return(7.5625*(A-=(2.25/2.75))*A+0.9375)}else{return(7.5625*(A-=(2.625/2.75))*A+0.984375)}}}};N2i.Animation.elastic=function(A){return 1-N2i.Animation.elastic2(1-A)};N2i.Animation.elastic2=function(B,A,D){if(B<=0||B>=1){return B}if(!D){D=0.45}var C;if(!A||A<1){A=1;C=D/4}else{C=D/(2*Math.PI)*Math.asin(1/A)}return -(A*Math.pow(2,10*(B-=1))*Math.sin((B-C)*(2*Math.PI)/D))};N2i.Animation.get=function(A){A=$id(A);if(!A.n2iAnimationId){A.n2iAnimationId=this.latestId++}if(!this.objects[A.n2iAnimationId]){this.objects[A.n2iAnimationId]=new N2i.Animation.Item(A)}return this.objects[A.n2iAnimationId]};N2i.Animation.start=function(){if(!this.running){N2i.Animation.render()}};N2i.Animation.render=function(F){this.running=true;var H=false;var A=new Date().getTime();for(id in this.objects){var E=this.objects[id];if(E.work){for(var G=0;G<E.work.length;G++){var J=E.work[G];if(J.finished){continue}var D=(A-J.start)/(J.end-J.start);if(D<0){H=true;continue}else{if(isNaN(D)){D=1}else{if(D>1){D=1}else{if(D<1){H=true}}}}var M=D;if(J.delegate&&J.delegate.ease){M=J.delegate.ease(M)}var L=null;if(!J.css){E.element[J.property]=Math.round(J.from+(J.to-J.from)*M)}else{if(J.to.red!=null){var B=Math.round(J.from.red+(J.to.red-J.from.red)*M);var C=Math.round(J.from.green+(J.to.green-J.from.green)*M);var K=Math.round(J.from.blue+(J.to.blue-J.from.blue)*M);L="rgb("+B+","+C+","+K+")";E.element.style[J.property]=L}else{if(N2i.Animation.IE&&J.property=="opacity"){var I=(J.from+(J.to-J.from)*M);if(I==1){E.element.style["filter"]=""}else{E.element.style["filter"]="alpha(opacity="+(I*100)+")"}}else{L=new String(J.from+(J.to-J.from)*M)+(J.unit!=null?J.unit:"");E.element.style[J.property]=L}}}if(D==1){J.finished=true;if(J.delegate&&J.delegate.onComplete){J.delegate.onComplete()}else{if(J.delegate&&J.delegate.hideOnComplete){E.element.style.display="none"}}}}}}if(H){window.setTimeout(function(){N2i.Animation.render()},0)}else{this.running=false}};N2i.Animation.parseStyle=function(D){var B={type:null,value:null,unit:null};var C;if(!isNaN(D)){B.value=parseFloat(D)}else{if(C=D.match(/([\-]?[0-9\.]+)(px|pt|%)/)){B.type="length";B.value=parseFloat(C[1]);B.unit=C[2]}else{if(C=D.match(/rgb\(([0-9]+),[ ]?([0-9]+),[ ]?([0-9]+)\)/)){B.type="color";B.value={red:parseInt(C[1]),green:parseInt(C[2]),blue:parseInt(C[3])}}else{var A=new N2i.Color(D);if(A.ok){B.value={red:A.r,green:A.g,blue:A.b}}}}}return B};N2i.Animation.Item=function(A){this.element=A;this.work=[]};N2i.Animation.Item.prototype.animate=function(H,I,J,B,F){var D=true;if(J=="scrollLeft"){D=false}var G=this.getWork(D?N2i.camelize(J):J);G.delegate=F;G.finished=false;G.css=D;if(H!=null){G.from=H}else{if(G.css&&N2i.Animation.IE&&J=="opacity"){G.from=this.getIEOpacity(this.element)}else{if(G.css){var A=N2i.Element.getStyle(this.element,J);var C=N2i.Animation.parseStyle(A);G.from=C.value}else{G.from=this.element[J]}}}if(G.css){var E=N2i.Animation.parseStyle(I);G.to=E.value;G.unit=E.unit}else{G.to=I;G.unit=null}G.start=new Date().getTime();if(F&&F.delay){G.start+=F.delay}G.end=G.start+B;N2i.Animation.start()};N2i.Animation.Item.prototype.getIEOpacity=function(B){var C=N2i.Element.getStyle(B,"filter").toLowerCase();var A;if(A=C.match(/opacity=([0-9]+)/)){return parseFloat(A[1])/100}else{return 1}};N2i.Animation.Item.prototype.getWork=function(C){for(var B=0;B<this.work.length;B++){if(this.work[B].property==C){return this.work[B]}}var A={property:C};this.work[this.work.length]=A;return A};N2i.Animation.Loop=function(A){this.recipe=A;this.position=-1;this.running=false};N2i.Animation.Loop.prototype.next=function(){this.position++;if(this.position>=this.recipe.length){this.position=0}var B=this.recipe[this.position];if(typeof (B)=="function"){B()}else{if(B.element){$ani(B.element,B.property,B.value,B.duration,{ease:B.ease})}}var A=this;var C=B.duration||0;window.setTimeout(function(){A.next()},C)};N2i.Animation.Loop.prototype.start=function(){this.running=true;this.next()};N2i.Color=function(G){this.ok=false;if(G.charAt(0)=="#"){G=G.substr(1,6)}G=G.replace(/ /g,"");G=G.toLowerCase();var A={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var C in A){if(G==C){G=A[C]}}var H=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(I){return[parseInt(I[1]),parseInt(I[2]),parseInt(I[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(I){return[parseInt(I[1],16),parseInt(I[2],16),parseInt(I[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(I){return[parseInt(I[1]+I[1],16),parseInt(I[2]+I[2],16),parseInt(I[3]+I[3],16)]}}];for(var B=0;B<H.length;B++){var E=H[B].re;var D=H[B].process;var F=E.exec(G);if(F){channels=D(F);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var K=this.r.toString(16);var J=this.g.toString(16);var I=this.b.toString(16);if(K.length==1){K="0"+K}if(J.length==1){J="0"+J}if(I.length==1){I="0"+I}return"#"+K+J+I}};N2i.ease={slowFastSlow:function(C){var B=1.6;var A=1.4;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(C,B)),Math.pow(Math.PI,A))+1},bounce:function(A){if(A<(1/2.75)){return 7.5625*A*A}else{if(A<(2/2.75)){return(7.5625*(A-=(1.5/2.75))*A+0.75)}else{if(A<(2.5/2.75)){return(7.5625*(A-=(2.25/2.75))*A+0.9375)}else{return(7.5625*(A-=(2.625/2.75))*A+0.984375)}}}},linear:function(A){return A},quadIn:function(A){return Math.pow(A,2)},quadOut:function(A){return A*(A-2)*-1},quadInOut:function(A){A=A*2;if(A<1){return Math.pow(A,2)/2}return -1*((--A)*(A-2)-1)/2},cubicIn:function(A){return Math.pow(A,3)},cubicOut:function(A){return Math.pow(A-1,3)+1},cubicInOut:function(A){A=A*2;if(A<1){return Math.pow(A,3)/2}A-=2;return(Math.pow(A,3)+2)/2},quartIn:function(A){return Math.pow(A,4)},quartOut:function(A){return -1*(Math.pow(A-1,4)-1)},quartInOut:function(A){A=A*2;if(A<1){return Math.pow(A,4)/2}A-=2;return -1/2*(Math.pow(A,4)-2)},quintIn:function(A){return Math.pow(A,5)},quintOut:function(A){return Math.pow(A-1,5)+1},quintInOut:function(A){A=A*2;if(A<1){return Math.pow(A,5)/2}A-=2;return(Math.pow(A,5)+2)/2},sineIn:function(A){return -1*Math.cos(A*(Math.PI/2))+1},sineOut:function(A){return Math.sin(A*(Math.PI/2))},sineInOut:function(A){return -1*(Math.cos(Math.PI*A)-1)/2},expoIn:function(A){return(A==0)?0:Math.pow(2,10*(A-1))},expoOut:function(A){return(A==1)?1:(-1*Math.pow(2,-10*A)+1)},expoInOut:function(A){if(A==0){return 0}if(A==1){return 1}A=A*2;if(A<1){return Math.pow(2,10*(A-1))/2}--A;return(-1*Math.pow(2,-10*A)+2)/2},circIn:function(A){return -1*(Math.sqrt(1-Math.pow(A,2))-1)},circOut:function(A){A=A-1;return Math.sqrt(1-Math.pow(A,2))},circInOut:function(A){A=A*2;if(A<1){return -1/2*(Math.sqrt(1-Math.pow(A,2))-1)}A-=2;return 1/2*(Math.sqrt(1-Math.pow(A,2))+1)},backIn:function(B){var A=1.70158;return Math.pow(B,2)*((A+1)*B-A)},backOut:function(B){B=B-1;var A=1.70158;return Math.pow(B,2)*((A+1)*B+A)+1},backInOut:function(B){var A=1.70158*1.525;B=B*2;if(B<1){return(Math.pow(B,2)*((A+1)*B-A))/2}B-=2;return(Math.pow(B,2)*((A+1)*B+A)+2)/2},elasticIn:function(C){if(C==0){return 0}if(C==1){return 1}var B=0.3;var A=B/4;C=C-1;return -1*Math.pow(2,10*C)*Math.sin((C-A)*(2*Math.PI)/B)},elasticOut:function(C){if(C==0){return 0}if(C==1){return 1}var B=0.3;var A=B/4;return Math.pow(2,-10*C)*Math.sin((C-A)*(2*Math.PI)/B)+1},elasticInOut:function(C){if(C==0){return 0}C=C*2;if(C==2){return 1}var B=0.3*1.5;var A=B/4;if(C<1){C-=1;return -0.5*(Math.pow(2,10*C)*Math.sin((C-A)*(2*Math.PI)/B))}C-=1;return 0.5*(Math.pow(2,-10*C)*Math.sin((C-A)*(2*Math.PI)/B))+1},bounceIn:function(A){return(1-N2i.ease.bounceOut(1-A))},bounceOut:function(D){var B=7.5625;var C=2.75;var A;if(D<(1/C)){A=B*Math.pow(D,2)}else{if(D<(2/C)){D-=(1.5/C);A=B*Math.pow(D,2)+0.75}else{if(D<(2.5/C)){D-=(2.25/C);A=B*Math.pow(D,2)+0.9375}else{D-=(2.625/C);A=B*Math.pow(D,2)+0.984375}}}return A},bounceInOut:function(A){if(A<0.5){return N2i.ease.bounceIn(A*2)/2}return(N2i.ease.bounceOut(A*2-1)/2)+0.5}};if(!N2i){var N2i={}}N2i.TextField=function(C,A,B){this.field=$id(C);this.value=this.field.value;this.options=A||{};this.delegate=B||{};if(this.options.placeholder&&this.field.value==""){this.field.value=this.options.placeholder}this.addBehaviour()};N2i.TextField.prototype.addBehaviour=function(){var A=this;this.field.onfocus=function(){A.onfocus()};this.field.onblur=function(){A.blur()};this.field.onkeydown=this.field.onkeyup=this.field.onkeypress=function(){A.key()}};N2i.TextField.prototype.setDelegate=function(A){this.delegate=A||{}};N2i.TextField.prototype.setEnabled=function(A){this.field.disabled=!A};N2i.TextField.prototype.getValue=function(){return this.value};N2i.TextField.prototype.setValue=function(A){A=A||"";this.value=this.field.value=A};N2i.TextField.prototype.focus=function(){this.field.focus()};N2i.TextField.prototype.onfocus=function(){if(this.field.value==this.options.placeholder){this.field.value=""}};N2i.TextField.prototype.blur=function(){if(this.field.value==""&&this.options.placeholder){this.field.value=this.options.placeholder}};N2i.TextField.prototype.key=function(){if(this.value!=this.field.value){this.value=this.field.value;if(this.delegate.valueDidChange){this.delegate.valueDidChange(this)}}};N2i.DateField=function(C,A,B){this.field=$id(C);this.value=this.field.value;this.date=null;this.inputFormats=["d-m-Y","d-m-Y","d-m-Y","d-m-Y","d-m","d/m","d","m-d-Y","m-d-Y","m-d-Y","m-d-Y","m-d","m/d"];this.outputFormat="d-m-Y";this.delegate=B||{};this.options=A||{};if(this.options.placeholder&&this.field.value==""){this.field.value=this.options.placeholder}this.addBehaviour();this.check()};N2i.DateField.prototype.setDelegate=function(A){this.delegate=A||{}};N2i.DateField.prototype.setEnabled=function(A){this.field.disabled=!A};N2i.DateField.prototype.setDate=function(A){this.date=A;this.field.value=this.date.dateFormat(this.outputFormat);this.value=this.field.value};N2i.DateField.prototype.getDate=function(){return this.date};N2i.DateField.prototype.addBehaviour=function(){var A=this;this.field.onfocus=function(){A.focus()};this.field.onblur=function(){A.blur()};this.field.onkeydown=this.field.onkeyup=this.field.onkeypress=function(){A.key()}};N2i.DateField.prototype.check=function(){var A=null;for(var B=0;B<this.inputFormats.length&&A==null;B++){A=Date.parseDate(this.value,this.inputFormats[B])}if(A){this.date=A}if(this.date==null){this.field.value=""}else{this.field.value=this.date.dateFormat(this.outputFormat)}this.value=this.field.value};N2i.DateField.prototype.getValue=function(){return this.value};N2i.DateField.prototype.focus=function(){if(this.field.value==this.options.placeholder){this.field.value=""}};N2i.DateField.prototype.blur=function(){this.check();if(this.field.value==""&&this.options.placeholder){this.field.value=this.options.placeholder}};N2i.DateField.prototype.key=function(){if(this.value!=this.field.value){this.value=this.field.value;if(this.options.valueDidChange){this.options.valueDidChange(this)}}};N2i.DateTimeField=function(B,A){this.field=$id(B);this.value=this.field.value;this.date=null;this.inputFormats=["d-m-Y H:i:s","d-m-Y H:i","d-m-Y H","d-m-Y","d-m","d/m"];this.outputFormat="d-m-Y H:i:s";this.delegate=A||{};if(this.delegate.placeholder&&this.field.value==""){this.field.value=this.delegate.placeholder}this.addBehaviour();this.check()};N2i.DateTimeField.prototype.addBehaviour=function(){var A=this;this.field.onfocus=function(){A.focus()};this.field.onblur=function(){A.blur()};this.field.onkeydown=this.field.onkeyup=this.field.onkeypress=function(){A.key()}};N2i.DateTimeField.prototype.check=function(){var A=null;for(var B=0;B<this.inputFormats.length&&A==null;B++){A=Date.parseDate(this.value,this.inputFormats[B])}if(A){this.date=A}this.field.value=this.date.dateFormat(this.outputFormat);this.value=this.field.value};N2i.DateTimeField.prototype.getValue=function(){return this.value};N2i.DateTimeField.prototype.focus=function(){if(this.field.value==this.delegate.placeholder){this.field.value=""}};N2i.DateTimeField.prototype.blur=function(){this.check();if(this.field.value==""&&this.delegate.placeholder){this.field.value=this.delegate.placeholder}};N2i.DateTimeField.prototype.key=function(){if(this.value!=this.field.value){this.value=this.field.value;if(this.delegate.valueDidChange){this.delegate.valueDidChange(this)}}};Date.parseFunctions={count:0};Date.parseRegexes=[];Date.formatFunctions={count:0};Date.prototype.dateFormat=function(B){if(Date.formatFunctions[B]==null){Date.createNewFormat(B)}var A=Date.formatFunctions[B];return this[A]()};Date.createNewFormat=function(format){var funcName="format"+Date.formatFunctions.count++;Date.formatFunctions[format]=funcName;var code="Date.prototype."+funcName+" = function(){return ";var special=false;var ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;code+="'"+String.escape(ch)+"' + "}else{code+=Date.getFormatCode(ch)}}}eval(code.substring(0,code.length-3)+";}")};Date.getFormatCode=function(A){switch(A){case"d":return"String.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"String.leftPad(this.getHours(), 2, '0') + ";case"i":return"String.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"String.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+String.escape(A)+"' + "}};Date.parseDate=function(A,C){if(Date.parseFunctions[C]==null){Date.createParser(C)}var B=Date.parseFunctions[C];return Date[B](A)};Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++;var regexNum=Date.parseRegexes.length;var currentGroup=1;Date.parseFunctions[format]=funcName;var code="Date."+funcName+" = function(input){\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {";var regex="";var special=false;var ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;regex+=String.escape(ch)}else{obj=Date.formatCodeToRegex(ch,currentGroup);currentGroup+=obj.g;regex+=obj.s;if(obj.g&&obj.c){code+=obj.c}}}}code+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}";Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$");eval(code)};Date.formatCodeToRegex=function(B,A){switch(B){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+A+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:0,c:null,s:"(?:\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+A+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+A+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+A+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+A+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+A+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+A+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+A+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+A+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+A+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+A+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:String.escape(B)}}};Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")};Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(this.getTimezoneOffset()/60),2,"0")+String.leftPad(this.getTimezoneOffset()%60,2,"0")};Date.prototype.getDayOfYear=function(){var A=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var B=0;B<this.getMonth();++B){A+=Date.daysInMonth[B]}return A+this.getDate()-1};Date.prototype.getWeekOfYear=function(){var B=this.getDayOfYear()+(5-this.getDay());var A=new Date(this.getFullYear(),0,1);var C=(5-A.getDay());return String.leftPad(((B-C)/7)+1,2,"0")};Date.prototype.isLeapYear=function(){var A=this.getFullYear();return((A&3)==0&&(A%100||(A%400==0&&A)))};Date.prototype.getFirstDayOfMonth=function(){var A=(this.getDay()-(this.getDate()-1))%7;return(A<0)?(A+7):A};Date.prototype.getLastDayOfMonth=function(){var A=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return(A<0)?(A+7):A};Date.prototype.getDaysInMonth=function(){Date.daysInMonth[1]=this.isLeapYear()?29:28;return Date.daysInMonth[this.getMonth()]};Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};String.escape=function(A){return A.replace(/('|\\)/g,"\\$1")};String.leftPad=function(D,B,C){var A=new String(D);if(C==null){C=" "}while(A.length<B){A=C+A}return A};Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.y2kYear=50;Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"};if(!this.JSON){JSON=function(){function f(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value,whitelist){var a,i,k,l,r=/["\\\x00-\x1f\x7f-\x9f]/g,v;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}if(typeof value.toJSON==="function"){return stringify(value.toJSON())}a=[];if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i],whitelist)||"null")}return"["+a.join(",")+"]"}if(whitelist){l=whitelist.length;for(i=0;i<l;i+=1){k=whitelist[i];if(typeof k==="string"){v=stringify(value[k],whitelist);if(v){a.push(stringify(k)+":"+v)}}}}else{for(k in value){if(typeof k==="string"){v=stringify(value[k],whitelist);if(v){a.push(stringify(k)+":"+v)}}}}return"{"+a.join(",")+"}"}}return{stringify:stringify,parse:function(text,filter){var j;function walk(k,v){var i,n;if(v&&typeof v==="object"){for(i in v){if(Object.prototype.hasOwnProperty.apply(v,[i])){n=walk(i,v[i]);if(n!==undefined){v[i]=n}}}}return filter(k,v)}if(/^[\],:{}\s]*$/.test(text.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof filter==="function"?walk("",j):j}throw new SyntaxError("parseJSON")}}}()}function In2iGui(){this.domLoaded=false;this.overflows=null;this.delegates=[];this.objects=$H();this.addBehavior()}In2iGui.latestObjectIndex=0;In2iGui.latestIndex=500;In2iGui.latestPanelIndex=1000;In2iGui.latestAlertIndex=1500;In2iGui.latestTopIndex=2000;In2iGui.browser={};In2iGui.browser.opera=/opera/i.test(navigator.userAgent);In2iGui.browser.msie=!In2iGui.browser.opera&&/MSIE/.test(navigator.userAgent);In2iGui.browser.msie7=navigator.userAgent.indexOf("MSIE 7")!=-1;In2iGui.browser.webkit=navigator.userAgent.indexOf("WebKit")!=-1;In2iGui.browser.gecko=!In2iGui.browser.webkit&&navigator.userAgent.indexOf("Gecko")!=-1;In2iGui.get=function(A){if(!In2iGui.instance){In2iGui.instance=new In2iGui()}if(A){return In2iGui.instance.objects.get(A)}else{return In2iGui.instance}};document.observe("dom:loaded",function(){In2iGui.get().ignite()});In2iGui.dwrErrorhandler=function(B,A){N2i.log(B);N2i.log(A);In2iGui.get().showAlert({title:"An unexpected error occurred!",text:B,emotion:"gasp"})};In2iGui.prototype={ignite:function(A){if(window.dwr){if(dwr&&dwr.engine&&dwr.engine.setErrorHandler){dwr.engine.setErrorHandler(In2iGui.dwrErrorhandler)}}this.domLoaded=true;this.resize();In2iGui.callSuperDelegates(this,"interfaceIsReady")},addBehavior:function(B){var A=this;N2i.Event.addListener(window,"resize",function(){A.resize()})},addDelegate:function(A){this.delegates[this.delegates.length]=A},getTopPad:function(A){var D=0;var B=parseInt(N2i.getStyle(A,"padding"));var C=parseInt(N2i.getStyle(A,"padding-top"));if(B){D+=B}if(C){D+=C}return D},getBottomPad:function(B){var D=0;var C=parseInt(N2i.getStyle(B,"padding"));var A=parseInt(N2i.getStyle(B,"padding-bottom"));if(C){D+=C}if(A){D+=A}return D},resize:function(B){if(!this.overflows){return }var A=N2i.Window.getInnerHeight();this.overflows.each(function(C){if(In2iGui.browser.webkit||In2iGui.browser.gecko){C.element.style.display="none";C.element.style.width=C.element.parentNode.clientWidth+"px";C.element.style.display=""}C.element.style.height=A+C.diff+"px"})},registerOverflow:function(C,A){if(!this.overflows){this.overflows=[]}var B=$(C);this.overflows.push({element:B,diff:A})},alert:function(A,B){if(!this.alertBox){this.alertBox=In2iGui.Alert.create(null,A);this.alertBoxButton=In2iGui.Button.create("in2iGuiAlertBoxButton",{text:"OK"});this.alertBoxButton.addDelegate(this);this.alertBox.addButton(this.alertBoxButton)}else{this.alertBox.update(A)}this.alertBoxCallBack=B;this.alertBoxButton.setText(A.button?A.button:"OK");this.alertBox.show()},click$in2iGuiAlertBoxButton:function(){In2iGui.get().alertBox.hide();if(this.alertBoxCallBack){this.alertBoxCallBack();this.alertBoxCallBack=null}},showAlert:function(A){this.alert(A)},confirm:function(B,A){var E=In2iGui.get(B);if(!E){E=In2iGui.Alert.create(B,A);var D=In2iGui.Button.create(B+"_cancel",{text:A.cancel||"Cancel",highlighted:A.highlighted=="cancel"});D.addDelegate({buttonWasClicked:function(){In2iGui.get(B).hide();In2iGui.callDelegates(In2iGui.get(B),"cancel")}});E.addButton(D);var C=In2iGui.Button.create(B+"_ok",{text:A.ok||"OK",highlighted:A.highlighted=="ok"});C.addDelegate({buttonWasClicked:function(){In2iGui.get(B).hide();In2iGui.callDelegates(In2iGui.get(B),"ok")}});E.addButton(C)}else{E.update(A);In2iGui.get(B+"_ok").setText(A.ok||"ok");In2iGui.get(B+"_ok").setHighlighted(A.highlighted=="ok");In2iGui.get(B+"_cancel").setText(A.ok||"cancel");In2iGui.get(B+"_cancel").setHighlighted(A.highlighted=="cancel");if(A.cancel){In2iGui.get(B+"_cancel").setText(A.cancel)}}E.show()},changeState:function(B){if(this.state==B){return }var A=this.objects.values();A.each(function(C){if(C.state){if(C.state==B){C.show()}else{C.hide()}}})},getDescendants:function(B){var E=[];var C=B.getElement();if(C){var D=C.descendants();var A=this;D.each(function(F){A.objects.values().each(function(G){if(G.getElement()==F){E.push(G)}})})}return E}};In2iGui.nextIndex=function(){In2iGui.latestIndex++;return In2iGui.latestIndex};In2iGui.nextPanelIndex=function(){In2iGui.latestPanelIndex++;return In2iGui.latestPanelIndex};In2iGui.nextAlertIndex=function(){In2iGui.latestAlertIndex++;return In2iGui.latestAlertIndex};In2iGui.nextTopIndex=function(){In2iGui.latestTopIndex++;return In2iGui.latestTopIndex};In2iGui.showCurtain=function(A,B){if(!A.curtain){A.curtain=N2i.create("div",{"class":"in2igui_curtain"},{"z-index":"none"});A.curtain.onclick=function(){if(A.curtainWasClicked){A.curtainWasClicked()}};document.body.appendChild(A.curtain)}A.curtain.style.height=N2i.getDocumentHeight()+"px";A.curtain.style.zIndex=B;N2i.setOpacity(A.curtain,0);A.curtain.style.display="block";$ani(A.curtain,"opacity",0.5,1000,{ease:N2i.Animation.slowFastSlow})};In2iGui.hideCurtain=function(A){if(A.curtain){$ani(A.curtain,"opacity",0,200,{hideOnComplete:true})}};In2iGui.showMessage=function(A){if(!In2iGui.message){In2iGui.message=new Element("div",{"class":"in2igui_message"}).update("<div><div></div></div>");document.body.appendChild(In2iGui.message)}In2iGui.message.select("div")[1].update(A);In2iGui.message.setStyle({"display":"block",zIndex:In2iGui.nextTopIndex(),opacity:0});In2iGui.message.setStyle({marginLeft:(In2iGui.message.getWidth()/-2)+"px",marginTop:N2i.Window.getScrollTop()+"px"});$ani(In2iGui.message,"opacity",1,300)};In2iGui.hideMessage=function(){if(In2iGui.message){$ani(In2iGui.message,"opacity",0,300,{hideOnComplete:true})}};In2iGui.isWithin=function(B,A){Event.extend(B);var D=A.cumulativeOffset();var C=A.getDimensions();return B.pointerX()>D.left&&B.pointerX()<D.left+C.width&&B.pointerY()>D.top&&B.pointerY()<D.top+C.height};In2iGui.getIconUrl=function(B,A){return In2iGui.context+"/In2iGui/icons/"+B+A+".png"};In2iGui.onDomReady=function(A){document.observe("dom:loaded",A)};In2iGui.positionAtElement=function(B,F,A){A=A||{};B=$(B);F=$(F);var C=B.getStyle("display");if(C=="none"){B.setStyle({"visibility":"hidden","display":"block"})}var G=F.cumulativeOffset();var E=G.left;var D=G.top;if(A.horizontal&&A.horizontal=="right"){E=E+F.getWidth()-B.getWidth()}if(A.vertical&&A.vertical=="topOutside"){D=D-B.getHeight()}B.setStyle({"left":E+"px","top":D+"px"});if(C=="none"){B.setStyle({"visibility":"visible","display":"none"})}};In2iGui.getDragProxy=function(){if(!In2iGui.dragProxy){In2iGui.dragProxy=N2i.create("div",{"class":"in2igui_dragproxy"},{"display":"none"});document.body.appendChild(In2iGui.dragProxy)}return In2iGui.dragProxy};In2iGui.startDrag=function(F,C,A){var E=C.dragDropInfo;In2iGui.dropTypes=In2iGui.findDropTypes(E);if(!In2iGui.dropTypes){return }var D=new N2i.Event(F);var B=In2iGui.getDragProxy();N2i.addListener(document.body,"mousemove",In2iGui.dragListener);N2i.addListener(document.body,"mouseup",In2iGui.dragEndListener);In2iGui.dragInfo=E;if(E.icon){B.style.backgroundImage="url("+In2iGui.getIconUrl(E.icon,1)+")"}In2iGui.startDragPos={top:D.mouseTop(),left:D.mouseLeft()};B.innerHTML="<span>"+E.title+"</span>"||"###";In2iGui.dragging=true};In2iGui.findDropTypes=function(D){var A=In2iGui.get();var F=null;for(var C=0;C<A.delegates.length;C++){if(A.delegates[C].dragDrop){for(var B=0;B<A.delegates[C].dragDrop.length;B++){var E=A.delegates[C].dragDrop[B];if(E.drag==D.kind){if(F==null){F={}}F[E.drop]={}}}}}return F};In2iGui.dragListener=function(C){var A=new N2i.Event(C);In2iGui.dragProxy.style.left=(A.mouseLeft()+10)+"px";In2iGui.dragProxy.style.top=A.mouseTop()+"px";In2iGui.dragProxy.style.display="block";var B=In2iGui.findDropTarget(A.getTarget());if(B&&In2iGui.dropTypes[B.dragDropInfo["kind"]]){if(In2iGui.latestDropTarget){N2i.removeClass(In2iGui.latestDropTarget,"in2igui_drop")}N2i.addClass(B,"in2igui_drop");In2iGui.latestDropTarget=B}else{if(In2iGui.latestDropTarget){N2i.removeClass(In2iGui.latestDropTarget,"in2igui_drop");In2iGui.latestDropTarget=null}}return false};In2iGui.findDropTarget=function(A){while(A){if(A.dragDropInfo){return A}A=A.parentNode}return null};In2iGui.dragEndListener=function(A){N2i.removeListener(document.body,"mousemove",In2iGui.dragListener);N2i.removeListener(document.body,"mouseup",In2iGui.dragEndListener);In2iGui.dragging=false;if(In2iGui.latestDropTarget){N2i.removeClass(In2iGui.latestDropTarget,"in2igui_drop");In2iGui.callDelegatesDrop(In2iGui.dragInfo,In2iGui.latestDropTarget.dragDropInfo);In2iGui.dragProxy.style.display="none"}else{$ani(In2iGui.dragProxy,"left",(In2iGui.startDragPos.left+10)+"px",300,{ease:N2i.Animation.fastSlow});$ani(In2iGui.dragProxy,"top",(In2iGui.startDragPos.top-5)+"px",300,{ease:N2i.Animation.fastSlow,hideOnComplete:true})}In2iGui.latestDropTarget=null};In2iGui.dropOverListener=function(A){if(In2iGui.dragging){}};In2iGui.dropOutListener=function(A){if(In2iGui.dragging){}};In2iGui.extend=function(A){if(!A.name){In2iGui.latestObjectIndex++;A.name="unnamed"+In2iGui.latestObjectIndex}In2iGui.get().objects.set(A.name,A);A.delegates=[];A.addDelegate=function(B){this.delegates[this.delegates.length]=B};if(!A.getElement){A.getElement=function(){return this.element}}};In2iGui.callDelegatesDrop=function(B,E){var C=In2iGui.get();var A=null;for(var D=0;D<C.delegates.length;D++){if(C.delegates[D]["drop$"+B.kind+"$"+E.kind]){C.delegates[D]["drop$"+B.kind+"$"+E.kind](B,E)}}};In2iGui.callDelegates=function(E,A,H,B){if(typeof (H)=="undefined"){H=E}var I=null;if(E.delegates){for(var F=0;F<E.delegates.length;F++){var G=E.delegates[F];var C=null;if(E.name&&G[A+"$"+E.name]){C=G[A+"$"+E.name](H,B)}else{if(E.kind&&G[A+"$"+E.kind]){C=G[A+"$"+E.kind](H,B)}else{if(G[A]){C=G[A](H,B)}}}if(I==null&&C!=null&&typeof (C)!="undefined"){I=C}}}var D=In2iGui.callSuperDelegates(E,A,H,B);if(I==null&&D!=null){I=D}return I};In2iGui.callSuperDelegates=function(E,A,H,B){if(typeof (H)=="undefined"){H=E}var C=In2iGui.get();var I=null;for(var F=0;F<C.delegates.length;F++){var G=C.delegates[F];var D=null;if(E.name&&G[A+"$"+E.name]){D=G[A+"$"+E.name](H,B)}else{if(E.kind&&G[A+"$"+E.kind]){D=G[A+"$"+E.kind](H,B)}else{if(G[A]){D=G[A](H,B)}}}if(I==null&&D!=null&&typeof (D)!="undefined"){I=D}}return I};In2iGui.fireValueChange=function(C,A,B){};In2iGui.bind=function(A,D,B,C){};In2iGui.dwrUpdate=function(){var C=arguments[0];var B={callback:function(D){In2iGui.handleDwrUpdate(D)}};var A=arguments.length;if(A==1){C(B)}else{if(A==2){C(arguments[1],B)}else{alert("Too many parameters")}}};In2iGui.handleDwrUpdate=function(C){var A=In2iGui.get();for(var B=0;B<C.length;B++){if(A.objects.get(C[B].name)){A.objects.get(C[B].name).updateFromObject(C[B])}}};In2iGui.update=function(A,B){var C={onSuccess:function(D){In2iGui.handleUpdate(D,B)}};$get(A,C)};In2iGui.handleUpdate=function(E,F){var A=In2iGui.get();var G=E.responseXML.firstChild;var D=G.childNodes;for(var C=0;C<D.length;C++){if(D[C].nodeType==1){var B=D[C].getAttribute("name");if(B&&B!=""&&A.objects.get(B)){A.objects.get(B).updateFromNode(D[C])}}}F.onSuccess()};In2iGui.jsonResponse=function(C,B){if(!C.responseXML||!C.responseXML.documentElement){var D=C.responseText.replace(/^\s+|\s+$/g,"");if(D.length>0){var A=C.responseText.evalJSON(true)}else{A=""}In2iGui.callDelegates(A,"success$"+B)}else{In2iGui.callDelegates(C,"success$"+B)}};In2iGui.json=function(D,C,B){if(typeof (B)=="string"){delegate={onSuccess:function(E){In2iGui.jsonResponse(E,B)}}}else{delegate=B}var A={method:"POST",parameters:{}};for(key in D){A.parameters[key]=Object.toJSON(D[key])}$get(C,delegate,A)};In2iGui.parseItems=function(G){var B=[];var D=G.getElementsByTagName("item");for(var C=0;C<D.length;C++){var I=D[C];var F=I.getAttribute("title");var H=I.getAttribute("value");var E=I.getAttribute("icon");var A=I.getAttribute("kind");B.push({title:F,value:H,icon:E,kind:A})}return B};In2iGui.Source=function(D,C,B){this.options=N2i.override({url:null},B);In2iGui.extend(this);var A=this;In2iGui.onDomReady(function(){A.refresh()})};In2iGui.Source.prototype={refresh:function(){var A=this;new Ajax.Request(this.options.url,{onSuccess:function(B){A.parse(B)}})},parse:function(A){if(A.responseXML){this.parseXML(A.responseXML)}},parseXML:function(B){if(B.documentElement.tagName=="items"){var A=In2iGui.parseItems(B);In2iGui.callDelegates(this,"itemsLoaded",A)}}};In2iGui.localize=function(A){alert(Object.toJSON(A))};In2iGui.TextField=function(C,B,A){this.options=N2i.override({},A);this.element=$(C);this.element.setAttribute("autocomplete","off");this.value=this.element.value;this.name=B;In2iGui.extend(this);this.addBehavior()};In2iGui.TextField.prototype={addBehavior:function(){var A=this;this.element.observe("keyup",function(){A.keyDidStrike()})},keyDidStrike:function(){if(this.value!=this.element.value){this.value=this.element.value;In2iGui.callDelegates(this,"valueChanged")}},getValue:function(){return this.value},setValue:function(A){if(A==undefined||A==null){A=""}this.value=A;this.element.value=A},isEmpty:function(){return this.value==""}};In2iGui.InfoView=function(C,B,A){this.options={clickObjects:false};N2i.override(this.options,A);this.element=$(C);this.body=this.element.select("tbody")[0];this.name=B;In2iGui.extend(this)};In2iGui.InfoView.create=function(B,A){A=A||{};var C=new Element("div",{"class":"in2igui_infoview"});if(A.height){C.setStyle({height:A.height+"px","overflow":"auto","overflowX":"hidden"})}if(A.margin){C.setStyle({margin:A.margin+"px"})}C.update("<table><tbody></tbody></table>");return new In2iGui.InfoView(C,B,A)};In2iGui.InfoView.prototype={addHeader:function(B){var A=new Element("tr");A.insert(new Element("th",{"class":"in2igui_infoview_header","colspan":"2"}).insert(B));this.body.insert(A)},addProperty:function(A,C){var B=new Element("tr");B.insert(new Element("th").insert(A));B.insert(new Element("td").insert(C));this.body.insert(B)},addObjects:function(B,D){if(!D||D.length==0){return }var E=new Element("tr");E.insert(new Element("th").insert(B));var A=new Element("td");var C=this.options.clickObjects;D.each(function(G){var F=new Element("div").insert(G.title);if(C){F.addClassName("in2igui_infoview_click");F.observe("click",function(){In2iGui.callDelegates(this,"objectWasClicked",G)})}A.insert(F)});E.insert(A);this.body.insert(E)},setBusy:function(A){if(A){this.element.addClassName("in2igui_infoview_busy")}else{this.element.removeClassName("in2igui_infoview_busy")}},clear:function(){this.body.update()},update:function(B){this.clear();for(var A=0;A<B.length;A++){switch(B[A].type){case"header":this.addHeader(B[A].value);break;case"property":this.addProperty(B[A].label,B[A].value);break;case"objects":this.addObjects(B[A].label,B[A].value);break}}}};Element.addMethods({setClassName:function(B,A,C){if(C){B.addClassName(A)}else{B.removeClassName(A)}return B}});In2iGui.Window=function(B,A){this.element=$(B);this.name=A;this.close=this.element.select(".close")[0];this.titlebar=this.element.select(".titlebar")[0];this.title=this.titlebar.select(".title")[0];this.content=this.element.select(".in2igui_window_body")[0];this.visible=false;In2iGui.extend(this);this.addBehavior()};In2iGui.Window.create=function(B,A){A=N2i.override({title:"Window",close:true},A);var C=new Element("div",{"class":"in2igui_window"+(A.variant?" in2igui_window_"+A.variant:"")});C.update((A.close?'<div class="close"></div>':"")+'<div class="titlebar"><div class="titlebar"><div class="titlebar"><span>'+A.title+'</span></div></div></div><div class="in2igui_window_content"><div class="in2igui_window_content"><div class="in2igui_window_body" style="'+(A.width?"width:"+A.width+"px;":"")+(A.padding?"padding:"+A.padding+"px;":"")+'"></div></div></div><div class="in2igui_window_bottom"><div class="in2igui_window_bottom"><div class="in2igui_window_bottom"></div></div></div></div>');document.body.appendChild(C);return new In2iGui.Window(C,B)};In2iGui.Window.prototype={addBehavior:function(){var A=this;if(this.close){this.close.observe("click",function(){A.hide()})}this.titlebar.onmousedown=function(B){A.startDrag(B);return false};this.titlebar.observe("touchstart",function(B){A.startDrag(B);return false});this.element.observe("mousedown",function(){A.element.style.zIndex=In2iGui.nextPanelIndex()})},setTitle:function(A){this.title.update(A)},show:function(){if(this.visible){return }this.element.setStyle({zIndex:In2iGui.nextPanelIndex(),visibility:"hidden",display:"block",top:(N2i.Window.getScrollTop()+40)+"px"});var A=this.element.clientWidth;this.element.setStyle({width:A+"px",visibility:"visible"});if(!N2i.isIE()){$ani(this.element,"opacity",1,0)}this.visible=true},toggle:function(){(this.visible?this.hide():this.show())},hide:function(){if(!this.visible){return }if(!N2i.isIE()){$ani(this.element,"opacity",0,200,{hideOnComplete:true})}else{this.element.setStyle({display:"none"})}this.visible=false},add:function(A){if(A.getElement){this.content.insert(A.getElement())}else{this.content.insert(A)}},setVariant:function(A){this.element.removeClassName("in2igui_window_dark");this.element.removeClassName("in2igui_window_light");if(A=="dark"||A=="light"){this.element.addClassName("in2igui_window_"+A)}},startDrag:function(C){var B=new N2i.Event(C);this.element.style.zIndex=In2iGui.nextPanelIndex();this.dragState={left:B.mouseLeft()-N2i.Element.getLeft(this.element),top:B.mouseTop()-N2i.Element.getTop(this.element)};this.latestPosition={left:this.dragState.left,top:this.dragState.top};this.latestTime=new Date().getMilliseconds();var A=this;this.moveListener=function(D){A.drag(D)};this.upListener=function(D){A.endDrag(D)};N2i.Event.addListener(document,"mousemove",this.moveListener);N2i.Event.addListener(document,"mouseup",this.upListener);N2i.Event.stop(C);document.body.onselectstart=function(){return false};return false},calc:function(B,A){this.a=this.latestPosition.left-A;this.b=this.latestPosition.top-B;this.dist=Math.sqrt(Math.pow((this.a),2),Math.pow((this.b),2));this.latestTime=new Date().getMilliseconds();this.latestPosition={"top":B,"left":A}},drag:function(D){var A=new N2i.Event(D);this.element.style.right="auto";var C=(A.mouseTop()-this.dragState.top);var B=(A.mouseLeft()-this.dragState.left);this.element.style.top=Math.max(C,0)+"px";this.element.style.left=Math.max(B,0)+"px";return false},endDrag:function(A){N2i.Event.removeListener(document,"mousemove",this.moveListener);N2i.Event.removeListener(document,"mouseup",this.upListener);document.body.onselectstart=null}};In2iGui.Formula=function(B,A){this.id=B;this.name=A;this.element=$(B);this.children=[];this.addBehavior();In2iGui.extend(this)};In2iGui.Formula.create=function(A){var B=new Element("form",{"class":"in2igui_formula"});return new In2iGui.Formula(B,A)};In2iGui.Formula.prototype={addBehavior:function(){var A=this;this.element.onsubmit=function(){In2iGui.callDelegates(A,"submit");return false}},getElement:function(){return this.element},registerInput:function(A){alert("Deprecated!")},registerChild:function(A){this.children.push(A)},getValues:function(){var B={};var C=In2iGui.get().getDescendants(this);for(var A=0;A<C.length;A++){if(C[A].options&&C[A].options.key&&C[A].getValue){B[C[A].options.key]=C[A].getValue()}else{if(C[A].name&&C[A].getValue){B[C[A].name]=C[A].getValue()}}}return B},setValues:function(A){var D=In2iGui.get().getDescendants(this);for(var C=0;C<D.length;C++){if(D[C].options&&D[C].options.key){var B=D[C].options.key;if(B&&A[B]){D[C].setValue(A[B])}}}},reset:function(){var B=In2iGui.get().getDescendants(this);for(var A=0;A<B.length;A++){if(B[A].reset){B[A].reset()}}},addContent:function(A){this.element.insert(A)},add:function(A){this.element.insert(A.getElement())},createGroup:function(A){var B=In2iGui.Formula.Group.create(null,A);this.add(B);return B}};In2iGui.Formula.Group=function(A,C,B){this.name=C;this.element=$(A);this.body=this.element.select("tbody")[0];this.options=N2i.override({above:true},B);In2iGui.extend(this)};In2iGui.Formula.Group.create=function(B,A){A=N2i.override({above:true},A);var C=new Element("table",{"class":"in2igui_formula_group"});if(A.above){C.addClassName("in2igui_formula_group_above")}C.insert(new Element("tbody"));return new In2iGui.Formula.Group(C,B,A)};In2iGui.Formula.Group.prototype={add:function(D){var C=new Element("tr");this.body.insert(C);N2i.log(D);if(D.getLabel){var A=D.getLabel();if(A){var B=new Element("th");B.insert(new Element("label").insert(A));C.insert(B)}}var E=new Element("td");E.insert(D.getElement());if(this.options.above){C=new Element("tr");this.body.insert(C)}C.insert(E)},createButtons:function(B){var C=new Element("tr");this.body.insert(C);var D=new Element("td",{colspan:this.options.above?1:2});C.insert(D);var A=In2iGui.Buttons.create(null,B);D.insert(A.getElement());return A}};In2iGui.Formula.Text=function(C,B,A){this.name=B;this.options={label:null,key:null};N2i.override(this.options,A);this.element=$(C);this.input=this.element.select(".in2igui_formula_text")[0];In2iGui.extend(this)};In2iGui.Formula.Text.create=function(C,B){B=N2i.override({lines:1},B);if(B.lines>1){var A=N2i.create("textarea",{"class":"in2igui_formula_text","rows":B.lines})}else{var A=N2i.create("input",{"class":"in2igui_formula_text"})}var D=N2i.create("div",{"class":"in2igui_field"});D.appendChild(A);return new In2iGui.Formula.Text(D,C,B)};In2iGui.Formula.Text.prototype={updateFromNode:function(A){if(A.firstChild){this.setValue(A.firstChild.nodeValue)}else{this.setValue(null)}},updateFromObject:function(A){this.setValue(A.value)},focus:function(){try{this.element.focus()}catch(A){}},reset:function(){this.setValue("")},setValue:function(A){this.input.value=A},getValue:function(){return this.input.value},getLabel:function(){return this.options.label},isEmpty:function(){return N2i.isEmpty(this.input.value)}};In2iGui.Formula.DateTime=function(A,C,B){this.inputFormats=["d-m-Y","d/m-Y","d/m/Y","d-m-Y H:i:s","d/m-Y H:i:s","d/m/Y H:i:s","d-m-Y H:i","d/m-Y H:i","d/m/Y H:i","d-m-Y H","d/m-Y H","d/m/Y H","d-m","d/m","d","Y","m-d-Y","m-d","m/d"];this.outputFormat="d-m-Y H:i:s";this.name=C;this.options=N2i.override({returnType:null,label:null},B);this.value=null;this.element=$(A);In2iGui.extend(this);this.addBehavior()};In2iGui.Formula.DateTime.create=function(B,A){var C=new Element("input",{"class":"in2igui_formula_text"});return new In2iGui.Formula.DateTime(C,B,A)};In2iGui.Formula.DateTime.prototype={addBehavior:function(){var A=this;this.element.onblur=function(){A.check()}},updateFromNode:function(A){if(A.firstChild){this.setValue(A.firstChild.nodeValue)}else{this.setValue(null)}},updateFromObject:function(A){this.setValue(A.value)},focus:function(){try{this.element.focus()}catch(A){}},reset:function(){this.setValue("")},setValue:function(A){if(!A){this.value=null}else{if(A.constructor==Date){this.value=A}else{this.value=new Date();this.value.setTime(parseInt(A)*1000)}}this.updateUI()},check:function(){var C=this.element.value;var A=null;for(var B=0;B<this.inputFormats.length&&A==null;B++){A=Date.parseDate(C,this.inputFormats[B])}this.value=A;this.updateUI()},getValue:function(){if(this.value!=null&&this.options.returnType=="seconds"){return Math.round(this.value.getTime()/1000)}return this.value},getElement:function(){return this.element},getLabel:function(){return this.options.label},updateUI:function(){if(this.value){this.element.value=this.value.dateFormat(this.outputFormat)}else{this.element.value=""}}};In2iGui.Formula.Select=function(C,B,A){this.name=B;N2i.log(A);this.options=N2i.override({label:null},A);this.element=$(C);this.value=this.options.value||null;this.invalidValue=false;In2iGui.extend(this);this.addBehavior();this.refresh()};In2iGui.Formula.Select.create=function(B,A){var C=new Element("select");return new In2iGui.Formula.Select(C,B,A)};In2iGui.Formula.Select.prototype={addBehavior:function(){var A=this;this.element.observe("change",function(){A.valueMightChange()})},refresh:function(){if(this.options.source){var A=this;new Ajax.Request(this.options.source,{onSuccess:function(B){A.update(B.responseXML)}})}},update:function(D){for(var B=this.element.options.length-1;B>=0;B--){this.element.remove(B)}var A=D.getElementsByTagName("item");for(var B=0;B<A.length;B++){var E=A[B].getAttribute("title");var C=A[B].getAttribute("value");this.element.options[this.element.options.length]=new Option(E,C)}this.setValue(this.value)},valueMightChange:function(){if(this.element.value!=this.value){this.value=this.element.value;In2iGui.callDelegates(this,"valueDidChange",this.value)}},reset:function(){this.element.selectedIndex=0;this.value=null},setValue:function(B){B=B+"";for(var A=0;A<this.element.options.length;A++){if(this.element.options[A].value==B){this.element.selectedIndex=A;this.value=B;if(this.invalidValue){this.element.firstDescendant().remove()}return }}if(this.invalidValue){this.element.firstDescendant().value=B}else{this.element.insert({top:new Element("option",{value:B})});this.invalidValue=true}this.element.selectedIndex=0;this.value=B},getValue:function(A){return this.element.value},getLabel:function(){return this.options.label}};In2iGui.Formula.Radiobuttons=function(C,B,A){this.options=A;this.element=$(C);this.name=B;this.radios=[];this.value=A.value;this.defaultValue=this.value;In2iGui.extend(this)};In2iGui.Formula.Radiobuttons.prototype={click:function(){this.value=!this.value;this.updateUI()},updateUI:function(){for(var B=0;B<this.radios.length;B++){var A=this.radios[B];N2i.setClass(A.id,"in2igui_selected",A.value==this.value)}},setValue:function(A){this.value=A;this.updateUI()},getValue:function(){return this.value},reset:function(){this.setValue(this.defaultValue)},registerRadiobutton:function(B){this.radios.push(B);var C=$(B.id);var A=this;C.onclick=function(){A.setValue(B.value)}}};In2iGui.Formula.Checkbox=function(C,B,A){this.element=$(C);this.options=A;this.name=B;this.value=A.value=="true";In2iGui.extend(this);this.addBehavior()};In2iGui.Formula.Checkbox.prototype={addBehavior:function(){var B=this.element.select("div")[0];var A=this;B.onclick=function(){A.click()}},click:function(){this.value=!this.value;this.updateUI()},updateUI:function(){N2i.setClass(this.element,"in2igui_checkbox_selected",this.value)},setValue:function(A){this.value=A;this.updateUI()},getValue:function(){return this.value},reset:function(){this.setValue(false)}};In2iGui.Formula.Checkboxes=function(C,B,A){this.options=A;this.element=$(C);this.name=B;this.checkboxes=[];this.sources=[];this.subItems=[];this.values=[];In2iGui.extend(this)};In2iGui.Formula.Checkboxes.prototype={getValue:function(){return this.values},getValues:function(){return this.values},checkValues:function(){var B=[];for(var C=0;C<this.values.length;C++){var E=this.values[C];var D=false;for(var A=0;A<this.subItems.length;A++){D=D||this.subItems[A].hasValue(E)}if(D){B.push(E)}}this.values=B},setValue:function(A){this.values=A;this.checkValues();this.updateUI()},setValues:function(A){this.setValue(A)},flipValue:function(A){N2i.flipInArray(this.values,A);this.checkValues();this.updateUI()},updateUI:function(){for(var A=0;A<this.subItems.length;A++){this.subItems[A].updateUI()}},refresh:function(){for(var A=0;A<this.subItems.length;A++){this.subItems[A].refresh()}},reset:function(){this.setValues([])},registerSource:function(A){A.parent=this;this.sources.push(A)},registerItems:function(A){A.parent=this;this.subItems.push(A)},itemWasClicked:function(A){this.changeValue(A.in2iGuiValue)}};In2iGui.Formula.Checkboxes.Items=function(C,B,A){this.element=$(C);this.name=B;this.parent=null;this.options=A;this.checkboxes=[];In2iGui.extend(this);if(this.options.source){this.options.source.addDelegate(this)}};In2iGui.Formula.Checkboxes.Items.prototype={refresh:function(){if(this.options.source){this.options.source.refresh()}},itemsLoaded:function(B){this.checkboxes=[];this.element.update();var A=this;B.each(function(D){var C=new Element("div",{"class":"in2igui_checkbox"});C.insert(new Element("div")).insert(D.title);C.observe("click",function(){A.itemWasClicked(D)});A.element.insert(C);A.checkboxes.push({title:D.title,element:C,value:D.value})});this.parent.checkValues();this.updateUI()},itemWasClicked:function(A){this.parent.flipValue(A.value)},updateUI:function(){for(var A=0;A<this.checkboxes.length;A++){var B=this.checkboxes[A];N2i.setClass(B.element,"in2igui_checkbox_selected",N2i.inArray(this.parent.values,B.value))}},hasValue:function(B){for(var A=0;A<this.checkboxes.length;A++){if(this.checkboxes[A].value==B){return true}}return false}};In2iGui.Formula.Tokens=function(C,B,A){this.options={label:null,key:null};N2i.override(this.options,A);this.element=$(C);this.name=B;this.value=[""];In2iGui.extend(this);this.updateUI()};In2iGui.Formula.Tokens.create=function(A,C){var B=new Element("div").addClassName("in2igui_tokens");return new In2iGui.Formula.Tokens(B,A,C)};In2iGui.Formula.Tokens.prototype={setValue:function(A){this.value=A;this.value.push("");this.updateUI()},reset:function(){this.value=[""];this.updateUI()},getValue:function(){var A=[];this.value.each(function(B){B=B.strip();if(B.length>0){A.push(B)}});return A},getLabel:function(){return this.options.label},updateUI:function(){this.element.update();var A=this;this.value.each(function(D,C){var B=new Element("input").addClassName("in2igui_tokens_token");B.value=D;B.in2iguiIndex=C;A.element.insert(B);B.observe("keyup",function(){A.inputChanged(B,C)})})},inputChanged:function(A,B){if(B==this.value.length-1&&A.value!=this.value[B]){this.addField()}this.value[B]=A.value},addField:function(){var B=new Element("input").addClassName("in2igui_tokens_token");var C=this.value.length;this.value.push("");this.element.insert(B);var A=this;B.observe("keyup",function(){A.inputChanged(B,C)})}};In2iGui.List=function(C,B,A){this.element=$(C);this.name=B;this.state=A.state;this.source=A.source;this.head=this.element.select("thead")[0];this.body=this.element.select("tbody")[0];this.columns=[];this.rows=[];this.selected=[];this.navigation=this.element.select(".navigation")[0];this.count=this.navigation.select(".count")[0];this.windowSize=this.navigation.select(".window_size")[0];this.windowNumber=this.navigation.select(".window_number")[0];this.windowNumberBody=this.navigation.select(".window_number_body")[0];this.parameters={};this.sortKey=null;this.sortDirection=null;this.window={size:null,number:1,total:0};if(A.windowSize!=""){this.window.size=parseInt(A.windowSize)}In2iGui.extend(this);this.refresh()};In2iGui.List.prototype={hide:function(){this.element.hide()},show:function(){this.element.show()},registerColumn:function(A){this.columns.push(A)},getSelection:function(){var A=[];for(var B=0;B<this.selected.length;B++){A.push(this.rows[this.selected[B]])}return A},getFirstSelection:function(){var A=this.getSelection();if(A.length>0){return A[0]}else{return null}},setParameter:function(A,B){this.parameters[A]=B},loadData:function(A){this.setSource(A)},setSource:function(A){this.source=A;this.selected=[];this.sortKey=null;this.sortDirection=null;this.window.number=0;this.refresh()},refresh:function(){if(!this.source){return }var B=this.source;if(this.window.number){B+=B.indexOf("?")==-1?"?":"&";B+="windowNumber="+this.window.number}if(this.window.size){B+=B.indexOf("?")==-1?"?":"&";B+="windowSize="+this.window.size}if(this.sortKey){B+=B.indexOf("?")==-1?"?":"&";B+="sort="+this.sortKey}if(this.sortDirection){B+=B.indexOf("?")==-1?"?":"&";B+="direction="+this.sortDirection}for(key in this.parameters){B+=B.indexOf("?")==-1?"?":"&";B+=key+"="+this.parameters[key]}var A=this;new Ajax.Request(B,{onSuccess:function(C){if(C.responseXML){try{A.parse(C.responseXML)}catch(D){N2i.log(D)}}else{if(C.responseText){A.setObjects(C.responseText.evalJSON())}}}})},sort:function(A){var B=this.columns[A].key;if(B==this.sortKey){this.sortDirection=this.sortDirection=="ascending"?"descending":"ascending"}this.sortKey=B;this.refresh()},parse:function(S){this.parseWindow(S);this.buildNavigation();this.body.update();this.head.update();this.rows=[];this.columns=[];var Q=new Element("tr");var P=S.getElementsByTagName("sort");this.sortKey=null;this.sortDirection=null;if(P.length>0){this.sortKey=P[0].getAttribute("key");this.sortDirection=P[0].getAttribute("direction")}var A=S.getElementsByTagName("header");for(var M=0;M<A.length;M++){var B="";var E=new Element("th");var J=A[M].getAttribute("width");var R=A[M].getAttribute("key");var C=A[M].getAttribute("sortable")=="true";if(J&&J!=""){E.style.width=J+"%"}if(C){var I=this;E.in2iguiIndex=M;E.onclick=function(){I.sort(this.in2iguiIndex)};B+="sortable"}if(R==this.sortKey){B+=" sort_"+this.sortDirection}E.className=B;var L=new Element("span");E.appendChild(L);L.appendChild(document.createTextNode(A[M].getAttribute("title")));Q.appendChild(E);this.columns.push({"key":R,"sortable":C,"width":J})}this.head.appendChild(Q);var H=S.getElementsByTagName("row");for(var M=0;M<H.length;M++){var D=H[M].getElementsByTagName("cell");var F=new Element("tr");var O=H[M].getAttribute("icon");var T=H[M].getAttribute("title");for(var K=0;K<D.length;K++){var G=new Element("td");this.parseCell(D[K],G);F.insert(G);if(!T){T=D[K].innerText}if(!O&&D[K].getAttribute("icon")){O=D[K].getAttribute("icon")}}var N={id:H[M].getAttribute("id"),kind:H[M].getAttribute("kind"),icon:O,title:T,index:M};F.dragDropInfo=N;this.addRowBehavior(F,M);this.body.insert(F);this.rows.push(N)}}};In2iGui.List.prototype.filter=function(G){var A=20;var E=new RegExp("[\\w]{"+A+",}","g");var C=E.exec(G);if(C){for(var D=0;D<C.length;D++){var F="";for(var B=0;B<C[D].length;B++){F+=C[D][B];if((B+1)%A==0){F+="\u200B"}}G=G.replace(C[D],F)}}return G};In2iGui.List.prototype.parseCell=function(D,A){if(D.getAttribute("icon")!=null){var C=new Element("div",{"class":"icon"}).setStyle({"backgroundImage":'url("'+In2iGui.getIconUrl(D.getAttribute("icon"),1)+'")'});A.insert(C)}for(var B=0;B<D.childNodes.length;B++){var F=D.childNodes[B];if(F.nodeType==N2i.TEXT_NODE&&F.nodeValue.length>0){A.appendChild(document.createTextNode(F.nodeValue))}else{if(F.nodeType==N2i.ELEMENT_NODE&&F.nodeName=="break"){A.insert(new Element("br"))}else{if(F.nodeType==N2i.ELEMENT_NODE&&F.nodeName=="object"){var E=new Element("div",{"class":"object"});if(F.getAttribute("icon")!=null){var C=new Element("div",{"class":"icon"}).setStyle({"backgroundImage":'url("'+In2iGui.getIconUrl(F.getAttribute("icon"),1)+'")'});E.insert(C)}if(F.firstChild&&F.firstChild.nodeType==N2i.TEXT_NODE&&F.firstChild.nodeValue.length>0){E.appendChild(document.createTextNode(F.firstChild.nodeValue))}A.insert(E)}}}}};In2iGui.List.prototype.parseWindow=function(B){var C=B.getElementsByTagName("window");if(C.length>0){var A=C[0];this.window.total=parseInt(A.getAttribute("total"));this.window.size=parseInt(A.getAttribute("size"));this.window.number=parseInt(A.getAttribute("number"))}else{this.window.total=0;this.window.size=0;this.window.number=0}};In2iGui.List.prototype.buildNavigation=function(E){var C=this;var A=this.window.size>0?Math.ceil(this.window.total/this.window.size):0;if(A<2){this.navigation.style.display="none";return }this.navigation.style.display="block";var F=((this.window.number-1)*this.window.size+1);this.count.update("<span><span>"+F+"-"+Math.min((this.window.number)*this.window.size,this.window.total)+"/"+this.window.total+"</span></span>");this.windowNumberBody.update();if(A<2){this.windowNumber.style.display="none"}else{for(var D=1;D<=A;D++){var B=document.createElement("a");B.appendChild(document.createTextNode(D));B.in2GuiNumber=D;B.onclick=function(){C.windowNumberWasClicked(this);return false};if(D==this.window.number){B.className="selected"}this.windowNumberBody.appendChild(B)}this.windowNumber.style.display="block"}};In2iGui.List.prototype.setObjects=function(F){this.selected=[];this.body.update();this.rows=[];for(var D=0;D<F.length;D++){var H=new Element("tr");var G=F[D];for(var C=0;C<this.columns.length;C++){var A=new Element("td");if(this.builder){A.update(this.builder.buildColumn(this.columns[C],G))}else{var E=G[this.columns[C].key]||"";if(E.constructor==Array){for(var B=0;B<E.length;B++){if(E[B].constructor==Object){A.insert(this.createObject(E[B]))}else{A.insert(new Element("div").update(E))}}}else{if(E.constructor==Object){A.insert(this.createObject(E[C]))}else{A.insert(E)}}}H.insert(A)}this.body.insert(H);this.addRowBehavior(H,D);this.rows.push(G)}};In2iGui.List.prototype.createObject=function(A){var B=new Element("div",{"class":"object"});if(A.icon){B.insert(new Element("div",{"class":"icon"}).setStyle({"backgroundImage":'url("'+In2iGui.getIconUrl(A.icon,1)+'")'}))}return B.insert(A.text||A.name||"")};In2iGui.List.prototype.addRowBehavior=function(C,B){var A=this;C.onmousedown=function(D){A.rowDown(B);In2iGui.startDrag(D,C);return false};C.ondblclick=function(){A.rowDoubleClick(B);return false}};In2iGui.List.prototype.changeSelection=function(A){var C=this.body.getElementsByTagName("tr");for(var B=0;B<this.selected.length;B++){N2i.Element.removeClassName(C[this.selected[B]],"selected")}for(var B=0;B<A.length;B++){N2i.Element.addClassName(C[A[B]],"selected")}this.selected=A};In2iGui.List.prototype.rowDown=function(A){this.changeSelection([A])};In2iGui.List.prototype.rowDoubleClick=function(A){In2iGui.callDelegates(this,"listRowsWasOpened")};In2iGui.List.prototype.windowNumberWasClicked=function(A){this.window.number=A.in2GuiNumber;this.refresh()};In2iGui.Icons=function(C,B,A){this.id=C;this.name=B;this.element=$id(C);this.source=A.source;In2iGui.extend(this)};In2iGui.Tabs=function(B,A){this.id=B;this.name=A;this.element=$(B);this.bar=this.element.select(".in2igui_tabs_bar")[0];this.activeTab=0;this.tabs=[];this.addBehavior();In2iGui.extend(this)};In2iGui.Tabs.prototype.registerTab=function(A){A.parent=this;this.tabs[this.tabs.length]=A};In2iGui.Tabs.prototype.addBehavior=function(){var A=this;var C=this.bar.select("li");for(var B=0;B<C.length;B++){C[B].in2iGuiIndex=B;C[B].onclick=function(){A.tabWasClicked(this)}}};In2iGui.Tabs.prototype.tabWasClicked=function(A){this.activeTab=A.in2iGuiIndex;this.updateGUI()};In2iGui.Tabs.prototype.updateGUI=function(){for(var A=0;A<this.tabs.length;A++){this.tabs[A].setActive(A==this.activeTab)}};In2iGui.Tabs.Tab=function(B,A){this.id=B;this.name=A;this.parent=null;this.element=$(B+"_content");this.tab=$(B+"_tab");In2iGui.extend(this)};In2iGui.Tabs.Tab.prototype={setActive:function(A){this.element.style.display=(A?"block":"none");N2i.setClass(this.tab,"in2igui_tabs_selected",A)}};In2iGui.ViewStack=function(C,B,A){this.id=C;this.name=B;this.element=$id(C);this.contents=[];In2iGui.extend(this)};In2iGui.ViewStack.prototype.registerContent=function(B,A){this.contents[this.contents.length]={element:$id(B),name:A}};In2iGui.ViewStack.prototype.change=function(A){for(var B=0;B<this.contents.length;B++){if(this.contents[B].name==A){this.contents[B].element.style.display="block"}else{this.contents[B].element.style.display="none"}}};In2iGui.Tabbox=function(B,A){this.id=B;this.name=A;this.element=$id(B);this.panes=$class("tab",$class("tabbox_top",this.element)[0]);this.activeTab=0;this.tabs=[];this.addBehavior();this.updateGUI();In2iGui.extend(this)};In2iGui.Tabbox.prototype.registerTab=function(A){this.tabs[this.tabs.length]=A};In2iGui.Tabbox.prototype.addBehavior=function(){var A=this;var C=$class("tabbox_top",this.element)[0].getElementsByTagName("a");for(var B=0;B<C.length;B++){C[B].in2iGuiIndex=B;C[B].onclick=function(){A.tabWasClicked(this)}}};In2iGui.Tabbox.prototype.tabWasClicked=function(A){this.activeTab=A.in2iGuiIndex;this.updateGUI()};In2iGui.Tabbox.prototype.updateGUI=function(){var A=$class("tabbox_body",this.element)[0];$ani(A,"scrollLeft",this.activeTab*592,700,{ease:N2i.Animation.slowFastSlow});for(var B=0;B<this.panes.length;B++){if(B==this.activeTab){N2i.Element.addClassName(this.panes[B],"tab_selected")}else{N2i.Element.removeClassName(this.panes[B],"tab_selected")}}};In2iGui.Tabbox.Tab=function(B,A){this.id=B;this.name=A;this.element=$id(B);In2iGui.extend(this)};In2iGui.ObjectList=function(C,B,A){this.options=N2i.override({key:null},A);this.name=B;this.element=$(C);this.body=this.element.select("tbody")[0];this.template=[];this.objects=[];In2iGui.extend(this)};In2iGui.ObjectList.prototype={ignite:function(){this.addObject({})},addObject:function(B,D){if(this.objects.length==0||D){var C=new In2iGui.ObjectList.Object(this.objects.length,B,this);this.objects.push(C);this.body.appendChild(C.getElement())}else{var A=this.objects.pop();var C=new In2iGui.ObjectList.Object(A.index,B,this);A.index++;this.objects.push(C);this.objects.push(A);this.body.insertBefore(C.getElement(),A.getElement())}},reset:function(){for(var B=0;B<this.objects.length;B++){var A=this.objects[B].getElement();A.parentNode.removeChild(A)}this.objects=[];this.addObject({})},addObjects:function(B){for(var A=0;A<B.length;A++){this.addObject(B[A])}},setObjects:function(A){this.reset();this.addObjects(A)},getObjects:function(C){var B=[];for(var A=0;A<this.objects.length-1;A++){B.push(this.objects[A].getData())}return B},getValue:function(){return this.getObjects()},setValue:function(A){this.setObjects(A)},registerTemplateItem:function(A){this.template.push(A)},objectDidChange:function(A){if(A.index>=this.objects.length-1){this.addObject({},true)}}};In2iGui.ObjectList.Object=function(A,C,B){this.data=C;this.index=A;this.list=B;this.fields=[]};In2iGui.ObjectList.Object.prototype={getElement:function(){if(!this.element){var B=this;this.element=document.createElement("tr");for(var C=0;C<this.list.template.length;C++){var D=this.list.template[C];var E=D.clone();E.object=this;this.fields.push(E);var A=document.createElement("td");if(C==0){A.className="first"}A.appendChild(E.getElement());E.setValue(this.data[D.key]);this.element.appendChild(A)}}return this.element},valueDidChange:function(){this.list.objectDidChange(this)},getData:function(){var B=this.data;for(var A=0;A<this.fields.length;A++){B[this.fields[A].key]=this.fields[A].getValue()}return B}};In2iGui.ObjectList.Text=function(A){this.key=A;this.value=null};In2iGui.ObjectList.Text.prototype={clone:function(){return new In2iGui.ObjectList.Text(this.key)},getElement:function(){var A=N2i.create("input",{"class":"in2igui_formula_text"});var B=N2i.create("div",{"class":"in2igui_field"});B.appendChild(A);this.wrapper=new N2i.TextField(A);this.wrapper.setDelegate(this);return B},valueDidChange:function(A){this.value=A.getValue();this.object.valueDidChange()},getValue:function(){return this.value},setValue:function(A){this.value=A;this.wrapper.setValue(A)}};In2iGui.ObjectList.Select=function(A){this.key=A;this.value=null;this.options=[]};In2iGui.ObjectList.Select.prototype={clone:function(){var A=new In2iGui.ObjectList.Select(this.key);A.options=this.options;return A},getElement:function(){this.select=N2i.create("select");for(var B=0;B<this.options.length;B++){this.select.options[this.select.options.length]=new Option(this.options[B].label,this.options[B].value)}var A=this;this.select.onchange=function(){A.object.valueDidChange()};return this.select},getValue:function(){return this.select.value},setValue:function(A){this.select.value=A},addOption:function(B,A){this.options.push({value:B,label:A})}};In2iGui.Alert=function(C,B,A){this.options=N2i.override({modal:false},A);this.element=$id(C);this.name=B;this.body=$firstClass("in2igui_alert_body",this.element);this.content=$firstClass("in2igui_alert_content",this.element);this.emotion=null;var D=$tag("h1",this.element);this.title=D.length>0?D[0]:null;In2iGui.extend(this)};In2iGui.Alert.create=function(C,B){B=N2i.override({title:"",text:"",emotion:null,variant:null,title:null},B);var D=new Element("div",{"class":"in2igui_alert"});var A=new Element("div",{"class":"in2igui_alert_body"});D.insert(A);var E=new Element("div",{"class":"in2igui_alert_content"});A.insert(E);document.body.appendChild(D);var F=new In2iGui.Alert(D,C,B);if(B.variant){F.setVariant(B.variant)}if(B.emotion){F.setEmotion(B.emotion)}if(B.title){F.setTitle(B.title)}if(B.text){F.setText(B.text)}return F};In2iGui.Alert.prototype={show:function(){var A=In2iGui.nextAlertIndex();if(this.options.modal){In2iGui.showCurtain(this,A);A++}this.element.style.zIndex=A;this.element.style.display="block";this.element.style.top=(N2i.Window.getScrollTop()+100)+"px";$ani(this.element,"opacity",1,200);$ani(this.element,"margin-top","40px",600,{ease:N2i.Animation.elastic})},hide:function(){$ani(this.element,"opacity",0,200,{hideOnComplete:true});$ani(this.element,"margin-top","0px",200);In2iGui.hideCurtain(this)},setTitle:function(A){if(!this.title){this.title=N2i.create("h1");this.content.appendChild(this.title)}this.title.innerHTML=A},setText:function(A){if(!this.text){this.text=N2i.create("p");this.content.appendChild(this.text)}this.text.innerHTML=A||""},setVariant:function(A){this.setEmotion(A)},setEmotion:function(A){if(this.emotion){N2i.removeClass(this.body,this.emotion)}this.emotion=A;N2i.addClass(this.body,A)},update:function(A){A=A||{};this.setTitle(A.title||null);this.setText(A.text||null);this.setVariant(A.variant||null);this.setEmotion(A.emotion||null)},addButton:function(A){if(!this.buttons){this.buttons=N2i.create("div",{"class":"in2igui_buttons"});this.body.appendChild(this.buttons)}this.buttons.appendChild(A.getElement())}};In2iGui.Button=function(B,A){this.name=A;this.element=$(B);this.inner=this.element.getElementsByTagName("span")[1];this.enabled=true;In2iGui.extend(this);this.addBehavior()};In2iGui.Button.create=function(B,H){var A={text:"",highlighted:false};N2i.override(A,H);var F="in2igui_button"+(A.highlighted?" in2igui_button_highlighted":"");var C=new Element("a",{"class":F});var G=new Element("span");C.appendChild(G);var E=new Element("span");G.appendChild(E);if(A.icon){var D=new Element("em",{"class":"in2igui_button_icon"}).setStyle({"backgroundImage":"url("+In2iGui.getIconUrl(A.icon,1)+")"});if(!A.text||A.text.length==0){D.addClassName("in2igui_button_icon_notext")}E.insert(D)}if(A.text&&A.text.length>0){E.insert(A.text)}if(A.title&&A.title.length>0){E.insert(A.title)}return new In2iGui.Button(C,B)};In2iGui.Button.prototype={addBehavior:function(){var A=this;this.element.onclick=function(){A.clicked()}},clicked:function(){if(this.enabled){In2iGui.callDelegates(this,"buttonWasClicked");In2iGui.callDelegates(this,"click")}},setEnabled:function(A){this.enabled=A;this.updateUI()},setHighlighted:function(A){N2i.setClass(this.element,"in2igui_button_highlighted",A)},updateUI:function(){N2i.setClass(this.element,"in2igui_button_disabled",!this.enabled)},setText:function(A){this.inner.innerHTML=A}};In2iGui.Buttons=function(B,A){this.name=A;this.element=$(B);In2iGui.extend(this)};In2iGui.Buttons.create=function(B,A){A=N2i.override({top:0},A);var C=new Element("div",{"class":"in2igui_buttons"});if(A.top>0){C.setStyle({paddingTop:A.top+"px"})}return new In2iGui.Buttons(C,B)};In2iGui.Buttons.prototype={add:function(A){this.element.insert(A.getElement())}};In2iGui.Selection=function(D,C,B){this.options=N2i.override({value:null},B);this.element=$(D);this.name=C;this.items=[];this.subItems=[];this.value=this.options.value;this.selected=[];In2iGui.extend(this);var A=this};In2iGui.Selection.create=function(B,A){A=N2i.override({width:0},A);var C=new Element("div",{"class":"in2igui_selection"});if(A.width>0){C.setStyle({width:A.width+"px"})}return new In2iGui.Selection(C,B,A)};In2iGui.Selection.prototype={getValue:function(){return this.value},getSelection:function(){for(var A=0;A<this.items.length;A++){if(this.items[A].value==this.value){return this.items[A]}}for(var A=0;A<this.subItems.length;A++){var B=this.subItems[A].getSelection();if(B){return B}}},setValue:function(C){this.value=C;for(var A=0;A<this.items.length;A++){var B=this.items[A];N2i.setClass(B.element,"selected",(B.value==C))}for(var A=0;A<this.subItems.length;A++){this.subItems[A].updateUI()}},changeValue:function(A){this.setValue(A);In2iGui.callDelegates(this,"selectorSelectionChanged");In2iGui.callDelegates(this,"selectionChanged",this.value)},registerItems:function(A){A.selection=this;this.subItems.push(A)},registerItem:function(H,G,E,A,F,D){var C=$(H);C.in2iGuiValue=F;this.items.push({id:H,title:G,icon:E,badge:A,element:C,value:F,kind:D});var B=this;C.onclick=function(){B.itemWasClicked(F)};C.ondblclick=function(){B.itemWasDoubleClicked();return false};C.dragDropInfo={kind:D,value:F};N2i.addClass(C,"droppable");N2i.addListener(C,"mouseover",In2iGui.dropOverListener);N2i.addListener(C,"mouseout",In2iGui.dropOutListener)},setObjects:function(B){var A=this;B.each(function(E){A.items.push(E);var D=new Element("div",{"class":"in2igui_selection_item"});E.element=D;A.element.insert(D);var C=new Element("span").update(E.title);if(E.icon){C.setStyle({"backgroundImage":"url("+In2iGui.getIconUrl(E.icon,1)+")"}).addClassName("in2igui_icon")}D.insert(C);D.observe("click",function(){A.changeValue(E.value)});D.observe("dblclick",function(){A.itemWasDoubleClicked();return false})})},itemWasClicked:function(A){this.changeValue(A)},itemWasDoubleClicked:function(){In2iGui.callDelegates(this,"selectorObjectWasOpened")}};In2iGui.Selection.Items=function(D,C,B){this.element=$(D);this.name=C;this.selection=null;this.options=N2i.override({source:null},B);this.items=[];In2iGui.extend(this);var A=this;if(this.options.source){this.options.source.addDelegate(this)}};In2iGui.Selection.Items.prototype={refresh:function(){if(this.options.source){this.options.source.refresh()}},itemsLoaded:function(D){this.items=[];N2i.removeChildren(this.element);var C=this;for(var E=0,A=D.length;E<A;++E){var G=D[E];var F=new Element("div",{"class":"in2igui_selection_item"});var B=new Element("span");if(G.icon){B.setStyle({"backgroundImage":"url("+In2iGui.getIconUrl(G.icon,1)+")"}).addClassName("in2igui_icon")}F.in2iGuiIndex=E;F.insert(B.insert(G.title));this.element.insert(F);F.observe("click",function(){C.itemWasClicked(C.items[this.in2iGuiIndex].value)});F.ondblclick=function(){C.itemWasDoubleClicked();return false};var H={title:G.title,icon:G.icon,badge:G.badge,kind:G.kind,element:F,value:G.value};F.dragDropInfo=H;this.items.push(H)}this.updateUI()},itemWasClicked:function(A){this.selection.changeValue(A)},itemWasDoubleClicked:function(A){this.selection.itemWasDoubleClicked()},getSelection:function(){for(var A=0;A<this.items.length;A++){if(this.items[A].value==this.selection.value){return this.items[A]}}return null},updateUI:function(){for(var A=0;A<this.items.length;A++){var B=this.items[A];N2i.setClass(B.element,"selected",(B.value==this.selection.value))}}};In2iGui.Toolbar=function(C,B,A){this.element=$id(C);this.name=B;In2iGui.extend(this)};In2iGui.Toolbar.create=function(B,A){var C=new Element("div",{"class":"in2igui_toolbar"});if(A&&A.labels==false){C.addClassName("in2igui_toolbar_nolabels")}return new In2iGui.Toolbar(C,B,A)};In2iGui.Toolbar.prototype={add:function(A){this.element.appendChild(A.getElement())},addDivider:function(){this.element.appendChild(N2i.create("div",{"class":"in2igui_divider"}))}};In2iGui.RevealingToolbar=function(C,B,A){this.element=$id(C);this.name=B;In2iGui.extend(this)};In2iGui.RevealingToolbar.create=function(C,B){var D=N2i.create("div",{"class":"in2igui_revealing_toolbar"},{"display":"none"});document.body.appendChild(D);var A=new In2iGui.RevealingToolbar(D,C,B);var E=In2iGui.Toolbar.create();A.setToolbar(E);return A};In2iGui.RevealingToolbar.prototype={setToolbar:function(A){this.toolbar=A;this.element.appendChild(A.getElement())},getToolbar:function(){return this.toolbar},show:function(A){this.element.style.display="";$ani(this.element,"height","58px",A?0:600,{ease:N2i.Animation.slowFastSlow})},hide:function(){$ani(this.element,"height","0px",500,{ease:N2i.Animation.slowFastSlow,hideOnComplete:true})}};In2iGui.Toolbar.Icon=function(B,A){this.element=$(B);this.name=A;this.enabled=!this.element.hasClassName("in2igui_toolbar_icon_disabled");this.icon=this.element.select(".in2igui_icon")[0];In2iGui.extend(this);this.addBehavior()};In2iGui.Toolbar.Icon.create=function(D,C){var E=new Element("div",{"class":"in2igui_toolbar_icon"});var G=new Element("div",{"class":"in2igui_icon"}).setStyle({"backgroundImage":"url("+In2iGui.getIconUrl(C.icon,2)+")"});var A=new Element("div",{"class":"in2igui_toolbar_inner_icon"});var F=new Element("div",{"class":"in2igui_toolbar_inner_icon"});E.insert(A);A.insert(F);var H=N2i.create("span");H.innerHTML=C.title;if(C.overlay){var B=N2i.create("div",{"class":"in2igui_icon_overlay"},{"backgroundImage":"url("+In2iGui.getIconUrl("overlay/"+C.overlay,2)+")"});G.insert(B)}F.insert(G);F.insert(H);return new In2iGui.Toolbar.Icon(E,D,C)};In2iGui.Toolbar.Icon.prototype={addBehavior:function(){var A=this;this.element.onclick=function(){A.wasClicked()}},setEnabled:function(A){this.enabled=A;N2i.setClass(this.element,"in2igui_toolbar_icon_disabled",!this.enabled)},wasClicked:function(){if(this.enabled){In2iGui.callDelegates(this,"toolbarIconWasClicked");In2iGui.callDelegates(this,"click")}}};In2iGui.Toolbar.SearchField=function(B,A){this.element=$(B);this.name=A;this.field=this.element.select("input")[0];this.value=this.field.value;In2iGui.extend(this);this.addBehavior()};In2iGui.Toolbar.SearchField.prototype={getValue:function(){return this.field.value},addBehavior:function(){var A=this;this.field.onkeyup=function(){A.fieldChanged()};this.field.onfocus=function(){$ani(this,"width","120px",500,{ease:N2i.Animation.slowFastSlow})};this.field.onblur=function(){$ani(this,"width","80px",500,{ease:N2i.Animation.slowFastSlow})}},fieldChanged:function(){if(this.field.value!=this.value){this.value=this.field.value;In2iGui.callDelegates(this,"valueChanged");In2iGui.fireValueChange(this,"value",this.value)}}};In2iGui.Toolbar.Badge=function(B,A){this.element=$(B);this.name=A;this.label=this.element.select("strong")[0];this.text=this.element.select("span")[0];In2iGui.extend(this)};In2iGui.Toolbar.Badge.prototype={setLabel:function(A){this.label.update(A)},setText:function(A){this.text.update(A)}};In2iGui.ImagePicker=function(C,B,A){this.id=C;this.name=B;this.options=A||{};this.element=$id(C);this.images=[];this.object=null;this.thumbnailsLoaded=false;In2iGui.extend(this);this.addBehavior()};In2iGui.ImagePicker.prototype={addBehavior:function(){var A=this;this.element.onclick=function(){A.showPicker()}},setObject:function(A){this.object=A;this.updateUI()},getObject:function(){return this.object},reset:function(){this.object=null;this.updateUI()},updateUI:function(){if(this.object==null){this.element.style.backgroundImage=""}else{var A=In2iGui.callDelegates(this,"getImageUrl");this.element.style.backgroundImage="url("+A+")"}},showPicker:function(){if(!this.picker){var B=this;this.picker=In2iGui.BoundPanel.create();this.content=N2i.create("div",{"class":"in2igui_imagepicker_thumbs"});var C=N2i.create("div",{"class":"in2igui_imagepicker_buttons"});var D=In2iGui.Button.create(null,{text:"Luk",highlighted:true});D.addDelegate({click:function(){B.hidePicker()}});var A=In2iGui.Button.create(null,{text:"Fjern"});A.addDelegate({click:function(){B.setObject(null);B.hidePicker()}});C.appendChild(D.getElement());C.appendChild(A.getElement());this.picker.add(this.content);this.picker.add(C)}this.picker.position(this.element);this.picker.show();if(!this.thumbnailsLoaded){this.updateImages();this.thumbnailsLoaded=true}},hidePicker:function(){this.picker.hide()},updateImages:function(){var A=this;var B={onXML:function(C){A.parse(C)}};$get(this.options.source,B)},parse:function(F){N2i.removeChildren(this.content);var A=F.getElementsByTagName("image");var C=this;for(var E=0;E<A.length&&E<50;E++){var G=A[E].getAttribute("id");var D="../../../util/images/?id="+G+"&maxwidth=48&maxheight=48&format=jpg";var B=N2i.create("div",{"class":"in2igui_imagepicker_thumbnail"},{"backgroundImage":"url("+D+")"});B.in2iguiObject={"id":G};B.onclick=function(){C.setObject(this.in2iguiObject);C.hidePicker()};this.content.appendChild(B)}}};In2iGui.BoundPanel=function(B,A){this.element=$(B);this.visible=false;this.content=this.element.select(".content")[0];this.arrow=this.element.select(".arrow")[0];In2iGui.extend(this)};In2iGui.BoundPanel.create=function(D){var A={name:null,top:"0px",left:"0px"};N2i.override(A,D);var C=N2i.create("div",{"class":"in2igui_boundpanel"},{"display":"none","zIndex":In2iGui.nextPanelIndex(),"top":A.top,"left":A.left});var B='<div class="arrow"></div><div class="top"><div><div></div></div></div><div class="body"><div class="body"><div class="body"><div class="content" style="';if(A.width){B+="width:"+A.width+"px;"}if(A.padding){B+="padding:"+A.padding+"px;"}B+='"></div></div></div></div><div class="bottom"><div><div></div></div></div>';C.innerHTML=B;document.body.appendChild(C);return new In2iGui.BoundPanel(C)};In2iGui.BoundPanel.prototype={show:function(){if(!this.visible){if(!N2i.isIE()){N2i.setOpacity(this.element,0)}if(this.relativePosition=="left"){this.element.style.marginLeft="30px"}else{this.element.style.marginLeft="-30px"}this.element.setStyle({visibility:"hidden",display:"block"});var A=this.element.clientWidth;this.element.setStyle({width:A+"px",visibility:"visible"});this.element.style.marginTop="0px";this.element.style.display="block";if(!N2i.isIE()){$ani(this.element,"opacity",1,400,{ease:N2i.Animation.fastSlow})}$ani(this.element,"margin-left","0px",800,{ease:N2i.Animation.bounce})}this.element.style.zIndex=In2iGui.nextPanelIndex();this.visible=true},hide:function(){if(N2i.isIE()){this.element.style.display="none"}else{$ani(this.element,"opacity",0,300,{ease:N2i.Animation.slowFast,hideOnComplete:true})}this.visible=false},add:function(A){if(A.getElement){this.content.appendChild(A.getElement())}else{this.content.appendChild(A)}},addSpace:function(A){this.add(new Element("div").setStyle({fontSize:"0px",height:A+"px"}))},getDimensions:function(){if(this.element.style.display=="none"){this.element.style.visibility="hidden";this.element.style.display="block";var B=N2i.getWidth(this.element);var A=N2i.getHeight(this.element);this.element.style.display="none";this.element.style.visibility=""}else{var B=N2i.getWidth(this.element);var A=N2i.getHeight(this.element)}return{width:B,height:A}},position:function(C){C=$(C);var F=C.cumulativeOffset();var G=C.cumulativeScrollOffset();var J=this.getDimensions();var D=N2i.Window.getInnerWidth();var L=F.left-G.left+N2i.Window.getScrollLeft();var K=N2i.getWidth(C);var A=N2i.getHeight(C);var E=F.top-G.top+N2i.Window.getScrollTop();if((L+K/2)/D<0.5){this.relativePosition="left";var B=L+K+10;this.arrow.className="arrow arrow_left";var H=-14}else{this.relativePosition="right";var B=L-J.width-10;this.arrow.className="arrow arrow_right";var H=J.width-4}var I=Math.max(0,E+(A-J.height)/2);this.arrow.style.marginTop=(J.height-32)/2+Math.min(0,E+(A-J.height)/2)+"px";this.arrow.style.marginLeft=H+"px";if(this.visible){$ani(this.element,"top",I+"px",500,{ease:N2i.Animation.fastSlow});$ani(this.element,"left",B+"px",500,{ease:N2i.Animation.fastSlow})}else{this.element.style.top=I+"px";this.element.style.left=B+"px"}}};In2iGui.RichText=function(C,B,A){this.element=$id(C);this.options=N2i.override({debug:false,value:"",autoHideToolbar:true,style:"font-family: sans-serif;"},A);this.iframe=this.element.getElementsByTagName("iframe")[0];this.toolbar=$firstClass("in2igui_richtext_toolbar",this.element);this.toolbarContent=$firstClass("in2igui_richtext_toolbar_content",this.element);this.value=this.options.value;this.document=null;this.buildToolbar();this.ignite();In2iGui.extend(this)};In2iGui.RichText.actions=[{key:"bold",cmd:"bold",value:null,icon:"edit/text_bold"},{key:"italic",cmd:"italic",value:null,icon:"edit/text_italic"},{key:"underline",cmd:"underline",value:null,icon:"edit/text_underline"},null,{key:"justifyleft",cmd:"justifyleft",value:null,icon:"edit/text_align_left"},{key:"justifycenter",cmd:"justifycenter",value:null,icon:"edit/text_align_center"},{key:"justifyright",cmd:"justifyright",value:null,icon:"edit/text_align_right"},null,{key:"increasefontsize",cmd:"increasefontsize",value:null,icon:"edit/increase_font_size"},{key:"decreasefontsize",cmd:"decreasefontsize",value:null,icon:"edit/decrease_font_size"},{key:"color",cmd:null,value:null,icon:"common/color"}];In2iGui.RichText.replaceInput=function(B){var A=$id(B.input);A.style.display="none";B.value=A.value;var C=In2iGui.RichText.create(B);A.parentNode.insertBefore(C.element,A);C.ignite()};In2iGui.RichText.create=function(B,A){var E=N2i.create("div",{"class":"in2igui_richtext"});var D=N2i.create("div",{"class":"in2igui_richtext_toolbar"});E.appendChild(D);var C=N2i.create("iframe",{frameborder:0});E.appendChild(C);D.innerHTML='<div class="in2igui_richtext_inner_toolbar"><div class="in2igui_richtext_toolbar_content"></div></div>';return new In2iGui.RichText(E,B,A)};In2iGui.RichText.prototype={ignite:function(){this.setupIframe()},isCompatible:function(){var A=navigator.userAgent.toLowerCase();return true;return(A.indexOf("msie 6")>-1||A.indexOf("msie 7")>-1||(A.indexOf("gecko")>-1&&A.indexOf("safari")<0))},setupIframe:function(){var A=this;if(!this.iframe.contentWindow){return }this.window=this.iframe.contentWindow;this.document=this.iframe.contentDocument||this.window.document;this.document.designMode="on";this.document.open();this.document.write("<html><head><style>body{margin:0px;"+this.options.style+"}</style></head><body>"+this.value+"</body></html>");this.document.close();this.document.body.style.minHeight="100%";this.document.documentElement.style.cursor="text";this.document.documentElement.style.minHeight="100%";this.window.onkeypress=function(){A.documentChanged()};N2i.Event.addListener(this.window,"focus",function(){A.documentFocused()});N2i.Event.addListener(this.window,"blur",function(){A.documentBlurred()});N2i.Event.addListener(this.window,"keyup",function(){A.documentChanged()})},setHeight:function(A){this.iframe.style.height=A+"px"},focus:function(){try{var A=this.document.createRange();A.selectNodeContents(this.document.body);this.window.getSelection().addRange(A)}catch(B){}this.window.focus()},setValue:function(A){this.value=A;this.document.body.innerHTML=A},getValue:function(){return this.value},deactivate:function(){if(this.colorPicker){this.colorPicker.hide()}},buildToolbar:function(){var B=this;var D=In2iGui.RichText.actions;for(var C=0;C<D.length;C++){if(D[C]==null){this.toolbarContent.appendChild(N2i.create("div",{"class":"in2igui_richtext_divider"}))}else{var E=new Element("div").addClassName("action action_"+D[C].key);E.title=D[C].key;E.in2iguiRichTextAction=D[C];E.onclick=E.ondblclick=function(F){return B.actionWasClicked(this.in2iguiRichTextAction,F)};var A=new Element("img");A.src=In2iGui.context+"/In2iGui/gfx/trans.png";if(D[C].icon){E.setStyle({"backgroundImage":"url("+In2iGui.getIconUrl(D[C].icon,1)+")"})}E.insert(A);this.toolbarContent.appendChild(E);E.onmousedown=In2iGui.RichText.stopEvent}}},documentFocused:function(){if(N2i.isIE()){this.toolbar.style.display="block";return }if(this.toolbar.style.display!="block"){this.toolbar.style.marginTop="-40px";N2i.setOpacity(this.toolbar,0);this.toolbar.style.display="block";$ani(this.toolbar,"opacity",1,300);$ani(this.toolbar,"margin-top","-32px",300)}},documentBlurred:function(){if(this.options.autoHideToolbar){if(N2i.isIE()){var A=this;window.setTimeout(function(){A.toolbar.style.display="none"},100);return }$ani(this.toolbar,"opacity",0,300,{hideOnComplete:true});$ani(this.toolbar,"margin-top","-40px",300)}this.documentChanged();In2iGui.callDelegates(this,"richTextDidChange")},documentChanged:function(){this.value=this.document.body.innerHTML;if(this.options.input){$id(this.options.input).value=this.value}},disabler:function(B){var A=B?B:window.event;if(A.returnValue){A.returnValue=false}else{if(A.preventDefault){A.preventDefault()}}return false},actionWasClicked:function(A,B){In2iGui.RichText.stopEvent(B);if(A.key=="color"){this.showColorPicker()}else{this.execCommand(A)}this.document.body.focus();this.documentChanged();return false},execCommand:function(A){this.document.execCommand(A.cmd,false,A.value);this.documentChanged()},showColorPicker:function(){if(!this.colorPicker){var A=In2iGui.Window.create(null,{variant:"dark"});var B=In2iGui.ColorPicker.create();B.addDelegate(this);A.add(B);A.show();this.colorPicker=A}this.colorPicker.show()},colorWasHovered:function(A){},colorWasSelected:function(A){this.document.execCommand("forecolor",false,A);this.documentChanged()}};In2iGui.RichText.stopEvent=function(B){var A=B?B:window.event;if(A.returnValue){A.returnValue=false}else{if(A.preventDefault){A.preventDefault()}else{return false}}};In2iGui.ImageViewer=function(C,B,A){this.options=N2i.override({maxWidth:800,maxHeight:600},A);this.element=$(C);this.box=this.options.box;this.viewer=this.element.select(".in2igui_imageviewer_viewer")[0];this.innerViewer=this.element.select(".in2igui_imageviewer_inner_viewer")[0];this.status=this.element.select(".in2igui_imageviewer_status")[0];this.previousControl=this.element.select(".in2igui_imageviewer_previous")[0];this.controller=this.element.select(".in2igui_imageviewer_controller")[0];this.nextControl=this.element.select(".in2igui_imageviewer_next")[0];this.playControl=this.element.select(".in2igui_imageviewer_play")[0];this.text=this.element.select(".in2igui_imageviewer_text")[0];this.dirty=false;this.width=600;this.height=460;this.index=0;this.playing=false;this.name=B;this.images=[];this.box.addDelegate(this);this.addBehavior();In2iGui.extend(this)};In2iGui.ImageViewer.create=function(B,A){A=A||{};var C=new Element("div",{"class":"in2igui_imageviewer"});C.update('<div class="in2igui_imageviewer_viewer"><div class="in2igui_imageviewer_inner_viewer"></div></div><div class="in2igui_imageviewer_text"></div><div class="in2igui_imageviewer_status"></div><div class="in2igui_imageviewer_controller"><a class="in2igui_imageviewer_previous"></a><a class="in2igui_imageviewer_play"></a><a class="in2igui_imageviewer_next"></a></div>');var D=In2iGui.Box.create(null,{absolute:true,modal:true});D.add(C);D.addToDocument();A.box=D;return new In2iGui.ImageViewer(C,B,A)};In2iGui.ImageViewer.prototype={addBehavior:function(){var A=this;this.nextControl.onclick=function(){A.next(true)};this.previousControl.onclick=function(){A.previous(true)};this.playControl.onclick=function(){A.playOrPause()};this.viewer.onclick=function(){A.hide()};this.timer=function(){A.next(false)};this.keyListener=function(C){var B=new N2i.Event(C);if(B.isRightKey()){A.next(true)}else{if(B.isLeftKey()){A.previous(true)}else{if(B.isEscapeKey()){A.hide()}else{if(B.isReturnKey()){A.playOrPause()}}}}}},getLargestSize:function(A,B){if(B.width<=A.width&&B.height<=A.height){return{width:B.width,height:B.height}}else{if(A.width/A.height>B.width/B.height){return{width:A.height/B.height*B.width,height:A.height}}else{if(A.width/A.height<B.width/B.height){return{width:A.width,height:A.width/B.width*B.height}}else{return{width:A.width,height:A.height}}}}},calculateSize:function(){var E=N2i.Window.getInnerWidth()-100;E=Math.floor(E/100)*100;E=Math.min(E,this.options.maxWidth);var A=N2i.Window.getInnerHeight()-100;A=Math.floor(A/100)*100;A=Math.min(A,this.options.maxHeight);var D=0;var C=0;for(var B=0;B<this.images.length;B++){N2i.log("********************");N2i.log({width:E,height:A});N2i.log(this.images[B]);var F=this.getLargestSize({width:E,height:A},this.images[B]);D=Math.max(D,F.width);C=Math.max(C,F.height);N2i.log(F)}A=Math.round(Math.min(A,C));E=Math.round(Math.min(E,D));if(E!=this.width||A!=this.height){this.width=E;this.height=A;this.dirty=true}},showById:function(B){for(var A=0;A<this.images.length;A++){if(this.images[A].id==B){this.show(A);break}}},show:function(A){this.index=A||0;this.calculateSize();this.updateUI();var B=this.shouldShowController()?50:5;this.element.setStyle({width:(this.width+10)+"px",height:(this.height+B)+"px"});this.viewer.setStyle({width:(this.width+10)+"px",height:this.height+"px"});this.innerViewer.setStyle({width:((this.width+10)*this.images.length)+"px",height:this.height+"px"});this.controller.setStyle({marginLeft:((this.width-115)/2+5)+"px"});this.box.show();this.goToImage(false,0,false);N2i.addListener(document,"keydown",this.keyListener)},hide:function(A){this.pause();this.box.hide();N2i.removeListener(document,"keydown",this.keyListener)},boxCurtainWasClicked:function(){this.hide()},updateUI:function(){if(this.dirty){this.innerViewer.innerHTML="";for(var C=0;C<this.images.length;C++){var A=this.resolveImageUrl(this.images[C]);A=A.replace(/&amp;/,"&");var B=N2i.create("div",{"class":"in2igui_imageviewer_image"},{"width":(this.width+10)+"px","height":this.height+"px"});var A=this.resolveImageUrl(this.images[C]);A=A.replace(/&amp;/g,"&");this.innerViewer.appendChild(B)}if(this.shouldShowController()){this.controller.show()}else{this.controller.hide()}this.dirty=false;this.preload()}},shouldShowController:function(){return this.images.length>1},goToImage:function(C,D,B){if(C){if(D>1){$ani(this.viewer,"scrollLeft",this.index*(this.width+10),Math.min(D*300,2000),{ease:N2i.Animation.slowFastSlow})}else{var A=this.index==0||this.index==this.images.length-1;var F=(A?N2i.Animation.bounce:N2i.Animation.elastic);if(!B){F=N2i.Animation.slowFastSlow}$ani(this.viewer,"scrollLeft",this.index*(this.width+10),(A?800:1200),{ease:F})}}else{this.viewer.scrollLeft=this.index*(this.width+10)}var E=this.images[this.index].text;if(E){this.text.update(E).show()}else{this.text.update().hide()}},clearImages:function(){this.images=[];this.dirty=true},addImages:function(A){for(var B=0;B<A.length;B++){this.addImage(A[B])}},addImage:function(A){this.images.push(A);this.dirty=true},resolveImageUrl:function(A){for(var B=0;B<this.delegates.length;B++){if(this.delegates[B].resolveImageUrl){return this.delegates[B].resolveImageUrl(A,this.width,this.height)}}return null},play:function(){if(!this.interval){this.interval=window.setInterval(this.timer,6000)}this.next(false);this.playing=true;this.playControl.className="in2igui_imageviewer_pause"},pause:function(){window.clearInterval(this.interval);this.interval=null;this.playControl.className="in2igui_imageviewer_play";this.playing=false},playOrPause:function(){if(this.playing){this.pause()}else{this.play()}},resetPlay:function(){if(this.playing){window.clearInterval(this.interval);this.interval=window.setInterval(this.timer,6000)}},previous:function(A){var B=1;this.index--;if(this.index<0){this.index=this.images.length-1;B=this.images.length-1}this.goToImage(true,B,A);this.resetPlay()},next:function(A){var B=1;this.index++;if(this.index==this.images.length){this.index=0;B=this.images.length-1}this.goToImage(true,B,A);this.resetPlay()},preload:function(){var B=new N2i.Preloader();B.addImages(In2iGui.context+"In2iGui/gfx/imageviewer_controls.png");var A=this;B.setDelegate({allImagesDidLoad:function(){A.preloadImages()}});B.load()},preloadImages:function(){this.loader=new N2i.Preloader();this.loader.setDelegate(this);for(var A=0;A<this.images.length;A++){this.loader.addImages(this.resolveImageUrl(this.images[A]))}this.status.innerHTML="0%";this.status.style.display="";this.loader.load()},allImagesDidLoad:function(){this.status.style.display="none"},imageDidLoad:function(C,D,B){this.status.innerHTML=Math.round(C/D*100)+"%";var A=this.resolveImageUrl(this.images[B]);A=A.replace(/&amp;/g,"&");this.innerViewer.childNodes[B].style.backgroundImage="url('"+A+"')";N2i.setClass(this.innerViewer.childNodes[B],"in2igui_imageviewer_image_abort",false);N2i.setClass(this.innerViewer.childNodes[B],"in2igui_imageviewer_image_error",false)},imageDidGiveError:function(B,C,A){N2i.setClass(this.innerViewer.childNodes[A],"in2igui_imageviewer_image_error",true)},imageDidAbort:function(B,C,A){N2i.setClass(this.innerViewer.childNodes[A],"in2igui_imageviewer_image_abort",true)}};In2iGui.Picker=function(C,B,A){this.options=N2i.override({itemWidth:100,itemHeight:150,itemsVisible:3,valueProperty:"value"},A);this.element=$(C);this.name=B;this.container=this.element.select(".in2igui_picker_container")[0];this.content=this.element.select(".in2igui_picker_content")[0];this.title=this.element.select("in2igui_picker_title")[0];this.objects=[];this.selected=null;this.value=null;this.addBehavior();In2iGui.extend(this)};In2iGui.Picker.create=function(B,A){A=N2i.override({shadow:true},A);var C=new Element("div",{"class":"in2igui_picker"});C.update('<div class="in2igui_picker_top"><div><div></div></div></div><div class="in2igui_picker_middle"><div class="in2igui_picker_middle">'+(A.title?'<div class="in2igui_picker_title">'+A.title+"</div>":"")+'<div class="in2igui_picker_container"><div class="in2igui_picker_content"></div></div></div></div><div class="in2igui_picker_bottom"><div><div></div></div></div>');if(A.shadow==true){C.addClassName("in2igui_picker_shadow")}return new In2iGui.Picker(C,B,A)};In2iGui.Picker.prototype={addBehavior:function(){var A=this;this.content.observe("mousedown",function(B){A.startDrag(B);return false})},setObjects:function(A){this.selected=null;this.objects=A||[];this.updateUI()},setValue:function(A){this.value=A;this.updateSelection()},reset:function(){this.value=null;this.updateSelection()},updateUI:function(){var A=this;this.content.update();this.container.scrollLeft=0;this.container.setStyle({width:this.options.itemsVisible*(this.options.itemWidth+14)+"px"});this.container.style.height=(this.options.itemHeight+10)+"px";this.content.style.width=(this.objects.length*(this.options.itemWidth+14))+"px";this.content.style.height=(this.options.itemHeight+10)+"px";this.objects.each(function(B,C){var D=new Element("div",{"class":"in2igui_picker_item",title:B.title});if(A.value!=null&&B[A.options.valueProperty]==A.value){D.addClassName("in2igui_picker_item_selected")}D.update('<div class="in2igui_picker_item_middle"><div class="in2igui_picker_item_middle"><div style="width:'+A.options.itemWidth+"px;height:"+A.options.itemHeight+"px;background-image:url('"+B.image+'\')"></div></div></div><div class="in2igui_picker_item_bottom"><div><div></div></div></div>');D.observe("mouseup",function(){A.selectionChanged(B[A.options.valueProperty])});A.content.insert(D)})},updateSelection:function(){var B=this.content.childNodes;for(var A=0;A<B.length;A++){N2i.setClass(B[A],"in2igui_picker_item_selected",this.value!=null&&this.objects[A][this.options.valueProperty]==this.value)}},selectionChanged:function(A){if(this.dragging){return }if(this.value==A){return }this.value=A;this.updateSelection();In2iGui.callDelegates(this,"selectionChanged",A)},startDrag:function(B){Event.stop(B);var A=this;this.dragX=Event.pointerX(B);this.dragScroll=this.container.scrollLeft;In2iGui.Picker.mousemove=function(C){A.drag(C);return false};In2iGui.Picker.mouseup=In2iGui.Picker.mousedown=function(C){A.endDrag(C);return false};window.document.observe("mousemove",In2iGui.Picker.mousemove);window.document.observe("mouseup",In2iGui.Picker.mouseup);window.document.observe("mousedown",In2iGui.Picker.mouseup)},drag:function(A){this.dragging=true;Event.stop(A);this.container.scrollLeft=this.dragX-A.pointerX()+this.dragScroll},endDrag:function(B){this.dragging=false;Event.stop(B);window.document.stopObserving("mousemove",In2iGui.Picker.mousemove);window.document.stopObserving("mouseup",In2iGui.Picker.mouseup);window.document.stopObserving("mousedown",In2iGui.Picker.mouseup);var A=(this.options.itemWidth+14);$ani(this.container,"scrollLeft",Math.round(this.container.scrollLeft/A)*A,500,{ease:N2i.ease.bounceOut})}};In2iGui.Editor=function(C,B,A){this.name="In2iGuiEditor";this.parts=[];this.rows=[];this.partControllers=[];this.activePart=null;this.active=false;this.dragProxy=null};In2iGui.Editor.get=function(){if(!In2iGui.Editor.instance){In2iGui.Editor.instance=new In2iGui.Editor()}return In2iGui.Editor.instance};In2iGui.Editor.prototype={ignite:function(A){this.reload()},addPartController:function(B,C,A){this.partControllers.push({key:B,"title":C,"controller":A})},getPartController:function(A){var B=null;this.partControllers.each(function(C){if(C.key==A){B=C}});return B},reload:function(){if(this.partControls){this.partControls.hide()}var A=this;this.parts=[];var B=$$(".row");B.each(function(F,E){var D=F.select(".column");A.reloadColumns(D,E);D.each(function(H,G){var I=H.select(".part");A.reloadParts(I,E,G)})});var C=$$(".part");this.parts.each(function(D){var E=C.indexOf(D.element);if(E!=-1){delete (C[E])}});this.reloadParts(C,-1,-1)},partExists:function(A){},reloadColumns:function(B,C){var A=this;B.each(function(E,D){E.observe("mouseover",function(){A.hoverColumn(E)});E.observe("mouseout",function(){A.blurColumn()});E.observe("contextmenu",function(F){A.contextColumn(E,C,D,F)})})},reloadParts:function(C,D,B){var A=this;C.each(function(G,I){if(!G){return }var F=G.className.match(/part_([\w]+)/i);if(F&&F[1]){var H=A.getPartController(F[1]);if(H){var E=new H.controller(G,D,B,I);E.type=F[1];G.observe("click",function(){A.editPart(E)});G.observe("mouseover",function(J){A.hoverPart(E)});G.observe("mouseout",function(J){A.blurPart(J)});G.observe("mousedown",function(J){A.startPartDrag(J)});A.parts.push(E)}}})},activate:function(){this.active=true},deactivate:function(){this.active=false;if(this.activePart){this.activePart.deactivate()}if(this.partControls){this.partControls.hide()}},hoverColumn:function(A){this.hoveredColumn=A;if(!this.active||this.activePart){return }A.addClassName("in2igui_editor_column_hover")},blurColumn:function(){if(!this.active||!this.hoveredColumn){return }this.hoveredColumn.removeClassName("in2igui_editor_column_hover")},contextColumn:function(B,E,A,C){if(!this.active||this.activePart){return }if(!this.columnMenu){var D=In2iGui.Menu.create("In2iGuiEditorColumnMenu");D.addItem({title:"Slet kolonne",value:"removeColumn"});D.addItem({title:"Tilfj kolonne",value:"addColumn"});this.partControllers.each(function(F){D.addItem({title:F.title,value:F.key})});this.columnMenu=D;D.addDelegate(this)}this.hoveredRow=E;this.hoveredColumnIndex=A;this.columnMenu.showAtPointer(C)},itemWasClicked$In2iGuiEditorColumnMenu:function(A){if(A=="removeColumn"){In2iGui.callDelegates(this,"removeColumn",{"row":this.hoveredRow,"column":this.hoveredColumnIndex})}else{if(A=="addColumn"){In2iGui.callDelegates(this,"addColumn",{"row":this.hoveredRow,"position":this.hoveredColumnIndex+1})}else{In2iGui.callDelegates(this,"addPart",{"row":this.hoveredRow,"column":this.hoveredColumnIndex,"position":0,type:A})}}},hoverPart:function(B,C){if(!this.active||this.activePart){return }this.hoveredPart=B;B.element.addClassName("in2igui_editor_part_hover");var A=this;this.partControlTimer=window.setTimeout(function(){A.showPartControls()},200)},blurPart:function(A){window.clearTimeout(this.partControlTimer);if(!this.active){return }if(this.partControls&&!In2iGui.isWithin(A,this.partControls.element)){this.hidePartControls();this.hoveredPart.element.removeClassName("in2igui_editor_part_hover")}if(!this.partControls){this.hoveredPart.element.removeClassName("in2igui_editor_part_hover")}},showPartEditControls:function(){if(!this.partEditControls){this.partEditControls=In2iGui.Overlay.create("In2iGuiEditorPartEditActions");this.partEditControls.addIcon("save","common/save");this.partEditControls.addIcon("cancel","common/close");this.partEditControls.addDelegate(this)}this.partEditControls.showAtElement(this.activePart.element,{"horizontal":"right","vertical":"topOutside"})},showPartControls:function(){if(!this.partControls){this.partControls=In2iGui.Overlay.create("In2iGuiEditorPartActions");this.partControls.addIcon("edit","common/edit");this.partControls.addIcon("new","common/new");this.partControls.addIcon("delete","common/delete");var A=this;this.partControls.getElement().observe("mouseout",function(B){A.blurControls(B)});this.partControls.getElement().observe("mouseover",function(B){A.hoverControls(B)});this.partControls.addDelegate(this)}if(this.hoveredPart.column==-1){this.partControls.hideIcons(["new","delete"])}else{this.partControls.showIcons(["new","delete"])}this.partControls.showAtElement(this.hoveredPart.element,{"horizontal":"right"})},hoverControls:function(A){this.hoveredPart.element.addClassName("in2igui_editor_part_hover")},blurControls:function(A){this.hoveredPart.element.removeClassName("in2igui_editor_part_hover");if(!In2iGui.isWithin(A,this.hoveredPart.element)){this.hidePartControls()}},iconWasClicked$In2iGuiEditorPartActions:function(A,B){if(A=="delete"){this.deletePart(this.hoveredPart)}else{if(A=="new"){this.newPart(B)}else{if(A=="edit"){this.editPart(this.hoveredPart)}}}},iconWasClicked$In2iGuiEditorPartEditActions:function(A,B){if(A=="cancel"){this.cancelPart(this.activePart)}else{if(A=="save"){this.savePart(this.activePart)}}},hidePartControls:function(){if(this.partControls){this.partControls.hide()}},hidePartEditControls:function(){if(this.partEditControls){this.partEditControls.hide()}},editPart:function(A){if(!this.active||this.activePart){return }if(this.activePart){this.activePart.deactivate()}this.hoveredPart.element.removeClassName("in2igui_editor_part_hover");this.activePart=A;this.showPartEditControls();A.element.addClassName("in2igui_editor_part_active");A.activate();window.clearTimeout(this.partControlTimer);this.hidePartControls();this.blurColumn()},cancelPart:function(A){A.cancel()},savePart:function(A){A.save()},getEditorForElement:function(B){for(var A=0;A<this.parts.length;A++){if(this.parts[A].element==B){return this.parts[A]}}return null},partDidDeacivate:function(A){A.element.removeClassName("in2igui_editor_part_active");this.activePart=null;this.hidePartEditControls()},partChanged:function(A){In2iGui.callDelegates(A,"partChanged")},deletePart:function(A){In2iGui.callDelegates(A,"deletePart");this.partControls.hide()},newPart:function(A){if(!this.newPartMenu){var B=In2iGui.Menu.create("In2iGuiEditorNewPartMenu");this.partControllers.each(function(C){B.addItem({title:C.title,value:C.key})});B.addDelegate(this);this.newPartMenu=B}this.newPartMenu.showAtPointer(A)},itemWasClicked$In2iGuiEditorNewPartMenu:function(A){var B={row:this.hoveredPart.row,column:this.hoveredPart.column,position:this.hoveredPart.position+1,type:A};In2iGui.callDelegates(this,"addPart",B)},startPartDrag:function(B){return true;if(!this.active||this.activePart){return true}if(!this.dragProxy){this.dragProxy=new Element("div").addClassName("in2igui_editor_dragproxy part part_header");document.body.appendChild(this.dragProxy)}var A=this.hoveredPart.element;this.dragProxy.setStyle({"width":A.getWidth()+"px"});this.dragProxy.innerHTML=A.innerHTML;In2iGui.Editor.startDrag(B,this.dragProxy);return ;Element.observe(document.body,"mouseup",function(){self.endPartDrag()})},dragPart:function(){},endPartDrag:function(){In2iGui.get()}};In2iGui.Editor.startDrag=function(B,A){In2iGui.Editor.dragElement=A;Element.observe(document.body,"mousemove",In2iGui.Editor.dragListener);Element.observe(document.body,"mouseup",In2iGui.Editor.dragEndListener);In2iGui.Editor.startDragPos={top:B.pointerY(),left:B.pointerX()};B.stop();return false};In2iGui.Editor.dragListener=function(B){var A=In2iGui.Editor.dragElement;A.style.left=B.pointerX()+"px";A.style.top=B.pointerY()+"px";A.style.display="block";return false};In2iGui.Editor.dragEndListener=function(A){Event.stopObserving(document.body,"mousemove",In2iGui.Editor.dragListener);Event.stopObserving(document.body,"mouseup",In2iGui.Editor.dragEndListener);In2iGui.Editor.dragElement.style.display="none";In2iGui.Editor.dragElement=null};In2iGui.Editor.Header=function(B,D,C,A){this.element=$(B);this.row=D;this.column=C;this.position=A;this.id=this.element.id.match(/part\-([\d]+)/i)[1];this.header=$tag("*",this.element)[0];this.field=null};In2iGui.Editor.Header.prototype={activate:function(){this.value=this.header.innerHTML;this.field=new Element("textarea").addClassName("in2igui_editor_header");this.field.value=this.value;this.header.style.visibility="hidden";this.updateFieldStyle();this.element.insertBefore(this.field,this.header);this.field.focus();this.field.select();var A=this;this.field.onblur=function(){};this.field.onkeydown=function(B){if(new N2i.Event(B).isReturnKey()){A.save()}}},save:function(){var A=this.field.value;this.header.innerHTML=A;this.deactivate();if(A!=this.value){this.value=A;In2iGui.Editor.get().partChanged(this)}},cancel:function(){this.deactivate()},deactivate:function(){this.header.style.visibility="";this.element.removeChild(this.field);In2iGui.Editor.get().partDidDeacivate(this)},updateFieldStyle:function(){this.field.style.width=N2i.getWidth(this.header)+"px";this.field.style.height=N2i.getHeight(this.header)+"px";this.field.style.fontSize=N2i.getStyle(this.header,"font-size");this.field.style.fontWeight=N2i.getStyle(this.header,"font-weight");this.field.style.fontFamily=N2i.getStyle(this.header,"font-family");this.field.style.textAlign=N2i.getStyle(this.header,"text-align");this.field.style.color=N2i.getStyle(this.header,"color")},getValue:function(){return this.value}};In2iGui.Editor.Html=function(B,D,C,A){this.element=$(B);this.row=D;this.column=C;this.position=A;this.id=this.element.id.match(/part\-([\d]+)/i)[1];this.field=null};In2iGui.Editor.Html.prototype={activate:function(){this.value=this.element.innerHTML;if(Prototype.Browser.IE){return }var A=this.element.getHeight();this.element.update("");var B=this.getStyle();this.editor=In2iGui.RichText.create(null,{autoHideToolbar:false,style:B});this.editor.setHeight(A);this.element.appendChild(this.editor.getElement());this.editor.addDelegate(this);this.editor.ignite();this.editor.setValue(this.value);this.editor.focus()},getStyle:function(){var A="";A+="text-align:"+N2i.getStyle(this.element,"text-align")+";";A+="font-family:"+N2i.getStyle(this.element,"font-family")+";";A+="font-size:"+N2i.getStyle(this.element,"font-size")+";";A+="font-weight:"+N2i.getStyle(this.element,"font-weight")+";";A+="color:"+N2i.getStyle(this.element,"color")+";";return A},cancel:function(){this.deactivate();this.element.innerHTML=this.value},save:function(){this.deactivate();if(Prototype.Browser.IE){return }var A=this.editor.value;if(A!=this.value){this.value=A;In2iGui.Editor.get().partChanged(this)}this.element.innerHTML=this.value},deactivate:function(){if(!Prototype.Browser.IE){this.editor.deactivate()}In2iGui.Editor.get().partDidDeacivate(this)},richTextDidChange:function(){},getValue:function(){return this.value}};In2iGui.Menu=function(C,B,A){this.options=N2i.override({autoHide:false,parentElement:null},A);this.element=$(C);this.name=B;this.value=null;this.subMenus=[];this.visible=false;In2iGui.extend(this);this.addBehavior()};In2iGui.Menu.create=function(B,A){A=A||{};var C=new Element("div").addClassName("in2igui_menu");var D=new In2iGui.Menu(C,B,A);document.body.appendChild(C);return D};In2iGui.Menu.prototype={addBehavior:function(){var B=this;this.hider=function(){B.hide()};if(this.options.autoHide){var A=function(C){if(!In2iGui.isWithin(C,B.element)&&(!B.options.parentElement||!In2iGui.isWithin(C,B.options.parentElement))){if(!B.isSubMenuVisible()){B.hide()}}};this.element.observe("mouseout",A);if(this.options.parentElement){this.options.parentElement.observe("mouseout",A)}}},addDivider:function(){this.element.insert(new Element("div").addClassName("in2igui_menu_divider"))},addItem:function(D){var A=this;var B=new Element("div").addClassName("in2igui_menu_item").update(D.title);B.observe("click",function(E){A.itemWasClicked(D.value);Event.stop(E)});if(D.children){var C=In2iGui.Menu.create(null,{autoHide:true,parentElement:B});C.addItems(D.children);B.observe("mouseover",function(E){C.showAtElement(B,E,"horizontal")});A.subMenus.push(C);B.addClassName("in2igui_menu_item_children")}this.element.insert(B)},addItems:function(A){for(var B=0;B<A.length;B++){if(A[B]==null){this.addDivider()}else{this.addItem(A[B])}}},getValue:function(){return this.value},itemWasClicked:function(A){this.value=A;In2iGui.callDelegates(this,"itemWasClicked",A);In2iGui.callDelegates(this,"select",A);this.hide()},showAtPointer:function(A){if(A){Event.stop(A)}this.showAtPoint({"top":A.pointerY(),"left":A.pointerX()})},showAtElement:function(C,D,B){if(D){Event.stop(D)}var A=C.cumulativeOffset();if(B=="horizontal"){A.left+=C.getWidth()}else{if(B=="vertical"){A.top+=C.getHeight()}}this.showAtPoint(A)},showAtPoint:function(G){var B=N2i.Window.getInnerWidth();var E=N2i.Window.getInnerHeight();var D=N2i.Window.getScrollTop();var F=N2i.Window.getScrollLeft();if(!this.visible){this.element.setStyle({"display":"block","visibility":"hidden",opacity:0})}var C=this.element.getWidth();var A=this.element.getHeight();this.element.setStyle({"top":Math.min(G.top,E-A-20+D)+"px","left":Math.min(G.left,B-C-20+F)+"px","visibility":"visible",zIndex:In2iGui.nextTopIndex()});if(!this.visible){$ani(this.element,"opacity",1,200);this.addHider();this.visible=true}},hide:function(){if(!this.visible){return }var A=this;$ani(this.element,"opacity",0,200,{onComplete:function(){A.element.setStyle({"display":"none"})}});this.removeHider();for(var B=0;B<this.subMenus.length;B++){this.subMenus[B].hide()}this.visible=false},isSubMenuVisible:function(){for(var A=0;A<this.subMenus.length;A++){if(this.subMenus[A].visible){return true}}return false},addHider:function(){Element.observe(document.body,"click",this.hider)},removeHider:function(){Event.stopObserving(document.body,"click",this.hider)}};In2iGui.Overlay=function(C,B,A){this.element=$(C);this.content=this.element.select("div.in2igui_inner_overlay")[1];this.name=B;this.icons=new Hash();this.visible=false;In2iGui.extend(this);this.addBehavior()};In2iGui.Overlay.create=function(B,A){var C=new Element("div").addClassName("in2igui_overlay").setStyle({"display":"none"});C.update('<div class="in2igui_inner_overlay"><div class="in2igui_inner_overlay"></div></div>');document.body.appendChild(C);return new In2iGui.Overlay(C,B)};In2iGui.Overlay.prototype={addBehavior:function(){var A=this;this.hider=function(B){if(A.boundElement){if(In2iGui.isWithin(B,A.boundElement)||In2iGui.isWithin(B,A.element)){return }A.boundElement.removeClassName("in2igui_overlay_bound");A.boundElement=null;A.hide()}};this.element.observe("mouseout",this.hider)},addIcon:function(C,D){var A=this;var B=new Element("div").addClassName("in2igui_overlay_icon");B.setStyle({"backgroundImage":"url("+In2iGui.getIconUrl(D,2)+")"});B.observe("click",function(E){A.iconWasClicked(C,E)});this.icons.set(C,B);this.content.insert(B)},hideIcons:function(B){var A=this;B.each(function(C){A.icons.get(C).hide()})},showIcons:function(B){var A=this;B.each(function(C){A.icons.get(C).show()})},iconWasClicked:function(A,B){In2iGui.callDelegates(this,"iconWasClicked",A,B)},showAtElement:function(B,A){In2iGui.positionAtElement(this.element,B,A);if(this.visible){return }if(In2iGui.browser.msie){this.element.setStyle({"display":"block"})}else{this.element.setStyle({"display":"block","opacity":0});$ani(this.element,"opacity",1,300)}this.visible=true;if(A.autoHide){this.boundElement=B;B.observe("mouseout",this.hider);B.addClassName("in2igui_overlay_bound")}return },hide:function(){this.element.setStyle({"display":"none"});this.visible=false}};In2iGui.Upload=function(C,B,A){this.options=N2i.override({parameters:[]},A);this.element=$(C);this.name=B;this.file=$class("file",this.element)[0];this.form=$tag("form",this.element)[0];In2iGui.extend(this);this.loader=null;this.addBehavior();this.createProgressBar()};In2iGui.Upload.create=function(B,A){A=A|{};var E=new Element("div",{"class":"in2igui_upload"});var F=new Element("form",{"action":A.action|"","method":"post","enctype":"multipart/form-data","encoding":"multipart/form-data","target":"upload"});if(A.parameters){for(var D=0;D<A.parameters.length;D++){var G=new Element("input",{"type":"hidden","name":A.parameters[D].name});G.setValue(A.parameters[D].value);F.insert(G)}}var C=N2i.create("input",{"type":"file","class":"file","name":A.name});F.insert(C);E.insert(F);E.insert(new Element("iframe",{name:"upload",id:"upload"}).setStyle({display:"none"}));return new In2iGui.Upload(E,B,A)};In2iGui.Upload.prototype={addBehavior:function(){var A=this;this.file.onchange=function(){A.submit()}},createProgressBar:function(){this.progressBar=In2iGui.ProgressBar.create();this.progressBar.hide();this.element.appendChild(this.progressBar.getElement())},submit:function(){var B=this.options.parameters;for(var A=0;A<B.length;A++){this.form[B[A].name].value=B[A].value}this.form.submit();In2iGui.callDelegates(this,"uploadDidSubmit")},startProgress:function(){this.form.style.display="none";this.progressBar.show()},setProgress:function(A){this.progressBar.setValue(A)},endProgress:function(){this.form.style.display="block";this.form.reset();this.progressBar.reset();this.progressBar.hide()}};In2iGui.MultiUpload=function(C,B,A){this.options=N2i.override({url:"",parameters:{}},A);this.element=$(C);this.itemContainer=this.element.select(".in2igui_multiupload_items")[0];this.name=B;this.items=[];this.busy=false;this.loaded=false;In2iGui.extend(this);this.addBehavior()};In2iGui.MultiUpload.create=function(B,A){var C=new Element("div",{"class":"in2igui_multiupload"});C.update('<div class="in2igui_upload_placeholder"></div><div class="in2igui_multiupload_items"><xsl:comment/></div></div>');return new In2iGui.MultiUpload(C,B,A)};In2iGui.MultiUpload.prototype={addBehavior:function(){var A=this;if(In2iGui.get().domLoaded){this.createLoader()}else{In2iGui.onDomLoaded(function(){A.createLoader()})}},createLoader:function(){var E=new String(document.location);var B=E.slice(0,E.lastIndexOf("/")+1);B+=this.options.url;var D=N2i.Cookie.get("JSESSIONID");if(D){B+=";jsessionid="+D}var C={width:108,height:28};var A=this;this.loader=new SWFUpload({upload_url:B,flash_url:In2iGui.context+"/In2iGui/lib/swfupload/swfupload.swf",file_size_limit:"20480",file_upload_limit:100,debug:true,post_params:this.options.parameters,button_placeholder_id:"x",button_placeholder:this.element.select(".in2igui_upload_placeholder")[0],button_width:C.width,button_height:C.height,swfupload_loaded_handler:function(){A.flashLoaded()},file_queued_handler:function(F){A.fileQueued(F)},file_queue_error_handler:function(G,F,H){A.fileQueueError(G,F,H)},file_dialog_complete_handler:function(){A.fileDialogComplete()},upload_start_handler:function(){A.uploadStart()},upload_progress_handler:function(G,F,H){A.uploadProgress(G,F,H)},upload_error_handler:function(G,F,H){A.uploadError(G,F,H)},upload_success_handler:function(F,G){A.uploadSuccess(F,G)},upload_complete_handler:function(F){A.uploadComplete(F)},queue_complete_handler:function(){A.queueComplete()},swfupload_pre_load_handler:function(){alert("swfupload_pre_load_handler!")},swfupload_load_failed_handler:function(){alert("swfupload_load_failed_handler!")}})},setButton:function(B){this.button=B;if(this.button){var A=this.element.select("object")[0].remove();A.setStyle({width:"108px","marginLeft":"-108px",position:"absolute"});B.getElement().insert(A);return }},startNextUpload:function(){this.loader.startUpload()},addError:function(A,C){var B=new Element("div",{"class":"in2igui_multiupload_item_error"});B.insert(new Element("a",{"class":"in2igui_link"}).update("<span>Fjern</span>").observe("click",function(){this.parentNode.remove();return false}));B.insert("<strong>"+In2iGui.MultiUpload.errors[A]+"</strong><br/><em>"+C.name+"</em>");this.itemContainer.insert(B)},flashLoaded:function(){this.loaded=true},fileQueued:function(A){var B=new In2iGui.MultiUpload.Item(A);this.items[A.index]=B;this.itemContainer.insert(B.element)},fileQueueError:function(B,A,C){this.addError(A,B)},fileDialogComplete:function(){this.startNextUpload()},uploadStart:function(){},uploadProgress:function(B,A,C){this.items[B.index].updateProgress(A,C)},uploadError:function(B,A,C){if(B){this.items[B.index].update(B)}this.addError(A,B)},uploadSuccess:function(A,B){this.items[A.index].updateProgress(A.size,A.size)},uploadComplete:function(B){this.startNextUpload();var A=this;window.setTimeout(function(){A.items[B.index].hide()},100);In2iGui.callDelegates(this,"uploadDidComplete",B)},queueComplete:function(){In2iGui.callDelegates(this,"uploadDidCompleteQueue",file)}};In2iGui.MultiUpload.Item=function(A){this.element=new Element("div").addClassName("in2igui_multiupload_item");this.info=new Element("strong");this.progress=In2iGui.ProgressBar.create();this.element.insert(this.progress.getElement());this.element.insert(this.info);this.update(A)};In2iGui.MultiUpload.Item.prototype={update:function(A){this.info.update(A.name)},updateProgress:function(A,B){this.progress.setValue(A/B)},hide:function(){this.element.hide()}};if(window.SWFUpload){In2iGui.MultiUpload.errors={};In2iGui.MultiUpload.errors[SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED]="Der er for mange filer i ken";In2iGui.MultiUpload.errors[SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT]="Filen er for stor";In2iGui.MultiUpload.errors[SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE]="Filen er tom";In2iGui.MultiUpload.errors[SWFUpload.QUEUE_ERROR.INVALID_FILETYPE]="Filens type er ikke understttet";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.HTTP_ERROR]="Der skete en netvrksfejl";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL]="Upload-adressen findes ikke";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.IO_ERROR]="Der skete en IO-fejl";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.SECURITY_ERROR]="Der skete en sikkerhedsfejl";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED]="Upload-strrelsen er overskredet";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED]="Upload af filen fejlede";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND]="Filens id kunne ikke findes";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED]="Validering af filen fejlede";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.FILE_CANCELLED]="Filen blev afbrudt";In2iGui.MultiUpload.errors[SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED]="Upload af filen blev stoppet"}In2iGui.ProgressBar=function(B,A){this.element=$(B);this.indicator=this.element.firstDescendant();this.name=A;In2iGui.extend(this)};In2iGui.ProgressBar.create=function(A){var B=new Element("div",{"class":"in2igui_progressbar"}).insert(N2i.create("div"));return new In2iGui.ProgressBar(B,A)};In2iGui.ProgressBar.prototype={setValue:function(A){$ani(this.indicator,"width",(A*100)+"%",A==1?10:200)},reset:function(){this.indicator.style.width="0%"},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="block"}};In2iGui.Gallery=function(C,B,A){this.id=C;this.name=B;this.options=A||{};this.element=$(C);this.objects=[];this.nodes=[];this.selected=new Hash();this.width=100;this.height=100;In2iGui.extend(this)};In2iGui.Gallery.prototype={setObjects:function(A){this.objects=A;this.render()},getObjects:function(){return this.objects},render:function(){this.nodes=[];this.element.update();var A=this;this.objects.each(function(D,E){var C=A.resolveImageUrl(D);C=C.replace(/&amp;/,"&");if(D.height<D.width){var G=(A.height-(A.height*D.height/D.width))/2}else{var G=0}var B=new Element("img",{src:C}).setStyle({margin:G+"px auto 0px"});var F=new Element("div",{"class":"in2igui_gallery_item"}).setStyle({"width":A.width+"px","height":A.height+"px"}).insert(B);F.observe("click",function(){A.itemClicked(E)});F.observe("dblclick",function(){A.itemDoubleClicked(E)});A.element.insert(F);A.nodes.push(F)})},updateUI:function(){var A=this;this.objects.each(function(B,C){if(A.selected.get(C)){A.nodes[C].addClassName("in2igui_gallery_item_selected")}else{A.nodes[C].removeClassName("in2igui_gallery_item_selected")}})},resolveImageUrl:function(A){for(var B=0;B<this.delegates.length;B++){if(this.delegates[B].resolveImageUrl){return this.delegates[B].resolveImageUrl(A,this.width,this.height)}}return""},itemClicked:function(A){this.selected=new Hash();this.selected.set(A,true);this.updateUI()},itemDoubleClicked:function(A){In2iGui.callDelegates(this,"itemOpened",this.objects[A])}};In2iGui.Calendar=function(C,B,A){this.name=B;this.options={startHour:7,endHour:24};N2i.override(this.options,A);this.element=$(C);this.head=$(this.element.getElementsByTagName("thead")[0]);this.body=$(this.element.getElementsByTagName("tbody")[0]);this.date=new Date();In2iGui.extend(this);this.buildUI();this.updateUI()};In2iGui.Calendar.prototype={getFirstDay:function(){var A=new Date(this.date.getTime());A.setDate(A.getDate()-A.getDay()+1);A.setHours(0);A.setMinutes(0);A.setSeconds(0);return A},getLastDay:function(){var A=new Date(this.date.getTime());A.setDate(A.getDate()-A.getDay()+7);A.setHours(23);A.setMinutes(59);A.setSeconds(59);return A},clearEvents:function(){this.events=[];var A=this.element.select(".in2igui_calendar_event");A.each(function(B){B.remove()});this.hideEventViewer()},setEvents:function(B){this.setBusy(false);this.clearEvents();this.events=B;var A=this;var C=(this.options.endHour-this.options.startHour)*40;this.events.each(function(H){var E=A.body.select(".day")[H.startTime.getDay()-1];var G=new Element("div",{"class":"in2igui_calendar_event"});var I=((H.startTime.getHours()*60+H.startTime.getMinutes())/60-A.options.startHour)*40-1;var D=(H.endTime.getTime()-H.startTime.getTime())/1000/60/60*40+1;var D=Math.min(C-I,D);G.setStyle({"marginTop":I+"px","height":D+"px"});var F=new Element("div");F.insert(new Element("p",{"class":"in2igui_calendar_event_time"}).update(H.startTime.dateFormat("H:i")));F.insert(new Element("p",{"class":"in2igui_calendar_event_text"}).update(H.text));if(H.location){F.insert(new Element("p",{"class":"in2igui_calendar_event_location"}).update(H.location))}E.insert(G.insert(F));G.observe("click",function(){A.eventWasClicked(H,this)})})},eventWasClicked:function(B,A){this.showEvent(B,A)},setBusy:function(A){if(A){this.element.addClassName("in2igui_calendar_busy")}else{this.element.removeClassName("in2igui_calendar_busy")}},updateUI:function(){var D=this.getFirstDay();var A=this.head.select(".time")[0];A.update("<div>Uge "+this.date.getWeekOfYear()+" "+this.date.getFullYear()+"</div>");var E=this.head.select(".day");for(var C=0;C<E.length;C++){var B=new Date(D.getTime());B.setDate(B.getDate()+C);E[C].update(B.dateFormat("l \\d. d M"))}},buildUI:function(){var F=this.element.select(".in2igui_calendar_bar")[0];this.toolbar=In2iGui.Toolbar.create(null,{labels:false});F.insert(this.toolbar.getElement());var E=In2iGui.Button.create("in2iguiCalendarPrevious",{text:"",icon:"monochrome/previous"});E.addDelegate(this);this.toolbar.add(E);var A=In2iGui.Button.create("in2iguiCalendarToday",{text:"Idag"});A.addDelegate(this);this.toolbar.add(A);var C=In2iGui.Button.create("in2iguiCalendarNext",{text:"",icon:"monochrome/next"});C.addDelegate(this);this.toolbar.add(C);this.datePickerButton=In2iGui.Button.create("in2iguiCalendarDatePicker",{text:"Vlg dato..."});this.datePickerButton.addDelegate(this);this.toolbar.add(this.datePickerButton);var G=this.body.select(".time")[0];for(var B=this.options.startHour;B<=this.options.endHour;B++){var D=new Element("div").update("<span><em>"+B+":00</em></span>");if(B==this.options.startHour){D.addClassName("first")}if(B==this.options.endHour){D.addClassName("last")}G.insert(D)}},click$in2iguiCalendarPrevious:function(){var A=new Date(this.date.getTime());A.setDate(this.date.getDate()-7);this.setDate(A)},click$in2iguiCalendarNext:function(){var A=new Date(this.date.getTime());A.setDate(this.date.getDate()+7);this.setDate(A)},click$in2iguiCalendarToday:function(){this.setDate(new Date())},setDate:function(A){this.date=new Date(A.getTime());this.updateUI();this.refresh();if(this.datePicker){this.datePicker.setValue(this.date)}},click$in2iguiCalendarDatePicker:function(){this.showDatePicker()},refresh:function(){this.clearEvents();this.setBusy(true);var A={"startTime":this.getFirstDay(),"endTime":this.getLastDay()};In2iGui.callDelegates(this,"calendarSpanChanged",A)},showDatePicker:function(){if(!this.datePickerPanel){this.datePickerPanel=In2iGui.BoundPanel.create();this.datePicker=In2iGui.DatePicker.create("in2iguiCalendarDatePicker",{value:this.date});this.datePicker.addDelegate(this);this.datePickerPanel.add(this.datePicker);this.datePickerPanel.addSpace(5);var A=In2iGui.Button.create("in2iguiCalendarDatePickerClose",{text:"Luk"});A.addDelegate(this);this.datePickerPanel.add(A)}this.datePickerPanel.position(this.datePickerButton.getElement());this.datePickerPanel.show()},click$in2iguiCalendarDatePickerClose:function(){this.datePickerPanel.hide()},dateChanged$in2iguiCalendarDatePicker:function(A){this.setDate(A)},showEvent:function(C,B){if(!this.eventViewerPanel){this.eventViewerPanel=In2iGui.BoundPanel.create({width:270,padding:3});this.eventInfo=In2iGui.InfoView.create(null,{height:240,clickObjects:true});this.eventViewerPanel.add(this.eventInfo);this.eventViewerPanel.addSpace(5);var A=In2iGui.Button.create("in2iguiCalendarEventClose",{text:"Luk"});A.addDelegate(this);this.eventViewerPanel.add(A)}this.eventInfo.clear();this.eventInfo.setBusy(true);this.eventViewerPanel.position(B);this.eventViewerPanel.show();In2iGui.callDelegates(this,"requestEventInfo",C);return },updateEventInfo:function(A,B){this.eventInfo.setBusy(false);this.eventInfo.update(B)},click$in2iguiCalendarEventClose:function(){this.hideEventViewer()},hideEventViewer:function(){if(this.eventViewerPanel){this.eventViewerPanel.hide()}}};In2iGui.DatePicker=function(C,B,A){this.name=B;this.element=$(C);this.options={};N2i.override(this.options,A);this.cells=[];this.title=this.element.select("strong")[0];this.today=new Date();this.value=this.options.value?new Date(this.options.value.getTime()):new Date();this.viewDate=new Date(this.value.getTime());this.viewDate.setDate(1);In2iGui.extend(this);this.addBehavior();this.updateUI()};In2iGui.DatePicker.create=function(A,J){var C=new Element("div",{"class":"in2igui_datepicker"});C.insert('<div class="in2igui_datepicker_header"><a class="in2igui_datepicker_next"></a><a class="in2igui_datepicker_previous"></a><strong></strong></div>');var H=new Element("table");var F=new Element("tr");H.insert(new Element("thead").insert(F));for(var D=0;D<7;D++){F.insert(new Element("th").update(Date.dayNames[D].substring(0,3)))}var E=new Element("tbody");H.insert(E);for(var D=0;D<6;D++){var I=new Element("tr");for(var B=0;B<7;B++){var G=new Element("td");I.insert(G)}E.insert(I)}C.insert(H);return new In2iGui.DatePicker(C,A,J)};In2iGui.DatePicker.prototype={addBehavior:function(){var A=this;this.cells=this.element.select("td");this.cells.each(function(B,C){B.observe("mousedown",function(){A.selectCell(C)})});this.element.select(".in2igui_datepicker_next")[0].observe("mousedown",function(){A.next()});this.element.select(".in2igui_datepicker_previous")[0].observe("mousedown",function(){A.previous()})},setValue:function(A){this.value=new Date(A.getTime());this.viewDate=new Date(A.getTime());this.viewDate.setDate(1);this.updateUI()},updateUI:function(){this.title.update(this.viewDate.dateFormat("F Y"));var C=this.value.getFullYear()==this.viewDate.getFullYear();var E=this.viewDate.getMonth();for(var D=0;D<this.cells.length;D++){var B=this.indexToDate(D);var A=this.cells[D];if(B.getMonth()<E){A.className="in2igui_datepicker_dimmed"}else{if(B.getMonth()>E){A.className="in2igui_datepicker_dimmed"}else{A.className=""}}if(B.getDate()==this.value.getDate()&&B.getMonth()==this.value.getMonth()&&C){A.addClassName("in2igui_datepicker_selected")}if(B.getDate()==this.today.getDate()&&B.getMonth()==this.today.getMonth()&&B.getFullYear()==this.today.getFullYear()){A.addClassName("in2igui_datepicker_today")}A.update(B.getDate())}},getPreviousMonth:function(){var A=new Date(this.viewDate.getTime());A.setMonth(A.getMonth()-1);return A},getNextMonth:function(){var A=new Date(this.viewDate.getTime());A.setMonth(A.getMonth()+1);return A},previous:function(){this.viewDate=this.getPreviousMonth();this.updateUI()},next:function(){this.viewDate=this.getNextMonth();this.updateUI()},selectCell:function(A){this.value=this.indexToDate(A);this.viewDate=new Date(this.value.getTime());this.viewDate.setDate(1);this.updateUI();In2iGui.callDelegates(this,"dateChanged",this.value)},indexToDate:function(B){var D=this.viewDate.getDay();var E=this.viewDate.getDaysInMonth();var C=this.getPreviousMonth().getDaysInMonth();if(B<D){var A=this.getPreviousMonth();A.setDate(C-D+B+1);return A}else{if(B>D+E-1){var A=this.getPreviousMonth();A.setDate(B-D-E+1);return A;cell.update(i-D-E+1)}else{var A=new Date(this.viewDate.getTime());A.setDate(B+1-D);return A}}}};Date.monthNames=["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"];Date.dayNames=["Sndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lrdag"];In2iGui.Columns=function(C,B,A){this.name=B;this.options=A||{};this.element=$(C);this.body=this.element.select("tr")[0];In2iGui.extend(this)};In2iGui.Columns.create=function(B,A){var C=new Element("table",{"class":"in2igui_columns"}).insert(new Element("tbody").insert(new Element("tr")));return new In2iGui.Columns(C,B,A)};In2iGui.Columns.prototype={addToColumn:function(A,B){var C=this.ensureColumn(A);C.insert(B.getElement())},setColumnStyle:function(A,B){var C=this.ensureColumn(A);C.setStyle(B)},setColumnWidth:function(A,B){var C=this.ensureColumn(A);C.setStyle({width:B+"px"})},ensureColumn:function(A){var C=this.body.childElements();for(var B=C.length-1;B<A;B++){this.body.insert(new Element("td",{"class":"in2igui_columns_column"}))}return this.body.childElements()[A]}};In2iGui.Dock=function(C,B,A){this.options=N2i.override({modal:false},A);this.element=$(C);this.iframe=this.element.select("iframe")[0];this.name=B;In2iGui.extend(this);In2iGui.get().registerOverflow(this.iframe,-58)};In2iGui.Dock.prototype={setUrl:function(A){N2i.getFrameDocument(this.iframe).location.href=A}};In2iGui.Box=function(C,B,A){this.options=N2i.override({},A);this.name=B;this.element=$(C);this.body=this.element.select(".in2igui_box_body")[0];In2iGui.extend(this)};In2iGui.Box.create=function(B,A){A=N2i.override({},A);var C=new Element("div",{"class":"in2igui_box"});if(A.width){C.setStyle({width:A.width+"px"})}if(A.absolute){C.addClassName("in2igui_box_absolute")}C.update('<div class="in2igui_box_top"><div><div></div></div></div><div class="in2igui_box_middle"><div class="in2igui_box_middle">'+(A.title?'<div class="in2igui_box_header"><strong class="in2igui_box_title">'+A.title+"</strong></div>":"")+'<div class="in2igui_box_body"'+(A.padding?' style="padding: '+A.padding+'px;"':"")+'></div></div></div><div class="in2igui_box_bottom"><div><div></div></div></div>');return new In2iGui.Box(C,B,A)};In2iGui.Box.prototype={addToDocument:function(){document.body.appendChild(this.element)},add:function(A){if(A.getElement){this.body.insert(A.getElement())}else{this.body.insert(A)}},show:function(){var D=this.element;if(this.options.modal){var B=In2iGui.nextPanelIndex();D.style.zIndex=B+1;In2iGui.showCurtain(this,B)}D.setStyle({display:"block",visibility:"hidden"});var A=D.getWidth();var C=(N2i.Window.getInnerHeight()-D.getHeight())/2+N2i.Window.getScrollTop();D.setStyle({"marginLeft":(A/-2)+"px",top:C+"px"});D.setStyle({display:"block",visibility:"visible"})},hide:function(){In2iGui.hideCurtain(this);this.element.setStyle({display:"none"})},curtainWasClicked:function(){In2iGui.callDelegates(this,"boxCurtainWasClicked")}}