var n2i={browser:{}};n2i.browser.opera=/opera/i.test(navigator.userAgent);n2i.browser.msie=!n2i.browser.opera&&/MSIE/.test(navigator.userAgent);n2i.browser.msie6=navigator.userAgent.indexOf("MSIE 6")!=-1;n2i.browser.msie7=navigator.userAgent.indexOf("MSIE 7")!=-1;n2i.browser.msie8=navigator.userAgent.indexOf("MSIE 8")!=-1;n2i.browser.webkit=navigator.userAgent.indexOf("WebKit")!=-1;n2i.browser.gecko=!n2i.browser.webkit&&navigator.userAgent.indexOf("Gecko")!=-1;n2i.ELEMENT_NODE=1;n2i.ATTRIBUTE_NODE=2;n2i.TEXT_NODE=3;n2i.log=function(A){try{console.log(A)}catch(B){}};n2i.camelize=function(F){var D=F.split("-");if(D.length==1){return D[0]}var B=F.indexOf("-")==0?D[0].charAt(0).toUpperCase()+D[0].substring(1):D[0];for(var C=1,A=D.length;C<A;C++){var E=D[C];B+=E.charAt(0).toUpperCase()+E.substring(1)}return B};n2i.override=function(B,A){if(A){for(prop in A){B[prop]=A[prop]}}return B};n2i.trim=function(A){if(!A){return A}return A.replace(/^[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+|[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+$/g,"")};n2i.escapeHTML=function(A){var B=document.createElement("div");B.appendChild(document.createTextNode(A));return B.innerHTML};n2i.isEmpty=function(A){if(A==null||typeof (A)=="undefined"){return true}return n2i.trim(A).length==0};n2i.isDefined=function(A){return A!==null&&typeof (A)!=="undefined"};n2i.inArray=function(A,C){for(var B=0;B<A.length;B++){if(A[B]==C){return true}}return false};n2i.flipInArray=function(A,B){if(n2i.inArray(A,B)){n2i.removeFromArray(A,B)}else{A.push(B)}};n2i.removeFromArray=function(A,C){for(var B=A.length-1;B>=0;B--){if(A[B]==C){A.splice(B,1)}}};n2i.addToArray=function(A,C){if(C.constructor==Array){for(var B=0;B<C.length;B++){if(!n2i.inArray(A,C[B])){A.push(C)}}}else{if(!n2i.inArray(A,C)){A.push(C)}}};n2i.scrollTo=function(A){A=$(A);if(A){var B=A.cumulativeOffset();window.scrollTo(B.left,B.top-50)}};n2i.dom={isElement:function(B,A){return B.nodeType==n2i.ELEMENT_NODE&&(A===undefined?true:B.nodeName==A)},isDefinedText:function(A){return A.nodeType==n2i.TEXT_NODE&&A.nodeValue.length>0},addText:function(A,B){A.appendChild(document.createTextNode(B))},getNodeText:function(C){var A="";var D=C.childNodes;for(var B=0;B<D.length;B++){if(D[B].nodeType==n2i.TEXT_NODE&&D[B].nodeValue!=null){A+=D[B].nodeValue}}return A}};n2i.getStyle=function(B,C){B=$(B);var E=n2i.camelize(C);var D=B.style[E];if(!D){if(document.defaultView&&document.defaultView.getComputedStyle){var A=document.defaultView.getComputedStyle(B,null);D=A?A.getPropertyValue(C):null}else{if(B.currentStyle){D=B.currentStyle[E]}}}if(window.opera&&["left","top","right","bottom"].include(C)){if(n2i.getStyle(B,"position")=="static"){D="auto"}}return D=="auto"?null:D};n2i.setOpacity=function(B,A){if(n2i.browser.msie){if(A==1){B.style["filter"]=null}else{B.style["filter"]="alpha(opacity="+(A*100)+")"}}else{B.style["opacity"]=A}};n2i.copyStyle=function(B,C,A){A.each(function(D){var E=B.getStyle(D);if(E){C.style[D]=B.getStyle(D)}})};n2i.isReturnKey=function(A){return A.keyCode==13};n2i.isRightKey=function(A){return A.keyCode==39};n2i.isLeftKey=function(A){return A.keyCode==37};n2i.isEscapeKey=function(A){return A.keyCode==27};n2i.isSpaceKey=function(A){return A.keyCode==32};n2i.getFrameDocument=function(A){if(A.contentDocument){return A.contentDocument}else{if(A.contentWindow){return A.contentWindow.document}else{if(A.document){return A.document}}}};n2i.getScrollTop=function(){if(self.pageYOffset){return self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}else{if(document.body){return document.body.scrollTop}}}};n2i.getScrollLeft=function(){if(self.pageYOffset){return self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollLeft}else{if(document.body){return document.body.scrollLeft}}}};n2i.getInnerHeight=function(){var A;if(self.innerHeight){return self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}else{if(document.body){return document.body.clientHeight}}}};n2i.getInnerWidth=function(){if(self.innerHeight){return self.innerWidth}else{if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientWidth}else{if(document.body){return document.body.clientWidth}}}};n2i.getDocumentHeight=function(){if(n2i.browser.msie6){var A=Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight);$(document.body).childElements().each(function(B){A=Math.max(A,B.getHeight())});return A}if(window.scrollMaxY&&window.innerHeight){return window.scrollMaxY+window.innerHeight}else{return Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight)}};n2i.Preloader=function(A){this.options=A||{};this.delegate={};this.images=[];this.loaded=0};n2i.Preloader.prototype={addImages:function(A){if(typeof (A)=="object"){for(var B=0;B<A.length;B++){this.images.push(A[B])}}else{this.images.push(A)}},setDelegate:function(A){this.delegate=A},load:function(){var B=this;this.obs=[];for(var C=0;C<this.images.length;C++){var A=new Image();A.n2iPreloaderIndex=C;A.onload=function(){B.imageChanged(this.n2iPreloaderIndex,"imageDidLoad")};A.onerror=function(){B.imageChanged(this.n2iPreloaderIndex,"imageDidGiveError")};A.onabort=function(){B.imageChanged(this.n2iPreloaderIndex,"imageDidAbort")};A.src=(this.options.context?this.options.context:"")+this.images[C];this.obs.push(A)}},imageChanged:function(A,B){this.loaded++;if(this.delegate[B]){this.delegate[B](this.loaded,this.images.length,A)}if(this.loaded==this.images.length&&this.delegate.allImagesDidLoad){this.delegate.allImagesDidLoad()}}};n2i.cookie={set:function(C,D,E){if(E){var B=new Date();B.setTime(B.getTime()+(E*24*60*60*1000));var A="; expires="+B.toGMTString()}else{var A=""}document.cookie=C+"="+D+A+"; path=/"},get:function(B){var D=B+"=";var A=document.cookie.split(";");for(var C=0;C<A.length;C++){var E=A[C];while(E.charAt(0)==" "){E=E.substring(1,E.length)}if(E.indexOf(D)==0){return E.substring(D.length,E.length)}}return null},clear:function(A){this.set(A,"",-1)}};n2i.URL=function(A){this.url=A||""};n2i.URL.prototype={addParameter:function(A,B){this.url+=this.url.indexOf("?")!=-1?"&":"?";this.url+=A+"="+(n2i.isDefined(B)?B:"")},toString:function(){return this.url}};n2i.location={getParameter:function(A){var C=n2i.location.getParameters();for(var B=0;B<C.length;B++){if(C[B].name==A){return C[B].value}}return null},setParameter:function(A,E){var C=n2i.location.getParameters();var D=false;for(var B=0;B<C.length;B++){if(C[B].name==A){C[B].value=E;D=true;break}}if(!D){C.push({name:A,value:E})}n2i.location.setParameters(C)},setParameters:function(B){var C="";for(var A=0;A<B.length;A++){C+=A==0?"?":"&";C+=B[A].name+"="+B[A].value}document.location.search=C},getBoolean:function(A){var B=n2i.location.getParameter(A);return(B=="true"||B=="1")},getParameters:function(){var B=document.location.search.substring(1).split("&");var A=[];for(var D=0;D<B.length;D++){var E=B[D].split("=");var C=unescape(E[0]).replace(/^\s*|\s*$/g,"");var F=unescape(E[1]).replace(/^\s*|\s*$/g,"");if(C){A.push({name:C,value:F})}}return A}};n2i.ani=n2i.animate=function(A,C,D,E,B){n2i.animation.get(A).animate(null,D,C,E,B)};n2i.animation={objects:{},running:false,latestId:0,get:function(A){A=$(A);if(!A.n2iAnimationId){A.n2iAnimationId=this.latestId++}if(!this.objects[A.n2iAnimationId]){this.objects[A.n2iAnimationId]=new n2i.animation.Item(A)}return this.objects[A.n2iAnimationId]},start:function(){if(!this.running){n2i.animation.render()}}};n2i.animation.render=function(F){this.running=true;var H=false;var A=new Date().getTime();for(id in this.objects){var E=this.objects[id];if(E.work){for(var G=0;G<E.work.length;G++){var J=E.work[G];if(J.finished){continue}var D=(A-J.start)/(J.end-J.start);if(D<0){H=true;continue}else{if(isNaN(D)){D=1}else{if(D>1){D=1}else{if(D<1){H=true}}}}var M=D;if(J.delegate&&J.delegate.ease){M=J.delegate.ease(M)}var L=null;if(!J.css){E.element[J.property]=Math.round(J.from+(J.to-J.from)*M)}else{if(J.to.red!=null){var B=Math.round(J.from.red+(J.to.red-J.from.red)*M);var C=Math.round(J.from.green+(J.to.green-J.from.green)*M);var K=Math.round(J.from.blue+(J.to.blue-J.from.blue)*M);L="rgb("+B+","+C+","+K+")";E.element.style[J.property]=L}else{if(n2i.browser.msie&&J.property=="opacity"){var I=(J.from+(J.to-J.from)*M);if(I==1){E.element.style["filter"]=""}else{E.element.style["filter"]="alpha(opacity="+(I*100)+")"}}else{L=new String(J.from+(J.to-J.from)*M)+(J.unit!=null?J.unit:"");E.element.style[J.property]=L}}}if(D==1){J.finished=true;if(J.delegate&&J.delegate.onComplete){J.delegate.onComplete()}else{if(J.delegate&&J.delegate.hideOnComplete){E.element.style.display="none"}}}}}}if(H){window.setTimeout(function(){n2i.animation.render()},0)}else{this.running=false}};n2i.animation.parseStyle=function(D){var B={type:null,value:null,unit:null};var C;if(!n2i.isDefined(D)){return B}else{if(!isNaN(D)){B.value=parseFloat(D)}else{if(C=D.match(/([\-]?[0-9\.]+)(px|pt|%)/)){B.type="length";B.value=parseFloat(C[1]);B.unit=C[2]}else{if(C=D.match(/rgb\(([0-9]+),[ ]?([0-9]+),[ ]?([0-9]+)\)/)){B.type="color";B.value={red:parseInt(C[1]),green:parseInt(C[2]),blue:parseInt(C[3])}}else{var A=new n2i.Color(D);if(A.ok){B.value={red:A.r,green:A.g,blue:A.b}}}}}}return B};n2i.animation.Item=function(A){this.element=A;this.work=[]};n2i.animation.Item.prototype.animate=function(H,I,J,B,F){var D=true;if(J=="scrollLeft"||J=="scrollTop"){D=false}var G=this.getWork(D?n2i.camelize(J):J);G.delegate=F;G.finished=false;G.css=D;if(H!=null){G.from=H}else{if(G.css&&n2i.browser.msie&&J=="opacity"){G.from=this.getIEOpacity(this.element)}else{if(G.css){var A=n2i.getStyle(this.element,J);var C=n2i.animation.parseStyle(A);G.from=C.value}else{G.from=this.element[J]}}}if(G.css){var E=n2i.animation.parseStyle(I);G.to=E.value;G.unit=E.unit}else{G.to=I;G.unit=null}G.start=new Date().getTime();if(F&&F.delay){G.start+=F.delay}G.end=G.start+B;n2i.animation.start()};n2i.animation.Item.prototype.getIEOpacity=function(B){var C=n2i.getStyle(B,"filter").toLowerCase();var A;if(A=C.match(/opacity=([0-9]+)/)){return parseFloat(A[1])/100}else{return 1}};n2i.animation.Item.prototype.getWork=function(C){for(var B=0;B<this.work.length;B++){if(this.work[B].property==C){return this.work[B]}}var A={property:C};this.work[this.work.length]=A;return A};n2i.animation.Loop=function(A){this.recipe=A;this.position=-1;this.running=false};n2i.animation.Loop.prototype.next=function(){this.position++;if(this.position>=this.recipe.length){this.position=0}var B=this.recipe[this.position];if(typeof (B)=="function"){B()}else{if(B.element){n2i.ani(B.element,B.property,B.value,B.duration,{ease:B.ease})}}var A=this;var C=B.duration||0;window.setTimeout(function(){A.next()},C)};n2i.animation.Loop.prototype.start=function(){this.running=true;this.next()};n2i.Color=function(G){this.ok=false;if(G.charAt(0)=="#"){G=G.substr(1,6)}G=G.replace(/ /g,"");G=G.toLowerCase();var A={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var C in A){if(G==C){G=A[C]}}var H=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(I){return[parseInt(I[1]),parseInt(I[2]),parseInt(I[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(I){return[parseInt(I[1],16),parseInt(I[2],16),parseInt(I[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(I){return[parseInt(I[1]+I[1],16),parseInt(I[2]+I[2],16),parseInt(I[3]+I[3],16)]}}];for(var B=0;B<H.length;B++){var E=H[B].re;var D=H[B].process;var F=E.exec(G);if(F){channels=D(F);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var K=this.r.toString(16);var J=this.g.toString(16);var I=this.b.toString(16);if(K.length==1){K="0"+K}if(J.length==1){J="0"+J}if(I.length==1){I="0"+I}return"#"+K+J+I}};n2i.ease={slowFastSlow:function(C){var B=1.6;var A=1.4;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(C,B)),Math.pow(Math.PI,A))+1},fastSlow:function(C){var B=0.5;var A=0.7;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(C,B)),Math.pow(Math.PI,A))+1},elastic:function(A){return 1-n2i.ease.elastic2(1-A)},elastic2:function(B,A,D){if(B<=0||B>=1){return B}if(!D){D=0.45}var C;if(!A||A<1){A=1;C=D/4}else{C=D/(2*Math.PI)*Math.asin(1/A)}return -(A*Math.pow(2,10*(B-=1))*Math.sin((B-C)*(2*Math.PI)/D))},bounce:function(A){if(A<(1/2.75)){return 7.5625*A*A}else{if(A<(2/2.75)){return(7.5625*(A-=(1.5/2.75))*A+0.75)}else{if(A<(2.5/2.75)){return(7.5625*(A-=(2.25/2.75))*A+0.9375)}else{return(7.5625*(A-=(2.625/2.75))*A+0.984375)}}}},linear:function(A){return A},quadIn:function(A){return Math.pow(A,2)},quadOut:function(A){return A*(A-2)*-1},quadInOut:function(A){A=A*2;if(A<1){return Math.pow(A,2)/2}return -1*((--A)*(A-2)-1)/2},cubicIn:function(A){return Math.pow(A,3)},cubicOut:function(A){return Math.pow(A-1,3)+1},cubicInOut:function(A){A=A*2;if(A<1){return Math.pow(A,3)/2}A-=2;return(Math.pow(A,3)+2)/2},quartIn:function(A){return Math.pow(A,4)},quartOut:function(A){return -1*(Math.pow(A-1,4)-1)},quartInOut:function(A){A=A*2;if(A<1){return Math.pow(A,4)/2}A-=2;return -1/2*(Math.pow(A,4)-2)},quintIn:function(A){return Math.pow(A,5)},quintOut:function(A){return Math.pow(A-1,5)+1},quintInOut:function(A){A=A*2;if(A<1){return Math.pow(A,5)/2}A-=2;return(Math.pow(A,5)+2)/2},sineIn:function(A){return -1*Math.cos(A*(Math.PI/2))+1},sineOut:function(A){return Math.sin(A*(Math.PI/2))},sineInOut:function(A){return -1*(Math.cos(Math.PI*A)-1)/2},expoIn:function(A){return(A==0)?0:Math.pow(2,10*(A-1))},expoOut:function(A){return(A==1)?1:(-1*Math.pow(2,-10*A)+1)},expoInOut:function(A){if(A==0){return 0}if(A==1){return 1}A=A*2;if(A<1){return Math.pow(2,10*(A-1))/2}--A;return(-1*Math.pow(2,-10*A)+2)/2},circIn:function(A){return -1*(Math.sqrt(1-Math.pow(A,2))-1)},circOut:function(A){A=A-1;return Math.sqrt(1-Math.pow(A,2))},circInOut:function(A){A=A*2;if(A<1){return -1/2*(Math.sqrt(1-Math.pow(A,2))-1)}A-=2;return 1/2*(Math.sqrt(1-Math.pow(A,2))+1)},backIn:function(B){var A=1.70158;return Math.pow(B,2)*((A+1)*B-A)},backOut:function(B){B=B-1;var A=1.70158;return Math.pow(B,2)*((A+1)*B+A)+1},backInOut:function(B){var A=1.70158*1.525;B=B*2;if(B<1){return(Math.pow(B,2)*((A+1)*B-A))/2}B-=2;return(Math.pow(B,2)*((A+1)*B+A)+2)/2},elasticIn:function(C){if(C==0){return 0}if(C==1){return 1}var B=0.3;var A=B/4;C=C-1;return -1*Math.pow(2,10*C)*Math.sin((C-A)*(2*Math.PI)/B)},elasticOut:function(C){if(C==0){return 0}if(C==1){return 1}var B=0.3;var A=B/4;return Math.pow(2,-10*C)*Math.sin((C-A)*(2*Math.PI)/B)+1},elasticInOut:function(C){if(C==0){return 0}C=C*2;if(C==2){return 1}var B=0.3*1.5;var A=B/4;if(C<1){C-=1;return -0.5*(Math.pow(2,10*C)*Math.sin((C-A)*(2*Math.PI)/B))}C-=1;return 0.5*(Math.pow(2,-10*C)*Math.sin((C-A)*(2*Math.PI)/B))+1},bounceIn:function(A){return(1-n2i.ease.bounceOut(1-A))},bounceOut:function(D){var B=7.5625;var C=2.75;var A;if(D<(1/C)){A=B*Math.pow(D,2)}else{if(D<(2/C)){D-=(1.5/C);A=B*Math.pow(D,2)+0.75}else{if(D<(2.5/C)){D-=(2.25/C);A=B*Math.pow(D,2)+0.9375}else{D-=(2.625/C);A=B*Math.pow(D,2)+0.984375}}}return A},bounceInOut:function(A){if(A<0.5){return n2i.ease.bounceIn(A*2)/2}return(n2i.ease.bounceOut(A*2-1)/2)+0.5}};var in2igui={};function In2iGui(){this.domLoaded=false;this.overflows=null;this.delegates=[];this.objects=$H();this.addBehavior()}window.ui=In2iGui;In2iGui.latestObjectIndex=0;In2iGui.latestIndex=500;In2iGui.latestPanelIndex=1000;In2iGui.latestAlertIndex=1500;In2iGui.latestTopIndex=2000;In2iGui.toolTips={};In2iGui.get=function(A){if(!In2iGui.instance){In2iGui.instance=new In2iGui()}if(A){return In2iGui.instance.objects.get(A)}else{return In2iGui.instance}};document.observe("dom:loaded",function(){In2iGui.get().ignite()});In2iGui.prototype={ignite:function(){if(window.dwr){if(dwr&&dwr.engine&&dwr.engine.setErrorHandler){dwr.engine.setErrorHandler(function(B,A){n2i.log(B);n2i.log(A);In2iGui.get().showAlert({title:"An unexpected error occurred!",text:B,emotion:"gasp"})})}}this.domLoaded=true;In2iGui.domReady=true;this.resize();In2iGui.callSuperDelegates(this,"interfaceIsReady")},addBehavior:function(){Event.observe(window,"resize",this.resize.bind(this))},addDelegate:function(A){this.delegates.push(A)},getTopPad:function(A){var B,C;B=parseInt(n2i.getStyle(A,"padding"),10);C=parseInt(n2i.getStyle(A,"padding-top"),10);if(B){return B}if(C){return C}return 0},getBottomPad:function(B){var C,A;C=parseInt(n2i.getStyle(B,"padding"),10);A=parseInt(n2i.getStyle(B,"padding-bottom"),10);if(C){return C}if(A){return A}return 0},resize:function(){if(!this.overflows){return }var A=n2i.getInnerHeight();this.overflows.each(function(B){if(n2i.browser.webkit||n2i.browser.gecko){B.element.style.display="none";B.element.style.width=B.element.parentNode.clientWidth+"px";B.element.style.display=""}B.element.style.height=A+B.diff+"px"})},registerOverflow:function(C,A){if(!this.overflows){this.overflows=[]}var B=$(C);this.overflows.push({element:B,diff:A})},alert:function(A){if(!this.alertBox){this.alertBox=In2iGui.Alert.create(A);this.alertBoxButton=In2iGui.Button.create({name:"in2iGuiAlertBoxButton",text:"OK"});this.alertBoxButton.addDelegate(this);this.alertBox.addButton(this.alertBoxButton)}else{this.alertBox.update(A)}this.alertBoxCallBack=A.onOK;this.alertBoxButton.setText(A.button?A.button:"OK");this.alertBox.show()},click$in2iGuiAlertBoxButton:function(){In2iGui.get().alertBox.hide();if(this.alertBoxCallBack){this.alertBoxCallBack();this.alertBoxCallBack=null}},confirm:function(A){if(!A.name){A.name="in2iguiConfirm"}var D=In2iGui.get(A.name);if(!D){D=In2iGui.Alert.create(A);var C=In2iGui.Button.create({name:name+"_cancel",text:A.cancel||"Cancel",highlighted:A.highlighted==="cancel"});C.addDelegate({buttonWasClicked:function(){D.hide();if(A.onCancel){A.onCancel()}In2iGui.callDelegates(D,"cancel")}});D.addButton(C);var B=In2iGui.Button.create({name:name+"_ok",text:A.ok||"OK",highlighted:A.highlighted==="ok"});B.addDelegate({buttonWasClicked:function(){D.hide();if(A.onOK){A.onOK()}In2iGui.callDelegates(D,"ok")}});D.addButton(B)}else{D.update(A);In2iGui.get(name+"_ok").setText(A.ok||"ok");In2iGui.get(name+"_ok").setHighlighted(A.highlighted=="ok");In2iGui.get(name+"_cancel").setText(A.ok||"cancel");In2iGui.get(name+"_cancel").setHighlighted(A.highlighted=="cancel");if(A.cancel){In2iGui.get(name+"_cancel").setText(A.cancel)}}D.show()},changeState:function(B){if(this.state==B){return }var A=this.objects.values();A.each(function(C){if(C.state){if(C.state==B){C.show()}else{C.hide()}}})},getDescendants:function(B){var E=[],C=B.getElement(),A=this;if(C){var D=C.descendants();D.each(function(F){A.objects.values().each(function(G){if(G.getElement()==F){E.push(G)}})})}return E},getAncestors:function(A){var D=[];var B=A.getElement();if(B){var C=B.ancestors();C.each(function(E){this.objects.values().each(function(F){if(F.getElement()==E){D.push(F)}})}.bind(this))}return D},getAncestor:function(D,B){var A=this.getAncestors(D);for(var C=0;C<A.length;C++){if(A[0].getElement().hasClassName(B)){return A[0]}}return null}};In2iGui.nextIndex=function(){In2iGui.latestIndex++;return In2iGui.latestIndex};In2iGui.nextPanelIndex=function(){In2iGui.latestPanelIndex++;return In2iGui.latestPanelIndex};In2iGui.nextAlertIndex=function(){In2iGui.latestAlertIndex++;return In2iGui.latestAlertIndex};In2iGui.nextTopIndex=function(){In2iGui.latestTopIndex++;return In2iGui.latestTopIndex};In2iGui.showCurtain=function(A,B){if(!A.curtain){A.curtain=new Element("div",{"class":"in2igui_curtain"}).setStyle({"z-index":"none"});A.curtain.onclick=function(){if(A.curtainWasClicked){A.curtainWasClicked()}};document.body.appendChild(A.curtain)}A.curtain.style.height=n2i.getDocumentHeight()+"px";A.curtain.style.zIndex=B;n2i.setOpacity(A.curtain,0);A.curtain.style.display="block";n2i.ani(A.curtain,"opacity",0.7,1000,{ease:n2i.ease.slowFastSlow})};In2iGui.hideCurtain=function(A){if(A.curtain){n2i.ani(A.curtain,"opacity",0,200,{hideOnComplete:true})}};In2iGui.alert=function(A){In2iGui.get().alert(A)};In2iGui.showMessage=function(A){if(typeof (A)=="string"){A={text:A}}if(!In2iGui.message){In2iGui.message=new Element("div",{"class":"in2igui_message"}).update("<div><div></div></div>");if(!n2i.browser.msie){In2iGui.message.setStyle({opacity:0})}document.body.appendChild(In2iGui.message)}In2iGui.message.select("div")[1].update(A.text);In2iGui.message.setStyle({"display":"block",zIndex:In2iGui.nextTopIndex()});In2iGui.message.setStyle({marginLeft:(In2iGui.message.getWidth()/-2)+"px",marginTop:n2i.getScrollTop()+"px"});if(!n2i.browser.msie){n2i.ani(In2iGui.message,"opacity",1,300)}window.clearTimeout(In2iGui.messageTimer);if(A.duration){In2iGui.messageTimer=window.setTimeout(In2iGui.hideMessage,A.duration)}};In2iGui.hideMessage=function(){if(In2iGui.message){if(!n2i.browser.msie){n2i.ani(In2iGui.message,"opacity",0,300,{hideOnComplete:true})}else{In2iGui.message.setStyle({display:"none"})}}};In2iGui.showToolTip=function(A){var C=A.key||"common";var B=In2iGui.toolTips[C];if(!B){B=new Element("div",{"class":"in2igui_tooltip"}).update("<div><div></div></div>").setStyle({display:"none"});document.body.appendChild(B);In2iGui.toolTips[C]=B}B.onclick=function(){In2iGui.hideToolTip(A)};var E=$(A.element);var D=E.cumulativeOffset();B.select("div")[1].update(A.text);if(B.style.display=="none"&&!n2i.browser.msie){B.setStyle({opacity:0})}B.setStyle({"display":"block",zIndex:In2iGui.nextTopIndex()});B.setStyle({left:(D.left-B.getWidth()+4)+"px",top:(D.top+2-(B.getHeight()/2)+(E.getHeight()/2))+"px"});if(!n2i.browser.msie){n2i.ani(B,"opacity",1,300)}};In2iGui.hideToolTip=function(A){var C=A?A.key||"common":"common";var B=In2iGui.toolTips[C];if(B){if(!n2i.browser.msie){n2i.ani(B,"opacity",0,300,{hideOnComplete:true})}else{B.setStyle({display:"none"})}}};In2iGui.isWithin=function(B,A){Event.extend(B);var D=A.cumulativeOffset();var C=A.getDimensions();return B.pointerX()>D.left&&B.pointerX()<D.left+C.width&&B.pointerY()>D.top&&B.pointerY()<D.top+C.height};In2iGui.getIconUrl=function(B,A){return In2iGui.context+"/In2iGui/icons/"+B+A+".png"};In2iGui.createIcon=function(B,A){return new Element("span",{"class":"in2igui_icon in2igui_icon_"+A}).setStyle({"backgroundImage":"url("+In2iGui.getIconUrl(B,A)+")"})};In2iGui.onDomReady=function(A){if(In2iGui.domReady){return A()}if(n2i.browser.gecko&&document.baseURI.endsWith("xml")){window.setTimeout(A,1000);return }document.observe("dom:loaded",A)};In2iGui.wrapInField=function(B){var A=new Element("div",{"class":"in2igui_field"}).update('<span class="in2igui_field_top"><span><span></span></span></span><span class="in2igui_field_middle"><span class="in2igui_field_middle"><span class="in2igui_field_content"></span></span></span><span class="in2igui_field_bottom"><span><span></span></span></span>');A.select("span.in2igui_field_content")[0].insert(B);return A};In2iGui.addFocusClass=function(B){var A=B.classElement||B.element,C=B["class"];B.element.observe("focus",function(){A.addClassName(C)}).observe("blur",function(){A.removeClassName(C)})};In2iGui.fadeIn=function(A,B){if($(A).getStyle("display")=="none"){A.setStyle({opacity:0,display:""})}n2i.ani(A,"opacity",1,B)};In2iGui.fadeOut=function(A,B){n2i.ani(A,"opacity",0,B,{hideOnComplete:true})};In2iGui.positionAtElement=function(C,G,B){B=B||{};C=$(C);G=$(G);var D=C.getStyle("display");if(D=="none"){C.setStyle({"visibility":"hidden","display":"block"})}var H=G.cumulativeOffset(),F=H.left,E=H.top;var A=B.vertical||null;if(B.horizontal&&B.horizontal=="right"){F=F+G.getWidth()-C.getWidth()}if(A=="topOutside"){E=E-C.getHeight()}else{if(A=="bottomOutside"){E=E+G.getHeight()}}F+=(B.left||0);E+=(B.top||0);C.setStyle({"left":F+"px","top":E+"px"});if(D=="none"){C.setStyle({"visibility":"visible","display":"none"})}};In2iGui.getDragProxy=function(){if(!In2iGui.dragProxy){In2iGui.dragProxy=new Element("div",{"class":"in2igui_dragproxy"}).setStyle({"display":"none"});document.body.appendChild(In2iGui.dragProxy)}return In2iGui.dragProxy};In2iGui.startDrag=function(E,C,A){var D=C.dragDropInfo;In2iGui.dropTypes=In2iGui.findDropTypes(D);if(!In2iGui.dropTypes){return }var B=In2iGui.getDragProxy();Event.observe(document.body,"mousemove",In2iGui.dragListener);Event.observe(document.body,"mouseup",In2iGui.dragEndListener);In2iGui.dragInfo=D;if(D.icon){B.style.backgroundImage="url("+In2iGui.getIconUrl(D.icon,1)+")"}In2iGui.startDragPos={top:Event.pointerY(E),left:Event.pointerX(E)};B.innerHTML="<span>"+D.title+"</span>"||"###";In2iGui.dragging=true;document.body.onselectstart=function(){return false}};In2iGui.findDropTypes=function(D){var A=In2iGui.get();var F=null;for(var C=0;C<A.delegates.length;C++){if(A.delegates[C].dragDrop){for(var B=0;B<A.delegates[C].dragDrop.length;B++){var E=A.delegates[C].dragDrop[B];if(E.drag==D.kind){if(F==null){F={}}F[E.drop]={}}}}}return F};In2iGui.dragListener=function(C){var A=Event.extend(C);In2iGui.dragProxy.style.left=(A.pointerX()+10)+"px";In2iGui.dragProxy.style.top=A.pointerY()+"px";In2iGui.dragProxy.style.display="block";var B=In2iGui.findDropTarget(A.element());if(B&&In2iGui.dropTypes[B.dragDropInfo["kind"]]){if(In2iGui.latestDropTarget){In2iGui.latestDropTarget.removeClassName("in2igui_drop")}B.addClassName("in2igui_drop");In2iGui.latestDropTarget=B}else{if(In2iGui.latestDropTarget){In2iGui.latestDropTarget.removeClassName("in2igui_drop");In2iGui.latestDropTarget=null}}return false};In2iGui.findDropTarget=function(A){while(A){if(A.dragDropInfo){return A}A=A.parentNode}return null};In2iGui.dragEndListener=function(A){Event.stopObserving(document.body,"mousemove",In2iGui.dragListener);Event.stopObserving(document.body,"mouseup",In2iGui.dragEndListener);In2iGui.dragging=false;if(In2iGui.latestDropTarget){In2iGui.latestDropTarget.removeClassName("in2igui_drop");In2iGui.callDelegatesDrop(In2iGui.dragInfo,In2iGui.latestDropTarget.dragDropInfo);In2iGui.dragProxy.style.display="none"}else{n2i.ani(In2iGui.dragProxy,"left",(In2iGui.startDragPos.left+10)+"px",200,{ease:n2i.ease.fastSlow});n2i.ani(In2iGui.dragProxy,"top",(In2iGui.startDragPos.top-5)+"px",200,{ease:n2i.ease.fastSlow,hideOnComplete:true})}In2iGui.latestDropTarget=null;document.body.onselectstart=null};In2iGui.dropOverListener=function(A){if(In2iGui.dragging){}};In2iGui.dropOutListener=function(A){if(In2iGui.dragging){}};In2iGui.extend=function(B,A){if(!B.name){In2iGui.latestObjectIndex++;B.name="unnamed"+In2iGui.latestObjectIndex}if(A!==undefined){if(B.options){B.options=n2i.override(B.options,A)}B.element=$(A.element);B.name=A.name}In2iGui.get().objects.set(B.name,B);B.delegates=[];B.addDelegate=B.listen=function(C){n2i.addToArray(this.delegates,C)};B.removeDelegate=function(C){n2i.removeFromArray(this.delegates,C)};B.fire=function(E,D,C){In2iGui.callDelegates(this,E,D,C)};B.fireProperty=function(C,D){In2iGui.firePropertyChange(this,C,D)};if(!B.getElement){B.getElement=function(){return this.element}}if(!B.valueForProperty){B.valueForProperty=function(C){return this[C]}}};In2iGui.callDelegatesDrop=function(B,E){var C=In2iGui.get();var A=null;for(var D=0;D<C.delegates.length;D++){if(C.delegates[D]["$drop$"+B.kind+"$"+E.kind]){C.delegates[D]["$drop$"+B.kind+"$"+E.kind](B,E)}}};In2iGui.callAncestors=function(C,E,B,A){if(typeof (B)=="undefined"){B=C}var D=In2iGui.get().getAncestors(C);D.each(function(F){if(F[E]){thisResult=F[E](B,A)}})};In2iGui.callDescendants=function(C,E,B,A){if(typeof (B)=="undefined"){B=C}var D=In2iGui.get().getDescendants(C);D.each(function(F){if(F[E]){thisResult=F[E](B,A)}})};In2iGui.callVisible=function(A){In2iGui.callDescendants(A,"$visibilityChanged")};In2iGui.addDelegate=function(A){In2iGui.get().addDelegate(A)};In2iGui.callDelegates=function(E,A,H,B){if(typeof (H)=="undefined"){H=E}var I=null;if(E.delegates){for(var F=0;F<E.delegates.length;F++){var G=E.delegates[F];var C=null;if(E.name&&G["$"+A+"$"+E.name]){C=G["$"+A+"$"+E.name](H,B)}else{if(E.name&&G[A+"$"+E.name]){C=G[A+"$"+E.name](H,B)}else{if("$"+E.name&&G[A+"$"+E.name]){C=G["$"+A+"$"+E.name](H,B)}else{if(E.kind&&G[A+"$"+E.kind]){C=G[A+"$"+E.kind](H,B)}else{if(G[A]){C=G[A](H,B)}else{if(G["$"+A]){C=G["$"+A](H,B)}}}}}}if(I==null&&C!=null&&typeof (C)!="undefined"){I=C}}}var D=In2iGui.callSuperDelegates(E,A,H,B);if(I==null&&D!=null){I=D}return I};In2iGui.callSuperDelegates=function(E,A,H,B){if(typeof (H)=="undefined"){H=E}var C=In2iGui.get();var I=null;for(var F=0;F<C.delegates.length;F++){var G=C.delegates[F];var D=null;if(E.name&&G["$"+A+"$"+E.name]){D=G["$"+A+"$"+E.name](H,B)}else{if(E.name&&G[A+"$"+E.name]){D=G[A+"$"+E.name](H,B)}else{if(E.kind&&G[A+"$"+E.kind]){D=G[A+"$"+E.kind](H,B)}else{if(G[A]){D=G[A](H,B)}else{if(G["$"+A]){D=G["$"+A](H,B)}}}}}if(I==null&&D!=null&&typeof (D)!="undefined"){I=D}}return I};In2iGui.resolveImageUrl=function(G,C,F,A){for(var D=0;D<G.delegates.length;D++){if(G.delegates[D].resolveImageUrl){return G.delegates[D].resolveImageUrl(C,F,A)}}var B=In2iGui.get();for(var D=0;D<B.delegates.length;D++){var E=B.delegates[D];if(E.resolveImageUrl){return E.resolveImageUrl(C,F,A)}}return null};In2iGui.firePropertyChange=function(C,A,B){In2iGui.callDelegates(C,"propertyChanged",{property:A,value:B})};In2iGui.bind=function(E,A){if(E.charAt(0)=="@"){var D=E.substring(1).split(".");var C=In2iGui.get(D[0]);var B=D.slice(1).join(".");C.addDelegate({propertyChanged:function(F){if(F.property==B){A(F.value)}}});return C.valueForProperty(B)}return E};In2iGui.dwrUpdate=function(){var C=arguments[0];var B={callback:function(D){In2iGui.handleDwrUpdate(D)}};var A=arguments.length;if(A==1){C(B)}else{if(A==2){C(arguments[1],B)}else{alert("Too many parameters")}}};In2iGui.handleDwrUpdate=function(C){var A=In2iGui.get();for(var B=0;B<C.length;B++){if(A.objects.get(C[B].name)){A.objects.get(C[B].name).updateFromObject(C[B])}}};In2iGui.update=function(A,B){var C={onSuccess:function(D){In2iGui.handleUpdate(D,B)}};$get(A,C)};In2iGui.handleUpdate=function(E,F){var A=In2iGui.get();var G=E.responseXML.firstChild;var D=G.childNodes;for(var C=0;C<D.length;C++){if(D[C].nodeType==1){var B=D[C].getAttribute("name");if(B&&B!=""&&A.objects.get(B)){A.objects.get(B).updateFromNode(D[C])}}}F.onSuccess()};In2iGui.jsonResponse=function(C,B){if(!C.responseXML||!C.responseXML.documentElement){var D=C.responseText.replace(/^\s+|\s+$/g,"");if(D.length>0){var A=C.responseText.evalJSON(true)}else{A=""}In2iGui.callDelegates(A,"success$"+B)}else{In2iGui.callDelegates(C,"success$"+B)}};In2iGui.json=function(D,C,B){var A={method:"post",parameters:{},onException:function(E){throw E}};if(typeof (B)=="string"){A.onSuccess=function(E){In2iGui.jsonResponse(E,B)}}else{delegate=B}for(key in D){A.parameters[key]=Object.toJSON(D[key])}new Ajax.Request(C,A)};In2iGui.jsonRequest=function(B){var A={method:"post",parameters:{},onException:function(C){throw C}};if(typeof (B.event)=="string"){A.onSuccess=function(C){In2iGui.jsonResponse(C,B.event)}}else{delegate=delegateOrKey}for(key in B.parameters){A.parameters[key]=Object.toJSON(B.parameters[key])}new Ajax.Request(B.url,A)};In2iGui.request=function(A){A=n2i.override({method:"post",parameters:{}},A);if(A.json){for(key in A.json){A.parameters[key]=Object.toJSON(A.json[key])}}var B=A.onSuccess;A.onSuccess=function(D){if(typeof (B)=="string"){In2iGui.jsonResponse(D,B)}else{if(D.responseXML&&D.responseXML.documentElement.nodeName!="parsererror"&&A.onXML){A.onXML(D.responseXML)}else{if(A.onJSON){var E=D.responseText.replace(/^\s+|\s+$/g,"");if(E.length>0){var C=D.responseText.evalJSON(true)}else{var C=null}A.onJSON(C)}else{if(typeof (B)=="function"){B(D)}}}}};A.onException=function(C,D){n2i.log(D)};new Ajax.Request(A.url,A)};In2iGui.parseItems=function(C){var A=C.documentElement;var B=[];In2iGui.parseSubItems(A,B);return B};In2iGui.parseSubItems=function(D,F){var B=D.childNodes;for(var A=0;A<B.length;A++){var E=B[A];if(E.nodeType==1&&E.nodeName=="item"){var C=[];In2iGui.parseSubItems(E,C);F.push({title:E.getAttribute("title"),value:E.getAttribute("value"),icon:E.getAttribute("icon"),kind:E.getAttribute("kind"),badge:E.getAttribute("badge"),children:C})}}};In2iGui.Source=function(A){this.options=n2i.override({url:null,dwr:null,parameters:[]},A);this.name=A.name;this.data=null;this.parameters=this.options.parameters;In2iGui.extend(this);if(A.delegate){this.addDelegate(A.delegate)}this.busy=false;In2iGui.onDomReady(this.init.bind(this))};In2iGui.Source.prototype={init:function(){var A=this;this.parameters.each(function(B){B.value=In2iGui.bind(B.value,function(C){A.changeParameter(B.key,C)})});this.refresh()},refresh:function(){if(this.delegates.length==0){return }if(this.busy){this.pendingRefresh=true;return }this.pendingRefresh=false;var self=this;if(this.options.url){var url=new n2i.URL(this.options.url);this.parameters.each(function(p){url.addParameter(p.key,p.value)});this.busy=true;In2iGui.callDelegates(this,"sourceIsBusy");new Ajax.Request(url.toString(),{onSuccess:function(t){self.parse(t)},onException:function(t,e){n2i.log(e)}})}else{if(this.options.dwr){var pair=this.options.dwr.split(".");var facade=eval(pair[0]);var method=pair[1];var args=facade[method].argumentNames();for(var i=0;i<args.length;i++){if(this.parameters[i]){args[i]=this.parameters[i].value||null}}args[args.length-1]=function(r){self.parseDWR(r)};this.busy=true;In2iGui.callDelegates(this,"sourceIsBusy");facade[method].apply(facade,args)}}},end:function(){In2iGui.callDelegates(this,"sourceIsNotBusy");this.busy=false;if(this.pendingRefresh){this.refresh()}},parse:function(A){if(A.responseXML){this.parseXML(A.responseXML)}this.end()},parseXML:function(A){if(A.documentElement.tagName=="items"){this.data=In2iGui.parseItems(A);this.fire("itemsLoaded",this.data)}else{if(A.documentElement.tagName=="list"){this.fire("listLoaded",A)}else{if(A.documentElement.tagName=="articles"){this.fire("articlesLoaded",A)}}}},parseDWR:function(A){this.data=A;this.fire("objectsLoaded",A);this.end()},addParameter:function(A){this.parameters.push(A)},changeParameter:function(B,C){this.parameters.each(function(D){if(D.key==B){D.value=C}});var A=this;window.clearTimeout(this.paramDelay);this.paramDelay=window.setTimeout(function(){this.refresh()}.bind(this),100)}};Element.addMethods({setClassName:function(B,A,C){if(C){B.addClassName(A)}else{B.removeClassName(A)}return B}});In2iGui.ImageViewer=function(A){this.options=n2i.override({maxWidth:800,maxHeight:600,perimeter:100,sizeSnap:100,margin:0,ease:n2i.ease.slowFastSlow,easeEnd:n2i.ease.bounce,easeAuto:n2i.ease.slowFastSlow,easeReturn:n2i.ease.cubicInOut,transition:400,transitionEnd:1000,transitionReturn:300},A);this.element=$(A.element);this.box=this.options.box;this.viewer=this.element.select(".in2igui_imageviewer_viewer")[0];this.innerViewer=this.element.select(".in2igui_imageviewer_inner_viewer")[0];this.status=this.element.select(".in2igui_imageviewer_status")[0];this.previousControl=this.element.select(".in2igui_imageviewer_previous")[0];this.controller=this.element.select(".in2igui_imageviewer_controller")[0];this.nextControl=this.element.select(".in2igui_imageviewer_next")[0];this.playControl=this.element.select(".in2igui_imageviewer_play")[0];this.closeControl=this.element.select(".in2igui_imageviewer_close")[0];this.text=this.element.select(".in2igui_imageviewer_text")[0];this.dirty=false;this.width=600;this.height=460;this.index=0;this.playing=false;this.name=A.name;this.images=[];this.box.addDelegate(this);this.addBehavior();In2iGui.extend(this)};In2iGui.ImageViewer.create=function(A){A=A||{};var B=A.element=new Element("div",{"class":"in2igui_imageviewer"});B.update('<div class="in2igui_imageviewer_viewer"><div class="in2igui_imageviewer_inner_viewer"></div></div><div class="in2igui_imageviewer_text"></div><div class="in2igui_imageviewer_status"></div><div class="in2igui_imageviewer_controller"><div><div><a class="in2igui_imageviewer_previous"></a><a class="in2igui_imageviewer_play"></a><a class="in2igui_imageviewer_next"></a><a class="in2igui_imageviewer_close"></a></div></div></div>');var C=In2iGui.Box.create({absolute:true,modal:true,closable:true});C.add(B);C.addToDocument();A.box=C;return new In2iGui.ImageViewer(A)};In2iGui.ImageViewer.prototype={addBehavior:function(){var A=this;this.nextControl.onclick=function(){A.next(true)};this.previousControl.onclick=function(){A.previous(true)};this.playControl.onclick=function(){A.playOrPause()};this.closeControl.onclick=this.hide.bind(this);this.viewer.observe("click",this.zoom.bind(this));this.timer=function(){A.next(false)};this.keyListener=function(B){if(n2i.isRightKey(B)){A.next(true)}else{if(n2i.isLeftKey(B)){A.previous(true)}else{if(n2i.isEscapeKey(B)){A.hide()}else{if(n2i.isReturnKey(B)){A.playOrPause()}}}}},this.viewer.observe("mousemove",this.mouseMoveEvent.bind(this));this.controller.observe("mouseenter",function(){A.overController=true});this.controller.observe("mouseleave",function(){A.overController=false});this.viewer.observe("mouseout",function(B){if(!In2iGui.isWithin(B,this.viewer)){A.hideController()}}.bind(this))},mouseMoveEvent:function(){window.clearTimeout(this.ctrlHider);if(this.shouldShowController()){this.ctrlHider=window.setTimeout(this.hideController.bind(this),2000);if(n2i.browser.msie){this.controller.show()}else{In2iGui.fadeIn(this.controller,200)}}},hideController:function(){if(!this.overController){if(n2i.browser.msie){this.controller.hide()}else{In2iGui.fadeOut(this.controller,500)}}},zoom:function(D){var A=this.images[this.index];if(A.width<=this.width&&A.height<=this.height){return }if(!this.zoomer){this.zoomer=new Element("div",{"class":"in2igui_imageviewer_zoomer"}).setStyle({width:this.viewer.clientWidth+"px",height:this.viewer.clientHeight+"px"});this.element.insert({top:this.zoomer});this.zoomer.observe("mousemove",this.zoomMove.bind(this));this.zoomer.observe("click",function(){this.hide()})}this.pause();var C=this.getLargestSize({width:2000,height:2000},A);var B=In2iGui.resolveImageUrl(this,A,C.width,C.height);this.zoomer.update('<div style="width:'+C.width+"px;height:"+C.height+'px;"><img src="'+B+'"/></div>').show();this.zoomInfo={width:C.width,height:C.height};this.zoomMove(D)},zoomMove:function(B){var C=this.zoomer.cumulativeOffset();var A=(B.pointerX()-C.left)/this.zoomer.clientWidth*(this.zoomInfo.width-this.zoomer.clientWidth);var D=(B.pointerY()-C.top)/this.zoomer.clientHeight*(this.zoomInfo.height-this.zoomer.clientHeight);this.zoomer.scrollLeft=A;this.zoomer.scrollTop=D},getLargestSize:function(A,B){if(B.width<=A.width&&B.height<=A.height){return{width:B.width,height:B.height}}else{if(A.width/A.height>B.width/B.height){return{width:A.height/B.height*B.width,height:A.height}}else{if(A.width/A.height<B.width/B.height){return{width:A.width,height:A.width/B.width*B.height}}else{return{width:A.width,height:A.height}}}}},calculateSize:function(){var A=this.options.sizeSnap;var F=n2i.getInnerWidth()-this.options.perimeter;F=Math.floor(F/A)*A;F=Math.min(F,this.options.maxWidth);var B=n2i.getInnerHeight()-this.options.perimeter;B=Math.floor(B/A)*A;B=Math.min(B,this.options.maxHeight);var E=0;var D=0;for(var C=0;C<this.images.length;C++){var G=this.getLargestSize({width:F,height:B},this.images[C]);E=Math.max(E,G.width);D=Math.max(D,G.height)}B=Math.floor(Math.min(B,D));F=Math.floor(Math.min(F,E));if(F!=this.width||B!=this.height){this.width=F;this.height=B;this.dirty=true}},adjustSize:function(){},showById:function(B){for(var A=0;A<this.images.length;A++){if(this.images[A].id==B){this.show(A);break}}},show:function(A){this.index=A||0;this.calculateSize();this.updateUI();var B=this.options.margin;this.element.setStyle({width:(this.width+B)+"px",height:(this.height+B*2-1)+"px"});this.viewer.setStyle({width:(this.width+B)+"px",height:(this.height-1)+"px"});this.innerViewer.setStyle({width:((this.width+B)*this.images.length)+"px",height:(this.height-1)+"px"});this.controller.setStyle({marginLeft:((this.width-180)/2+B*0.5)+"px",display:"none"});this.box.show();this.goToImage(false,0,false);Event.observe(document,"keydown",this.keyListener)},hide:function(A){this.pause();this.box.hide();Event.stopObserving(document,"keydown",this.keyListener)},$boxCurtainWasClicked:function(){this.hide()},$boxWasClosed:function(){this.hide()},updateUI:function(){if(this.dirty){this.innerViewer.innerHTML="";for(var B=0;B<this.images.length;B++){var A=new Element("div",{"class":"in2igui_imageviewer_image"}).setStyle({"width":(this.width+this.options.margin)+"px","height":(this.height-1)+"px"});this.innerViewer.appendChild(A)}if(this.shouldShowController()){this.controller.show()}else{this.controller.hide()}this.dirty=false;this.preload()}},shouldShowController:function(){return this.images.length>1},goToImage:function(C,D,B){if(C){if(D>1){n2i.ani(this.viewer,"scrollLeft",this.index*(this.width+this.options.margin),Math.min(D*this.options.transitionReturn,2000),{ease:this.options.easeReturn})}else{var A=this.index==0||this.index==this.images.length-1;var F=(A?this.options.easeEnd:this.options.ease);if(!B){F=this.options.easeAuto}n2i.ani(this.viewer,"scrollLeft",this.index*(this.width+this.options.margin),(A?this.options.transitionEnd:this.options.transition),{ease:F})}}else{this.viewer.scrollLeft=this.index*(this.width+this.options.margin)}var E=this.images[this.index].text;if(E){this.text.update(E).show()}else{this.text.update().hide()}},clearImages:function(){this.images=[];this.dirty=true},addImages:function(A){for(var B=0;B<A.length;B++){this.addImage(A[B])}},addImage:function(A){this.images.push(A);this.dirty=true},play:function(){if(!this.interval){this.interval=window.setInterval(this.timer,6000)}this.next(false);this.playing=true;this.playControl.className="in2igui_imageviewer_pause"},pause:function(){window.clearInterval(this.interval);this.interval=null;this.playControl.className="in2igui_imageviewer_play";this.playing=false},playOrPause:function(){if(this.playing){this.pause()}else{this.play()}},resetPlay:function(){if(this.playing){window.clearInterval(this.interval);this.interval=window.setInterval(this.timer,6000)}},previous:function(A){var B=1;this.index--;if(this.index<0){this.index=this.images.length-1;B=this.images.length-1}this.goToImage(true,B,A);this.resetPlay()},next:function(A){var B=1;this.index++;if(this.index==this.images.length){this.index=0;B=this.images.length-1}this.goToImage(true,B,A);this.resetPlay()},preload:function(){var B=new n2i.Preloader();B.addImages(In2iGui.context+"In2iGui/gfx/imageviewer_controls.png");var A=this;B.setDelegate({allImagesDidLoad:function(){A.preloadImages()}});B.load()},preloadImages:function(){this.loader=new n2i.Preloader();this.loader.setDelegate(this);for(var B=0;B<this.images.length;B++){var A=In2iGui.resolveImageUrl(this,this.images[B],this.width,this.height);this.loader.addImages(A)}this.status.innerHTML="0%";this.status.style.display="";this.loader.load()},allImagesDidLoad:function(){this.status.style.display="none"},imageDidLoad:function(C,D,B){this.status.innerHTML=Math.round(C/D*100)+"%";var A=In2iGui.resolveImageUrl(this,this.images[B],this.width,this.height);A=A.replace(/&amp;/g,"&");this.innerViewer.childNodes[B].style.backgroundImage="url('"+A+"')";Element.setClassName(this.innerViewer.childNodes[B],"in2igui_imageviewer_image_abort",false);Element.setClassName(this.innerViewer.childNodes[B],"in2igui_imageviewer_image_error",false)},imageDidGiveError:function(B,C,A){Element.setClassName(this.innerViewer.childNodes[A],"in2igui_imageviewer_image_error",true)},imageDidAbort:function(B,C,A){Element.setClassName(this.innerViewer.childNodes[A],"in2igui_imageviewer_image_abort",true)}};In2iGui.Box=function(C,B,A){this.options=n2i.override({},A);this.name=B;this.element=$(C);this.body=this.element.select(".in2igui_box_body")[0];this.close=this.element.select(".in2igui_box_close")[0];if(this.close){this.close.observe("click",function(D){D.stop();this.hide();this.fire("boxWasClosed")}.bind(this))}In2iGui.extend(this)};In2iGui.Box.create=function(A){A=n2i.override({},A);var B=new Element("div",{"class":"in2igui_box"});if(A.width){B.setStyle({width:A.width+"px"})}if(A.absolute){B.addClassName("in2igui_box_absolute")}B.update((A.closable?'<a class="in2igui_box_close" href="#"></a>':"")+'<div class="in2igui_box_top"><div><div></div></div></div><div class="in2igui_box_middle"><div class="in2igui_box_middle">'+(A.title?'<div class="in2igui_box_header"><strong class="in2igui_box_title">'+A.title+"</strong></div>":"")+'<div class="in2igui_box_body"'+(A.padding?' style="padding: '+A.padding+'px;"':"")+'></div></div></div><div class="in2igui_box_bottom"><div><div></div></div></div>');return new In2iGui.Box(B,name,A)};In2iGui.Box.prototype={addToDocument:function(){document.body.appendChild(this.element)},add:function(A){if(A.getElement){this.body.insert(A.getElement())}else{this.body.insert(A)}},show:function(){var D=this.element;if(this.options.modal){var B=In2iGui.nextPanelIndex();D.style.zIndex=B+1;In2iGui.showCurtain(this,B)}D.setStyle({display:"block",visibility:"hidden"});var A=D.getWidth();var C=(n2i.getInnerHeight()-D.getHeight())/2+n2i.getScrollTop();D.setStyle({"marginLeft":(A/-2)+"px",top:C+"px"});D.setStyle({display:"block",visibility:"visible"});In2iGui.callVisible(this)},hide:function(){In2iGui.hideCurtain(this);this.element.setStyle({display:"none"})},curtainWasClicked:function(){this.fire("boxCurtainWasClicked")}}