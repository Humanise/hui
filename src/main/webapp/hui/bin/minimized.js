var hui={browser:{},KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45};(function(b,c,d){b.msie=!/opera/i.test(c)&&/MSIE/.test(c)||/Trident/.test(c);b.msie6=c.indexOf("MSIE 6")!==-1;b.msie7=c.indexOf("MSIE 7")!==-1;b.msie8=c.indexOf("MSIE 8")!==-1;b.msie9=c.indexOf("MSIE 9")!==-1;b.msie9compat=b.msie7&&c.indexOf("Trident/5.0")!==-1;b.msie10=c.indexOf("MSIE 10")!==-1;b.msie11=c.indexOf("Trident/7.0")!==-1;b.webkit=c.indexOf("WebKit")!==-1;b.safari=c.indexOf("Safari")!==-1;b.webkitVersion=null;b.gecko=!b.webkit&&!b.msie&&c.indexOf("Gecko")!==-1;b.ipad=b.webkit&&c.indexOf("iPad")!==-1;b.windows=c.indexOf("Windows")!==-1;b.opacity=!b.msie6&&!b.msie7&&!b.msie8;b.mediaQueries=b.opacity;b.animation=!b.msie6&&!b.msie7&&!b.msie8&&!b.msie9;b.wordbreak=!b.msie6&&!b.msie7&&!b.msie8;b.touch=(!!("ontouchstart" in d)||(!!("onmsgesturechange" in d)&&!!d.navigator.maxTouchPoints))?true:false;var a=/Safari\/([\d.]+)/.exec(c);if(a){b.webkitVersion=parseFloat(a[1])}})(hui.browser,navigator.userAgent,window);hui.log=function(a){try{if(arguments.length==1){console.log(a)}else{if(arguments.length==2){console.log(arguments[0],arguments[1])}else{console.log(arguments)}}}catch(b){}};hui.defer=function(a,b){if(b){a=a.bind(b)}window.setTimeout(a)};hui.override=function(b,a){if(a){for(var c in a){b[c]=a[c]}}return b};hui.each=function(a,d){var c;if(hui.isArray(a)){for(c=0;c<a.length;c++){d(a[c],c)}}else{if(a instanceof NodeList){for(c=0;c<a.length;c++){d(a.item(c),c)}}else{for(var b in a){d(b,a[b])}}}};hui.when=function(b,a){return b?a:""};hui.intOrString=function(b){if(hui.isDefined(b)){var a=/[0-9]+/.exec(b);if(a!==null&&a[0]==b){if(parseInt(b,10)==b){return parseInt(b,10)}}}return b};hui.between=function(c,d,b){var a=Math.min(b,Math.max(c,d));return isNaN(a)?c:a};hui.fit=function(f,b,c){c=c||{};var e=f.width/f.height;var g=b.width/b.height;var d,a;if(c.upscale===false&&f.width<=b.width&&f.height<=b.height){d=f.width;a=f.height}else{if(e>g){d=b.width;a=Math.round(b.width/f.width*f.height)}else{d=Math.round(b.height/f.height*f.width);a=b.height}}return{width:d,height:a}};hui.isBlank=function(a){if(a===null||typeof(a)==="undefined"||a===""){return true}return typeof(a)=="string"&&hui.string.trim(a).length===0};hui.isDefined=function(a){return a!==null&&typeof(a)!=="undefined"};hui.isString=function(a){return typeof(a)==="string"};hui.isArray=function(a){if(a===null||a===undefined){return false}if(a.constructor==Array){return true}else{return Object.prototype.toString.call(a)==="[object Array]"}};hui.string={startsWith:function(a,b){if(typeof(a)!=="string"||typeof(b)!=="string"){return false}return(a.match("^"+b)==b)},endsWith:function(b,a){if(typeof(b)!=="string"||typeof(a)!=="string"){return false}return(b.match(a+"$")==a)},camelize:function(f){if(f.indexOf("-")==-1){return f}var d=f.split("-");var b=f.indexOf("-")===0?d[0].charAt(0).toUpperCase()+d[0].substring(1):d[0];for(var c=1,a=d.length;c<a;c++){var e=d[c];b+=e.charAt(0).toUpperCase()+e.substring(1)}return b},trim:function(a){if(a===null||a===undefined){return""}if(typeof(a)!="string"){a=String(a)}return a.replace(/^[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+|[\s\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]+$/g,"")},wrap:function(a){if(a===null||a===undefined){return""}return a.split("").join("\u200B")},shorten:function(b,a){if(!hui.isDefined(b)){return""}if(b.length>a){return b.substring(0,a-3)+"..."}return b},escapeHTML:function(a){if(a===null||a===undefined){return""}return hui.build("div",{text:a}).innerHTML},escape:function(b){if(!hui.isString(b)){return b}var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};return b.replace(/[&<>'`"]/g,function(c){return a[c]||c})},fromJSON:function(a){try{return JSON.parse(a)}catch(b){hui.log(b);return null}},toJSON:function(a){return JSON.stringify(a)}};hui.array={add:function(a,c){if(c.constructor==Array){for(var b=0;b<c.length;b++){if(!hui.array.contains(a,c[b])){a.push(c)}}}else{if(!hui.array.contains(a,c)){a.push(c)}}},contains:function(a,b){return hui.array.indexOf(a,b)!==-1},flip:function(a,b){if(hui.array.contains(a,b)){hui.array.remove(a,b)}else{a.push(b)}},remove:function(a,c){for(var b=a.length-1;b>=0;b--){if(a[b]==c){a.splice(b,1)}}},indexOf:function(a,c){for(var b=0;b<a.length;b++){if(a[b]===c){return b}}return -1},toIntegers:function(b){var c=b.split(",");for(var a=c.length-1;a>=0;a--){c[a]=parseInt(c[a],10)}return c}};hui.dom={isElement:function(b,a){return b.nodeType==1&&(a===undefined?true:b.nodeName.toLowerCase()==a)},isDefinedText:function(a){return a.nodeType==3&&a.nodeValue.length>0},addText:function(a,b){a.appendChild(document.createTextNode(b))},firstChild:function(c){var b=c.childNodes;for(var a=0;a<b.length;a++){if(b[a].nodeType==1){return b[a]}}return null},parseToNode:function(a){var b=hui.build("div",{html:a});return hui.get.firstChild(b,"table")},clear:function(c){var b=c.childNodes;for(var a=b.length-1;a>=0;a--){b[a].parentNode.removeChild(b[a])}},remove:function(a){if(a.parentNode){a.parentNode.removeChild(a)}},replaceNode:function(b,a){if(a.parentNode){a.parentNode.removeChild(a)}b.parentNode.insertBefore(a,b);b.parentNode.removeChild(b)},changeTag:function(d,b){var c=hui.build(b);while(d.firstChild){c.appendChild(d.firstChild)}for(var a=d.attributes.length-1;a>=0;--a){c.attributes.setNamedItem(d.attributes[a].cloneNode())}d.parentNode.insertBefore(c,d);d.parentNode.removeChild(d);return c},insertBefore:function(b,a){b.parentNode.insertBefore(a,b)},insertAfter:function(c,a){var b=c.nextSibling;if(b){b.parentNode.insertBefore(a,b)}else{c.parentNode.appendChild(a)}},replaceHTML:function(b,a){b=hui.get(b);b.innerHTML=a},runScripts:function(node){if(hui.dom.isElement(node)){if(hui.dom.isElement(node,"script")){eval(node.innerHTML)}else{var scripts=node.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){eval(scripts[i].innerHTML)}}}},setText:function(d,e){if(e===undefined||e===null){e=""}var f=d.childNodes;var a=false;for(var b=f.length-1;b>=0;b--){if(!a&&f[b].nodeType===3){f[b].nodeValue=e;a=true}else{d.removeChild(f[b])}}if(!a){hui.dom.addText(d,e)}},getText:function(d){var a="";var e=d.childNodes;for(var b=0;b<e.length;b++){if(e[b].nodeType===3&&e[b].nodeValue!==null){a+=e[b].nodeValue}else{if(e[b].nodeType==1){a+=hui.dom.getText(e[b])}}}return a},isVisible:function(a){while(a){if(a.style&&(hui.style.get(a,"display")==="none"||hui.style.get(a,"visibility")==="hidden")){return false}a=a.parentNode}return true},isDescendantOrSelf:function(a,b){while(a){if(a==b){return true}a=a.parentNode}return false}};hui.form={getValues:function(c){var d={};var a=c.getElementsByTagName("input");for(var b=0;b<a.length;b++){if(hui.isDefined(a[b].name)){d[a[b].name]=a[b].value}}return d}};hui.get=function(a){if(typeof(a)=="string"){return document.getElementById(a)}return a};hui.get.children=function(d){var c=[];var a=d.childNodes;for(var b=0;b<a.length;b++){if(hui.dom.isElement(a[b])){c.push(a[b])}}return c};hui.get.ancestors=function(a){var c=[];var b=a.parentNode;while(b){c[c.length]=b;b=b.parentNode}return c};hui.get.firstAncestorByClass=function(a,b){while(a){if(hui.cls.has(a,b)){return a}a=a.parentNode}return null};hui.get.next=function(a){if(!a){return null}if(a.nextElementSibling){return a.nextElementSibling}if(!a.nextSibling){return null}var b=a.nextSibling;while(b&&b.nodeType!=1){b=b.nextSibling}if(b&&b.nodeType==1){return b}return null};hui.get.previous=function(a){if(!a){return null}if(a.previousElementSibling){return a.previousElementSibling}if(!a.previousSibling){return null}var b=a.previousSibling;while(b&&b.nodeType!=1){b=b.previousSibling}if(b&&b.nodeType==1){return b}return null};hui.get.before=function(c){var d=[];if(c){var a=c.parentNode.childNodes;for(var b=0;b<a.length;b++){if(a[b]==c){break}else{if(a[b].nodeType===1){d.push(a[b])}}}}return d};hui.get.after=function(a){var c=[];var b=hui.get.next(a);while(b){c.push(b);b=hui.get.next(b)}return c};hui.get.firstByClass=function(b,e,a){b=hui.get(b)||document.body;if(b.querySelector){return b.querySelector((a?a+".":".")+e)}else{var d=b.getElementsByTagName(a||"*");for(var c=0;c<d.length;c++){if(hui.cls.has(d[c],e)){return d[c]}}}return null};hui.get.byClass=function(d,h,a){d=hui.get(d)||document.body;var g;if(d.querySelectorAll){var c=d.querySelectorAll((a?a+".":".")+h);var b=[];for(g=0,ll=c.length;g!=ll;b.push(c[g++])){}return b}else{var f=d.getElementsByTagName(a||"*"),e=[];for(g=0;g<f.length;g++){if(hui.cls.has(f[g],h)){e[e.length]=f[g]}}return e}};hui.get.byTag=function(e,c){var b=e.getElementsByTagName(c),a=[];for(var d=0,f=b.length;d!=f;a.push(b[d++])){}return a};hui.get.byId=function(d,f){var b=d.childNodes;for(var a=b.length-1;a>=0;a--){if(b[a].nodeType===1&&b[a].getAttribute("id")===f){return b[a]}else{var c=hui.get.byId(b[a],f);if(c){return c}}}return null};hui.get.firstParentByTag=function(c,a){var b=c;while(b){if(b.tagName&&b.tagName.toLowerCase()==a){return b}b=b.parentNode}return null};hui.get.firstParentByClass=function(c,a){var b=c;while(b){if(hui.cls.has(b)){return b}b=b.parentNode}return null};hui.get.firstByTag=function(c,a){c=hui.get(c)||document.body;if(c.querySelector&&a!=="*"){return c.querySelector(a)}var b=c.getElementsByTagName(a);return b[0]};hui.get.firstChild=hui.dom.firstChild;hui.find=function(a,b){return(b||document).querySelector(a)};hui.collect=function(b,a){var c={};for(key in b){c[key]=hui.get.firstByClass(a,b[key])}return c};hui.build=function(b,a,d){d=d||document;var c=d.createElement(b);if(a){for(var f in a){if(f=="text"){c.appendChild(d.createTextNode(a.text))}else{if(f=="html"){c.innerHTML=a.html}else{if(f=="parent"&&hui.isDefined(a.parent)){a.parent.appendChild(c)}else{if(f=="parentFirst"){if(a.parentFirst.childNodes.length===0){a.parentFirst.appendChild(c)}else{a.parentFirst.insertBefore(c,a.parentFirst.childNodes[0])}}else{if(f=="before"){a.before.parentNode.insertBefore(c,a.before)}else{if(f=="className"){c.className=a.className}else{if(f=="class"){c.className=a["class"]}else{if(f=="style"&&typeof(a[f])=="object"){hui.style.set(c,a[f])}else{if(f=="style"&&(hui.browser.msie7||hui.browser.msie6)){c.style.setAttribute("cssText",a[f])}else{if(hui.isDefined(a[f])){c.setAttribute(f,a[f])}}}}}}}}}}}}return c};hui.position={getTop:function(a){a=hui.get(a);if(a){var b=a.offsetTop,c=a.offsetParent;while(c!==null){b+=c.offsetTop;c=c.offsetParent}return b}else{return 0}},getLeft:function(a){a=hui.get(a);if(a){var b=a.offsetLeft,c=a.offsetParent;while(c!==null){b+=c.offsetLeft;c=c.offsetParent}return b}else{return 0}},get:function(a){return{left:hui.position.getLeft(a),top:hui.position.getTop(a)}},getScrollOffset:function(a){a=hui.get(a);var c=0,b=0;do{c+=a.scrollTop||0;b+=a.scrollLeft||0;a=a.parentNode;if(a.tagName==="HTML"){break}}while(a);return{top:c,left:b}},place:function(j){var b=0,g=0,a=hui.get(j.source.element),e=hui.get(j.target.element),d={left:hui.position.getLeft(e),top:hui.position.getTop(e)};b=d.left+e.clientWidth*(j.target.horizontal||0);g=d.top+e.clientHeight*(j.target.vertical||0);b-=a.clientWidth*(j.source.horizontal||0);g-=a.clientHeight*(j.source.vertical||0);if(j.top){g+=j.top}if(j.left){b+=j.left}if(j.insideViewPort){var h=hui.window.getViewWidth();if(b+a.clientWidth>h){b=h-a.clientWidth-(j.viewPartMargin||0)}if(b<0){b=0}if(g<0){g=0}var i=hui.window.getViewHeight();var f=hui.window.getScrollTop()+hui.window.getViewHeight()-a.clientHeight,c=hui.window.getScrollTop();g=Math.max(Math.min(g,f),c)}a.style.top=Math.round(g)+"px";a.style.left=Math.round(b)+"px"},getRemainingHeight:function(d){var a=d.parentNode.clientHeight;var e=d.parentNode.childNodes;for(var c=0;c<e.length;c++){var b=e[c];if(b!==d&&hui.dom.isElement(e[c])){if(hui.style.get(b,"position")!="absolute"){a-=b.offsetHeight}}}return a}};hui.window={getScrollTop:function(){if(window.pageYOffset){return window.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop}else{if(document.body){return document.body.scrollTop}}}return 0},getScrollLeft:function(){if(window.pageYOffset){return window.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollLeft}else{if(document.body){return document.body.scrollLeft}}}return 0},scrollTo:function(i){i=hui.override({duration:0,top:0},i);var c=i.element;var g=hui.position.get(c);var e=hui.window.getScrollTop();var d=hui.window.getViewHeight();var f=e+d;if(e<g.top+c.clientHeight||(g.top)<f){var h=g.top-Math.round((d-c.clientHeight)/2);h-=i.top/2;h=Math.max(0,h);var a=new Date().getTime();var b;b=function(){var j=(new Date().getTime()-a)/i.duration;if(j>1){j=1}window.scrollTo(0,e+Math.round((h-e)*hui.ease.fastSlow(j)));if(j<1){window.setTimeout(b)}};b()}},getViewHeight:function(){if(window.innerHeight){return window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight}else{if(document.body){return document.body.clientHeight}}}},getViewWidth:function(){if(window.innerWidth){return window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth}else{if(document.body){return document.body.clientWidth}}}}};hui.cls={has:function(d,e){d=hui.get(d);if(!d||!d.className){return false}if(d.hasClassName){return d.hasClassName(e)}if(d.className==e){return true}var b=d.className.split(/\s+/);for(var c=0;c<b.length;c++){if(b[c]==e){return true}}return false},add:function(a,b){a=hui.get(a);if(!a){return}if(a.addClassName){a.addClassName(b)}hui.cls.remove(a,b);a.className+=" "+b},remove:function(e,f){e=hui.get(e);if(!e||!e.className){return}if(e.removeClassName){e.removeClassName(f)}if(e.className==f){e.className="";return}var c="";var b=e.className.split(/\s+/);for(var d=0;d<b.length;d++){if(b[d]!=f){if(d>0){c+=" "}c+=b[d]}}e.className=c},toggle:function(a,b){if(hui.cls.has(a,b)){hui.cls.remove(a,b)}else{hui.cls.add(a,b)}},set:function(a,b,c){if(c){hui.cls.add(a,b)}else{hui.cls.remove(a,b)}}};hui.listen=function(b,c,d,a){b=hui.get(b);if(!b){return}if(document.addEventListener){b.addEventListener(c,d,a?true:false)}else{b.attachEvent("on"+c,d)}};hui.listenOnce=function(a,b,d){var c=null;c=function(f){hui.unListen(a,b,c);d(f)};hui.listen(a,b,c)};hui.unListen=function(c,b,d,a){c=hui.get(c);if(document.removeEventListener){c.removeEventListener(b,d,a?true:false)}else{c.detachEvent("on"+b,d)}};hui.event=function(a){if(a!==undefined&&a.huiEvent===true){return a}return new hui.Event(a)};hui.Event=function(a){this.huiEvent=true;this.event=a=a||window.event;if(!a){hui.log("No event")}this.element=a.target?a.target:a.srcElement;this.shiftKey=a.shiftKey;this.altKey=a.altKey;this.metaKey=a.metaKey;this.returnKey=a.keyCode==13;this.escapeKey=a.keyCode==27;this.spaceKey=a.keyCode==32;this.backspaceKey=a.keyCode==8;this.upKey=a.keyCode==38;this.downKey=a.keyCode==40;this.leftKey=a.keyCode==37;this.rightKey=a.keyCode==39;this.keyCode=a.keyCode};hui.Event.prototype={getLeft:function(){var a=0;if(this.event){if(this.event.pageX){a=this.event.pageX}else{if(this.event.clientX){a=this.event.clientX+hui.window.getScrollLeft()}}}return a},getTop:function(){var a=0;if(this.event){if(this.event.pageY){a=this.event.pageY}else{if(this.event.clientY){a=this.event.clientY+hui.window.getScrollTop()}}}return a},getElement:function(){return this.element},findByClass:function(a){return hui.get.firstAncestorByClass(this.element,a)},findByTag:function(a){var b=this.element;while(b){if(b.tagName&&b.tagName.toLowerCase()==a){return b}b=b.parentNode}return null},find:function(b){var a=this.element;while(a){if(a.tagName&&a.tagName.toLowerCase()==tag){if(b(a)){return a}}a=a.parentNode}return null},isDescendantOf:function(b){var a=this.element;while(a){if(a===b){return true}a=a.parentNode}return false},stop:function(){hui.stop(this.event)}};hui.stop=function(a){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}if(a.preventDefault){a.preventDefault()}a.cancelBubble=true;a.stopped=true};hui._defered=[];hui._ready=document.readyState=="complete";hui.onReady=function(a){if(hui._ready){a()}else{hui._defered.push(a)}if(hui._defered.length==1){hui._onReady(function(){hui._ready=true;for(var b=0;b<hui._defered.length;b++){hui._defered[b]()}hui._defered=null})}};hui._onReady=function(a){if(window.addEventListener){window.addEventListener("DOMContentLoaded",a,false)}else{if(typeof document.addEventListener!="undefined"){document.addEventListener("load",a,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onload",a)}else{if(typeof window.onload=="function"){var b=window.onload;window.onload=function(){b();a()}}else{window.onload=a}}}}};hui.request=function(c){c=hui.override({method:"POST",async:true,headers:{Ajax:true}},c);var g=new XMLHttpRequest();if(!g){return}g.onreadystatechange=function(){try{if(g.readyState==4){if(g.status==200&&c.$success){c.$success(g)}else{if(g.status==403&&c.$forbidden){c.$forbidden(g)}else{if(g.status!==0&&c.$failure){c.$failure(g)}else{if(g.status===0&&c.$abort){c.$abort(g)}}}}if(c.$finally){c.$finally()}}}catch(h){if(c.$exception){c.$exception(h,g)}else{throw h}}};var f=c.method.toUpperCase();g.open(f,c.url,c.async);var a=null;if(f=="POST"&&c.file){if(false){a=c.file;g.setRequestHeader("Content-type",c.file.type);g.setRequestHeader("X_FILE_NAME",c.file.name)}else{a=new FormData();a.append("file",c.file);if(c.parameters){for(var e in c.parameters){a.append(e,c.parameters[e])}}}if(c.$progress){g.upload.addEventListener("progress",function(h){c.$progress(h.loaded,h.total)},false)}if(c.$load){g.upload.addEventListener("load",function(h){c.$load()},false)}}else{if(f=="POST"&&c.files){a=new FormData();for(var d=0;d<c.files.length;d++){a.append("file"+d,c.files[d])}}else{if(f=="POST"&&c.parameters){a=hui.request._buildPostBody(c.parameters);g.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=utf-8")}else{a=""}}}if(c.headers){for(var b in c.headers){g.setRequestHeader(b,c.headers[b])}}g.send(a);return g};hui.request.isXMLResponse=function(a){return a.responseXML&&a.responseXML.documentElement&&a.responseXML.documentElement.nodeName!="parsererror"};hui.request._buildPostBody=function(c){if(!c){return null}var a="",d;if(hui.isArray(c)){for(var b=0;b<c.length;b++){d=c[b];if(b>0){a+="&"}a+=encodeURIComponent(d.name)+"=";if(d.value!==undefined&&d.value!==null){a+=encodeURIComponent(d.value)}}}else{for(d in c){if(a.length>0){a+="&"}a+=encodeURIComponent(d)+"=";if(c[d]!==undefined&&c[d]!==null){a+=encodeURIComponent(c[d])}}}return a};hui.style={copy:function(e,f,b){for(var a=0;a<b.length;a++){var d=b[a];var c=hui.style.get(e,d);if(c){f.style[hui.string.camelize(d)]=c}}},set:function(a,c){for(var b in c){if(b==="transform"){a.style.webkitTransform=c[b]}else{if(b==="opacity"){hui.style.setOpacity(a,c[b])}else{a.style[b]=c[b]}}}},get:function(b,c){b=hui.get(b);var e=hui.string.camelize(c);var d=b.style[e];if(!d){if(document.defaultView&&document.defaultView.getComputedStyle){var a=document.defaultView.getComputedStyle(b,null);d=a?a.getPropertyValue(c):null}else{if(b.currentStyle){d=b.currentStyle[e]}}}if(window.opera&&hui.array.contains(["left","top","right","bottom"],c)){if(hui.style.get(b,"position")=="static"){d="auto"}}return d=="auto"?"":d},setOpacity:function(b,a){if(!hui.browser.opacity){if(a==1){b.style.filter=null}else{b.style.filter="alpha(opacity="+(a*100)+")"}}else{b.style.opacity=a}},length:function(a){if(typeof(a)==="number"){return a+"px"}return a}};hui.frame={getDocument:function(a){if(a.contentDocument){return a.contentDocument}else{if(a.contentWindow){return a.contentWindow.document}else{if(a.document){return a.document}}}},getWindow:function(a){if(a.defaultView){return a.defaultView}else{if(a.contentWindow){return a.contentWindow}}}};hui.selection={clear:function(){var a;if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){a=window.getSelection();if(a&&a.removeAllRanges){a.removeAllRanges()}}}},getText:function(a){a=a||document;if(a.getSelection){return a.getSelection()+""}else{if(a.selection){return a.selection.createRange().text}}return""},getNode:function(b){b=b||document;if(b.getSelection){var a=b.getSelection().getRangeAt(0);if(typeof(a.commonAncestorContainer)=="function"){return a.commonAncestorContainer()}return a.commonAncestorContainer}return null},get:function(a){return{node:hui.selection.getNode(a),text:hui.selection.getText(a)}},enable:function(a){document.onselectstart=a?null:function(){return false};document.body.style.webkitUserSelect=a?null:"none"}};hui.effect={makeFlippable:function(a){if(hui.browser.webkit){hui.cls.add(a.container,"hui_flip_container");hui.cls.add(a.front,"hui_flip_front");hui.cls.add(a.back,"hui_flip_back")}else{hui.cls.add(a.front,"hui_flip_front_legacy");hui.cls.add(a.back,"hui_flip_back_legacy")}},flip:function(b){if(!hui.browser.webkit){hui.cls.toggle(b.element,"hui_flip_flipped_legacy")}else{var c=hui.get(b.element);var e=b.duration||"1s";var d=hui.get.firstByClass(c,"hui_flip_front");var a=hui.get.firstByClass(c,"hui_flip_back");d.style.webkitTransitionDuration=e;a.style.webkitTransitionDuration=e;hui.cls.toggle(b.element,"hui_flip_flipped")}},bounceIn:function(a){var b=a.element;if(hui.browser.msie){hui.style.set(b,{display:"block",visibility:"visible"})}else{hui.style.set(b,{display:"block",opacity:0,visibility:"visible"});hui.animate(b,"transform","scale(0.1)",0);window.setTimeout(function(){hui.animate(b,"opacity",1,300);hui.animate(b,"transform","scale(1)",400,{ease:hui.ease.backOut})})}},fadeIn:function(a){var b=a.element;if(hui.style.get(b,"display")=="none"){hui.style.set(b,{opacity:0,display:"inherit"})}hui.animate({node:b,css:{opacity:1},delay:a.delay||null,duration:a.duration||500,$complete:a.onComplete||a.$complete})},fadeOut:function(a){hui.animate({node:a.element,css:{opacity:0},delay:a.delay||null,duration:a.duration||500,hideOnComplete:true,complete:a.onComplete||a.$complete})},wiggle:function(a){var b=hui.ui.getElement(a.element);hui.cls.add(a.element,"hui_effect_wiggle");window.setTimeout(function(){hui.cls.remove(a.element,"hui_effect_wiggle")},a.duration||1000)},shake:function(a){var b=hui.ui.getElement(a.element);hui.cls.add(a.element,"hui_effect_shake");window.setTimeout(function(){hui.cls.remove(a.element,"hui_effect_shake")},a.duration||1000)}};hui.document={getWidth:function(){return Math.max(document.body.clientWidth,document.documentElement.clientWidth,document.documentElement.scrollWidth)},getHeight:function(){if(hui.browser.msie6){var a=Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight);var c=document.body.childNodes;for(var b=0;b<c.length;b++){if(hui.dom.isElement(c[b])){a=Math.max(a,c[b].clientHeight)}}return a}if(window.scrollMaxY&&window.innerHeight){return window.scrollMaxY+window.innerHeight}else{return Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight)}}};hui.drag={register:function(a){var b=a.touch&&hui.browser.touch;hui.listen(a.element,b?"touchstart":"mousedown",function(c){c=hui.event(c);if(a.$check&&a.$check(c)===false){return}c.stop();hui.drag.start(a,c)})},start:function(j,d){var f=hui.browser.msie?document:window;var c=j.touch&&hui.browser.touch;if(j.onStart){j.onStart()}var b={x:d.getLeft(),y:d.getTop(),time:Date.now()};var g=b;var a,i,h=false;a=function(k){k=hui.event(k);k.stop(k);if(!h&&j.onBeforeMove){j.onBeforeMove(k)}h=true;j.onMove(k)}.bind(this);hui.listen(f,c?"touchmove":"mousemove",a);i=function(){hui.unListen(f,c?"touchmove":"mousemove",a);hui.unListen(f,c?"touchend":"mouseup",i);if(j.onEnd){j.onEnd()}if(h&&j.onAfterMove){j.onAfterMove()}if(!h&&j.onNotMoved){j.onNotMoved()}hui.selection.enable(true)}.bind(this);hui.listen(f,c?"touchend":"mouseup",i);hui.selection.enable(false)},_nativeListeners:[],_activeDrop:null,listen:function(a){if(hui.browser.msie){return}hui.drag._nativeListeners.push(a);if(hui.drag._nativeListeners.length>1){return}hui.listen(document.body,"dragenter",function(g){var b=hui.drag._nativeListeners;var f=null;for(var d=0;d<b.length;d++){var c=b[d].element;if(hui.dom.isDescendantOrSelf(g.target,c)){f=b[d];if(hui.drag._activeDrop===null||hui.drag._activeDrop!=f){hui.cls.add(c,f.hoverClass)}break}}if(hui.drag._activeDrop){if(hui.drag._activeDrop!=f){hui.cls.remove(hui.drag._activeDrop.element,hui.drag._activeDrop.hoverClass);if(hui.drag._activeDrop.$leave){hui.drag._activeDrop.$leave(g)}}else{if(hui.drag._activeDrop.$hover){hui.drag._activeDrop.$hover(g)}}}hui.drag._activeDrop=f});hui.listen(document.body,"dragover",function(b){hui.stop(b);if(hui.drag._activeDrop){if(hui.drag._activeDrop.$hover){hui.drag._activeDrop.$hover(b)}}});hui.listen(document.body,"dragend",function(b){hui.log("drag end")});hui.listen(document.body,"dragstart",function(b){hui.log("drag start")});hui.listen(document.body,"drop",function(g){var f=hui.event(g);f.stop();var c=hui.drag._activeDrop;hui.drag._activeDrop=null;if(c){hui.cls.remove(c.element,c.hoverClass);if(c.$drop){c.$drop(g,{event:f})}if(g.dataTransfer){hui.log(g.dataTransfer.types);if(c.$dropFiles&&g.dataTransfer.files&&g.dataTransfer.files.length>0){c.$dropFiles(g.dataTransfer.files,{event:f})}else{if(c.$dropURL&&g.dataTransfer.types!==null&&(hui.array.contains(g.dataTransfer.types,"public.url")||hui.array.contains(g.dataTransfer.types,"text/uri-list"))){var b=g.dataTransfer.getData("public.url");var d=g.dataTransfer.getData("text/uri-list");if(b&&!hui.string.startsWith(b,"data:")){c.$dropURL(b,{event:f})}else{if(d&&!hui.string.startsWith(b,"data:")){c.$dropURL(d,{event:f})}}}else{if(c.$dropText&&g.dataTransfer.types!==null&&hui.array.contains(g.dataTransfer.types,"text/plain")){c.$dropText(g.dataTransfer.getData("text/plain"),{event:f})}}}}}})}};hui.Preloader=function(a){this.options=a||{};this.delegate={};this.images=[];this.loaded=0};hui.Preloader.prototype={addImages:function(a){if(typeof(a)=="object"){for(var b=0;b<a.length;b++){this.images.push(a[b])}}else{this.images.push(a)}},setDelegate:function(a){this.delegate=a},load:function(h){h=h||0;var c=this;this.obs=[];var f=function(){c._imageChanged(this.huiPreloaderIndex,"imageDidLoad")};var g=function(){c._imageChanged(this.huiPreloaderIndex,"imageDidGiveError")};var b=function(){c._imageChanged(this.huiPreloaderIndex,"imageDidAbort")};for(var e=h;e<this.images.length+h;e++){var d=e;if(d>=this.images.length){d=d-this.images.length}var a=new Image();a.huiPreloaderIndex=d;a.onload=f;a.onerror=g;a.onabort=b;a.src=(this.options.context?this.options.context:"")+this.images[d];this.obs.push(a)}},_imageChanged:function(a,b){this.loaded++;if(this.delegate[b]){this.delegate[b](this.loaded,this.images.length,a)}if(this.loaded==this.images.length&&this.delegate.allImagesDidLoad){this.delegate.allImagesDidLoad()}}};hui.cookie={set:function(c,d,e){var a;if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+b.toGMTString()}else{a=""}document.cookie=c+"="+d+a+"; path=/"},get:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)===0){return f.substring(e.length,f.length)}}return null},clear:function(a){this.set(a,"",-1)}};hui.location={getParameter:function(a){var c=hui.location.getParameters();for(var b=0;b<c.length;b++){if(c[b].name==a){return c[b].value}}return null},setParameter:function(a,e){var c=hui.location.getParameters();var d=false;for(var b=0;b<c.length;b++){if(c[b].name==a){c[b].value=e;d=true;break}}if(!d){c.push({name:a,value:e})}hui.location.setParameters(c)},hasHash:function(a){var b=document.location.hash;if(b!==""){return b=="#"+a}return false},getHash:function(){var a=document.location.hash;if(a!==""){return a.substring(1)}return null},getHashParameter:function(a){var d=document.location.hash;if(d!==""){var b=d.indexOf(a+"=");if(b!==-1){var c=d.substring(b+a.length+1);if(c.indexOf("&")!==-1){return c.substring(0,c.indexOf("&"))}return c}}return null},clearHash:function(){document.location.hash="#"},setParameters:function(b){var c="";for(var a=0;a<b.length;a++){c+=a===0?"?":"&";c+=b[a].name+"="+b[a].value}document.location.search=c},getBoolean:function(a){var b=hui.location.getParameter(a);return(b=="true"||b=="1")},getInt:function(a){var b=parseInt(hui.location.getParameter(a));if(!isNaN(b)){return b}return null},getParameters:function(){var b=document.location.search.substring(1).split("&");var a=[];for(var d=0;d<b.length;d++){var e=b[d].split("=");var c=unescape(e[0]).replace(/^\s*|\s*$/g,"");var f=unescape(e[1]).replace(/^\s*|\s*$/g,"");if(c){a.push({name:c,value:f})}}return a}};if(window.define){define("hui",hui)}hui.animate=function(a,e,d,f,b){if(typeof(a)=="string"||hui.dom.isElement(a)){hui.animation.get(a).animate(null,d,e,f,b)}else{var c=hui.animation.get(a.node);if(a.property){c.animate(null,a.value,a.property,a.duration,a)}else{if(!a.css){c.animate(null,"","",a.duration,a)}else{var g=a;for(var h in a.css){c.animate(null,a.css[h],h,a.duration,g);g=hui.override({},a);g.$complete=undefined}}}}};hui.animation={objects:{},running:false,latestId:0,get:function(a){a=hui.get(a);if(!a.huiAnimationId){a.huiAnimationId=this.latestId++}if(!this.objects[a.huiAnimationId]){this.objects[a.huiAnimationId]=new hui.animation.Item(a)}return this.objects[a.huiAnimationId]},start:function(){if(!this.running){hui.animation._render()}}};hui.animation._lengthUpater=function(c,b,a){c.style[a.property]=(a.from+(a.to-a.from)*b)+(a.unit!=null?a.unit:"")};hui.animation._transformUpater=function(d,b,a){var c=a.transform;var e="";if(c.rotate){e+=" rotate("+(c.rotate.from+(c.rotate.to-c.rotate.from)*b)+c.rotate.unit+")"}if(c.scale){e+=" scale("+(c.scale.from+(c.scale.to-c.scale.from)*b)+")"}d.style[hui.animation.TRANSFORM]=e};hui.animation._colorUpater=function(d,c,b){var f=Math.round(b.from.red+(b.to.red-b.from.red)*c);var e=Math.round(b.from.green+(b.to.green-b.from.green)*c);var a=Math.round(b.from.blue+(b.to.blue-b.from.blue)*c);value="rgb("+f+","+e+","+a+")";d.style[b.property]=value};hui.animation._propertyUpater=function(c,b,a){c[a.property]=Math.round(a.from+(a.to-a.from)*b)};hui.animation._ieOpacityUpdater=function(d,b,a){var c=(a.from+(a.to-a.from)*b);if(c==1){d.style.removeAttribute("filter")}else{d.style.filter="alpha(opacity="+(c*100)+")"}};hui.animation._render=function(){hui.animation.running=true;var g=false,a=Date.now();for(var b in hui.animation.objects){var d=hui.animation.objects[b];if(d.work){var e=d.element;for(var f=0;f<d.work.length;f++){var h=d.work[f];if(h.finished){continue}var c=(a-h.start)/(h.end-h.start);if(c<0){g=true;continue}else{if(isNaN(c)||c>1){c=1}else{if(c<1){g=true}}}var k=c,j=null;if(h.delegate&&h.delegate.ease){k=h.delegate.ease(k)}if(h.delegate&&h.delegate.$render){h.delegate.$render(e,k)}else{if(h.delegate&&h.delegate.callback){h.delegate.callback(e,k)}else{if(h.updater){h.updater(e,k,h)}}}if(c==1){h.finished=true;if(h.delegate&&h.delegate.$complete){window.setTimeout(h.delegate.$complete)}else{if(h.delegate&&h.delegate.onComplete){window.setTimeout(h.delegate.onComplete)}else{if(h.delegate&&h.delegate.hideOnComplete){e.style.display="none"}}}}}}}if(g){window.requestAnimationFrame(hui.animation._render)}else{hui.animation.running=false}};hui.animation._parseStyle=function(d){var b={type:null,value:null,unit:null};var c;if(!hui.isDefined(d)){return b}else{if(!isNaN(d)){b.value=parseFloat(d)}else{if(c=d.match(/([\-]?[0-9\.]+)(px|pt|%)/)){b.type="length";b.value=parseFloat(c[1]);b.unit=c[2]}else{if(c=d.match(/rgb\(([0-9]+),[ ]?([0-9]+),[ ]?([0-9]+)\)/)){b.type="color";b.value={red:parseInt(c[1]),green:parseInt(c[2]),blue:parseInt(c[3])}}else{var a=new hui.Color(d);if(a.ok){b.value={red:a.r,green:a.g,blue:a.b}}}}}}return b};hui.animation.Item=function(a){this.element=a;this.work=[]};hui.animation.Item.prototype.animate=function(h,i,j,b,f){var g=this.getWork(hui.string.camelize(j));g.delegate=f;g.finished=false;var d=!(j=="scrollLeft"||j=="scrollTop"||j=="");if(h!==null){g.from=h}else{if(j=="transform"){g.transform=hui.animation.Item.parseTransform(i,this.element)}else{if(!hui.browser.opacity&&j=="opacity"){g.from=this._getIEOpacity(this.element)}else{if(d){var a=hui.style.get(this.element,j);var c=hui.animation._parseStyle(a);g.from=c.value}else{g.from=this.element[j]}}}}if(d){var e=hui.animation._parseStyle(i);g.to=e.value;g.unit=e.unit;if(!hui.browser.opacity&&j=="opacity"){g.updater=hui.animation._ieOpacityUpdater}else{if(j=="transform"){g.updater=hui.browser.msie?function(){}:hui.animation._transformUpater}else{if(e.type=="color"){g.updater=hui.animation._colorUpater}else{g.updater=hui.animation._lengthUpater}}}}else{g.to=i;g.unit=null;g.updater=hui.animation._propertyUpater}g.start=Date.now();if(f&&f.delay){g.start+=f.delay}g.end=g.start+b;hui.animation.start()};hui.animation.TRANSFORM=hui.browser.gecko?"MozTransform":"WebkitTransform";hui.animation.Item.parseTransform=function(g,d){var i={};var f,e;var h=/rotate\(([0-9\.]+)([a-z]+)\)/i;var c=g.match(h);if(c){f=0;if(d.style[hui.animation.TRANSFORM]){e=d.style[hui.animation.TRANSFORM].match(h);if(e){f=parseFloat(e[1])}}i.rotate={from:f,to:parseFloat(c[1]),unit:c[2]}}var a=/scale\(([0-9\.]+)\)/i;var b=g.match(a);if(b){f=1;if(d.style[hui.animation.TRANSFORM]){e=d.style[hui.animation.TRANSFORM].match(a);if(e){f=parseFloat(e[1])}}i.scale={from:f,to:parseFloat(b[1])}}return i};hui.animation.Item.prototype._getIEOpacity=function(b){var c=hui.style.get(b,"filter").toLowerCase();var a;if(a=c.match(/opacity=([0-9]+)/)){return parseFloat(a[1])/100}else{return 1}};hui.animation.Item.prototype.getWork=function(c){for(var b=this.work.length-1;b>=0;b--){if(this.work[b].property===c){return this.work[b]}}var a={property:c};this.work[this.work.length]=a;return a};hui.animation.Loop=function(a){this.recipe=a;this.position=-1;this.running=false};hui.animation.Loop.prototype.next=function(){this.position++;if(this.position>=this.recipe.length){this.position=0}var b=this.recipe[this.position];if(typeof(b)=="function"){b()}else{if(b.element){hui.animate(b.element,b.property,b.value,b.duration,{ease:b.ease})}}var a=this;var c=b.duration||0;if(b.wait!==undefined){c=b.wait}window.setTimeout(function(){a.next()},c)};hui.animation.Loop.prototype.start=function(){this.running=true;this.next()};hui.ease={slowFastSlow:function(e){var d=1.6;var c=1.4;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(e,d)),Math.pow(Math.PI,c))+1},fastSlow:function(e){var d=0.5;var c=0.7;return -1*Math.pow(Math.cos((Math.PI/2)*Math.pow(e,d)),Math.pow(Math.PI,c))+1},elastic:function(a){return 1-hui.ease.elastic2(1-a)},elastic2:function(c,b,e){if(c<=0||c>=1){return c}if(!e){e=0.45}var d;if(!b||b<1){b=1;d=e/4}else{d=e/(2*Math.PI)*Math.asin(1/b)}return -(b*Math.pow(2,10*(c-=1))*Math.sin((c-d)*(2*Math.PI)/e))},bounce:function(a){if(a<(1/2.75)){return 7.5625*a*a}else{if(a<(2/2.75)){return(7.5625*(a-=(1.5/2.75))*a+0.75)}else{if(a<(2.5/2.75)){return(7.5625*(a-=(2.25/2.75))*a+0.9375)}else{return(7.5625*(a-=(2.625/2.75))*a+0.984375)}}}},flicker:function(a){if(a==1){return 1}return Math.random()*a},linear:function(a){return a},quadIn:function(a){return Math.pow(a,2)},quadOut:function(a){return a*(a-2)*-1},quadInOut:function(a){a=a*2;if(a<1){return Math.pow(a,2)/2}return -1*((--a)*(a-2)-1)/2},cubicIn:function(a){return Math.pow(a,3)},cubicOut:function(a){return Math.pow(a-1,3)+1},cubicInOut:function(a){a=a*2;if(a<1){return Math.pow(a,3)/2}a-=2;return(Math.pow(a,3)+2)/2},quartIn:function(a){return Math.pow(a,4)},quartOut:function(a){return -1*(Math.pow(a-1,4)-1)},quartInOut:function(a){a=a*2;if(a<1){return Math.pow(a,4)/2}a-=2;return -1/2*(Math.pow(a,4)-2)},quintIn:function(a){return Math.pow(a,5)},quintOut:function(a){return Math.pow(a-1,5)+1},quintInOut:function(a){a=a*2;if(a<1){return Math.pow(a,5)/2}a-=2;return(Math.pow(a,5)+2)/2},sineIn:function(a){return -1*Math.cos(a*(Math.PI/2))+1},sineOut:function(a){return Math.sin(a*(Math.PI/2))},sineInOut:function(a){return -1*(Math.cos(Math.PI*a)-1)/2},expoIn:function(a){return(a==0)?0:Math.pow(2,10*(a-1))},expoOut:function(a){return(a==1)?1:(-1*Math.pow(2,-10*a)+1)},expoInOut:function(a){if(a==0){return 0}if(a==1){return 1}a=a*2;if(a<1){return Math.pow(2,10*(a-1))/2}--a;return(-1*Math.pow(2,-10*a)+2)/2},circIn:function(a){return -1*(Math.sqrt(1-Math.pow(a,2))-1)},circOut:function(a){a=a-1;return Math.sqrt(1-Math.pow(a,2))},circInOut:function(a){a=a*2;if(a<1){return -1/2*(Math.sqrt(1-Math.pow(a,2))-1)}a-=2;return 1/2*(Math.sqrt(1-Math.pow(a,2))+1)},backIn:function(b){var a=1.70158;return Math.pow(b,2)*((a+1)*b-a)},backOut:function(b){b=b-1;var a=1.70158;return Math.pow(b,2)*((a+1)*b+a)+1},backInOut:function(b){var a=1.70158*1.525;b=b*2;if(b<1){return(Math.pow(b,2)*((a+1)*b-a))/2}b-=2;return(Math.pow(b,2)*((a+1)*b+a)+2)/2},elasticIn:function(c){if(c==0){return 0}if(c==1){return 1}var b=0.3;var a=b/4;c=c-1;return -1*Math.pow(2,10*c)*Math.sin((c-a)*(2*Math.PI)/b)},elasticOut:function(c){if(c==0){return 0}if(c==1){return 1}var b=0.3;var a=b/4;return Math.pow(2,-10*c)*Math.sin((c-a)*(2*Math.PI)/b)+1},elasticInOut:function(c){if(c==0){return 0}c=c*2;if(c==2){return 1}var b=0.3*1.5;var a=b/4;if(c<1){c-=1;return -0.5*(Math.pow(2,10*c)*Math.sin((c-a)*(2*Math.PI)/b))}c-=1;return 0.5*(Math.pow(2,-10*c)*Math.sin((c-a)*(2*Math.PI)/b))+1},bounceIn:function(a){return(1-hui.ease.bounceOut(1-a))},bounceOut:function(d){var b=7.5625;var c=2.75;var a;if(d<(1/c)){a=b*Math.pow(d,2)}else{if(d<(2/c)){d-=(1.5/c);a=b*Math.pow(d,2)+0.75}else{if(d<(2.5/c)){d-=(2.25/c);a=b*Math.pow(d,2)+0.9375}else{d-=(2.625/c);a=b*Math.pow(d,2)+0.984375}}}return a},bounceInOut:function(a){if(a<0.5){return hui.ease.bounceIn(a*2)/2}return(hui.ease.bounceOut(a*2-1)/2)+0.5}};if(!Date.now){Date.now=function now(){return new Date().getTime()}}(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=Date.now();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},0);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());hui.Color=function(g){this.ok=false;if(hui.isBlank(g)){return}if(g.charAt(0)=="#"){g=g.substr(1,6)}g=g.replace(/ /g,"");g=g.toLowerCase();for(var c in hui.Color.table){if(g==c){g=hui.Color.table[c]}}var h=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^rgb\((\d{1,3})%,\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,process:function(i){return[Math.round(parseInt(i[1])/100*255),Math.round(parseInt(i[2])/100*255),Math.round(parseInt(i[3])/100*255)]}},{re:/^(\w{2})(\w{2})(\w{2})$/,process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}];for(var b=0;b<h.length;b++){var e=h[b].re,d=h[b].process,f=e.exec(g);if(f){var a=d(f);this.r=a[0];this.g=a[1];this.b=a[2];this.ok=true;break}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b)};hui.Color.prototype={toRGB:function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},isDefined:function(){return !(this.r===undefined||this.g===undefined||this.b===undefined)},toHex:function(){if(!this.isDefined()){return null}var d=this.r.toString(16);var c=this.g.toString(16);var a=this.b.toString(16);if(d.length==1){d="0"+d}if(c.length==1){c="0"+c}if(a.length==1){a="0"+a}return"#"+d+c+a}};hui.Color.table={white:"ffffff",black:"000000",red:"ff0000",green:"00ff00",blue:"0000ff"};hui.Color.hex2rgb=function(d){if(hui.isBlank(d)){return null}if(d[0]=="#"){d=d.substr(1)}if(d.length==3){var a=d;d="";a=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(a).slice(1);for(var c=0;c<3;c++){d+=a[c]+a[c]}}var b=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(d).slice(1);return{r:parseInt(b[0],16),g:parseInt(b[1],16),b:parseInt(b[2],16)}};hui.Color.hsv2rgb=function(e,f,d){var m=e/360,j,o,b;if(f==0){j=d*255;o=d*255;b=d*255}else{var k=m*6,c,l,n;var g=Math.floor(k);var a=d*(1-f);var q=d*(1-f*(k-g));var p=d*(1-f*(1-(k-g)));if(g==0){c=d;l=p;n=a}else{if(g==1){c=q;l=d;n=a}else{if(g==2){c=a;l=d;n=p}else{if(g==3){c=a;l=q;n=d}else{if(g==4){c=p;l=a;n=d}else{c=d;l=a;n=q}}}}}j=Math.round(c*255);o=Math.round(l*255);b=Math.round(n*255)}return new Array(j,o,b)};hui.Color.rgb2hsv=function(i,h,c){i=(i/255);h=(h/255);c=(c/255);var e=Math.min(Math.min(i,h),c),a=Math.max(Math.max(i,h),c),j=a,f,d;if(a==e){d=0}else{if(a==i){d=(60*((h-c)/(a-e)))%360}else{if(a==h){d=60*((c-i)/(a-e))+120}else{if(a==c){d=60*((i-h)/(a-e))+240}}}}if(d<0){d+=360}if(a==0){f=0}else{f=1-(e/a)}return[Math.round(d),Math.round(f*100),Math.round(j*100)]};hui.Color.rgb2hex=function(b){var e="#";for(var a=0;a<3;a++){var d=parseInt(b[a]).toString(16);if(d.length<2){d="0"+d}e+=d}return e};!function(g,v,k){var h=v.getElementsByTagName("head")[0],t={},q={},u={},d={},n="string",r=false,i="push",l="DOMContentLoaded",b="readyState",p="addEventListener",o="onreadystatechange",w=function(f,y){for(var x=0,s=f.length;x<s;++x){if(!y(f[x])){return r}}return 1};function e(f,s){w(f,function(x){return !s(x)})}if(!v[b]&&v[p]){v[p](l,function j(){v.removeEventListener(l,j,r);v[b]="complete"},r);v[b]="loading"}var c=function(D,z,x){D=D[i]?D:[D];var s=z&&z.call,y=s?z:x,f=s?D.join(""):z,A=D.length;function B(E){return E.call?E():t[E]}function C(){if(!--A){t[f]=1;y&&y();for(var E in u){w(E.split("|"),B)&&!e(u[E],B)&&(u[E]=[])}}}k(function(){e(D,function(E){if(d[E]){f&&(q[f]=1);C();return}d[E]=1;f&&(q[f]=1);m(c.path?c.path+E+".js":E,C)})},0);return c};function m(y,x){var s=v.createElement("script"),f=r;s.onload=s.onerror=s[o]=function(){if((s[b]&&!(/^c|loade/.test(s[b])))||f){return}s.onload=s[o]=null;f=1;x()};s.async=1;s.src=y;h.insertBefore(s,h.firstChild)}c.get=m;c.ready=function(y,s,x){y=y[i]?y:[y];var f=[];!e(y,function(z){t[z]||f[i](z)})&&w(y,function(z){return t[z]})?s():!function(z){u[z]=u[z]||[];u[z][i](s);x&&x(f)}(y.join("|"));return c};var a=g.$script;c.noConflict=function(){g.$script=a;return this};(typeof module!=="undefined"&&module.exports)?(module.exports=c):(g.hui.require=c)}(this,document,setTimeout);hui.parallax={_listeners:[],_init:function(){if(this._listening){return}this._listening=true;hui.listen(window,"scroll",this._scroll.bind(this));hui.listen(window,"resize",this._resize.bind(this))},_resize:function(){for(var b=this._listeners.length-1;b>=0;b--){var a=this._listeners[b];if(a.$resize){a.$resize(hui.window.getViewWidth(),hui.window.getViewHeight())}}this._scroll()},_scroll:function(){var e=hui.window.getScrollTop(),a=hui.window.getViewHeight();for(var c=this._listeners.length-1;c>=0;c--){var b=this._listeners[c];if(!b.$scroll){continue}if(b.debug&&!b.debugElement){b.debugElement=hui.build("div",{style:"position: absolute; border-top: 1px solid red; left: 0; right: 0;",parent:document.body})}if(b.element){var f=hui.position.getTop(b.element);f+=b.element.clientHeight/2;var j=f-e;var g=(j/a);if(b.debugElement){b.debugElement.style.top=f+"px";b.debugElement.innerHTML="<span>"+g+"</span>"}b.$scroll(g);continue}var h=(e-b.min)/(b.max-b.min);var d=hui.between(0,h,1);if(b._latest!==d){b.$scroll(d);b._latest=d}}},listen:function(a){this._listeners.push(a)},start:function(){this._init();this._resize()}};hui.store={isSupported:function(){try{return hui.isDefined(window.localStorage)}catch(a){return false}},set:function(a,b){if(this.isSupported()){localStorage.setItem(a,b)}},get:function(a){if(this.isSupported()){return localStorage.getItem(a)}return null},setObject:function(a,b){this.set(a,hui.string.toJSON(b))},getObject:function(a){return hui.string.fromJSON(this.get(a))}};hui.xml={parse:function(a){var c;try{if(window.DOMParser){var f=new DOMParser();c=f.parseFromString(a,"text/xml");var d=c.getElementsByTagName("parsererror");if(d.length>0&&d[0].textContent){hui.log(d[0].textContent);return null}}else{c=new ActiveXObject("Microsoft.XMLDOM");c.async=false;c.loadXML(a)}}catch(b){return null}return c},serialize:function(b){try{return(new XMLSerializer()).serializeToString(b)}catch(c){try{return b.xml}catch(a){}}return null}};var SWFUpload=function(a){this.initSWFUpload(a)};SWFUpload.prototype.initSWFUpload=function(b){try{this.customSettings={};this.settings=b;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(a){delete SWFUpload.instances[this.movieName];throw a}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 Alpha";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(b,a){this.settings[b]=(this.settings[b]==undefined)?a:this.settings[b]};this.ensureDefault("upload_url","");this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id",null);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",function(a){hui.log(a)});this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+"?swfuploadrnd="+Math.floor(Math.random()*999999999)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){if(this.settings.button_placeholder_id!==""){this.replaceWithFlash()}else{this.appendFlash()}};SWFUpload.prototype.appendFlash=function(){var b,a;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}b=document.getElementsByTagName("body")[0];if(b==undefined){throw"Could not find the 'body' element."}a=document.createElement("div");a.style.width="1px";a.style.height="1px";a.style.overflow="hidden";b.appendChild(a);a.innerHTML=this.getFlashHTML()};SWFUpload.prototype.replaceWithFlash=function(){var a,b;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}a=this.settings.button_placeholder||document.getElementById(this.settings.button_placeholder_id);if(a==undefined){throw"Could not find the placeholder element."}b=document.createElement("div");b.innerHTML=this.getFlashHTML();a.parentNode.replaceChild(b.firstChild,a)};SWFUpload.prototype.getFlashHTML=function(){var a=this.settings.button_image_url===""?true:false;return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',a?"transparent":"window",'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var a=this.buildParamString();return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;params=",encodeURIComponent(a),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var c=this.settings.post_params;var b=[];if(typeof(c)==="object"){for(var a in c){if(c.hasOwnProperty(a)){b.push(encodeURIComponent(a.toString())+"="+encodeURIComponent(c[a].toString()))}}}return b.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.stopUpload();var b=null;try{b=this.getMovieElement()}catch(c){}if(b!=undefined&&b.parentNode!=undefined&&typeof b.parentNode.removeChild==="function"){var a=b.parentNode;if(a!=undefined){a.removeChild(b);if(a.parentNode!=undefined&&typeof a.parentNode.removeChild==="function"){a.parentNode.removeChild(a)}}}SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];delete this.movieElement;delete this.settings;delete this.customSettings;delete this.eventQueue;delete this.movieName;delete window[this.movieName];return true}catch(d){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(b,c,a){if(c==undefined){return(this.settings[b]=a)}else{return(this.settings[b]=c)}};SWFUpload.prototype.getSetting=function(a){if(this.settings[a]!=undefined){return this.settings[a]}return""};SWFUpload.prototype.callFlash=function(c,d){d=d||[];var a=this.getMovieElement();var b;if(typeof a[c]==="function"){if(d.length===0){b=a[c]()}else{if(d.length===1){b=a[c](d[0])}else{if(d.length===2){b=a[c](d[0],d[1])}else{if(d.length===3){b=a[c](d[0],d[1],d[2])}else{throw"Too many arguments"}}}}if(b!=undefined&&typeof b.post==="object"){b=this.unescapeFilePostParams(b)}return b}else{throw"Invalid function name: "+c}};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])};SWFUpload.prototype.cancelUpload=function(a){this.callFlash("CancelUpload",[a])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])};SWFUpload.prototype.getFile=function(a){if(typeof(a)==="number"){return this.callFlash("GetFileByIndex",[a])}else{return this.callFlash("GetFile",[a])}};SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])};SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])};SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString();this.callFlash("SetUploadURL",[a])};SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a;this.callFlash("SetPostParams",[a])};SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a;this.settings.file_types_description=b;this.callFlash("SetFileTypes",[a,b])};SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a;this.callFlash("SetFileSizeLimit",[a])};SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a;this.callFlash("SetFileUploadLimit",[a])};SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a;this.callFlash("SetFileQueueLimit",[a])};SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a;this.callFlash("SetFilePostName",[a])};SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a;this.callFlash("SetUseQueryString",[a])};SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a;this.callFlash("SetRequeueOnError",[a])};SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a;this.callFlash("SetDebugEnabled",[a])};SWFUpload.prototype.setButtonImageURL=function(a){if(a==undefined){a=""}this.settings.button_image_url=a;this.callFlash("SetButtonImageURL",[a])};SWFUpload.prototype.setButtonDimensions=function(c,a){this.settings.button_width=c;this.settings.button_height=a;var b=this.getMovieElement();if(b!=undefined){b.style.width=c+"px";b.style.height=a+"px"}this.callFlash("SetButtonDimensions",[c,a])};SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a;this.callFlash("SetButtonText",[a])};SWFUpload.prototype.setButtonTextPadding=function(b,a){this.settings.button_text_top_padding=a;this.settings.button_text_left_padding=b;this.callFlash("SetButtonTextPadding",[b,a])};SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a;this.callFlash("SetButtonTextStyle",[a])};SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a;this.callFlash("SetButtonDisabled",[a])};SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a;this.callFlash("SetButtonAction",[a])};SWFUpload.prototype.queueEvent=function(b,c){if(c==undefined){c=[]}else{if(!(c instanceof Array)){c=[c]}}var a=this;if(typeof this.settings[b]==="function"){this.eventQueue.push(function(){this.settings[b].apply(this,c)});setTimeout(function(){a.executeNextEvent()},0)}else{if(this.settings[b]!==null){throw"Event handler "+b+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;if(typeof(a)==="function"){a.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(c){var e=/[$]([0-9a-f]{4})/i;var f={};var d;if(c!=undefined){for(var a in c.post){if(c.post.hasOwnProperty(a)){d=a;var b;while((b=e.exec(d))!==null){d=d.replace(b[0],String.fromCharCode(parseInt("0x"+b[1],16)))}f[d]=c.post[a]}}c.post=f}return c};SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();if(typeof a.StartUpload!=="function"){throw"ExternalInterface methods failed to initialize."}if(window[this.movieName]==undefined){window[this.movieName]=a}this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("file_queued_handler",a)};SWFUpload.prototype.fileQueueError=function(a,c,b){a=this.unescapeFilePostParams(a);this.queueEvent("file_queue_error_handler",[a,c,b])};SWFUpload.prototype.fileDialogComplete=function(a,b){this.queueEvent("file_dialog_complete_handler",[a,b])};SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("return_upload_start_handler",a)};SWFUpload.prototype.returnUploadStart=function(a){var b;if(typeof this.settings.upload_start_handler==="function"){a=this.unescapeFilePostParams(a);b=this.settings.upload_start_handler.call(this,a)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(b===undefined){b=true}b=!!b;this.callFlash("ReturnUploadStart",[b])};SWFUpload.prototype.uploadProgress=function(a,c,b){a=this.unescapeFilePostParams(a);this.queueEvent("upload_progress_handler",[a,c,b])};SWFUpload.prototype.uploadError=function(a,c,b){a=this.unescapeFilePostParams(a);this.queueEvent("upload_error_handler",[a,c,b])};SWFUpload.prototype.uploadSuccess=function(b,a){b=this.unescapeFilePostParams(b);this.queueEvent("upload_success_handler",[b,a])};SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("upload_complete_handler",a)};SWFUpload.prototype.debug=function(a){hui.log(a)};Date.parseFunctions={count:0};Date.parseRegexes=[];Date.formatFunctions={count:0};Date.prototype.dateFormat=function(b){if(Date.formatFunctions[b]==null){Date.createNewFormat(b)}var a=Date.formatFunctions[b];return this[a]()};Date.createNewFormat=function(format){var funcName="format"+Date.formatFunctions.count++;Date.formatFunctions[format]=funcName;var code="Date.prototype."+funcName+" = function(){return ";var special=false;var ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;code+="'"+Date.escape(ch)+"' + "}else{code+=Date.getFormatCode(ch)}}}eval(code.substring(0,code.length-3)+";}")};Date.getFormatCode=function(a){switch(a){case"d":return"Date.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"Date.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"Date.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"Date.leftPad(this.getHours(), 2, '0') + ";case"i":return"Date.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"Date.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+Date.escape(a)+"' + "}};Date.parseDate=function(a,c){if(Date.parseFunctions[c]==null){Date.createParser(c)}var b=Date.parseFunctions[c];return Date[b](a)};Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++;var regexNum=Date.parseRegexes.length;var currentGroup=1;Date.parseFunctions[format]=funcName;var code="Date."+funcName+" = function(input){\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {";var regex="";var special=false;var ch="";for(var i=0;i<format.length;++i){ch=format.charAt(i);if(!special&&ch=="\\"){special=true}else{if(special){special=false;regex+=Date.escape(ch)}else{var obj=Date.formatCodeToRegex(ch,currentGroup);currentGroup+=obj.g;regex+=obj.s;if(obj.g&&obj.c){code+=obj.c}}}}code+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}";Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$");eval(code)};Date.formatCodeToRegex=function(b,a){switch(b){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+a+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:0,c:null,s:"(?:\\d{1,3})"};case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+a+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+a+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+a+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+a+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+a+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+a+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+a+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+a+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+a+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+a+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:Date.escape(b)}}};Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")};Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+Date.leftPad(Math.floor(this.getTimezoneOffset()/60),2,"0")+Date.leftPad(this.getTimezoneOffset()%60,2,"0")};Date.prototype.getDayOfYear=function(){var a=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var b=0;b<this.getMonth();++b){a+=Date.daysInMonth[b]}return a+this.getDate()-1};Date.prototype.getWeekOfYear=function(){var b=this.getDayOfYear()+(5-this.getDay());var a=new Date(this.getFullYear(),0,1);var c=(5-a.getDay());return parseInt(Date.leftPad(((b-c)/7)+1,2,"0"))};Date.prototype.isLeapYear=function(){var a=this.getFullYear();return((a&3)==0&&(a%100||(a%400==0&&a)))};Date.prototype.getFirstDayOfMonth=function(){var a=(this.getDay()-(this.getDate()-1))%7;return(a<0)?(a+7):a};Date.prototype.getLastDayOfMonth=function(){var a=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return(a<0)?(a+7):a};Date.prototype.getDaysInMonth=function(){Date.daysInMonth[1]=this.isLeapYear()?29:28;return Date.daysInMonth[this.getMonth()]};Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};Date.escape=function(a){return a.replace(/('|\\)/g,"\\$1")};Date.leftPad=function(d,b,c){var a=new String(d);if(c==null){c=" "}while(a.length<b){a=c+a}return a};Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31];Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.y2kYear=50;Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"};hui.ui={domReady:false,context:"",language:"en",objects:{},delegates:[],state:"default",latestObjectIndex:0,latestIndex:500,latestPanelIndex:1000,latestAlertIndex:1500,latestTopIndex:2000,toolTips:{},confirmOverlays:{},delayedUntilReady:[],texts:{request_error:{en:"An error occurred on the server",da:"Der skete en fejl på serveren"},"continue":{en:"Continue",da:"Fortsæt"},reload_page:{en:"Reload page",da:"Indæs siden igen"},access_denied:{en:"Access denied, maybe you are nolonger logged in",da:"Adgang nægtet, du er måske ikke længere logget ind"}}};hui.ui.get=function(a){if(a){if(a.element){return a}return hui.ui.objects[a]}return null};hui.ui.onReady=function(a){if(hui.ui.domReady){return a()}if(hui.browser.gecko&&hui.string.endsWith(document.baseURI,"xml")){window.setTimeout(a,1000);return}hui.ui.delayedUntilReady.push(a)};hui.ui._frameLoaded=function(a){hui.ui.callSuperDelegates(this,"frameLoaded",a)};hui.ui._resize=function(){hui.ui.reLayout();window.clearTimeout(this._delayedResize);if(!hui.ui._resizeFirst){this._delayedResize=window.setTimeout(hui.ui._afterResize,1000)}};hui.ui._afterResize=function(){hui.ui.callSuperDelegates(hui.ui,"$afterResize")};hui.ui.confirmOverlay=function(b){var e=b.element,a;if(!e){e=document.body}if(b.widget){e=b.widget.getElement()}if(hui.ui.confirmOverlays[e]){a=hui.ui.confirmOverlays[e];a.clear()}else{a=hui.ui.Overlay.create({modal:true});hui.ui.confirmOverlays[e]=a}if(b.text){a.addText(hui.ui.getTranslated(b.text))}var c=hui.ui.Button.create({text:hui.ui.getTranslated(b.okText)||"OK",highlighted:"true"});c.click(function(){if(b.onOk){b.onOk()}else{if(b.$ok){b.$ok()}}a.hide()});a.add(c);var d=hui.ui.Button.create({text:hui.ui.getTranslated(b.cancelText)||"Cancel"});d.onClick(function(){if(b.onCancel){b.onCancel()}else{if(b.$cancel){b.$cancel()}}a.hide()});a.add(d);a.show({element:e})};hui.ui.destroy=function(a){if(typeof(a.destroy)=="function"){a.destroy()}delete (hui.ui.objects[a.name])};hui.ui.destroyDescendants=function(d){var c=hui.ui.getDescendants(d);var b=hui.ui.objects;for(var a=0;a<c.length;a++){hui.ui.destroy(c[a])}};hui.ui.getAncestors=function(g){var l=[];var h=g.element;if(h){var b=hui.get.ancestors(h);var k=[];for(var f in hui.ui.objects){k.push(hui.ui.objects[f])}for(var d=0;d<b.length;d++){for(var c=0;c<k.length;c++){if(k[c].element==b[d]){l.push(k[c])}}}}return l};hui.ui.getDescendants=function(l){var k=[];if(l){var f=l.getElement?l.getElement():l;if(f){var h=f.getElementsByTagName("*");var g=[];for(var c in hui.ui.objects){g.push(hui.ui.objects[c])}for(var b=0;b<h.length;b++){for(var a=0;a<g.length;a++){if(h[b]==g[a].element){k.push(g[a])}}}}}return k};hui.ui.getAncestor=function(e,c){var b=hui.ui.getAncestors(e);for(var d=0;d<b.length;d++){if(hui.cls.has(b[d].getElement(),c)){return b[d]}}return null};hui.ui.changeState=function(c){if(hui.ui.state===c){return}var b=hui.ui.objects,a,d;for(a in b){d=b[a];if(d.options&&d.options.state){if(d.options.state==c){d.show()}else{d.hide()}}}hui.ui.state=c;this.reLayout()};hui.ui.reLayout=function(){var b=hui.ui.getDescendants(document.body);for(var a=0;a<b.length;a++){var c=b[a];if(c.$$layout){c.$$layout()}}};hui.ui.nextIndex=function(){hui.ui.latestIndex++;return hui.ui.latestIndex};hui.ui.nextPanelIndex=function(){hui.ui.latestPanelIndex++;return hui.ui.latestPanelIndex};hui.ui.nextAlertIndex=function(){hui.ui.latestAlertIndex++;return hui.ui.latestAlertIndex};hui.ui.nextTopIndex=function(){hui.ui.latestTopIndex++;return hui.ui.latestTopIndex};hui.ui.showCurtain=function(d){var e=d.widget;if(!e.curtain){e.curtain=hui.build("div",{"class":"hui_curtain",style:"z-index:none"});var a=hui.get.firstByClass(document.body,"hui_body");if(!a){a=document.body}a.appendChild(e.curtain);hui.listen(e.curtain,"click",function(){if(e.$curtainWasClicked){e.$curtainWasClicked()}})}var c=e.curtain;if(d.transparent){c.style.background="none"}else{if(d.color){if(d.color=="auto"){var b=hui.style.get(document.body,"background-color");if(b=="transparent"||b=="rgba(0, 0, 0, 0)"){b="#fff"}c.style.backgroundColor=b}else{c.style.backgroundColor=d.color}}}if(hui.browser.msie){c.style.height=hui.document.getHeight()+"px"}else{c.style.position="fixed";c.style.top="0";c.style.left="0";c.style.bottom="0";c.style.right="0"}c.style.zIndex=d.zIndex;if(d.transparent){c.style.display="block"}else{hui.style.setOpacity(c,0);c.style.display="block";hui.animate(c,"opacity",0.7,1000,{ease:hui.ease.slowFastSlow})}};hui.ui.hideCurtain=function(a){if(a.curtain){hui.animate(a.curtain,"opacity",0,200,{hideOnComplete:true})}};hui.ui.getText=function(a){var b=this.texts[a];if(!b){return a}if(b[this.language]){return b[this.language]}else{return b.en}};hui.ui.getTranslated=function(b){if(!hui.isDefined(b)||hui.isString(b)||typeof(b)=="number"){return b}if(b[hui.ui.language]){return b[hui.ui.language]}if(b[null]){return b[null]}for(var a in b){return b[a]}};hui.ui.confirm=function(a){if(!a.name){a.name="huiConfirm"}var d=hui.ui.get(a.name);var b;if(!d){d=hui.ui.Alert.create(a);var c=hui.ui.Button.create({name:name+"_cancel",text:a.cancel||"Cancel",highlighted:a.highlighted==="cancel"});c.listen({$click:function(){d.hide();if(a.onCancel){a.onCancel()}hui.ui.callDelegates(d,"cancel")}});d.addButton(c);b=hui.ui.Button.create({name:name+"_ok",text:a.ok||"OK",highlighted:a.highlighted==="ok"});d.addButton(b)}else{d.update(a);b=hui.ui.get(name+"_ok");b.setText(a.ok||"OK");b.setHighlighted(a.highlighted=="ok");b.clearListeners();hui.ui.get(name+"_cancel").setText(a.ok||"Cancel");hui.ui.get(name+"_cancel").setHighlighted(a.highlighted=="cancel");if(a.cancel){hui.ui.get(name+"_cancel").setText(a.cancel)}}b.listen({$click:function(){d.hide();if(a.onOK){a.onOK()}hui.ui.callDelegates(d,"ok")}});d.show()};hui.ui.alert=function(a){if(!this.alertBox){this.alertBox=hui.ui.Alert.create(a);this.alertBoxButton=hui.ui.Button.create({name:"huiAlertBoxButton",text:"OK"});this.alertBoxButton.listen({$click$huiAlertBoxButton:function(){hui.ui.alertBox.hide();if(hui.ui.alertBoxCallBack){hui.ui.alertBoxCallBack();hui.ui.alertBoxCallBack=null}}});this.alertBox.addButton(this.alertBoxButton)}else{this.alertBox.update(a)}this.alertBoxCallBack=a.onOK;this.alertBoxButton.setText(a.button?a.button:"OK");this.alertBox.show()};hui.ui.showMessage=function(b){if(typeof(b)=="string"){b={text:b}}if(b.delay){hui.ui.messageDelayTimer=window.setTimeout(function(){b.delay=null;hui.ui.showMessage(b)},b.delay);return}window.clearTimeout(hui.ui.messageDelayTimer);if(!hui.ui.message){hui.ui.message=hui.build("div",{"class":"hui_message",html:"<div><div></div></div>"});if(!hui.browser.msie){hui.style.setOpacity(hui.ui.message,0)}document.body.appendChild(hui.ui.message)}var c=hui.ui.getTranslated(b.text)||"";var a=hui.ui.message.getElementsByTagName("div")[1];if(b.icon){hui.dom.clear(a);a.appendChild(hui.ui.createIcon(b.icon,24));hui.dom.addText(a,c)}else{if(b.busy){a.innerHTML='<span class="hui_message_busy"></span>';hui.dom.addText(a,c)}else{hui.dom.setText(a,c)}}hui.ui.message.style.display="block";hui.ui.message.style.zIndex=hui.ui.nextTopIndex();hui.ui.message.style.marginLeft=(hui.ui.message.clientWidth/-2)+"px";hui.ui.message.style.marginTop=hui.window.getScrollTop()+"px";if(hui.browser.opacity){hui.animate(hui.ui.message,"opacity",1,300)}window.clearTimeout(hui.ui.messageTimer);if(b.duration){hui.ui.messageTimer=window.setTimeout(hui.ui.hideMessage,b.duration)}};hui.ui.msg=hui.ui.showMessage;hui.ui.msg.success=function(a){a=hui.override({icon:"common/success",duration:2000},a);hui.ui.msg(a)};hui.ui.msg.fail=function(a){a=hui.override({icon:"common/warning",duration:3000},a);hui.ui.msg(a)};hui.ui.hideMessage=function(){window.clearTimeout(hui.ui.messageDelayTimer);if(hui.ui.message){if(hui.browser.opacity){hui.animate(hui.ui.message,"opacity",0,300,{hideOnComplete:true})}else{hui.ui.message.style.display="none"}}};hui.ui.showToolTip=function(a){var c=a.key||"common";var b=hui.ui.toolTips[c];if(!b){b=hui.build("div",{"class":"hui_tooltip",style:"display:none;",html:"<div><div></div></div>",parent:document.body});hui.ui.toolTips[c]=b}b.onclick=function(){hui.ui.hideToolTip(a)};var e=hui.get(a.element);var d=hui.position.get(e);hui.dom.setText(b.getElementsByTagName("div")[1],a.text);if(b.style.display=="none"&&hui.browser.opacity){hui.style.setOpacity(b,0)}hui.style.set(b,{display:"block",zIndex:hui.ui.nextTopIndex()});hui.style.set(b,{left:(d.left-b.clientWidth+4)+"px",top:(d.top+2-(b.clientHeight/2)+(e.clientHeight/2))+"px"});if(hui.browser.opacity){hui.animate(b,"opacity",1,300)}};hui.ui.hideToolTip=function(a){var c=a?a.key||"common":"common";var b=hui.ui.toolTips[c];if(b){if(!hui.browser.msie){hui.animate(b,"opacity",0,300,{hideOnComplete:true})}else{b.style.display="none"}}};hui.ui.getElement=function(a){if(hui.dom.isElement(a)){return a}else{if(a.getElement){return a.getElement()}}return null};hui.ui.isWithin=function(d,a){d=hui.event(d);var g=hui.position.get(a),f={width:a.offsetWidth,height:a.offsetHeight},c=d.getLeft(),b=d.getTop();return c>g.left&&c<g.left+f.width&&b>g.top&&b<g.top+f.height};hui.ui.getIconUrl=function(b,a){return hui.ui.context+"/hui/icons/"+b+a+".png"};hui.ui.createIcon=function(c,b,a){return hui.build(a||"span",{"class":"hui_icon hui_icon_"+b,style:"background-image: url("+hui.ui.getIconUrl(c,b)+")"})};hui.ui.wrapInField=function(b){var a=hui.build("div",{"class":"hui_field",html:'<span class="hui_field_top"><span><span></span></span></span><span class="hui_field_middle"><span class="hui_field_middle"><span class="hui_field_content"></span></span></span><span class="hui_field_bottom"><span><span></span></span></span>'});hui.get.firstByClass(a,"hui_field_content").appendChild(b);return a};hui.ui.addFocusClass=function(a){var b=a.classElement||a.element,d=a["class"];hui.listen(a.element,"focus",function(){hui.cls.add(b,d);if(a.widget){hui.ui.setKeyboardTarget(a.widget)}});hui.listen(a.element,"blur",function(){hui.cls.remove(b,d);if(a.widget){hui.ui.setKeyboardTarget(null)}})};hui.ui.keyboardTarget=null;hui.ui.setKeyboardTarget=function(a){hui.ui.keyboardTarget=a};hui.ui.stress=function(a){var b=hui.ui.getElement(a);hui.effect.wiggle({element:b,duration:1000})};hui.ui.positionAtElement=function(c,g,b){b=b||{};c=hui.get(c);g=hui.get(g);var d=hui.style.get(c,"display");if(d=="none"){hui.style.set(c,{visibility:"hidden",display:"block"})}var f=hui.position.getLeft(g),e=hui.position.getTop(g);var a=b.vertical||null;if(b.horizontal&&b.horizontal=="right"){f=f+g.clientWidth-c.clientWidth}if(a=="topOutside"){e=e-c.clientHeight}else{if(a=="bottomOutside"){e=e+g.clientHeight}}f+=(b.left||0);e+=(b.top||0);hui.style.set(c,{left:f+"px",top:e+"px"});if(d=="none"){hui.style.set(c,{visibility:"visible",display:"none"})}};hui.ui.extend=function(b,a){if(a!==undefined){if(b.options){b.options=hui.override(b.options,a)}b.element=hui.get(a.element);b.name=a.name}if(!b.name){hui.ui.latestObjectIndex++;b.name="unnamed"+hui.ui.latestObjectIndex}if(hui.ui.objects[b.name]){hui.log("Widget replaced: "+b.name,hui.ui.objects[b.name])}hui.ui.objects[b.name]=b;b.delegates=[];b.listen=function(c){hui.array.add(this.delegates,c);return this};b.unListen=function(c){hui.array.remove(this.delegates,c)};b.clearListeners=function(){this.delegates=[]};b.fire=function(e,d,c){return hui.ui.callDelegates(this,e,d,c)};b.fireValueChange=function(){b.fire("valueChanged",b.value);hui.ui.firePropertyChange(b,"value",b.value);hui.ui.callAncestors(b,"childValueChanged",b.value)};b.fireProperty=function(c,d){hui.ui.firePropertyChange(this,c,d)};b.fireSizeChange=function(){hui.ui.callAncestors(b,"$$childSizeChanged")};if(!b.getElement){b.getElement=function(){return this.element}}if(!b.destroy){b.destroy=function(){if(this.element){hui.dom.remove(this.element)}}}if(!b.valueForProperty){b.valueForProperty=function(c){return this[c]}}if(b.nodes&&b.element){b.nodes=hui.collect(b.nodes,b.element)}};hui.ui.callAncestors=function(e,g,c,b){if(typeof(c)=="undefined"){c=e}var f=hui.ui.getAncestors(e);for(var a=0;a<f.length;a++){if(f[a][g]){f[a][g](c,b)}}};hui.ui.callDescendants=function(e,g,c,b){if(typeof(c)=="undefined"){c=e}if(g[0]!=="$"){g="$"+g}var f=hui.ui.getDescendants(e);for(var a=0;a<f.length;a++){if(f[a][g]){f[a][g](c,b)}}};hui.ui.callVisible=function(a){hui.ui.callDescendants(a,"$visibilityChanged")};hui.ui.listen=function(a){if(hui.ui.domReady&&a.$ready){a.$ready()}hui.ui.delegates.push(a)};hui.ui.unListen=function(a){hui.array.remove(hui.ui.delegates,a)};hui.ui.callDelegates=function(e,a,j,b){if(typeof(j)=="undefined"){j=e}var k;if(e.delegates){for(var f=0;f<e.delegates.length;f++){var g=e.delegates[f],c,h="$"+a+"$"+e.name;if(e.name&&g[h]){c=g[h](j,b)}else{if(g["$"+a]){c=g["$"+a](j,b)}}if(k===undefined&&c!==undefined&&typeof(c)!="undefined"){k=c}}}var d=hui.ui.callSuperDelegates(e,a,j,b);if(k===undefined&&d!==undefined){k=d}return k};hui.ui.tellContainers=function(a,b){if(window.parent!=window){try{window.parent.hui.ui._tellContainers(a,b)}catch(c){}}};hui.ui._tellContainers=function(a,b){hui.ui.callSuperDelegates({},a,b);if(window.parent!=window){try{window.parent.hui.ui._tellContainers(a,b)}catch(c){}}};hui.ui.callSuperDelegates=function(f,h,e,d){if(typeof(e)=="undefined"){e=f}var a;for(var b=0;b<hui.ui.delegates.length;b++){var c=hui.ui.delegates[b],g;if(f.name&&c["$"+h+"$"+f.name]){g=c["$"+h+"$"+f.name](e,d)}else{if(c["$"+h]){g=c["$"+h](e,d)}}if(a===undefined&&g!==undefined&&typeof(g)!="undefined"){a=g}}return a};hui.ui.resolveImageUrl=function(g,b,f,a){for(var d=0;d<g.delegates.length;d++){if(g.delegates[d].$resolveImageUrl){return g.delegates[d].$resolveImageUrl(b,f,a)}}for(var c=0;c<hui.ui.delegates.length;c++){var e=hui.ui.delegates[c];if(e.$resolveImageUrl){return e.$resolveImageUrl(b,f,a)}}return null};hui.ui.include=function(a){hui.ui.request({url:a.url,$text:function(c){var b=hui.build("div",{html:c,parent:document.body});hui.dom.runScripts(b);a.$success()}})};hui.ui.firePropertyChange=function(c,a,b){hui.ui.callDelegates(c,"propertyChanged",{property:a,value:b})};hui.ui.bind=function(e,a){if(hui.isString(e)&&e.charAt(0)=="@"){var d=e.substring(1).split(".");var c=hui.ui.get(d[0]);if(!c){hui.log("Unable to bind to "+e);return}var b=d.slice(1).join(".");c.listen({$propertyChanged:function(f){if(f.property==b){a(f.value)}}});return c.valueForProperty(b)}return e};hui.ui.handleRequestError=function(b){hui.log("General request error received");var a=hui.ui.callSuperDelegates(b||this,"requestError");if(!a){hui.ui.confirmOverlay({element:document.body,text:hui.ui.getText("request_error"),okText:hui.ui.getText("reload_page"),cancelText:hui.ui.getText("continue"),onOk:function(){document.location.reload()}})}};hui.ui.handleForbidden=function(b){hui.log("General access denied received");var a=hui.ui.callSuperDelegates(b||this,"accessDenied");if(!a){hui.ui.confirmOverlay({element:document.body,text:hui.ui.getText("access_denied"),okText:hui.ui.getText("reload_page"),cancelText:hui.ui.getText("continue"),onOk:function(){document.location.reload()}})}};hui.ui.request=function(i){i=hui.override({method:"post",parameters:{}},i);if(i.json){for(var e in i.json){i.parameters[e]=hui.string.toJSON(i.json[e])}}var f=i.$success,b=i.$object,g=i.$text,c=i.$xml,a=i.$failure,d=i.$forbidden,h=i.message;i.$success=function(k){if(h){if(h.success){hui.ui.showMessage({text:h.success,icon:"common/success",duration:h.duration||2000})}else{if(h.start){hui.ui.hideMessage()}}}var l,j;if(typeof(f)=="string"){if(!hui.request.isXMLResponse(k)){l=k.responseText.replace(/^\s+|\s+$/g,"");if(l.length>0){j=hui.string.fromJSON(k.responseText)}else{j=""}hui.ui.callDelegates(j,"success$"+f)}else{hui.ui.callDelegates(k,"success$"+f)}}else{if(c&&hui.request.isXMLResponse(k)){c(k.responseXML)}else{if(b){l=k.responseText.replace(/^\s+|\s+$/g,"");if(l.length>0){j=hui.string.fromJSON(k.responseText)}else{j=null}b(j)}else{if(typeof(f)=="function"){f(k)}else{if(g){g(k.responseText)}}}}}};i.$failure=function(j){if(typeof(a)=="string"){hui.ui.callDelegates(j,"failure$"+a)}else{if(typeof(a)=="function"){a(j)}else{if(i.message&&i.message.start){hui.ui.hideMessage()}hui.ui.handleRequestError()}}};i.$exception=i.$exception||function(k,j){hui.log(k);hui.log(j);throw k};i.$forbidden=function(j){if(i.message&&i.message.start){hui.ui.hideMessage()}if(d){d(j)}else{i.$failure(j);hui.ui.handleForbidden()}};if(i.message&&i.message.start){hui.ui.msg({text:i.message.start,busy:true,delay:i.message.delay})}hui.request(i)};hui.ui.parseItems=function(c){var a=c.documentElement;var b=[];hui.ui.parseSubItems(a,b);return b};hui.ui.parseSubItems=function(d,f){var b=d.childNodes;for(var a=0;a<b.length;a++){var e=b[a];if(e.nodeType==1&&e.nodeName=="title"){f.push({title:e.getAttribute("title"),type:"title"})}else{if(e.nodeType==1&&e.nodeName=="item"){var c=[];hui.ui.parseSubItems(e,c);f.push({text:e.getAttribute("text"),title:e.getAttribute("title"),value:e.getAttribute("value"),icon:e.getAttribute("icon"),kind:e.getAttribute("kind"),badge:e.getAttribute("badge"),children:c})}}}};hui.ui.require=function(c,b){for(var a=c.length-1;a>=0;a--){c[a]=hui.ui.context+"hui/js/"+c[a]+".js"}hui.require(c,b)};if(window.define){define("hui.ui",hui.ui)}hui.onReady(function(){hui.listen(window,"resize",hui.ui._resize);hui.ui.reLayout();hui.ui.domReady=true;if(window.parent&&window.parent.hui&&window.parent.hui.ui){window.parent.hui.ui._frameLoaded(window)}for(var a=0;a<hui.ui.delayedUntilReady.length;a++){hui.ui.delayedUntilReady[a]()}hui.ui.callSuperDelegates(this,"ready")});hui.ui.Source=function(a){this.options=hui.override({url:null,dwr:null,parameters:[],lazy:false},a);this.name=a.name;this.data=null;this.parameters=[];for(var b=0;b<this.options.parameters.length;b++){var c=this.options.parameters[b];this.parameters.push({key:c.key,value:c.value,separate:c.separate})}hui.ui.extend(this);if(a.delegate){this.listen(a.delegate)}this.initial=true;this.busy=false;hui.ui.onReady(this._init.bind(this))};hui.ui.Source.prototype={_init:function(){var a=this;hui.each(this.parameters,function(c){var b=hui.ui.bind(c.value,function(d){a.changeParameter(c.key,d)});c.value=a._convertValue(b)});if(!this.options.lazy){this.refresh()}},_convertValue:function(a){if(a&&a.getTime){return a.getTime()}return a},refreshFirst:function(){if(this.initial){this.refresh()}},refreshLater:function(){window.clearTimeout(this.paramDelay);this.paramDelay=window.setTimeout(function(){this.refresh()}.bind(this),100)},refresh:function(){if(this.options.delay<1){this._refresh()}else{window.clearTimeout(this._refreshDelay);this._refreshDelay=window.setTimeout(this._refresh.bind(this),this.options.delay)}},_refresh:function(){if(this.delegates.length==0){return}var shouldRefresh=this.delegates.length==0;for(var i=0;i<this.delegates.length;i++){var d=this.delegates[i];if(d["$sourceShouldRefresh"]){shouldRefresh=shouldRefresh||d["$sourceShouldRefresh"]()}else{shouldRefresh=true}}if(!shouldRefresh){return}if(this.busy){this.pendingRefresh=true;return}this.initial=false;this.pendingRefresh=false;var self=this;if(this.options.url){var prms=[];for(var j=0;j<this.parameters.length;j++){var p=this.parameters[j];if(hui.isArray(p.value)&&p.separate){for(var k=0;k<p.value.length;k++){prms.push({name:p.key,value:p.value[k]})}}else{prms.push({name:p.key,value:p.value})}}this.busy=true;hui.ui.callDelegates(this,"sourceIsBusy");this.transport=hui.request({method:"post",url:this.options.url,parameters:prms,$success:this.parse.bind(this),$exception:function(e,t){hui.log("Exception while loading source...");hui.log(e);self.end()},$forbidden:function(){hui.ui.handleForbidden(self);hui.ui.callDelegates(self,"sourceFailed");self.end()},$failure:function(t){hui.log("sourceFailed");hui.ui.callDelegates(self,"sourceFailed");self.end()}})}else{if(this.options.dwr){var pair=this.options.dwr.split(".");var facade=eval(pair[0]);var method=pair[1];var args=facade[method].argumentNames();for(var k=0;k<args.length;k++){if(this.parameters[k]){args[k]=this.parameters[k].value===undefined?null:this.parameters[k].value}}args[args.length-1]=function(r){self.parseDWR(r)};this.busy=true;hui.ui.callDelegates(this,"sourceIsBusy");facade[method].apply(facade,args)}}},end:function(){this.busy=false;hui.ui.callDelegates(this,"sourceIsNotBusy");if(this.pendingRefresh){this.refresh()}},parse:function(b){if(hui.request.isXMLResponse(b)){this.parseXML(b.responseXML)}else{var c=b.responseText.replace(/^\s+|\s+$/g,""),a=null;if(c.length>0){a=hui.string.fromJSON(b.responseText)}this.fire("objectsLoaded",a)}this.end()},parseXML:function(a){if(a.documentElement.tagName=="items"){this.data=hui.ui.parseItems(a);this.fire("itemsLoaded",this.data)}else{if(a.documentElement.tagName=="list"){this.fire("listLoaded",a)}else{if(a.documentElement.tagName=="articles"){this.fire("articlesLoaded",a)}}}},parseDWR:function(a){this.data=a;this.fire("objectsLoaded",a);this.end()},addParameter:function(b){this.parameters.push(b);var a=hui.ui.bind(b.value,function(c){this.changeParameter(b.key,c)}.bind(this));b.value=this._convertValue(a)},setParameter:function(b,c){c=this._convertValue(c);for(var a=0;a<this.parameters.length;a++){var d=this.parameters[a];if(d.key==b){d.value=c;return}}this.parameters.push({key:b,value:c})},changeParameter:function(b,c){c=this._convertValue(c);for(var a=0;a<this.parameters.length;a++){var d=this.parameters[a];if(d.key==b){d.value=c}}this.refreshLater()}};if(!Function.prototype.argumentNames){Function.prototype.argumentNames=function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return a.length==1&&!a[0]?[]:a}}hui.ui.callDelegatesDrop=function(a,c){for(var b=0;b<hui.ui.delegates.length;b++){if(hui.ui.delegates[b]["$drop$"+a.kind+"$"+c.kind]){hui.ui.delegates[b]["$drop$"+a.kind+"$"+c.kind](a,c)}}};hui.ui.getDragProxy=function(){if(!hui.ui.dragProxy){hui.ui.dragProxy=hui.build("div",{"class":"hui_dragproxy",style:"display:none"});document.body.appendChild(hui.ui.dragProxy)}return hui.ui.dragProxy};hui.ui.startDrag=function(f,c,a){f=new hui.Event(f);var d=c.dragDropInfo;hui.ui.dropTypes=hui.ui.findDropTypes(d);if(!hui.ui.dropTypes){return}var b=hui.ui.getDragProxy();hui.listen(document.body,"mousemove",hui.ui.dragListener);hui.listen(document.body,"mouseup",hui.ui.dragEndListener);hui.ui.dragInfo=d;if(d.icon){b.style.backgroundImage="url("+hui.ui.getIconUrl(d.icon,16)+")"}hui.ui.startDragPos={top:f.getTop(),left:f.getLeft()};b.innerHTML=d.title?"<span>"+hui.string.escape(d.title)+"</span>":"###";hui.ui.dragging=true;hui.selection.enable(false)};hui.ui.findDropTypes=function(d){var a=hui.ui;var f=null;for(var c=0;c<a.delegates.length;c++){if(a.delegates[c].dragDrop){for(var b=0;b<a.delegates[c].dragDrop.length;b++){var e=a.delegates[c].dragDrop[b];if(e.drag==d.kind){if(f==null){f={}}f[e.drop]={}}}}}return f};hui.ui.dragListener=function(b){b=new hui.Event(b);hui.ui.dragProxy.style.left=(b.getLeft()+10)+"px";hui.ui.dragProxy.style.top=b.getTop()+"px";hui.ui.dragProxy.style.display="block";var a=hui.ui.findDropTarget(b.getElement());if(a&&hui.ui.dropTypes[a.dragDropInfo.kind]){if(hui.ui.latestDropTarget){hui.cls.remove(hui.ui.latestDropTarget,"hui_drop")}hui.cls.add(a,"hui_drop");hui.ui.latestDropTarget=a}else{if(hui.ui.latestDropTarget){hui.cls.remove(hui.ui.latestDropTarget,"hui_drop");hui.ui.latestDropTarget=null}}return false};hui.ui.findDropTarget=function(a){while(a){if(a.dragDropInfo){return a}a=a.parentNode}return null};hui.ui.dragEndListener=function(a){hui.unListen(document.body,"mousemove",hui.ui.dragListener);hui.unListen(document.body,"mouseup",hui.ui.dragEndListener);hui.ui.dragging=false;if(hui.ui.latestDropTarget){hui.cls.remove(hui.ui.latestDropTarget,"hui_drop");hui.ui.callDelegatesDrop(hui.ui.dragInfo,hui.ui.latestDropTarget.dragDropInfo);hui.ui.dragProxy.style.display="none"}else{hui.animate(hui.ui.dragProxy,"left",(hui.ui.startDragPos.left+10)+"px",200,{ease:hui.ease.fastSlow});hui.animate(hui.ui.dragProxy,"top",(hui.ui.startDragPos.top-5)+"px",200,{ease:hui.ease.fastSlow,hideOnComplete:true})}hui.ui.latestDropTarget=null;hui.selection.enable(false)};hui.ui.dropOverListener=function(a){if(hui.ui.dragging){}};hui.ui.dropOutListener=function(a){if(hui.ui.dragging){}};hui.ui.Window=function(a){this.element=hui.get(a.element);this.name=a.name;this.close=hui.get.firstByClass(this.element,"hui_window_close");this.titlebar=hui.get.firstByClass(this.element,"hui_window_titlebar");this.title=hui.get.firstByClass(this.titlebar,"hui_window_title");this.content=hui.get.firstByClass(this.element,"hui_window_body");this.front=hui.get.firstByClass(this.element,"hui_window_front");this.back=hui.get.firstByClass(this.element,"hui_window_back");if(this.back){hui.effect.makeFlippable({container:this.element,front:this.front,back:this.back})}this.visible=false;hui.ui.extend(this);this._addBehavior();if(a.listener){this.listen(a.listener)}};hui.ui.Window.create=function(b){b=hui.override({title:"Window",close:true},b);var c='<div class="hui_window_front">'+(b.close?'<div class="hui_window_close"></div>':"")+'<div class="hui_window_titlebar"><div><div>';if(b.icon){c+='<span class="hui_window_icon" style="background-image: url('+hui.ui.getIconUrl(b.icon,16)+')"></span>'}c+='<span class="hui_window_title">'+hui.ui.getTranslated(b.title)+'</span></div></div></div><div class="hui_window_content"><div class="hui_window_content"><div class="hui_window_body" style="'+(b.width?"width:"+b.width+"px;":"")+(b.height?"height:"+b.height+"px;":"")+(b.padding?"padding:"+b.padding+"px;":"")+(b.padding?"padding-bottom:"+Math.max(0,b.padding-2)+"px;":"")+'"></div></div></div><div class="hui_window_bottom"><div class="hui_window_bottom"><div class="hui_window_bottom"></div></div></div></div>';var a="hui_window"+(b.variant?" hui_window_"+b.variant:"");if(b.variant=="dark"){a+=" hui_context_dark"}b.element=hui.build("div",{"class":a,html:c,parent:document.body});if(b.variant=="dark"){hui.cls.add(b.element,"hui_context_dark")}return new hui.ui.Window(b)};hui.ui.Window.prototype={_addBehavior:function(){var a=this;if(this.close){hui.listen(this.close,"click",function(b){this.hide();this.fire("userClosedWindow")}.bind(this));hui.listen(this.close,"mousedown",function(b){hui.stop(b)})}hui.drag.register({element:this.titlebar,onStart:this._onDragStart.bind(this),onBeforeMove:this._onBeforeMove.bind(this),onMove:this._onMove.bind(this),onAfterMove:this._onAfterMove.bind(this)});hui.listen(this.element,"mousedown",function(){a.element.style.zIndex=hui.ui.nextPanelIndex()})},setTitle:function(a){hui.dom.setText(this.title,hui.ui.getTranslated(a))},_positionInView:function(){var b=hui.window.getScrollTop();var a=hui.position.getTop(this.element);if(a<b||a+this.element.clientHeight>hui.window.getViewHeight()+b){hui.animate({node:this.element,css:{top:(b+40)+"px"},duration:500,ease:hui.ease.slowFastSlow})}},show:function(a){if(this.visible){this._positionInView();this.element.style.zIndex=hui.ui.nextPanelIndex();return}a=a||{};hui.style.set(this.element,{zIndex:hui.ui.nextPanelIndex(),visibility:"hidden",display:"block"});var b=this.element.clientWidth;hui.style.set(this.element,{width:b+"px",visibility:"visible"});if(a.avoid){hui.position.place({insideViewPort:true,target:{element:a.avoid,vertical:0.5,horizontal:1},source:{element:this.element,vertical:0.5,horizontal:0}})}else{if(!this.element.style.top){this.element.style.top=(hui.window.getScrollTop()+40)+"px"}else{this._positionInView()}if(!this.element.style.left){this.element.style.left=Math.round((hui.window.getViewWidth()-b)/2)+"px"}}if(hui.browser.opacity){hui.animate(this.element,"opacity",1,0)}this.visible=true;hui.ui.callVisible(this)},toggle:function(a){(this.visible?this.hide():this.show(a))},hide:function(){if(!this.visible){return}if(hui.browser.opacity){hui.animate(this.element,"opacity",0,100,{onComplete:function(){this.element.style.display="none";hui.ui.callVisible(this)}.bind(this)})}else{this.element.style.display="none";hui.ui.callVisible(this)}this.visible=false},add:function(a){if(a.getElement){this.content.appendChild(a.getElement())}else{this.content.appendChild(a)}},addToBack:function(a){if(!this.back){this.back=hui.build("div",{className:"hui_window_back"});this.element.insertBefore(this.back,this.front);hui.effect.makeFlippable({container:this.element,front:this.front,back:this.back})}this.back.appendChild(hui.ui.getElement(a))},setVariant:function(a){hui.cls.remove(this.element,"hui_window_dark");hui.cls.remove(this.element,"hui_window_light");hui.cls.remove(this.element,"hui_window_news");if(a=="dark"||a=="light"||a=="news"){hui.cls.add(this.element,"hui_window_"+a)}hui.cls.set(this.element,"hui_context_dark",a=="dark")},flip:function(){if(this.back){this.back.style.minHeight=this.element.clientHeight+"px";hui.effect.flip({element:this.element})}},setBusy:function(a){window.clearTimeout(this._busyTimer);if(a===false){if(this._busyCurtain){this._busyCurtain.style.display="none"}return}this._busyTimer=window.setTimeout(function(){var b=this._busyCurtain;if(!b){b=this._busyCurtain=hui.build("div",{"class":"hui_window_busy",parentFirst:hui.get.firstByClass(this.element,"hui_window_content")})}b.innerHTML=hui.isString(a)?"<span>"+a+"</span>":"<span></span>";b.style.display="";b.style.height=this.content.clientHeight+"px";b.style.width=this.content.clientWidth+"px"}.bind(this),300)},move:function(a){hui.style.set(this.element,{top:a.top+"px",left:a.left+"px"})},_onDragStart:function(a){this.element.style.zIndex=hui.ui.nextPanelIndex()},_onBeforeMove:function(a){a=hui.event(a);var b=hui.position.get(this.element);this.dragState={left:a.getLeft()-b.left,top:a.getTop()-b.top};this.element.style.right="auto";hui.cls.add(this.element,"hui_window_dragging")},_onMove:function(c){var b=(c.getTop()-this.dragState.top);var a=(c.getLeft()-this.dragState.left);this.element.style.top=Math.max(b,0)+"px";this.element.style.left=Math.max(a,0)+"px"},_onAfterMove:function(){hui.ui.callDescendants(this,"$$parentMoved");hui.cls.remove(this.element,"hui_window_dragging")},destroy:function(){hui.dom.remove(this.element)}};hui.ui.Formula=function(a){this.options=a;hui.ui.extend(this,a);this.addBehavior();if(a.listener){this.listen(a.listener)}};hui.ui.Formula.create=function(a){a=a||{};var b={"class":"hui_formula hui_formula"};if(a.action){b.action=a.action}if(a.method){b.method=a.method}a.element=hui.build("form",b);return new hui.ui.Formula(a)};hui.ui.Formula.prototype={addBehavior:function(){this.element.onsubmit=function(){return false}},submit:function(){this.fire("submit")},getValues:function(){var c={};var e=hui.ui.getDescendants(this);for(var a=0;a<e.length;a++){var b=e[a];if(b.options&&b.options.key&&b.getValue){c[b.options.key]=b.getValue()}else{if(b.name&&b.getValue){c[b.name]=b.getValue()}}}return c},setValues:function(a){if(!hui.isDefined(a)){return}var e=hui.ui.getDescendants(this);for(var c=0;c<e.length;c++){if(e[c].options&&(e[c].options.key||e[c].options.name)){var b=e[c].options.key||e[c].options.name;if(b&&a[b]!==undefined){e[c].setValue(a[b])}}}},focus:function(b){var c=hui.ui.getDescendants(this);for(var a=0;a<c.length;a++){if(c[a].focus&&(!b||(c[a].options&&c[a].options.key==b)||c[a].name==b)){c[a].focus();return}}},reset:function(){var b=hui.ui.getDescendants(this);for(var a=0;a<b.length;a++){if(b[a].reset){b[a].reset()}}},add:function(a){this.element.appendChild(a.getElement())},createGroup:function(a){var b=hui.ui.Formula.Group.create(a);this.add(b);return b},buildGroup:function(a,c){var b=this.createGroup(a);hui.each(c,function(e){if(hui.ui.Formula[e.type]){var d=hui.ui.Formula[e.type].create(e.options);b.add(d,e.label)}else{if(hui.ui[e.type]){var d=hui.ui[e.type].create(e.options);b.add(d,e.label)}else{hui.log("buildGroup: Unable to find type: "+e.type)}}});return b},childValueChanged:function(a){this.fire("valuesChanged",this.getValues())},show:function(){this.element.style.display=""},hide:function(){this.element.style.display="none"}};hui.ui.Formula.Group=function(a){this.name=a.name;this.element=hui.get(a.element);this.body=hui.get.firstByTag(this.element,"tbody");this.options=hui.override({above:true},a);hui.ui.extend(this)};hui.ui.Formula.Group.create=function(a){a=hui.override({above:true},a);var b=a.element=hui.build("table",{"class":"hui_formula_fields"});if(a.above){hui.cls.add(b,"hui_formula_fields_above")}b.appendChild(hui.build("tbody"));return new hui.ui.Formula.Group(a)};hui.ui.Formula.Group.prototype={add:function(e,a){var d=hui.build("tr");this.body.appendChild(d);var f=hui.build("td",{"class":"hui_formula_field"});if(!a&&e.getLabel){a=e.getLabel()}if(a){a=hui.ui.getTranslated(a);if(this.options.above){hui.build("label",{className:"hui_formula_field",text:a,parent:f})}else{var c=hui.build("th",{parent:d,className:"hui_formula_middle"});hui.build("label",{className:"hui_formula_field",text:a,parent:c})}}var b=hui.build("div",{"class":"hui_formula_field_body"});b.appendChild(e.getElement());f.appendChild(b);d.appendChild(f)},createButtons:function(c){var d=hui.build("tr",{parent:this.body});var e=hui.build("td",{colspan:this.options.above?1:2,parent:d});var a=hui.ui.Buttons.create(c);e.appendChild(a.getElement());return a}};hui.ui.Formula.Field=function(a){this.name=a.name;this.element=hui.get(a.element);hui.ui.extend(this)};hui.ui.Formula.Field.prototype={setVisible:function(a){this.element.style.display=a?"":"none"}};hui.ui.List=function(a){this.options=hui.override({url:null,source:null,selectable:true,indent:null,selectMany:false,rememberSelection:false},a);this.element=hui.get(a.element);this.name=a.name;if(this.options.source){this.options.source.listen(this)}this.url=a.url;this.table=hui.get.firstByTag(this.element,"table");this.head=hui.get.firstByTag(this.element,"thead");this.body=hui.get.firstByTag(this.element,"tbody");this.columns=[];this.rows=[];this.selected=[];this.checked=[];this.navigation=hui.get.firstByClass(this.element,"hui_list_navigation");this.count=hui.get.firstByClass(this.navigation,"hui_list_count");this.windowPage=hui.get.firstByClass(this.navigation,"window_page");this.windowPageBody=hui.get.firstByClass(this.navigation,"window_page_body");this.parameters={};this.sortKey=null;this.sortDirection=null;this.window={size:null,page:0,total:0};if(a.windowSize!=""){this.window.size=parseInt(a.windowSize)}hui.ui.extend(this);if(a.dropFiles){this._addDrop()}if(this.url){this.refresh()}};hui.ui.List.create=function(b){b=b||{};var a="hui_list";if(b.variant){a+=" hui_list_"+b.variant}b.element=hui.build("div",{"class":a,html:'<div class="hui_list_progress"></div><div class="hui_list_navigation"><div class="hui_list_selection window_page"><div><div class="window_page_body"></div></div></div><span class="hui_list_count"></span></div><div class="hui_list_body"'+(b.maxHeight>0?' style="max-height: '+b.maxHeight+'px; overflow: auto;"':"")+'><table cellspacing="0" cellpadding="0"><thead><tr></tr></thead><tbody></tbody></table></div>'});return new hui.ui.List(b)};hui.ui.List.prototype={_addDrop:function(){hui.drag.listen({element:this.element,hoverClass:"hui_list_drop",$dropFiles:function(a){this.fire("filesDropped",a)}.bind(this),$dropURL:function(a){this.fire("urlDropped",a)}.bind(this)})},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="block";this.refresh()},registerColumn:function(a){this.columns.push(a)},getSelection:function(){if(this.selected.length>0){return this._getRowsByIndexes(this.selected)}return this._getRowsByIndexes(this.checked)},getFirstSelection:function(){var a=this.getSelection();if(a.length>0){return a[0]}return null},getSelectionSize:function(){return this.selected.length+this.checked.length},getSelectionIds:function(){var c=this.getSelection(),b=[];for(var a=0;a<c.length;a++){b.push(c[a].id)}return b},_getRowsByIndexes:function(b){var a=[];for(var c=0;c<b.length;c++){a.push(this.rows[b[c]])}return a},getRows:function(){return this.rows},setParameter:function(a,b){this.parameters[a]=b},loadData:function(a){this.setUrl(a)},setSource:function(a){if(this.options.source!=a){if(this.options.source){this.options.source.unListen(this)}a.listen(this);this.options.source=a;a.refresh()}},setUrl:function(a){if(this.options.source){this.options.source.unListen(this);this.options.source=null}this.url=a;this.selected=[];this.checked=[];this.sortKey=null;this.sortDirection=null;this.resetState();this.refresh()},clear:function(){this._empty();if(this.options.source){this.options.source.unListen(this)}this.options.source=null;this.url=null},clearSelection:function(){this._changeSelection([])},_empty:function(){this.selected=[];this.checked=[];this.columns=[];this.rows=[];this.navigation.style.display="none";hui.dom.clear(this.body);hui.dom.clear(this.head)},resetState:function(){this.window={size:null,page:0,total:0};hui.ui.firePropertyChange(this,"window",this.window);hui.ui.firePropertyChange(this,"window.page",this.window.page)},valueForProperty:function(b){if(b=="window.page"){return this.window.page}else{if(b=="sort.key"){return this.sortKey}else{if(b=="sort.direction"){return(this.sortDirection||"ascending")}else{if(b=="selection.id"){var a=this.getFirstSelection();if(a){return a.id}return null}else{return this[b]}}}}},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$visibilityChanged:function(){if(this.options.source&&hui.dom.isVisible(this.element)){this.options.source.refreshFirst()}},refresh:function(){if(this.options.source){this.options.source.refreshLater();return}if(!this.url){return}var a=this.url;if(typeof(this.window.page)=="number"){a+=a.indexOf("?")==-1?"?":"&";a+="windowPage="+this.window.page}if(this.window.size){a+=a.indexOf("?")==-1?"?":"&";a+="windowSize="+this.window.size}if(this.sortKey){a+=a.indexOf("?")==-1?"?":"&";a+="sort="+this.sortKey}if(this.sortDirection){a+=a.indexOf("?")==-1?"?":"&";a+="direction="+this.sortDirection}for(var b in this.parameters){a+=a.indexOf("?")==-1?"?":"&";a+=b+"="+this.parameters[b]}this._setBusy(true);hui.ui.request({url:a,$object:function(c){this._setBusy(false);this.$objectsLoaded(c)}.bind(this),$xml:function(c){this._setBusy(false);this.$listLoaded(c)}.bind(this)})},sort:function(a){var b=this.columns[a].key;if(b==this.sortKey){this.sortDirection=this.sortDirection=="ascending"?"descending":"ascending";hui.ui.firePropertyChange(this,"sort.direction",this.sortDirection)}else{hui.ui.firePropertyChange(this,"sort.key",b)}this.sortKey=b},_debug:function(a){},$listLoaded:function(E){this._debug("List loaded");this._setError(false);var r=this.selected.length>0||this.checked.length>0;var n;if(this.options.rememberSelection){n=this.getSelectionIds()}this.selected=[];this.checked=[];this._parseWindow(E);this._buildNavigation();hui.dom.clear(this.head);hui.dom.clear(this.body);this.rows=[];this.columns=[];this.checkboxMode=E.documentElement.getAttribute("checkboxes")==="true";var g=E.documentElement.getAttribute("ordering")==="true";var B=document.createElement("tr");var z=E.getElementsByTagName("sort");this.sortKey=null;this.sortDirection=null;if(z.length>0){this.sortKey=z[0].getAttribute("key");this.sortDirection=z[0].getAttribute("direction")}if(this.checkboxMode){var k=hui.build("th",{className:"list_check",parent:B});var A=hui.build("a",{className:"list_check_all",parent:k});hui.listen(k,"click",this._checkAll.bind(this))}if(g){hui.build("th",{"class":"hui_list_order_header",parent:B})}var d=E.getElementsByTagName("header");var w;for(w=0;w<d.length;w++){var e="";var k=document.createElement("th");var t=d[w].getAttribute("width");var D=d[w].getAttribute("key");var f=d[w].getAttribute("sortable")=="true";if(t&&t!=""){k.style.width=t+"%"}if(d[w].getAttribute("align")){k.style.textAlign=d[w].getAttribute("align")}if(f){var q=this;k.huiIndex=w;k.onclick=function(){q.sort(this.huiIndex)};e+="sortable"}if(this.sortKey&&D==this.sortKey){e+=" sort_"+this.sortDirection}k.className=e;var v=document.createElement("span");k.appendChild(v);v.appendChild(document.createTextNode(d[w].getAttribute("title")||""));B.appendChild(k);this.columns.push({key:D,sortable:f,width:t})}this.head.appendChild(B);var c=document.createDocumentFragment();var o=E.getElementsByTagName("row");for(w=0;w<o.length;w++){var h=o[w].getElementsByTagName("cell");var l=document.createElement("tr");l.setAttribute("data-index",w);if(this.checkboxMode){var m=hui.build("td",{parent:l,className:"hui_list_checkbox"});hui.build("a",{className:"hui_list_checkbox",parent:m})}if(g){var m=hui.build("td",{parent:l,className:"hui_list_order"});hui.build("a",{className:"hui_list_order_handler",parent:m})}var y=o[w].getAttribute("icon");var C=o[w].getAttribute("title");var b=o[w].getAttribute("level");for(var u=0;u<h.length;u++){var m=document.createElement("td");if(h[u].getAttribute("wrap")=="false"){m.style.whiteSpace="nowrap"}if(h[u].getAttribute("vertical-align")){m.style.verticalAlign=h[u].getAttribute("vertical-align")}if(h[u].getAttribute("width")){m.style.width=h[u].getAttribute("width")+"%"}if(h[u].getAttribute("align")){m.style.textAlign=h[u].getAttribute("align")}if(h[u].getAttribute("class")){hui.cls.add(m,h[u].getAttribute("class"))}if(h[u].getAttribute("dimmed")=="true"){m.className="hui_list_dimmed"}if(u==0&&b>1){m.style.paddingLeft=((parseInt(b)-1)*16+5)+"px"}else{if(u==0&&this.options.indent!=null){m.style.paddingLeft=this.options.indent+"px"}}this._parseCell(h[u],m);l.appendChild(m);if(!C){C=hui.dom.getText(h[u])}if(!y){y=h[u].getAttribute("icon")}}var x={id:o[w].getAttribute("id"),kind:o[w].getAttribute("kind"),icon:y,title:C,index:w,data:this._getData(o[w])};l.dragDropInfo=x;this._addRowBehavior(l,w);c.appendChild(l);this.rows.push(x)}this.body.appendChild(c);this._setEmpty(o.length==0);if(this.options.rememberSelection){hui.log("Previous:",n);var p=[];for(var w=0;w<n.length;w++){for(var u=0;u<this.rows.length;u++){if(this.rows[u].id===n[w]){p.push(u)}}}this._changeSelection(p)}else{this.fire("selectionReset");if(r){this.fire("select",null)}}this.fireSizeChange()},_parseCell:function(c,o){var d=c.getAttribute("variant");if(d!=null&&d!=""){o=hui.build("div",{parent:o,className:"hui_list_cell_"+d})}var n=c.getAttribute("icon");if(n!=null&&n!=""){o.appendChild(hui.ui.createIcon(n,16));o=hui.build("div",{parent:o,style:"margin-left: 21px; padding-top: 1px;"})}for(var h=0;h<c.childNodes.length;h++){var b=c.childNodes[h];if(hui.dom.isDefinedText(b)){hui.dom.addText(o,b.nodeValue)}else{if(hui.dom.isElement(b,"break")){o.appendChild(document.createElement("br"))}else{if(hui.dom.isElement(b,"icon")){var r=b.getAttribute("size")||16;var n=hui.ui.createIcon(b.getAttribute("icon"),r);if(b.getAttribute("hint")){n.setAttribute("title",b.getAttribute("hint"))}if(b.getAttribute("action")=="true"){hui.cls.add(n,"hui_list_icon_action")}var g=b.getAttribute("data");if(g){n.setAttribute("data",g)}if(b.getAttribute("revealing")==="true"){hui.cls.add(n,"hui_list_revealing")}o.appendChild(n)}else{if(hui.dom.isElement(b,"line")){var q=hui.build("p",{"class":"hui_list_line"});if(b.getAttribute("dimmed")=="true"){hui.cls.add(q,"hui_list_dimmed")}if(b.getAttribute("minor")=="true"){hui.cls.add(q,"hui_list_minor")}if(b.getAttribute("mini")=="true"){hui.cls.add(q,"hui_list_mini")}if(b.getAttribute("class")){hui.cls.add(q,b.getAttribute("class"))}if(b.getAttribute("top")){q.style.paddingTop=b.getAttribute("top")+"px"}o.appendChild(q);this._parseCell(b,q)}else{if(hui.dom.isElement(b,"object")){var f=hui.build("div",{"class":"hui_list_object"});if(b.getAttribute("icon")){f.appendChild(hui.ui.createIcon(b.getAttribute("icon"),16))}if(b.firstChild&&b.firstChild.nodeType===3&&b.firstChild.nodeValue.length>0){hui.dom.addText(f,b.firstChild.nodeValue)}o.appendChild(f)}else{if(hui.dom.isElement(b,"icons")){var p=hui.build("span",{"class":"hui_list_icons"});if(b.getAttribute("left")){p.style.marginLeft=b.getAttribute("left")+"px"}this._parseCell(b,p);o.appendChild(p)}else{if(hui.dom.isElement(b,"button")){var k=hui.ui.Button.create({text:b.getAttribute("text"),small:true,rounded:true,data:this._getData(b)});k.click(this._buttonClick.bind(this));o.appendChild(k.getElement())}else{if(hui.dom.isElement(b,"wrap")){if(hui.browser.wordbreak){hui.cls.add(o,"hui_list_wrap");hui.dom.addText(o,hui.dom.getText(b))}else{hui.dom.addText(o,this._wrap(hui.dom.getText(b)))}}else{if(hui.dom.isElement(b,"delete")){this._parseCell(b,hui.build("del",{parent:o}))}else{if(hui.dom.isElement(b,"strong")){this._parseCell(b,hui.build("strong",{parent:o}))}else{if(hui.dom.isElement(b,"badge")){this._parseCell(b,hui.build("span",{className:"hui_list_badge",parent:o}))}else{if(hui.dom.isElement(b,"progress")){var a=hui.build("span",{className:"hui_list_progress",parent:o});var l=Math.round(parseFloat(b.getAttribute("value"))*100);hui.build("span",{style:{width:l+"%"},parent:a});this._parseCell(b,a)}else{if(hui.dom.isElement(b,"html")){for(var e=0;e<b.childNodes.length;e++){var m=b.childNodes[e].cloneNode(true);m.namespaceURI=b.namespaceURI;o.appendChild(m)}}}}}}}}}}}}}}}},$objectsLoaded:function(b){var a=this.selected.length>0||this.checked.length>0;this._setError(false);if(b==null){}else{if(b.constructor==Array){this.setObjects(b)}else{this.setData(b)}}this.fire("selectionReset");if(a){this.fire("select")}this.fireSizeChange()},$sourceIsBusy:function(){this._debug("$sourceIsBusy");this._setBusy(true)},$sourceIsNotBusy:function(){this._debug("$sourceIsNotBusy");this._setBusy(false)},$sourceFailed:function(){hui.log("The source failed!");this._setError(true)},_setError:function(a){hui.cls.set(this.element,"hui_list_error",a)},_setBusy:function(a){this.busy=a;window.clearTimeout(this.busytimer);if(a){var b=this.element;this.busytimer=window.setTimeout(function(){hui.cls.add(b,"hui_list_busy");if(b.parentNode.className=="hui_overflow"){hui.cls.add(b,"hui_list_busy_large")}},300)}else{hui.cls.remove(this.element,"hui_list_busy");if(this.element.parentNode.className=="hui_overflow"){hui.cls.remove(this.element,"hui_list_busy_large")}}},_setEmpty:function(b){var a=hui.get.firstByClass(this.element,"hui_list_empty");if(a){a.style.display=b?"block":""}},_wrap:function(d){var a="";var c=0;for(var b=0;b<d.length;b++){if(d[b]===" "||d[b]==="-"){c=0}else{c++}a+=d[b];if(c>10){a+="\u200B";c=0}}return a},_getData:function(a){var b=a.getAttribute("data");if(b){return hui.string.fromJSON(b)}return null},_buttonClick:function(a){var c=hui.get.firstParentByTag(a.getElement(),"tr");var b=this.rows[parseInt(c.getAttribute("data-index"),10)];this.fire("clickButton",{row:b,button:a})},_parseWindow:function(b){var c=b.getElementsByTagName("window");if(c.length>0){var a=c[0];this.window.total=parseInt(a.getAttribute("total"));this.window.size=parseInt(a.getAttribute("size"));this.window.page=parseInt(a.getAttribute("page"))}else{this.window.total=0;this.window.size=0;this.window.page=0}},_buildNavigation:function(){var d=this;var b=this.window.size>0?Math.ceil(this.window.total/this.window.size):0;if(b<2){this.navigation.style.display="none";return}this.navigation.style.display="block";var j=((this.window.page)*this.window.size+1);hui.dom.setText(this.count,(j+"-"+Math.min((this.window.page+1)*this.window.size,this.window.total)+" / "+this.window.total));var g=this.windowPageBody;g.innerHTML="";if(b<2){this.windowPage.style.display="none"}else{var h=this._buildPages(b,this.window.page);for(var f=0;f<h.length;f++){var e=h[f];if(e===""){g.appendChild(hui.build("span",{text:"·"}))}else{var c=document.createElement("a");c.appendChild(document.createTextNode(e+1));c.setAttribute("data-index",e);c.onmousedown=function(){d._onPageClick(this);return false};if(e==d.window.page){c.className="hui_list_selected"}g.appendChild(c)}}this.windowPage.style.display="block"}},_buildPages:function(e,d){var b=[];var a=false;for(var c=0;c<e;c++){if(c<1||c>e-2||Math.abs(d-c)<5){b.push(c);a=false}else{if(!a){b.push("")}a=true}}return b},setData:function(a){this.selected=[];this.checked=[];var b=a.window||{};this.window.total=b.total||0;this.window.size=b.size||0;this.window.page=b.page||0;this._buildNavigation();this._buildHeaders(a.headers);this._buildRows(a.rows);this._setEmpty(!a.rows||a.rows.length==0)},_buildHeaders:function(b){hui.dom.clear(this.head);this.columns=[];var a=hui.build("tr",{parent:this.head});hui.each(b,function(d,c){var e=hui.build("th");if(d.width){e.style.width=d.width+"%"}if(d.sortable){hui.listen(e,"click",function(){this.sort(c)}.bind(this));hui.cls.add(e,"sortable")}e.appendChild(hui.build("span",{text:d.title}));a.appendChild(e);this.columns.push(d)}.bind(this))},_buildRows:function(b){var a=this;hui.dom.clear(this.body);this.rows=[];if(!b){return}hui.each(b,function(e,c){var f=hui.build("tr");var d=e.icon;var h=e.title;hui.each(e.cells,function(j){var i=hui.build("td");if(j.icon){i.appendChild(hui.ui.createIcon(j.icon,16));d=d||j.icon}if(j.text){i.appendChild(document.createTextNode(j.text));h=h||j.text}f.appendChild(i)});a.body.appendChild(f);var g={id:e.id,kind:e.kind,icon:d,title:h,index:c};f.dragDropInfo=g;hui.log(this._getData(f));a.rows.push({id:e.id,kind:e.kind,icon:d,title:h,index:c,data:e.data});this._addRowBehavior(f,c)}.bind(this))},setObjects:function(l){l=l||[];this.selected=[];this.checked=[];hui.dom.clear(this.body);this.rows=[];for(var e=0;e<l.length;e++){var m=hui.build("tr");var d=l[e];var f=null;for(var c=0;c<this.columns.length;c++){var h=hui.build("td");if(this.builder){h.appendChild(this.builder.buildColumn(this.columns[c],d))}else{var g=d[this.columns[c].key]||"";if(hui.isArray(g)){for(var b=0;b<g.length;b++){if(g[b].constructor==Object){h.appendChild(this._createObject(g[b]))}else{h.appendChild(hui.build("div",{text:g}))}}}else{if(g.constructor==Object){h.appendChild(this._createObject(g[c]))}else{hui.dom.addText(h,g);f=f==null?g:f}}}m.appendChild(h)}var a={id:d.id,kind:d.kind,title:f};m.dragDropInfo=a;this.body.appendChild(m);this._addRowBehavior(m,e);this.rows.push(d)}},_createObject:function(a){var b=hui.build("div",{"class":"hui_list_object"});if(a.icon){b.appendChild(hui.ui.createIcon(a.icon,16))}hui.dom.addText(b,a.text||a.name||"");return b},_addRowBehavior:function(c,b){var a=this;c.onmousedown=function(h){if(a.busy){return}var f=hui.event(h);var g=f.findByClass("hui_list_icon_action");if(!g){var d=f.findByClass("hui_list_checkbox");if(d){a._toggleChecked(b)}else{a._onRowDown(b,f);if(hui.ui.startDrag){hui.ui.startDrag(h,c)}return false}}};c.ondblclick=function(d){if(a.busy){return}a._onRowDoubleClick(b,d);hui.selection.clear();return false};c.onclick=function(d){if(a.busy){return}a._onRowClick(b,d);return false}},_checkAll:function(){for(var a=0;a<this.rows.length;a++){hui.array.flip(this.checked,a)}this._drawChecks();this._changeSelection([])},_toggleChecked:function(a){hui.array.flip(this.checked,a);this._drawChecks();this._changeSelection([])},_drawChecks:function(){var b=this.body.getElementsByTagName("tr");for(var a=0;a<b.length;a++){hui.cls.set(b[a],"hui_list_checked",hui.array.contains(this.checked,a))}},_clearChecked:function(){this.checked=[];this._drawChecks();this.fire("checkedReset")},_changeSelection:function(a){var c=this.body.getElementsByTagName("tr"),b;for(b=0;b<this.selected.length;b++){hui.cls.remove(c[this.selected[b]],"hui_list_selected")}for(b=0;b<a.length;b++){hui.cls.add(c[a[b]],"hui_list_selected")}this.selected=a;if(a.length>0){this.fire("select",this.rows[a[0]]);hui.ui.firePropertyChange(this,"selection.id",this.rows[a[0]].id);this._clearChecked()}else{this.fire("select")}},_onRowClick:function(c,f){f=hui.event(f);var b=f.findByClass("hui_list_icon_action");if(b){var d=b.getAttribute("data");if(d){d=hui.string.fromJSON(d)}this.fire("clickIcon",{row:this.rows[c],data:d,node:b})}},_onRowDown:function(b,c){if(!this.options.selectable){return}this.checked=[];if(c.metaKey&&this.options.selectMany){var a=this.selected.slice(0);hui.array.flip(a,b);this._changeSelection(a)}else{this._changeSelection([b])}},_onRowDoubleClick:function(a,b){b=hui.event(b);if(!b.findByClass("hui_list_icon_action")){var c=this.getFirstSelection();if(c){this.fire("open",c)}}},_onPageClick:function(a){var c=parseInt(a.getAttribute("data-index"));this.window.page=c;hui.ui.firePropertyChange(this,"window",this.window);hui.ui.firePropertyChange(this,"window.page",this.window.page);var b=this.windowPageBody.getElementsByTagName("a");for(var d=b.length-1;d>=0;d--){b[d].className=b[d]==a?"hui_list_selected":""}}};hui.ui.Tabs=function(d){d=d||{};this.name=d.name;this.element=hui.get(d.element);this.activeTab=-1;var a=hui.get.firstByClass(this.element,"hui_tabs_bar");this.bar=hui.get.firstByTag(a,"ul");this.tabs=[];var b=this.bar.getElementsByTagName("li");for(var c=0;c<b.length;c++){if(!hui.browser.msie){hui.get.firstByTag(b[c],"a").removeAttribute("href")}this.tabs.push(b[c])}this.contents=hui.get.byClass(this.element,"hui_tabs_tab");this.addBehavior();hui.ui.extend(this)};hui.ui.Tabs.create=function(b){b=b||{};var d=b.element=hui.build("div",{"class":"hui_tabs"});var a="hui_tabs_bar";if(b.small){a+=" hui_tabs_bar_small"}if(b.centered){a+=" hui_tabs_bar_centered"}var c=hui.build("div",{"class":a,parent:d});hui.build("ul",{parent:c});return new hui.ui.Tabs(b)};hui.ui.Tabs.prototype={addBehavior:function(){for(var a=0;a<this.tabs.length;a++){this.addTabBehavior(this.tabs[a],a)}},addTabBehavior:function(b,a){hui.listen(b,"click",function(){this.tabWasClicked(a)}.bind(this))},registerTab:function(a){a.parent=this;this.tabs.push(a)},tabWasClicked:function(a){this.activeTab=a;this.updateGUI();hui.ui.callVisible(this)},updateGUI:function(){for(var a=0;a<this.tabs.length;a++){hui.cls.set(this.tabs[a],"hui_tabs_selected",a==this.activeTab);this.contents[a].style.display=a==this.activeTab?"block":"none"}},createTab:function(a){a=a||{};var b=hui.build("li",{html:"<a><span><span>"+hui.string.escape(a.title)+"</span></span></a>",parent:this.bar});this.addTabBehavior(b,this.tabs.length);this.tabs.push(b);var c=a.element=hui.build("div",{"class":"hui_tabs_tab"});if(a.padding>0){c.style.padding=a.padding+"px"}this.contents.push(c);this.element.appendChild(c);if(this.activeTab==-1){this.activeTab=0;hui.cls.add(b,"hui_tabs_selected")}else{c.style.display="none"}return new hui.ui.Tab(a)}};hui.ui.Tab=function(a){this.name=a.name;this.element=hui.get(a.element)};hui.ui.Tab.prototype={add:function(a){this.element.appendChild(a.element)}};hui.ui.ObjectList=function(a){this.options=hui.override({key:null},a);this.name=a.name;this.element=hui.get(a.element);this.body=hui.get.firstByTag(this.element,"tbody");this.template=[];this.objects=[];hui.ui.extend(this)};hui.ui.ObjectList.create=function(f){f=f||{};var d=f.element=hui.build("table",{"class":"hui_objectlist",cellpadding:"0",cellspacing:"0"});if(f.template){var b="<thead><tr>";for(var a=0;a<f.template.length;a++){b+="<th>"+(f.template[a].label||"")+"</th>"}b+="</tr></thead>";d.innerHTML=b}hui.build("tbody",{parent:d});var c=new hui.ui.ObjectList(f);if(f.template){hui.each(f.template,function(e){c.registerTemplateItem(new hui.ui.ObjectList.Text(e.key))})}return c};hui.ui.ObjectList.prototype={ignite:function(){this.addObject({})},addObject:function(b,d){var c;if(this.objects.length==0||d){c=new hui.ui.ObjectList.Object(this.objects.length,b,this);this.objects.push(c);this.body.appendChild(c.getElement())}else{var a=this.objects[this.objects.length-1];hui.array.remove(this.objects,a);c=new hui.ui.ObjectList.Object(a.index,b,this);a.index++;this.objects.push(c);this.objects.push(a);this.body.insertBefore(c.getElement(),a.getElement())}},reset:function(){for(var b=0;b<this.objects.length;b++){var a=this.objects[b].getElement();if(!a.parentNode){hui.log("no parent for...");hui.log(a)}else{a.parentNode.removeChild(a)}}this.objects=[];this.addObject({})},addObjects:function(b){for(var a=0;a<b.length;a++){this.addObject(b[a])}},setObjects:function(a){this.reset();this.addObjects(a)},getObjects:function(c){var b=[];for(var a=0;a<this.objects.length-1;a++){b.push(this.objects[a].getData())}return b},getValue:function(){return this.getObjects()},setValue:function(a){this.setObjects(a)},registerTemplateItem:function(a){this.template.push(a)},objectDidChange:function(a){if(a.index>=this.objects.length-1){this.addObject({},true)}},getLabel:function(){return this.options.label}};hui.ui.ObjectList.Object=function(a,c,b){this.data=c;this.index=a;this.list=b;this.fields=[]};hui.ui.ObjectList.Object.prototype={getElement:function(){if(!this.element){this.element=document.createElement("tr");for(var b=0;b<this.list.template.length;b++){var c=this.list.template[b];var d=c.clone();d.object=this;this.fields.push(d);var a=document.createElement("td");if(b==0){a.className="first"}a.appendChild(d.getElement());d.setValue(this.data[c.key]);this.element.appendChild(a)}}return this.element},valueDidChange:function(){this.list.objectDidChange(this)},getData:function(){var b=this.data;for(var a=0;a<this.fields.length;a++){b[this.fields[a].key]=this.fields[a].getValue()}return b}};hui.ui.ObjectList.Text=function(a){this.key=a;this.value=null};hui.ui.ObjectList.Text.prototype={clone:function(){return new hui.ui.ObjectList.Text(this.key)},getElement:function(){var a=hui.build("input",{"class":"hui_formula_text"});var b=hui.ui.wrapInField(a);this.wrapper=new hui.ui.Input({element:a});this.wrapper.listen(this);hui.ui.addFocusClass({element:a,classElement:b,"class":"hui_field_focused"});return b},$valueChanged:function(a){this.value=a;this.object.valueDidChange()},getValue:function(){return this.value},setValue:function(a){this.value=a;this.wrapper.setValue(a)}};hui.ui.ObjectList.Select=function(a){this.key=a;this.value=null;this.options=[]};hui.ui.ObjectList.Select.prototype={clone:function(){var a=new hui.ui.ObjectList.Select(this.key);a.options=this.options;return a},getElement:function(){this.select=hui.build("select");for(var b=0;b<this.options.length;b++){this.select.options[this.select.options.length]=new Option(this.options[b].label,this.options[b].value)}var a=this;this.select.onchange=function(){a.object.valueDidChange()};return this.select},getValue:function(){return this.select.value},setValue:function(a){this.select.value=a},addOption:function(b,a){this.options.push({value:b,label:a})}};hui.ui.DropDown=function(a){this.options=hui.override({label:null,placeholder:null,url:null,source:null,focus:false},a);this.name=a.name;var b=this.element=hui.get(a.element);this.inner=b.getElementsByTagName("strong")[0];this.items=a.items||[];this.index=-1;this.value=this.options.value||null;this.dirty=true;this.busy=false;hui.ui.extend(this);if(a.listener){this.listen(a.listener)}this._attach();this._updateIndex();this._updateUI();if(this.options.url){this.options.source=new hui.ui.Source({url:this.options.url,delegate:this})}else{if(this.options.source){this.options.source.listen(this)}}};hui.ui.DropDown.create=function(b){b=b||{};var a="hui_dropdown";if(b.variant){a+=" hui_dropdown_"+b.variant}b.element=hui.build("a",{"class":a,href:"javascript://",html:"<span><span><strong></strong></span></span>"});return new hui.ui.DropDown(b)};hui.ui.DropDown.prototype={_attach:function(){hui.ui.addFocusClass({element:this.element,"class":"hui_dropdown_focused"});hui.listen(this.element,"click",this._click.bind(this));hui.listen(this.element,"blur",this._hideSelector.bind(this));hui.listen(this.element,"keydown",this._keyDown.bind(this));if(!this.options.focus){hui.listen(this.element,"mousedown",function(a){hui.stop(a)})}},_updateIndex:function(){this.index=-1;for(var a=0;a<this.items.length;a++){if(this.items[a].value==this.value){this.index=a}}},_updateUI:function(){var c=this.items[this.index];if(c){var d=c.label||c.title||c.text||"";this.inner.innerHTML="";hui.dom.addText(this.inner,hui.string.wrap(d))}else{if(this.options.placeholder){this.inner.innerHTML="";this.inner.appendChild(hui.build("em",{text:hui.string.escape(this.options.placeholder)}))}else{this.inner.innerHTML=""}}if(!this.selector){return}var a=this.selector.getElementsByTagName("a");for(var b=0;b<a.length;b++){if(this.index==b){hui.cls.add(a[b],"hui_selected")}else{a[b].className=""}}},_click:function(a){if(this.busy){return}hui.stop(a);if(this._selectorVisible){this._hideSelector()}else{this._showSelector();this._hider=function(b){b=hui.event(b);if(!b.isDescendantOf(this.element)){this._hideSelector()}}.bind(this);hui.listen(document.body,"mousedown",this._hider)}},_showSelector:function(){this._buildSelector();var d=this.element,i=this.selector;if(this.options.focus){d.focus()}if(!this.items){return}var j=hui.document.getHeight();if(j<200){var e=hui.position.getLeft(this.element);hui.style.set(this.selector,{left:e+"px",top:"5px"})}else{var g=hui.window.getScrollTop();var f=hui.position.getScrollOffset(this.element).top;var c=g-f;hui.position.place({target:{element:this.element,vertical:1,horizontal:0},source:{element:this.selector,vertical:0,horizontal:0},top:c})}hui.style.set(i,{visibility:"hidden",display:"block",width:""});var h=Math.min(j-hui.position.getTop(i)-5,200);var b=Math.max(d.clientWidth-5,100,i.clientWidth+20);var a=hui.window.getViewWidth()-hui.position.getLeft(d)-20;b=Math.min(b,a);hui.style.set(i,{visibility:"visible",width:b+"px",zIndex:hui.ui.nextTopIndex(),maxHeight:h+"px"});this._selectorVisible=true},_hideSelector:function(){hui.unListen(document.body,"mousedown",this._hider);if(!this.selector){return}this.selector.style.display="none";this._selectorVisible=false},_keyDown:function(a){if(this.busy){return}if(this.items.length==0){return}if(a.keyCode==40){hui.stop(a);if(this.index>=this.items.length-1){this.value=this.items[0].value}else{this.value=this.items[this.index+1].value}this._updateIndex();this._updateUI();this._fireChange()}else{if(a.keyCode==38){hui.stop(a);if(this.index>0){this.index--}else{this.index=this.items.length-1}this.value=this.items[this.index].value;this._updateUI();this._fireChange()}}},selectFirst:function(){if(this.items.length>0){this.setValue(this.items[0].value)}},getValue:function(){return this.value},setValue:function(a){this.value=a;this._updateIndex();this._updateUI()},reset:function(){this.setValue(null)},getLabel:function(){return this.options.label},refresh:function(){if(this.options.source){this.options.source.refresh()}},stress:function(){hui.ui.stress(this)},focus:function(){try{this.element.focus()}catch(a){}},getItem:function(){if(this.index>=0){return this.items[this.index]}return 0},addItem:function(a){this.items.push(a);this.dirty=true;this._updateIndex();this._updateUI()},setItems:function(a){this.items=a;this.dirty=true;this.index=-1;this._updateIndex();this._updateUI()},$itemsLoaded:function(a){this.setItems(a)},$sourceIsBusy:function(){this.busy=true;hui.style.setOpacity(this.element,0.5)},$sourceIsNotBusy:function(){this.busy=false;hui.style.setOpacity(this.element,1)},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$visibilityChanged:function(){if(hui.dom.isVisible(this.element)){if(this.options.source){this.options.source.refreshFirst()}}else{this._hideSelector()}},_buildSelector:function(){if(!this.dirty||!this.items){return}if(!this.selector){this.selector=hui.build("div",{"class":"hui_dropdown_selector"});document.body.appendChild(this.selector);hui.listen(this.selector,"mousedown",function(b){hui.stop(b)})}else{this.selector.innerHTML=""}var a=this;hui.each(this.items,function(c,b){var d=hui.build("a",{href:"javascript://",text:c.label||c.title||c.text||""});hui.listen(d,"mousedown",function(f){hui.stop(f);a._itemClicked(c,b);hui.listenOnce(document.body,"mouseup",function(g){hui.stop(g)})});if(b==a.index){hui.cls.add(d,"hui_selected")}a.selector.appendChild(d)});this.dirty=false},_itemClicked:function(b,a){this.index=a;var c=this.value!=this.items[a].value;this.value=this.items[a].value;this._updateUI();this._hideSelector();if(c){this._fireChange()}},_fireChange:function(){hui.ui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value);hui.ui.firePropertyChange(this,"value",this.value)},destroy:function(){hui.dom.remove(this.element);if(this.selector){hui.dom.remove(this.selector)}}};hui.ui.Alert=function(a){this.options=hui.override({modal:false},a);this.element=hui.get(a.element);this.name=a.name;this.body=hui.get.firstByClass(this.element,"hui_alert_body");this.content=hui.get.firstByClass(this.element,"hui_alert_content");this.emotion=this.options.emotion;this.title=hui.get.firstByTag(this.element,"h1");hui.ui.extend(this)};hui.ui.Alert.create=function(b){b=hui.override({text:"",emotion:null,title:null},b);var c=b.element=hui.build("div",{"class":"hui_alert"});var a=hui.build("div",{"class":"hui_alert_body",parent:c});hui.build("div",{"class":"hui_alert_content",parent:a});document.body.appendChild(c);var d=new hui.ui.Alert(b);if(b.emotion){d.setEmotion(b.emotion)}if(b.title){d.setTitle(b.title)}if(b.text){d.setText(b.text)}return d};hui.ui.Alert.prototype={show:function(){var a=hui.ui.nextAlertIndex();if(this.options.modal){hui.ui.showCurtain({widget:this,zIndex:a});a++}this.element.style.zIndex=a;this.element.style.display="block";this.element.style.top=(hui.window.getScrollTop()+100)+"px";hui.animate(this.element,"opacity",1,200);hui.animate(this.element,"margin-top","40px",600,{ease:hui.ease.elastic})},hide:function(){hui.animate(this.element,"opacity",0,200,{hideOnComplete:true});hui.animate(this.element,"margin-top","0px",200);hui.ui.hideCurtain(this)},setTitle:function(a){if(!this.title){this.title=hui.build("h1",{parent:this.content})}hui.dom.setText(this.title,hui.ui.getTranslated(a))},setText:function(a){if(!this.text){this.text=hui.build("p",{parent:this.content})}hui.dom.setText(this.text,hui.ui.getTranslated(a))},setEmotion:function(a){if(this.emotion){hui.cls.remove(this.body,this.emotion)}this.emotion=a;hui.cls.add(this.body,a)},update:function(a){a=a||{};this.setTitle(a.title||null);this.setText(a.text||null);this.setEmotion(a.emotion||null)},addButton:function(a){if(!this.buttons){this.buttons=hui.ui.Buttons.create({align:"right"});this.body.appendChild(this.buttons.element)}this.buttons.add(a)}};hui.ui.Button=function(a){this.options=a;this.name=a.name;this.element=hui.get(a.element);this.enabled=!hui.cls.has(this.element,"hui_button_disabled");hui.ui.extend(this);this._attach();if(a.listener){this.listen(a.listener)}};hui.ui.Button.create=function(b){b=hui.override({text:"",highlighted:false,enabled:true},b);var e="hui_button"+(b.highlighted?" hui_button_highlighted":"");if(b.variant){e+=" hui_button_"+b.variant}if(b.small&&b.variant){e+=" hui_button_small_"+b.variant}if(b.small){e+=" hui_button_small"+(b.highlighted?" hui_button_small_highlighted":"")}if(!b.enabled){e+=" hui_button_disabled"}var f=b.text?hui.ui.getTranslated(b.text):null;if(b.title){f=hui.ui.getTranslated(b.title)}var c=b.element=hui.build("a",{"class":e,href:"javascript://"});var a=hui.build("span",{parent:hui.build("span",{parent:c})});if(b.icon){var d=hui.build("em",{parent:a,"class":"hui_button_icon",style:"background-image:url("+hui.ui.getIconUrl(b.icon,16)+")"});if(!f){hui.cls.add(d,"hui_button_icon_notext")}}if(f){hui.dom.addText(a,f)}return new hui.ui.Button(b)};hui.ui.Button.prototype={_attach:function(){var a=this;hui.listen(this.element,"mousedown",function(b){hui.stop(b)});hui.listen(this.element,"click",function(b){hui.stop(b);a._onClick(b)})},_onClick:function(b){if(this.enabled){var a=false;if(b){a=hui.event(b).altKey}if(this.options.confirm&&!a){hui.ui.confirmOverlay({widget:this,text:this.options.confirm.text,okText:this.options.confirm.okText,cancelText:this.options.confirm.cancelText,onOk:this._fireClick.bind(this)})}else{this._fireClick()}}else{this.element.blur()}},_fireClick:function(){this.fire("click",this);if(this.options.submit){var a=hui.ui.getAncestor(this,"hui_formula");if(a){a.submit()}else{hui.log("No form found to submit")}}},click:function(a){if(a){this.listen({$click:a});return this}else{this._onClick()}},focus:function(){this.element.focus()},onClick:function(a){this.listen({$click:a})},setEnabled:function(a){this.enabled=a;this._updateUI()},enable:function(){this.setEnabled(true)},disable:function(){this.setEnabled(false)},setHighlighted:function(a){hui.cls.set(this.element,"hui_button_highlighted",a)},_updateUI:function(){hui.cls.set(this.element,"hui_button_disabled",!this.enabled)},setText:function(a){hui.dom.setText(this.element.getElementsByTagName("span")[1],hui.ui.getTranslated(a))},getData:function(){return this.options.data}};hui.ui.Buttons=function(a){this.name=a.name;this.element=hui.get(a.element);this.body=hui.get.firstByClass(this.element,"hui_buttons_body");hui.ui.extend(this)};hui.ui.Buttons.create=function(a){a=hui.override({top:0},a);var b=a.element=hui.build("div",{"class":"hui_buttons"});if(a.align==="right"){hui.cls.add(b,"hui_buttons_right")}if(a.align==="center"){hui.cls.add(b,"hui_buttons_center")}if(a.top>0){b.style.paddingTop=a.top+"px"}hui.build("div",{"class":"hui_buttons_body",parent:b});return new hui.ui.Buttons(a)};hui.ui.Buttons.prototype={add:function(a){this.body.appendChild(a.element);return this}};hui.ui.Selection=function(a){this.options=hui.override({value:null},a);this.element=hui.get(a.element);this.name=a.name;this.items=[];this.subItems=[];this.busy=0;this.selection=null;if(a.items&&a.items.length>0){for(var c=0;c<a.items.length;c++){var d=a.items[c];this.items.push(d);var b=hui.get(d.id);d.element=b;this.addItemBehavior(b,d)}this.selection=this._getSelectionWithValue(this.options.value);this._updateUI()}else{if(this.options.value!=null){this.selection={value:this.options.value}}}hui.ui.extend(this)};hui.ui.Selection.create=function(a){a=hui.override({width:0},a);var b=a.element=hui.build("div",{"class":"hui_selection"});if(a.width>0){b.style.width=a.width+"px"}return new hui.ui.Selection(a)};hui.ui.Selection.prototype={getValue:function(){return this.selection},valueForProperty:function(a){if(a==="value"){return this.selection?this.selection.value:null}else{if(a==="kind"){return this.selection?this.selection.kind:null}}return undefined},setValue:function(b){var a=this._getSelectionWithValue(b);if(a===null){this.selection=null}else{this.selection=a;this.kind=a.kind}this._updateUI();this.fireChange()},_getSelectionWithValue:function(d){var c;for(c=0;c<this.items.length;c++){if(this.items[c].value==d){return this.items[c]}}for(c=0;c<this.subItems.length;c++){var a=this.subItems[c].items;for(var b=0;b<a.length;b++){if(a[b].value==d){return a[b]}}}return null},selectFirst:function(){var c;for(c=0;c<this.items.length;c++){this.changeSelection(this.items[c]);return}for(c=0;c<this.subItems.length;c++){var a=this.subItems[c].items;for(var b=0;b<a.length;b++){this.changeSelection(a[b]);return}}},reset:function(){this.setValue(null)},addItems:function(b){b.element=hui.build("div",{parent:this.element});var a=new hui.ui.Selection.Items(b);a.parent=this;this.subItems.push(a)},_updateUI:function(){var a;for(a=0;a<this.items.length;a++){hui.cls.set(this.items[a].element,"hui_selected",this.isSelection(this.items[a]))}for(a=0;a<this.subItems.length;a++){this.subItems[a]._updateUI()}},changeSelection:function(b){for(var a=0;a<this.subItems.length;a++){this.subItems[a].selectionChanged(this.selection,b)}this.selection=b;this._updateUI();this.fireChange()},fireChange:function(){this.fire("select",this.selection);this.fireProperty("value",this.selection?this.selection.value:null);this.fireProperty("kind",this.selection?this.selection.kind:null);for(var a=0;a<this.subItems.length;a++){this.subItems[a].parentValueChanged()}},registerItems:function(a){a.parent=this;this.subItems.push(a)},addItemBehavior:function(b,a){hui.listen(b,"click",function(){this.itemWasClicked(a)}.bind(this));hui.listen(b,"dblclick",function(c){hui.stop(c);hui.selection.clear();this._onDoubleClick(a)}.bind(this));b.dragDropInfo=a},setObjects:function(a){this.items=[];hui.each(a,function(d){this.items.push(d);var c=hui.build("div",{"class":"hui_selection_item"});d.element=c;this.element.appendChild(c);var b=hui.build("span",{"class":"hui_selection_label",text:d.title});if(d.icon){c.appendChild(hui.ui.createIcon(d.icon,16))}c.appendChild(b);hui.listen(c,"click",function(){this.itemWasClicked(d)}.bind(this));hui.listen(c,"dblclick",function(f){hui.stop(f);this._onDoubleClick(d)}.bind(this))}.bind(this));this.fireSizeChange()},isSelection:function(b){if(this.selection===null){return false}var a=b.value==this.selection.value;if(this.selection.kind){a=a&&b.kind==this.selection.kind}return a},itemWasClicked:function(a){if(this.busy>0){return}this.changeSelection(a)},_onDoubleClick:function(a){if(this.busy>0){return}this.fire("open",a)},_setBusy:function(a){this.busy+=a?1:-1;window.clearTimeout(this.busytimer);if(this.busy>0){var b=this.element;this.busytimer=window.setTimeout(function(){hui.cls.add(b,"hui_selection_busy")},300)}else{hui.cls.remove(this.element,"hui_selection_busy");this.fire("loaded")}},_checkValue:function(){if(!this.selection){return}var a=this._getSelectionWithValue(this.selection.value);if(!a){hui.log("Value not found: "+this.selection.value);if(!this.busy){this.selectFirst()}else{hui.log("Will not select first since im still busy")}}},show:function(){this.element.style.display=""},hide:function(){this.element.style.display="none"}};hui.ui.Selection.Items=function(a){this.options=hui.override({source:null},a);this.element=hui.get(a.element);this.title=hui.get(this.element.id+"_title");this.name=a.name;this.disclosed={};this.parent=null;this.items=[];hui.ui.extend(this);if(this.options.source){this.options.source.listen(this)}};hui.ui.Selection.Items.prototype={refresh:function(){if(this.options.source){this.options.source.refresh()}},$objectsLoaded:function(a){this.$itemsLoaded(a)},$itemsLoaded:function(a){this.items=[];this.element.innerHTML="";this.buildLevel(this.element,a,0,true);if(this.title){this.title.style.display=this.items.length>0?"block":"none"}this.parent._updateUI();this.parent._checkValue();this.fireSizeChange()},$sourceIsBusy:function(){this.parent._setBusy(true)},$sourceIsNotBusy:function(){this.parent._setBusy(false)},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$visibilityChanged:function(){if(hui.dom.isVisible(this.element)){if(this.options.source){this.options.source.refreshFirst()}}},buildLevel:function(d,b,e,c){if(!b){return}var a=this.isHierarchy(b);var f=hui.build("div",{"class":"hui_selection_level",style:(c?"display:block":"display:none"),parent:d});hui.each(b,function(m){if(m.type=="title"){hui.build("div",{"class":"hui_selection_title",html:"<span>"+m.title+"</span>",parent:f});return}var k=m.children&&m.children.length>0;var h=e*16+6;if(!a&&e>0||a&&!k){h+=13}var i=hui.build("div",{"class":"hui_selection_item"});i.style.paddingLeft=h+"px";if(m.badge){i.appendChild(hui.build("strong",{"class":"hui_selection_badge",text:m.badge}))}var l=false;if(a&&k){var n=this;l=this.disclosed[m.value];var o=this.disclosed[m.value]?"hui_disclosure hui_disclosure_open":"hui_disclosure";var j=hui.build("span",{"class":o,parent:i});hui.listen(j,"click",function(q){hui.stop(q);n.toggle(j,m)})}var p=hui.build("span",{"class":"hui_selection_label",text:m.title});if(m.icon){i.appendChild(hui.build("span",{"class":"hui_icon_1",style:"background-image: url("+hui.ui.getIconUrl(m.icon,16)+")"}))}i.appendChild(p);hui.listen(i,"click",function(q){this.parent.itemWasClicked(m)}.bind(this));hui.listen(i,"dblclick",function(q){hui.stop(q);hui.selection.clear();this.parent._onDoubleClick(m)}.bind(this));f.appendChild(i);var g={title:m.title,icon:m.icon,badge:m.badge,kind:m.kind,element:i,value:m.value};i.dragDropInfo=g;this.items.push(g);this.buildLevel(f,m.children,e+1,l)}.bind(this))},toggle:function(b,a){if(hui.cls.has(b,"hui_disclosure_open")){this.disclosed[a.value]=false;hui.get.next(b.parentNode).style.display="none";hui.cls.remove(b,"hui_disclosure_open")}else{this.disclosed[a.value]=true;hui.get.next(b.parentNode).style.display="block";hui.cls.add(b,"hui_disclosure_open")}this.parent.fireSizeChange()},isHierarchy:function(a){if(!a){return false}for(var b=0;b<a.length;b++){if(a[b]!==null&&a[b].children&&a[b].children.length>0){return true}}return false},getValue:function(){if(this.parent.selection==null){return null}for(var a=0;a<this.items.length;a++){if(this.items[a].value==this.parent.selection.value){return this.items[a]}}return null},_updateUI:function(){for(var a=0;a<this.items.length;a++){hui.cls.set(this.items[a].element,"hui_selected",this.parent.isSelection(this.items[a]))}},selectionChanged:function(b,a){for(var c=0;c<this.items.length;c++){var d=this.items[c].value;if(d==a.value){this.fireProperty("value",a.value);return}}this.fireProperty("value",null)},parentValueChanged:function(){for(var a=0;a<this.items.length;a++){if(this.parent.isSelection(this.items[a])){this.fireProperty("value",this.items[a].value);return}}this.fireProperty("value",null)}};hui.ui.Toolbar=function(a){this.element=hui.get(a.element);this.name=a.name;hui.ui.extend(this)};hui.ui.Toolbar.create=function(a){a=a||{};a.element=hui.build("div",{"class":a.labels?"hui_toolbar hui_toolbar_nolabels":"hui_toolbar"});return new hui.ui.Toolbar(a)};hui.ui.Toolbar.prototype={add:function(a){this.element.appendChild(a.getElement())},addDivider:function(){this.element.appendChild(hui.build("span",{"class":"hui_divider"}))},setSelection:function(b){var d=hui.ui.getDescendants(this);for(var a=0;a<d.length;a++){var c=d[a];if(c.setSelected){c.setSelected(c.key==b)}}},getByKey:function(b){var d=hui.ui.getDescendants(this);for(var a=0;a<d.length;a++){var c=d[a];if(c.key==b){return c}}}};hui.ui.RevealingToolbar=function(a){this.element=hui.get(a.element);this.name=a.name;hui.ui.extend(this)};hui.ui.RevealingToolbar.create=function(a){a=a||{};a.element=hui.build("div",{className:"hui_revealing_toolbar",style:"display:none",parent:document.body});var b=new hui.ui.RevealingToolbar(a);b.setToolbar(hui.ui.Toolbar.create());return b};hui.ui.RevealingToolbar.prototype={setToolbar:function(a){this.toolbar=a;this.element.appendChild(a.getElement())},getToolbar:function(){return this.toolbar},show:function(a){this.element.style.display="";hui.animate(this.element,"height","58px",a?0:600,{ease:hui.ease.slowFastSlow})},hide:function(){hui.animate(this.element,"height","0px",500,{ease:hui.ease.slowFastSlow,hideOnComplete:true})}};hui.ui.Toolbar.Icon=function(a){this.options=a;this.element=hui.get(a.element);this.name=a.name;this.key=a.key;this.enabled=!hui.cls.has(this.element,"hui_toolbar_icon_disabled");this.element.tabIndex=this.enabled?0:-1;this.icon=hui.get.firstByClass(this.element,"hui_icon");hui.ui.extend(this);if(a.listener){this.listen(a.listener)}this._attach()};hui.ui.Toolbar.Icon.create=function(b){var c=b.element=hui.build("a",{"class":"hui_toolbar_icon"});var e=hui.build("span",{"class":"hui_icon",style:"background-image: url("+hui.ui.getIconUrl(b.icon,32)+")"});var a=hui.build("span",{"class":"hui_toolbar_inner_icon",parent:c});var d=hui.build("span",{"class":"hui_toolbar_inner_icon",parent:a});var f=hui.build("strong",{text:b.title});if(b.overlay){hui.build("span",{"class":"hui_icon_overlay",parent:e,style:"background-image: url("+hui.ui.getIconUrl("overlay/"+b.overlay,32)+")"})}d.appendChild(e);d.appendChild(f);return new hui.ui.Toolbar.Icon(b)};hui.ui.Toolbar.Icon.prototype={_attach:function(){var a=this;this.element.onclick=function(){a._click()}},setEnabled:function(a){this.enabled=a;this.element.tabIndex=a?0:-1;hui.cls.set(this.element,"hui_toolbar_icon_disabled",!this.enabled)},disable:function(){this.setEnabled(false)},enable:function(){this.setEnabled(true)},setOverlay:function(a){var c=hui.get.firstByClass(this.element,"hui_icon_overlay");if(c&&!a){c.style.backgroundImage=""}else{if(c&&a){c.style.backgroundImage="url('"+hui.ui.getIconUrl("overlay/"+a,32)+"')"}else{if(a){var b=hui.get.firstByClass(this.element,"hui_icon");hui.build("span",{"class":"hui_icon_overlay",parent:b,style:"background-image: url("+hui.ui.getIconUrl("overlay/"+a,32)+")"})}}}},setBadge:function(b){var a=hui.get.firstByClass(this.element,"hui_icon_badge");if(!a&&!hui.isBlank(b)){a=hui.build("span",{"class":"hui_icon_badge",parent:hui.get.firstByClass(this.element,"hui_icon"),text:b})}else{if(hui.isBlank(b)&&a){hui.dom.remove(a)}else{if(a){hui.dom.setText(a,b)}}}},setLabel:function(a){var b=hui.get.firstByTag(this.element,"strong");hui.dom.setText(b,a)},setIcon:function(a){var b=hui.get.firstByClass(this.element,"hui_icon");b.style.backgroundImage="url("+hui.ui.getIconUrl(a,32)+")"},setSelected:function(a){if(a){this.element.blur()}hui.cls.set(this.element,"hui_toolbar_icon_selected",a)},_click:function(){if(this.enabled){if(this.options.confirm){hui.ui.confirmOverlay({widget:this,text:this.options.confirm.text,okText:this.options.confirm.okText,cancelText:this.options.confirm.cancelText,onOk:this._fireClick.bind(this)})}else{this._fireClick()}}},_fireClick:function(){this.fire("toolbarIconWasClicked");this.fire("click")}};hui.ui.Toolbar.Badge=function(a){this.element=hui.get(a.element);this.name=a.name;this.label=hui.get.firstByTag(this.element,"strong");this.text=hui.get.firstByTag(this.element,"span");hui.ui.extend(this)};hui.ui.Toolbar.Badge.prototype={setLabel:function(a){hui.dom.setText(this.label,a)},setText:function(a){hui.dom.setText(this.text,a)}};hui.ui.Toolbar.More=function(a){this.element=hui.get(a.element);this.name=a.name;this.button=hui.get.firstByClass(this.element,"hui_toolbar_more");hui.listen(this.button,"click",this.toggle.bind(this));hui.ui.extend(this)};hui.ui.Toolbar.More.prototype={toggle:function(){hui.cls.toggle(this.element,"hui_toolbar_more_expanded")}};hui.ui.ImageInput=function(a){this.name=a.name;this.options=hui.override({width:48,height:48},a);this.element=hui.get(a.element);this.images=[];this.value=null;this.thumbnailsLoaded=false;hui.ui.extend(this);this._attach()};hui.ui.ImageInput.prototype={_attach:function(){hui.listen(this.element,"click",this._showPicker.bind(this));hui.listen(hui.get.firstByTag(this.element,"a"),"click",this._clear.bind(this))},setObject:function(a){this.value=a;this._updateUI()},getObject:function(){return this.value},getValue:function(){return this.value},setValue:function(a){this.setObject(a)},_clear:function(a){hui.stop(a);this.reset();this._fireChange()},reset:function(){this.value=null;this._updateUI()},_updateUI:function(){hui.cls.set(this.element,"hui_imageinput_full",this.value!==null);if(this.value==null){this.element.style.backgroundImage=""}else{var a=hui.ui.resolveImageUrl(this,this.value,this.options.width,this.options.height);this.element.style.backgroundImage="url("+a+")"}},_showFinder:function(){if(!this.finder){this.finder=hui.ui.Finder.create(this.options.finder);this.finder.listen({$select:function(a){this.setObject(a);this._fireChange();this.finder.hide()}.bind(this)})}this.finder.show()},_showPicker:function(){if(this.options.finder){this._showFinder();return}if(!this.picker){var b=this;this.picker=hui.ui.BoundPanel.create({modal:true});this.content=hui.build("div",{"class":"hui_imageinput_thumbs"});var c=hui.ui.Buttons.create({align:"right"});var d=hui.ui.Button.create({text:"Luk",highlighted:true,small:true});d.listen({$click:function(){b._hidePicker()}});var a=hui.ui.Button.create({text:"Fjern",small:true});a.listen({$click:function(){b.setObject(null);b._hidePicker();b._fireChange()}});c.add(a).add(d);this.picker.add(this.content);this.picker.add(c)}this.picker.position(this.element);this.picker.show();if(!this.thumbnailsLoaded){this._updateImages();this.thumbnailsLoaded=true}},_hidePicker:function(){this.picker.hide()},$visibilityChanged:function(){if(this.picker&&!hui.dom.isVisible(this.element)){this.picker.hide()}if(this.finder&&!hui.dom.isVisible(this.element)){this.finder.hide()}},_fireChange:function(){this.fireValueChange()},_updateImages:function(){var a=this;hui.request({$success:function(b){a._parse(b.responseXML)},url:this.options.source})},_parse:function(g){this.content.innerHTML="";var a=g.getElementsByTagName("image");var d=this;for(var f=0;f<a.length;f++){var h=parseInt(a[f].getAttribute("id"));var c={id:h};var e=hui.ui.resolveImageUrl(this,c,48,48);var b=hui.build("div",{"class":"hui_imageinput_thumbnail",style:"background-image:url("+e+")"});b.huiObject={id:h};b.onclick=function(){d.setObject(this.huiObject);d._hidePicker();d._fireChange()};this.content.appendChild(b)}}};hui.ui.BoundPanel=function(a){this.options=a;this.element=hui.get(a.element);this.name=a.name;this.visible=false;this.content=hui.get.firstByClass(this.element,"hui_boundpanel_content");this.arrow=hui.get.firstByClass(this.element,"hui_boundpanel_arrow");this.arrowWide=37;this.arrowNarrow=18;if(a.variant=="light"){this.arrowWide=23;this.arrowNarrow=12}hui.ui.extend(this)};hui.ui.BoundPanel.create=function(a){a=hui.override({name:null,top:0,left:0,width:null,padding:null,modal:false,hideOnClick:false},a);var b='<div class="hui_boundpanel_arrow"></div><div class="hui_boundpanel_top"><div><div></div></div></div><div class="hui_boundpanel_body"><div class="hui_boundpanel_body"><div class="hui_boundpanel_body"><div class="hui_boundpanel_content" style="';if(a.width){b+="width:"+a.width+"px;"}if(a.padding){b+="padding:"+a.padding+"px;"}b+='"></div></div></div></div><div class="hui_boundpanel_bottom"><div><div></div></div></div>';a.element=hui.build("div",{"class":a.variant?"hui_boundpanel hui_boundpanel_"+a.variant:"hui_boundpanel",style:"display:none;zIndex:"+hui.ui.nextPanelIndex()+";top:"+a.top+"px;left:"+a.left+"px",html:b,parent:document.body});return new hui.ui.BoundPanel(a)};hui.ui.BoundPanel.prototype={toggle:function(){if(!this.visible){this.show()}else{this.hide()}},show:function(c){c=c||{};var d=c.target||this.options.target;if(d){if(d.nodeName){this.position(d)}else{this.position(hui.ui.get(d))}}if(this.visible){this.element.style.zIndex=hui.ui.nextPanelIndex();return}if(hui.browser.opacity){hui.style.setOpacity(this.element,0)}var a;if(this.relativePosition=="left"){a=false;this.element.style.marginLeft="20px"}else{if(this.relativePosition=="right"){a=false;this.element.style.marginLeft="-20px"}else{if(this.relativePosition=="top"){a=true;this.element.style.marginTop="20px"}else{if(this.relativePosition=="bottom"){a=true;this.element.style.marginTop="-20px"}}}}this.element.style.visibility="visible";this.element.style.display="block";var b=hui.ui.nextPanelIndex();this.element.style.zIndex=b;hui.ui.callVisible(this);if(hui.browser.opacity){hui.animate(this.element,"opacity",1,300,{ease:hui.ease.fastSlow})}hui.animate(this.element,a?"margin-top":"margin-left","0px",300,{ease:hui.ease.fastSlow});this.visible=true;if(this.options.modal){hui.ui.showCurtain({widget:this,zIndex:b-1,transparent:this.options.modal=="transparent",color:"auto"})}if(this.options.hideOnClick){this.hideListener=hui.listen(document.body,"click",function(f){if(!hui.ui.isWithin(f,this.element)){this.hide()}}.bind(this))}},$curtainWasClicked:function(){hui.ui.hideCurtain(this);this.hide()},hide:function(){if(!this.visible){return}if(!hui.browser.opacity){this.element.style.display="none";hui.ui.callVisible(this)}else{hui.animate(this.element,"opacity",0,100,{ease:hui.ease.slowFast,$complete:function(){this.element.style.display="none";hui.ui.callVisible(this)}.bind(this)})}if(this.options.modal){hui.ui.hideCurtain(this)}this.visible=false;hui.unListen(document.body,"click",this.hideListener)},isVisible:function(){return this.visible},add:function(a){if(a.getElement){this.content.appendChild(a.getElement())}else{this.content.appendChild(a)}},clear:function(){hui.ui.destroyDescendants(this.content);this.content.innerHTML=""},addSpace:function(a){this.add(hui.build("div",{style:"font-size:0px;height:"+a+"px"}))},getDimensions:function(){var b,a;if(this.element.style.display=="none"){this.element.style.visibility="hidden";this.element.style.display="block";b=this.element.clientWidth;a=this.element.clientHeight;this.element.style.display="none";this.element.style.visibility=""}else{b=this.element.clientWidth;a=this.element.clientHeight}return{width:b,height:a}},position:function(f){var m,t,a,r;if(f.getElement){m=f.getElement()}else{if(f.element){m=f.element;t=f.position}else{if(f.rect){t=f.position;m={offsetWidth:f.rect.width,offsetHeight:f.rect.height};a={left:f.rect.left,top:f.rect.top};r={left:0,top:0}}else{m=hui.get(f)}}}if(!a){a={left:hui.position.getLeft(m),top:hui.position.getTop(m)}}if(!r){r=hui.position.getScrollOffset(m)}var o={left:hui.window.getScrollLeft(),top:hui.window.getScrollTop()};var i=a.left-o.left+hui.window.getScrollLeft();var d=m.clientWidth||m.offsetWidth;var j=m.clientHeight||m.offsetHeight;var c=this.getDimensions();var p=hui.window.getViewWidth();var e=hui.window.getViewHeight();var g,l,h,k;var s={top:a.top-o.top-(r.top-o.top)};var b=s.top/e;if(t=="vertical"){b=b>0.5?0.9:0.1}if(b<=0.1){this.relativePosition="top";this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_top";if(this.options.variant=="light"){l=this.arrowNarrow*-1+1}else{l=this.arrowNarrow*-1+2}h=Math.min(p-c.width-2,Math.max(3,i+(d/2)-((c.width)/2)));g=(i+d/2)-h-this.arrowNarrow;k=a.top+j+8-(r.top-o.top)}else{if(b>=0.9){this.relativePosition="bottom";this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_bottom";if(this.options.variant=="light"){l=c.height-2}else{l=c.height-6}h=Math.min(p-c.width-3,Math.max(3,i+(d/2)-((c.width)/2)));g=(i+d/2)-h-this.arrowNarrow;k=a.top-c.height-5-(r.top-o.top)}else{if((i+d/2)/p<0.5){this.relativePosition="left";h=i+d+10;this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_left";k=a.top+(j-c.height)/2;k-=(r.top-o.top);var n=o.top+3;var q=o.top+(e-c.height)-3;k=Math.min(Math.max(k,n),q);l=a.top-k;l-=(r.top-o.top);l-=this.arrowWide/2;l+=j/2;if(this.options.variant=="light"){g=-11;l+=2}else{g=-14}}else{this.relativePosition="right";h=i-c.width-10;this.arrow.className="hui_boundpanel_arrow hui_boundpanel_arrow_right";k=a.top+(j-c.height)/2;k-=(r.top-o.top);var n=o.top+3;var q=o.top+(e-c.height)-3;k=Math.min(Math.max(k,n),q);l=a.top-k;l-=(r.top-o.top);l-=this.arrowWide/2;l+=j/2;if(this.options.variant=="light"){g=c.width-1;l+=2}else{g=c.width-4}}}}this.arrow.style.marginTop=l+"px";this.arrow.style.marginLeft=g+"px";if(this.visible){hui.animate(this.element,"top",k+"px",500,{ease:hui.ease.fastSlow});hui.animate(this.element,"left",h+"px",500,{ease:hui.ease.fastSlow})}else{this.element.style.top=k+"px";this.element.style.left=h+"px"}},destroy:function(){hui.ui.hideCurtain(this);hui.dom.remove(this.element)}};hui.ui.ImageViewer=function(a){this.options=hui.override({maxWidth:800,maxHeight:600,perimeter:100,sizeSnap:100,margin:0,ease:hui.ease.slowFastSlow,easeEnd:hui.ease.bounce,easeAuto:hui.ease.slowFastSlow,easeReturn:hui.ease.cubicInOut,transition:400,transitionEnd:1000,transitionReturn:300,images:[]},a);this.element=hui.get(a.element);this.box=this.options.box;this.dirty=false;this.width=600;this.height=460;this.index=0;this.position=0;this.playing=false;this.name=a.name;this.images=a.images||[];hui.ui.extend(this);this.box.listen(this);this._attach();this._attachDrag();if(a.listener){this.listen(a.listener)}};hui.ui.ImageViewer.create=function(a){a=a||{};var b=a.element=hui.build("div",{"class":"hui_imageviewer",html:'<div class="hui_imageviewer_viewer"><div class="hui_imageviewer_inner_viewer"></div></div><div class="hui_imageviewer_text"></div><div class="hui_imageviewer_status"></div><div class="hui_imageviewer_controller"><div><div><a class="hui_imageviewer_previous"></a><a class="hui_imageviewer_play"></a><a class="hui_imageviewer_next"></a><a class="hui_imageviewer_close"></a></div></div></div>'});var c=a.box=hui.ui.Box.create({variant:"plain",absolute:true,modal:true,closable:true});c.add(b);c.addToDocument();return new hui.ui.ImageViewer(a)};hui.ui.ImageViewer.prototype={nodes:{viewer:"hui_imageviewer_viewer",innerViewer:"hui_imageviewer_inner_viewer",status:"hui_imageviewer_status",text:"hui_imageviewer_text",previous:"hui_imageviewer_previous",controller:"hui_imageviewer_controller",next:"hui_imageviewer_next",play:"hui_imageviewer_play",close:"hui_imageviewer_close"},_attach:function(){var a=this;this.nodes.next.onclick=function(){a.next(true)};this.nodes.previous.onclick=function(){a.previous(true)};this.nodes.play.onclick=function(){a.playOrPause()};this.nodes.close.onclick=this.hide.bind(this);this._timer=function(){a.next(false)};this._keyListener=function(b){b=hui.event(b);if(b.escapeKey){a.hide()}else{if(!a.zoomed){if(b.rightKey){a.next(true)}else{if(b.leftKey){a.previous(true)}else{if(b.returnKey){a.playOrPause()}}}}}},hui.listen(this.nodes.viewer,"mousemove",this._onMouseMove.bind(this));hui.listen(this.nodes.controller,"mouseover",function(){a.overController=true});hui.listen(this.nodes.controller,"mouseout",function(){a.overController=false});hui.listen(this.nodes.viewer,"mouseout",function(b){if(!hui.ui.isWithin(b,this.nodes.viewer)){a._hideController()}}.bind(this))},_draw:function(a){if(hui.browser.webkit){this.nodes.innerViewer.style.webkitTransform="translate3d("+this.position+"px,0,0)"}else{this.nodes.innerViewer.style.marginLeft=this.position+"px"}},_attachDrag:function(){var c=0;var e=0;var d=0;var f=this.nodes.viewer;var b=this.nodes.innerViewer;var a=0;hui.drag.register({touch:true,element:this.nodes.innerViewer,onBeforeMove:function(g){c=g.getLeft();d=this.position;a=(this.images.length-1)*this.width*-1}.bind(this),onMove:function(g){e=g.getLeft();var h=(d-(c-e));if(h>0){h=(Math.exp(h*-0.013)-1)*-80}if(h<a){h=(Math.exp((h-a)*0.013)-1)*80+a}this.position=h;this._draw()}.bind(this),onAfterMove:function(){var h=(c-e)<0?Math.floor:Math.ceil;this.index=h(this.position*-1/this.width);var g=this.images.length-1;if(this.index==this.images.length){this.index=0}else{if(this.index<0){this.index=this.images.length-1}else{g=1}}this._goToImage(true,g,false,true)}.bind(this),onNotMoved:this._zoom.bind(this)})},_onMouseMove:function(){window.clearTimeout(this.ctrlHider);if(this._shouldShowController()){this.ctrlHider=window.setTimeout(this._hideController.bind(this),2000);if(!hui.browser.opacity){this.nodes.controller.style.display="block"}else{hui.effect.fadeIn({element:this.nodes.controller,duration:200})}}},_hideController:function(){if(!this.overController){if(!hui.browser.opacity){this.nodes.controller.style.display="none"}else{hui.effect.fadeOut({element:this.nodes.controller,duration:500})}}},_getLargestSize:function(a,b){return hui.fit(b,a,{upscale:false})},_calculateSize:function(){var a=this.options.sizeSnap;var f=hui.window.getViewWidth()-this.options.perimeter;f=Math.floor(f/a)*a;f=Math.min(f,this.options.maxWidth);var b=hui.window.getViewHeight()-this.options.perimeter;b=Math.floor(b/a)*a;b=Math.min(b,this.options.maxHeight);var e=0;var d=0;for(var c=0;c<this.images.length;c++){var g=this._getLargestSize({width:f,height:b},this.images[c]);e=Math.max(e,g.width);d=Math.max(d,g.height)}b=Math.floor(Math.min(b,d));f=Math.floor(Math.min(f,e));if(f!=this.width||b!=this.height){this.width=f;this.height=b;this.dirty=true}},_updateUI:function(){if(this.dirty){this.nodes.innerViewer.innerHTML="";for(var b=0;b<this.images.length;b++){var a=hui.build("div",{"class":"hui_imageviewer_image"});hui.style.set(a,{width:(this.width+this.options.margin)+"px",height:(this.height-1)+"px"});this.nodes.innerViewer.appendChild(a)}this.nodes.controller.style.display=this._shouldShowController()?"block":"none";this.dirty=false;this._preload()}},_shouldShowController:function(){return this.images.length>1},_goToImage:function(a,g,e,f){var i=this.position;var h=this.position=this.index*(this.width+this.options.margin)*-1;if(a){var d,c;if(f){d=200*g;c=hui.ease.fastSlow;c=hui.ease.quadOut}else{if(g>1){d=Math.min(g*this.options.transitionReturn,2000);c=this.options.easeReturn}else{var b=this.index==0||this.index==this.images.length-1;c=(b?this.options.easeEnd:this.options.ease);if(!e){c=this.options.easeAuto}d=(b?this.options.transitionEnd:this.options.transition)}}hui.animate({node:this.nodes.innerViewer,css:{marginLeft:h+"px"},duration:d,ease:c,$render:function(k,j){this.position=i+(h-i)*j;this._draw()}.bind(this)})}else{this._draw()}this._drawText()},_drawText:function(){var a=this.images[this.index].text;if(a){this.nodes.text.innerHTML=a;this.nodes.text.style.display="block"}else{this.nodes.text.innerHTML="";this.nodes.text.style.display="none"}},showById:function(b){for(var a=0;a<this.images.length;a++){if(this.images[a].id==b){this.show(a);break}}},show:function(a){this.index=a||0;this._calculateSize();this._updateUI();var b=this.options.margin;hui.style.set(this.element,{width:(this.width+b)+"px",height:(this.height+b*2-1)+"px"});hui.style.set(this.nodes.viewer,{width:(this.width+b)+"px",height:(this.height-1)+"px"});hui.style.set(this.nodes.innerViewer,{width:((this.width+b)*this.images.length)+"px",height:(this.height-1)+"px"});hui.style.set(this.nodes.controller,{marginLeft:((this.width-160)/2+b*0.5)+"px",display:"none"});this.box.show();this._goToImage(false,0,false);hui.listen(document,"keydown",this._keyListener);this.visible=true;this._setHash(true)},_setHash:function(a){return;if(!this._listening){this._listening=true;if(!hui.browser.msie6&&!hui.browser.msie7){hui.listen(window,"hashchange",this._onHashChange.bind(this))}}if(a){document.location="#imageviewer"}else{hui.location.clearHash()}},_onHashChange:function(){if(this._changing){return}this._changing=true;if(hui.location.hasHash("imageviewer")&&!this.visible){this.show()}else{if(!hui.location.hasHash("imageviewer")&&this.visible){this.hide()}}this._changing=false},hide:function(){this._hide()},_hide:function(){this.pause();this.box.hide();this._endZoom();hui.unListen(document,"keydown",this._keyListener);this.visible=false;this._setHash(false)},$boxCurtainWasClicked:function(){this.hide()},$boxWasClosed:function(){this.hide()},clearImages:function(){this.images=[];this.dirty=true},addImages:function(a){for(var b=0;b<a.length;b++){this.addImage(a[b])}},addImage:function(a){this.images.push(a);this.dirty=true},play:function(){if(!this.interval){this.interval=window.setInterval(this._timer,6000)}this.next(false);this.playing=true;this.nodes.play.className="hui_imageviewer_pause"},pause:function(){window.clearInterval(this.interval);this.interval=null;this.nodes.play.className="hui_imageviewer_play";this.playing=false},playOrPause:function(){if(this.playing){this.pause()}else{this.play()}},_resetPlay:function(){if(this.playing){window.clearInterval(this.interval);this.interval=window.setInterval(this._timer,6000)}},previous:function(a){var b=1;this.index--;if(this.index<0){this.index=this.images.length-1;b=this.images.length-1}this._goToImage(true,b,a);this._resetPlay()},next:function(a){var b=1;this.index++;if(this.index==this.images.length){this.index=0;b=this.images.length-1}this._goToImage(true,b,a);this._resetPlay()},_preload:function(){var b=new hui.Preloader();b.addImages(hui.ui.context+"/hui/gfx/imageviewer_controls.png");var a=this;b.setDelegate({allImagesDidLoad:function(){a._preloadImages()}});b.load()},_preloadImages:function(){var a=new hui.Preloader();a.setDelegate(this);for(var c=0;c<this.images.length;c++){var b=hui.ui.resolveImageUrl(this,this.images[c],this.width,this.height);if(b!==null){a.addImages(b)}}this.nodes.status.innerHTML="0%";this.nodes.status.style.display="";a.load(this.index)},allImagesDidLoad:function(){this.nodes.status.style.display="none"},imageDidLoad:function(c,d,b){this.nodes.status.innerHTML=Math.round(c/d*100)+"%";var a=hui.ui.resolveImageUrl(this,this.images[b],this.width,this.height);a=a.replace(/&amp;/g,"&");this.nodes.innerViewer.childNodes[b].style.backgroundImage="url('"+a+"')";hui.cls.set(this.nodes.innerViewer.childNodes[b],"hui_imageviewer_image_abort",false);hui.cls.set(this.nodes.innerViewer.childNodes[b],"hui_imageviewer_image_error",false)},imageDidGiveError:function(b,c,a){hui.cls.set(this.nodes.innerViewer.childNodes[a],"hui_imageviewer_image_error",true)},imageDidAbort:function(b,c,a){hui.cls.set(this.nodes.innerViewer.childNodes[a],"hui_imageviewer_image_abort",true)},zoomed:false,_zoom:function(f){var a=this.images[this.index];if(a.width<=this.width&&a.height<=this.height){return}if(!this.zoomer){this.zoomer=hui.build("div",{"class":"hui_imageviewer_zoomer",style:"width:"+this.nodes.viewer.clientWidth+"px;height:"+this.nodes.viewer.clientHeight+"px"});this.element.insertBefore(this.zoomer,hui.dom.firstChild(this.element));hui.listen(this.zoomer,"mousemove",this._onZoomMove.bind(this));hui.listen(this.zoomer,"click",this._endZoom.bind(this))}this._hideController();this.pause();var c=this._getLargestSize({width:2000,height:2000},a);var b=hui.ui.resolveImageUrl(this,a,c.width,c.height);var d=Math.max(0,Math.round((this.nodes.viewer.clientHeight-c.height)/2));this.zoomer.innerHTML='<div style="width:'+c.width+"px;height:"+c.height+'px; margin: 0 auto;"><img src="'+b+'" style="margin-top: '+d+'px" /></div>';this.zoomer.style.display="block";this.zoomInfo={width:c.width,height:c.height};this._onZoomMove(f);this.zoomed=true},_onZoomMove:function(b){if(!this.zoomInfo){return}var c=hui.position.get(this.zoomer);b=new hui.Event(b);var a=(b.getLeft()-c.left)/this.zoomer.clientWidth*(this.zoomInfo.width-this.zoomer.clientWidth);var d=(b.getTop()-c.top)/this.zoomer.clientHeight*(this.zoomInfo.height-this.zoomer.clientHeight);this.zoomer.scrollLeft=a;this.zoomer.scrollTop=d},_endZoom:function(){if(this.zoomer){this.zoomer.style.display="none";this.zoomed=false}}};if(window.define){define("hui.ui.ImageViewer",hui.ui.ImageViewer)}hui.ui.Picker=function(a){a=this.options=hui.override({itemWidth:100,itemHeight:150,itemsVisible:null,shadow:true,valueProperty:"value"},a);this.element=hui.get(a.element);this.name=a.name;this.container=hui.get.firstByClass(this.element,"hui_picker_container");this.content=hui.get.firstByClass(this.element,"hui_picker_content");this.title=hui.get.firstByClass(this.element,"hui_picker_title");this.pages=[];this.objects=[];this.selected=null;this.value=null;this._addBehavior();hui.ui.extend(this)};hui.ui.Picker.create=function(a){a=hui.override({shadow:true},a);a.element=hui.build("div",{"class":"hui_picker",html:hui.when(a.title,'<div class="hui_picker_title">'+a.title+"</div>")+'<div class="hui_picker_container"><div class="hui_picker_content"></div></div><div class="hui_picker_pages"></div>'});if(a.shadow==true){hui.cls.add(a.element,"hui_picker_shadow")}return new hui.ui.Picker(a)};hui.ui.Picker.prototype={_addBehavior:function(){hui.drag.register({element:this.element,onBeforeMove:this._onBeforeMove.bind(this),onMove:this._onMove.bind(this),onAfterMove:this._onAfterMove.bind(this)});hui.listen(this.element,"click",this._onClick.bind(this))},_onClick:function(b){if(this.dragging){return}b=hui.event(b);var a=b.findByClass("hui_picker_page");if(a){this.goToPage(parseInt(a.getAttribute("data-index")))}},goToPage:function(a){var b=Math.round(this.container.clientWidth*a);b=Math.min(b,this.content.clientWidth-this.container.clientWidth);this._scrollTo(b,hui.ease.fastSlow)},setObjects:function(a){this.selected=null;this.objects=a||[];this._updateUI()},setValue:function(a){this.value=a;this._updateSelection()},getValue:function(){return this.value},reset:function(){this.value=null;this._updateSelection()},_updateUI:function(){var a=this,b;this.content.innerHTML="";this.container.scrollLeft=0;if(this.options.itemsVisible){b=this.options.itemsVisible*(this.options.itemWidth+14)}else{b=this.container.clientWidth}hui.style.set(this.container,{width:b+"px",height:(this.options.itemHeight+14)+"px"});hui.style.set(this.content,{width:(this.objects.length*(this.options.itemWidth+14))+"px",height:(this.options.itemHeight+14)+"px"});hui.each(this.objects,function(c,d){var e=hui.build("div",{"class":"hui_picker_item",title:c.title,html:'<div style="width:'+a.options.itemWidth+"px;height:"+a.options.itemHeight+"px; overflow: hidden; background-image:url('"+c.image+"')\"><strong>"+hui.string.escape(c.title)+"</strong></div>",parent:a.content});if(a.value!=null&&c[a.options.valueProperty]==a.value){hui.cls.add(e,"hui_picker_item_selected")}hui.listen(e,"mouseup",function(){a._onItemClick(c[a.options.valueProperty])})});this._updatePages()},_updatePages:function(){var b=this.container.clientWidth;if(!b){return}var c=Math.ceil(this.content.clientWidth/b);var a=hui.get.firstByClass(this.element,"hui_picker_pages");hui.dom.clear(a);if(c<2){return}for(var d=1;d<=c;d++){hui.build("a",{parent:a,text:d,className:"hui_picker_page"+hui.when(d==1," hui_picker_page_selected"),"data-index":d-1})}},_updateSelection:function(){var b=this.content.childNodes;for(var a=0;a<b.length;a++){hui.cls.set(b[a],"hui_picker_item_selected",this.value!=null&&this.objects[a][this.options.valueProperty]==this.value)}},_onItemClick:function(a){if(this.dragging){return}if(this.value==a){return}this.value=a;this._updateSelection();this.fire("select",a)},_onBeforeMove:function(a){this.dragX=a.getLeft();this.dragScroll=this.container.scrollLeft;this.dragging=true},_onMove:function(a){this.container.scrollLeft=this.dragX-a.getLeft()+this.dragScroll},_onAfterMove:function(b){var a=this.options.itemWidth+14;var c=Math.round(this.container.scrollLeft/a)*a;this._scrollTo(c);this.dragging=false},_scrollTo:function(b,a){a=a||hui.ease.bounceOut;hui.animate(this.container,"scrollLeft",b,500,{ease:a,onComplete:this._updatePager.bind(this)})},_updatePager:function(){var c=Math.ceil(this.container.scrollLeft/this.container.clientWidth);hui.log(c);var a=hui.get.byClass(this.element,"hui_picker_page");for(var b=0;b<a.length;b++){hui.cls.set(a[b],"hui_picker_page_selected",c==b)}},$visibilityChanged:function(){if(!hui.dom.isVisible(this.element)){return}this.container.style.display="none";var a;if(this.options.itemsVisible){a=this.options.itemsVisible*(this.options.itemWidth+14)}else{a=this.container.parentNode.clientWidth}a=Math.max(a,0);hui.style.set(this.container,{width:a+"px",display:"block"});this._updatePages()}};hui.ui.Menu=function(a){this.options=hui.override({autoHide:false,parentElement:null},a);this.element=hui.get(a.element);this.name=a.name;this.value=null;this.subMenus=[];this.visible=false;hui.ui.extend(this);this._addBehavior()};hui.ui.Menu.create=function(a){a=a||{};a.element=hui.build("div",{"class":"hui_menu"});var b=new hui.ui.Menu(a);document.body.appendChild(a.element);return b};hui.ui.Menu.prototype={_addBehavior:function(){this.hider=function(){this.hide();this.fire("cancel")}.bind(this);if(this.options.autoHide){var a=function(b){if(!hui.ui.isWithin(b,this.element)&&(!this.options.parentElement||!hui.ui.isWithin(b,this.options.parentElement))){if(!this._isSubMenuVisible()){this.hide()}}}.bind(this);hui.listen(this.element,"mouseout",a);if(this.options.parentElement){hui.listen(this.options.parentElement,"mouseout",a)}}},addDivider:function(){hui.build("div",{"class":"hui_menu_divider",parent:this.element})},addItem:function(d){var a=this;var b=hui.build("div",{"class":"hui_menu_item",text:d.title||d.text});hui.listen(b,"click",function(f){hui.stop(f);a._onItemClick(d.value)});if(d.children&&d.children.length>0){var c=hui.ui.Menu.create({autoHide:true,parentElement:b});c.addItems(d.children);hui.listen(b,"mouseover",function(f){c.showAtElement(b,f,"horizontal")});a.subMenus.push(c);hui.cls.add(b,"hui_menu_item_children");c.listen({$select:function(e){a.hide();a.fire("select",e)}})}this.element.appendChild(b)},addItems:function(a){for(var b=0;b<a.length;b++){if(a[b]==null){this.addDivider()}else{this.addItem(a[b])}}},getValue:function(){return this.value},_onItemClick:function(a){this.value=a;this.fire("itemWasClicked",a);this.fire("select",a);this.hide()},showAtPointer:function(a){a=hui.event(a);a.stop();this.showAtPoint({top:a.getTop(),left:a.getLeft()})},showAtElement:function(c,d,b){d=hui.event(d);d.stop();c=hui.get(c);var a=hui.position.get(c);if(b=="horizontal"){a.left+=c.clientWidth}else{if(b=="vertical"){a.top+=c.clientHeight}}this.showAtPoint(a)},showAtPoint:function(h){var f=hui.window.getViewWidth();var a=hui.window.getViewHeight();var c=hui.window.getScrollTop();var e=hui.window.getScrollLeft();if(!this.visible){hui.style.set(this.element,{display:"block",visibility:"hidden",opacity:0})}var b=this.element.clientWidth;var i=this.element.clientHeight;var d=Math.min(h.left,f-b-26+e);var g=Math.max(0,Math.min(h.top,a-i-20+c));hui.style.set(this.element,{top:g+"px",left:d+"px",visibility:"visible",zIndex:hui.ui.nextTopIndex()});if(!this.element.style.width){this.element.style.width=(b+6)+"px"}if(!this.visible){hui.style.set(this.element,{opacity:1});this._addHider();this.visible=true}},hide:function(a){if(!this.visible){return}if(true||a&&a.immediate){this.element.style.display="none"}else{hui.animate(this.element,"opacity",0,200,{onComplete:function(){this.element.style.display="none"}.bind(this)})}this._removeHider();for(var b=0;b<this.subMenus.length;b++){this.subMenus[b].hide()}this.visible=false;this.fire("hide")},isVisible:function(){return this.visible},_isSubMenuVisible:function(){for(var a=0;a<this.subMenus.length;a++){if(this.subMenus[a].visible){return true}}return false},_addHider:function(){hui.listen(document.body,"click",this.hider)},_removeHider:function(){hui.unListen(document.body,"click",this.hider)}};hui.ui.Overlay=function(a){this.options=a;this.element=hui.get(a.element);this.content=hui.get.byClass(this.element,"hui_inner_overlay")[1];this.name=a.name;this.icons={};this.visible=false;hui.ui.extend(this);this._addBehavior()};hui.ui.Overlay.create=function(a){a=a||{};var b=a.element=hui.build("div",{className:"hui_overlay"+(a.variant?" hui_overlay_"+a.variant:""),style:"display:none",html:'<div class="hui_inner_overlay"><div class="hui_inner_overlay"></div></div>'});document.body.appendChild(b);return new hui.ui.Overlay(a)};hui.ui.Overlay.prototype={_addBehavior:function(){var a=this},addIcon:function(c,d){var a=this;var b=hui.build("div",{className:"hui_overlay_icon"});b.style.backgroundImage="url("+hui.ui.getIconUrl(d,32)+")";hui.listen(b,"click",function(f){a._iconWasClicked(c,f)});this.icons[c]=b;this.content.appendChild(b)},addText:function(a){this.content.appendChild(hui.build("span",{"class":"hui_overlay_text",text:a}))},add:function(a){this.content.appendChild(a.getElement())},hideIcons:function(b){for(var a=0;a<b.length;a++){this.icons[b[a]].style.display="none"}},showIcons:function(b){for(var a=0;a<b.length;a++){this.icons[b[a]].style.display=""}},_iconWasClicked:function(a,b){hui.ui.callDelegates(this,"iconWasClicked",a,b)},showAtElement:function(b,a){a=a||{};hui.ui.positionAtElement(this.element,b,a);if(a.autoHide){this._autoHide(b)}if(this.visible){return}if(hui.browser.msie){this.element.style.display="block"}else{hui.style.set(this.element,{display:"block",opacity:0});hui.animate(this.element,"opacity",1,150)}var c=a.zIndex===undefined?a.zIndex:hui.ui.nextAlertIndex();if(this.options.modal){this.element.style.zIndex=hui.ui.nextAlertIndex();hui.ui.showCurtain({widget:this,zIndex:c})}else{this.element.style.zIndex=c}this.visible=true},_autoHide:function(a){hui.cls.add(a,"hui_overlay_bound");hui.unListen(document.body,"mousemove",this._hider);this._hider=function(b){if(!hui.ui.isWithin(b,a)&&!hui.ui.isWithin(b,this.element)){try{hui.unListen(document.body,"mousemove",this._hider);hui.cls.remove(a,"hui_overlay_bound");this.hide()}catch(b){hui.log("unable to stop listening: document="+document)}}}.bind(this);hui.listen(document.body,"mousemove",this._hider)},show:function(a){a=a||{};if(!this.visible){hui.style.set(this.element,{display:"block",visibility:"hidden"})}if(a.element){hui.position.place({source:{element:this.element,vertical:0,horizontal:0.5},target:{element:a.element,vertical:0.5,horizontal:0.5},insideViewPort:true,viewPartMargin:9})}if(a.autoHide&&a.element){this._autoHide(a.element)}if(this.visible){return}hui.effect.bounceIn({element:this.element});this.visible=true;if(this.options.modal){var b=hui.ui.nextAlertIndex();this.element.style.zIndex=b+1;hui.ui.showCurtain({widget:this,zIndex:b,color:"auto"})}},$curtainWasClicked:function(){this.hide()},hide:function(){hui.ui.hideCurtain(this);this.element.style.display="none";this.visible=false},clear:function(){hui.ui.destroyDescendants(this.content);this.content.innerHTML=""}};hui.ui.Upload=function(a){this.options=hui.override({url:"",parameters:{},multiple:false,maxSize:"20480",types:"*.*",fieldName:"file",chooseButton:"Choose files..."},a);this.element=hui.get(a.element);this.itemContainer=hui.get.firstByClass(this.element,"hui_upload_items");this.status=hui.get.firstByClass(this.element,"hui_upload_status");this.placeholder=hui.get.firstByClass(this.element,"hui_upload_placeholder");this.name=a.name;this.items=[];this.busy=false;this._chooseImplementation();hui.ui.extend(this);this._addBehavior()};hui.ui.Upload.implementations=["HTML5","Frame","Flash"];hui.ui.Upload.nameIndex=0;hui.ui.Upload.create=function(a){a=a||{};a.element=hui.build("div",{"class":"hui_upload",html:'<div class="hui_upload_items"></div><div class="hui_upload_status"></div>'+(a.placeholder?'<div class="hui_upload_placeholder"><span class="hui_upload_icon"></span>'+(a.placeholder.title?"<h2>"+hui.string.escape(hui.ui.getTranslated(a.placeholder.title))+"</h2>":"")+(a.placeholder.text?"<p>"+hui.string.escape(hui.ui.getTranslated(a.placeholder.text))+"</p>":"")+"</div>":"")});return new hui.ui.Upload(a)};hui.ui.Upload.prototype={setParameter:function(a,b){this.options.parameters[a]=b;if(this.impl.setParameter){this.impl.setParameter(a,b)}},clear:function(){for(var a=0;a<this.items.length;a++){if(this.items[a]){this.items[a].destroy()}}this.items=[];this.itemContainer.style.display="none";this.status.style.display="none";if(this.placeholder){this.placeholder.style.display="block"}},addDropTarget:function(a){if(a.element){hui.drag.listen({element:a.element,hoverClass:a.hoverClass,$dropFiles:function(b){if(a.$drop){a.$drop()}this._transferFiles(b)}.bind(this)})}},uploadFiles:function(a){this._transferFiles(a)},_chooseImplementation:function(){var d=hui.ui.Upload.implementations;if(this.options.implementation){d.splice(0,0,this.options.implementation)}for(var b=0;b<d.length;b++){var a=hui.ui.Upload[d[b]];var c=a.support();if(c.supported){if(!this.options.multiple){this.impl=new a(this);hui.log("Selected impl (single): "+d[b]);break}else{if(this.options.multiple&&c.multiple){this.impl=new a(this);hui.log("Selected impl (multiple): "+d[b]);break}}}}if(!this.impl){hui.log("No implementation found, using frame");this.impl=new hui.ui.Upload.Frame(this)}},_addBehavior:function(){if(!this.impl.initialize){alert(this.impl);return}hui.ui.onReady(function(){this.impl.initialize();hui.drag.listen({element:this.element,hoverClass:"hui_upload_drop",$dropFiles:this._transferFiles.bind(this)})}.bind(this))},_transferFiles:function(c){if(c.length>0){if(!this.options.multiple){this._transferFile(c[0])}else{for(var b=0;b<c.length;b++){var a=c[b];this._transferFile(a)}}}},_transferFile:function(a){hui.log(a);var b=this.$_addItem({name:a.name,size:a.size});hui.request({method:"post",file:a,url:this.options.url,parameters:this.options.parameters,$progress:function(d,c){b.updateProgress(d,c)},$load:function(){hui.log("transferFile: load")},$abort:function(){this.$_itemFail(b);b.setError("Afbrudt")}.bind(this),$success:function(c){hui.log("transferFile: success");b.data.request=c;this.$_itemSuccess(b)}.bind(this),$failure:function(){hui.log("transferFile: fail");this.$_itemFail(b)}.bind(this)})},$_addItem:function(a){if(!this.busy){this.fire("uploadDidStartQueue");this.status.style.display="block";this._setWidgetEnabled(false);this.busy=true}return this._addItem(a)},$_itemSuccess:function(d){var e=hui.get.firstByClass(this.itemContainer,"hui_upload_item_success");d.setProgress(1);d.setSuccess();this.fire("uploadDidComplete",d.getInfo());this._checkQueue();var b=e!=null||this.items.length>1;b=b&&d.element.nextSibling!=null;if(b&&(e==null||e!=d.element.nextSibling)){var c=d.element.parentNode;var a=d.element.clientHeight;hui.animate({node:d.element,css:{height:"0px"},ease:hui.ease.slowFastSlow,duration:500,onComplete:function(){c.removeChild(d.element);if(e){c.insertBefore(d.element,e)}else{c.appendChild(d.element)}hui.animate({node:d.element,css:{height:a+"px"},ease:hui.ease.slowFastSlow,duration:200})}})}},$_itemFail:function(a){a.setError("Upload af filen fejlede!");this.fire("uploadDidFail",a.getInfo());this._checkQueue()},$_getButtonContainer:function(){var b=hui.build("span",{"class":"hui_upload_button"});if(this.options.widget){var a=hui.ui.get(this.options.widget);a.element.parentNode.insertBefore(b,a.element);a.element.parentNode.removeChild(a.element);b.appendChild(a.element)}else{b.innerHTML='<a href="javascript:void(0);" class="hui_button"><span><span>'+hui.string.escape(hui.ui.getTranslated(this.options.chooseButton))+"</span></span></a>";this.element.appendChild(b)}return b},_setWidgetEnabled:function(b){if(this.options.widget){var a=hui.ui.get(this.options.widget);if(a&&a.setEnabled){a.setEnabled(b)}}},_checkQueue:function(){for(var a=0;a<this.items.length;a++){if(!this.items[a].isFinished()){return}}this.busy=false;this._setWidgetEnabled(true);this.fire("uploadDidCompleteQueue")},_addItem:function(c){var a=c.index;if(a===undefined){a=this.items.length;c.index=a}var b=a>4;var d=new hui.ui.Upload.Item(c,b);this.items[a]=d;var e=hui.get.firstByClass(this.itemContainer,"hui_upload_item_success");if(e){this.itemContainer.insertBefore(d.element,e)}else{this.itemContainer.appendChild(d.element)}this.itemContainer.style.display="block";if(this.placeholder){this.placeholder.style.display="none"}return d}};hui.ui.Upload.Item=function(b,a){this.data=b;this.rearrange=a;this.element=hui.build("div",{className:"hui_upload_item"});this.element.appendChild(hui.ui.createIcon("file/generic",32));this.content=hui.build("div",{className:"hui_upload_item_content",parent:this.element});this.progress=hui.ui.ProgressBar.create({small:true});this.content.appendChild(this.progress.getElement());var c=hui.build("p",{parent:this.content});this.info=hui.build("strong",{parent:c});this.status=hui.build("em",{parent:c});if(b.name){hui.dom.setText(this.info,b.name)}this.finished=false;this.error=false};hui.ui.Upload.Item.prototype={getInfo:function(){return this.data},isFinished:function(){return this.finished},setError:function(a){this._setStatus(a||hui.ui.getTranslated({en:"Error",da:"Fejl"}));hui.cls.add(this.element,"hui_upload_item_error");this.progress.hide();this.progress.setValue(0);this.finished=true},setSuccess:function(a){this._setStatus(hui.ui.getTranslated({en:"Complete",da:"Færdig"}));this.progress.setValue(1);this.finished=true;hui.cls.add(this.element,"hui_upload_item_success")},updateProgress:function(a,b){this.setProgress(a/b);return this},setProgress:function(a){this._setStatus(hui.ui.getTranslated({en:"Transfering",da:"Overfører"}));this.progress.setValue(Math.min(0.9999,a));return this},setWaiting:function(){this._setStatus("Venter");this.progress.setWaiting();return this},hide:function(){this.element.hide()},destroy:function(){hui.dom.remove(this.element)},_setStatus:function(a){if(this._status!==a){hui.dom.setText(this.status,a);this._status=a}}};hui.ui.Upload._nameIndex=0;hui.ui.Upload._buildForm=function(f){var b=f.options;hui.ui.Upload._nameIndex++;var a="hui_upload_"+hui.ui.Upload._nameIndex;hui.log("Frame: name="+a);var d=hui.build("form");d.setAttribute("action",b.url||"");d.setAttribute("method","post");d.setAttribute("enctype","multipart/form-data");d.setAttribute("encoding","multipart/form-data");d.setAttribute("target",a);if(b.parameters){for(var c in b.parameters){var e=hui.build("input",{type:"hidden",name:c});e.value=b.parameters[c];d.appendChild(e)}}return d};hui.ui.Upload.Frame=function(a){this.parent=a};hui.ui.Upload.Frame.support=function(){return{supported:true,multiple:false}};hui.ui.Upload.Frame.prototype={initialize:function(){var d=this.parent.options;var g=this.form=hui.ui.Upload._buildForm(this.parent);var a=g.getAttribute("target");var f=this.iframe=hui.build("iframe",{name:a,id:a,src:hui.ui.context+"/hui/html/blank.html",style:"display:none"});this.parent.element.appendChild(f);var b=this;hui.listen(f,"load",function(){b._uploadComplete()});this.fileInput=hui.build("input",{type:"file",name:d.fieldName});hui.listen(this.fileInput,"change",this._onSubmit.bind(this));g.appendChild(this.fileInput);var e=hui.build("span",{"class":"hui_upload_button_input"});e.appendChild(g);var h=this.parent.$_getButtonContainer();h.insertBefore(e,h.firstChild)},setParameter:function(a,d){var c=this.form.getElementsByTagName("input");for(var b=0;b<c.length;b++){if(c[b].name==a){c[b].value=d;return}}hui.build("input",{type:"hidden",name:a,value:d,parent:this.form})},_rebuildParameters:function(){if(hui.browser.msie){hui.each(this.parent.options.parameters,function(a,b){this.form[a].value=b}.bind(this))}},_rebuildFileInput:function(){var b=this.parent.options;var a=this.fileInput;this.fileInput=hui.build("input",{type:"file",name:b.fieldName});hui.listen(this.fileInput,"change",this._onSubmit.bind(this));hui.dom.replaceNode(a,this.fileInput);hui.log("Frame: input replaced")},_getFileName:function(){return this.fileInput.value.split("\\").pop()},_onSubmit:function(){this.form.style.display="none";this.uploading=true;this._rebuildParameters();this.form.submit();this.item=this.parent.$_addItem({name:this._getFileName()});this.item.setWaiting();this._rebuildFileInput();hui.log("Frame: Upload started:"+this.uploading)},_uploadComplete:function(){hui.log("complete:"+this.uploading+" / "+this.parent.name);if(!this.uploading){return}this.uploading=false;var b=this._isSuccessResponse();hui.log("Frame: Upload complete: success="+b);var a=this.item;if(a){if(b){this.parent.$_itemSuccess(a);hui.log("Frame: Upload succeeded")}else{this.parent.$_itemFail(a);hui.log("Frame: Upload failed!")}}this.iframe.src=hui.ui.context+"/hui/html/blank.html";this.form.style.display="block";this.form.reset()},_isSuccessResponse:function(){var a=hui.frame.getDocument(this.iframe);return a.body.innerHTML.indexOf("SUCCESS")!==-1}};hui.ui.Upload.Flash=function(a){this.parent=a;this.items=[]};hui.ui.Upload.Flash.support=function(){return{supported:hui.ui.Flash.getMajorVersion()>=10&&window.SWFUpload!==undefined,multiple:true}};hui.ui.Upload.Flash.prototype={initialize:function(){var e=this.parent.options;hui.log("Creating flash verison");var d=this._getAbsoluteUrl(e.url);var b=hui.cookie.get("JSESSIONID");if(b){d+=";jsessionid="+b}var f=hui.cookie.get("PHPSESSID");if(f){d+="?PHPSESSID="+f}var c=hui.build("span",{"class":"hui_upload_button"});var g=hui.build("span",{"class":"hui_upload_button_object",parent:c});if(e.widget){var a=hui.ui.get(e.widget);a.element.parentNode.insertBefore(c,a.element);a.element.parentNode.removeChild(a.element);c.appendChild(a.element)}else{c.innerHTL='<a href="javascript:void(0);" class="hui_button"><span><span>'+e.chooseButton+"</span></span></a>";this.parent.element.appendChild(c)}this.loader=new SWFUpload({upload_url:d,flash_url:hui.ui.context+"/hui/lib/swfupload/swfupload.swf",file_size_limit:e.maxSize,file_queue_limit:e.maxItems,file_post_name:e.fieldName,file_upload_limit:e.maxItems,file_types:e.types,debug:!true,post_params:e.parameters,button_placeholder_id:"x",button_placeholder:g,button_width:"100%",button_height:30,swfupload_loaded_handler:this._onFlashLoaded.bind(this),file_queued_handler:this._onFileQueued.bind(this),file_queue_error_handler:this._onFileQueueError.bind(this),file_dialog_complete_handler:this._onFileDialogComplete.bind(this),upload_start_handler:this._onUploadStart.bind(this),upload_progress_handler:this._onUploadProgress.bind(this),upload_error_handler:this._onUploadError.bind(this),upload_success_handler:this._onUploadSuccess.bind(this),upload_complete_handler:this._onUploadComplete.bind(this)})},setParameter:function(a,b){hui.log("Flash: Warning: cannot change parameters")},_getAbsoluteUrl:function(b){var c=new String(document.location);var a=c.slice(0,c.lastIndexOf("/"));while(b.indexOf("../")===0){b=b.substring(3);a=a.slice(0,a.lastIndexOf("/"))}a+="/"+b;return a},_onFlashLoaded:function(){hui.log("Flash loaded")},_onFileQueued:function(a){var b=this.parent.$_addItem({name:a.name,size:a.size});b.setWaiting();this.items.push(b)},_onFileQueueError:function(b,a,d){hui.log("Flash: fileQueueError file:"+hui.string.toJSON(b)+", error:"+a+", message:"+d);if(b!==null){var c=this.parent.$_addItem({name:b.name,size:b.size});this.items.push(c);this.parent.$_itemFail(c);c.setError(hui.ui.Upload.Flash.errors[a])}else{hui.ui.showMessage({text:hui.ui.Upload.Flash.errors[a],duration:4000})}},_onFileDialogComplete:function(){hui.log("Flash: fileDialogComplete");this.loader.startUpload()},_onUploadStart:function(){},_onUploadProgress:function(b,a,d){var c=this.items[b.index];c.updateProgress(a,d)},_onUploadError:function(b,a,d){hui.log("Flash: uploadError file:"+b+", error:"+a+", message:"+d);if(b){var c=this.items[b.index];this.parent.$_itemFail(c);c.setError(hui.ui.Upload.Flash.errors[a])}},_onUploadSuccess:function(a,c){var b=this.items[a.index];b.updateProgress(a.size,a.size);this.parent.$_itemSuccess(b)},_onUploadComplete:function(a){this.loader.startUpload()}};!(function(){var b=hui.ui.Upload.Flash.errors={};var a=hui.ui.Upload.Flash.status={};if(window.SWFUpload){b[SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED]="Der er valgt for mange filer";b[SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT]="Filen er for stor";b[SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE]="Filen er tom";b[SWFUpload.QUEUE_ERROR.INVALID_FILETYPE]="Filens type er ikke understøttet";b[SWFUpload.UPLOAD_ERROR.HTTP_ERROR]="Der skete en netværksfejl";b[SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL]="Upload-adressen findes ikke";b[SWFUpload.UPLOAD_ERROR.IO_ERROR]="Der skete en IO-fejl";b[SWFUpload.UPLOAD_ERROR.SECURITY_ERROR]="Der skete en sikkerhedsfejl";b[SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED]="Upload-størrelsen er overskredet";b[SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED]="Upload af filen fejlede";b[SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND]="Filens id kunne ikke findes";b[SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED]="Validering af filen fejlede";b[SWFUpload.UPLOAD_ERROR.FILE_CANCELLED]="Filen blev afbrudt";b[SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED]="Upload af filen blev stoppet";a[SWFUpload.FILE_STATUS.QUEUED]="I kø";a[SWFUpload.FILE_STATUS.IN_PROGRESS]="I gang";a[SWFUpload.FILE_STATUS.ERROR]="Filen gav fejl";a[SWFUpload.FILE_STATUS.COMPLETE]="Færdig";a[SWFUpload.FILE_STATUS.CANCELLED]="Afbrudt"}})();hui.ui.Upload.HTML5=function(a){this.parent=a};hui.ui.Upload.HTML5.support=function(){var a=window.File!==undefined&&(hui.browser.webkit||hui.browser.gecko||hui.browser.msie10||hui.browser.msie11);hui.log("HTML5: supported="+a);return{supported:a,multiple:true}};hui.ui.Upload.HTML5.prototype={initialize:function(){var a=this.parent.options;var b=hui.build("span",{"class":"hui_upload_button_input"});this.form=hui.build("form",{style:"display: inline-block; margin:0;",parent:b});var d={type:"file",name:a.fieldName,parent:this.form};if(a.multiple){d.multiple="multiple"}this.fileInput=hui.build("input",d);var e=this.parent.$_getButtonContainer();e.insertBefore(b,e.firstChild);hui.listen(this.fileInput,"change",this._submit.bind(this))},_submit:function(b){var a=this.fileInput.files;this.parent._transferFiles(a);this._resetInput()},_resetInput:function(){this.form.reset()}};hui.ui.ProgressBar=function(a){this.element=hui.get(a.element);this.name=a.name;this.WAITING=a.small?"hui_progressbar_small_waiting":"hui_progressbar_waiting";this.COMPLETE=a.small?"hui_progressbar_small_complete":"hui_progressbar_complete";this.options=a||{};this.indicator=hui.get.firstByTag(this.element,"div");hui.ui.extend(this)};hui.ui.ProgressBar.create=function(b){b=b||{};var a=b.element=hui.build("div",{"class":b.small?"hui_progressbar hui_progressbar_small":"hui_progressbar"});a.appendChild(document.createElement("div"));return new hui.ui.ProgressBar(b)};hui.ui.ProgressBar.prototype={setValue:function(b){var a=this.element;if(this.waiting){hui.cls.remove(a,this.WAITING)}hui.cls.set(a,this.COMPLETE,b==1);hui.animate(this.indicator,"width",(b*100)+"%",200)},setWaiting:function(){this.waiting=true;this.indicator.style.width=0;hui.cls.add(this.element,this.WAITING)},reset:function(){var a=this.element;if(this.waiting){hui.cls.remove(a,this.WAITING)}hui.cls.remove(a,this.COMPLETE);this.indicator.style.width="0%"},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="block"}};hui.ui.Gallery=function(a){this.options=a||{};this.name=a.name;this.element=hui.get(a.element);this.body=hui.get.firstByClass(this.element,"hui_gallery_body");this.objects=[];this.nodes=[];this.selected=[];this.width=100;this.height=100;this.revealing=false;hui.ui.extend(this);if(a.dropFiles){this._addDrop()}if(this.options.source){this.options.source.listen(this)}if(this.element.parentNode&&hui.cls.has(this.element.parentNode,"hui_overflow")){this.revealing=true;hui.listen(this.element.parentNode,"scroll",this._reveal.bind(this))}};hui.ui.Gallery.create=function(a){a=a||{};a.element=hui.build("div",{"class":"hui_gallery",html:'<div class="hui_gallery_progress"></div><div class="hui_gallery_body"></div>'});return new hui.ui.Gallery(a)};hui.ui.Gallery.prototype={_addDrop:function(){hui.drag.listen({element:this.element,hoverClass:"hui_gallery_drop",$dropFiles:function(a){this.fire("filesDropped",a)}.bind(this),$dropURL:function(a){this.fire("urlDropped",a)}.bind(this)})},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display="";if(this.options.source){this.options.source.refresh()}},setSize:function(c){this.width=c;this.height=c;for(var b=0;b<this.nodes.length;b++){var e=this.nodes[b];var f=this.objects[b];e.style.width=c+"px";e.style.height=c+"px";var a=hui.get.firstChild(e);if(a.height&&a.width){var d=this._findSize(f,c);hui.style.set(a,{width:d.width+"px",height:d.height+"px",marginTop:((c-d.height)/2)+"px"})}}},_findSize:function(c,a){var b={width:a,height:a};if(c.width>c.height){b.height=c.height/c.width*a}if(c.width<c.height){b.width=c.width/c.height*a}return b},reRender:function(){this._render()},setObjects:function(a){this.selected=[];this.objects=a;this._render();this.fire("selectionReset")},getObjects:function(){return this.objects},$sourceShouldRefresh:function(){return hui.dom.isVisible(this.element)},$objectsLoaded:function(a){this.setObjects(a)},$itemsLoaded:function(a){this.setObjects(a)},_render:function(){this.nodes=[];this.maxRevealed=0;this.body.innerHTML="";hui.each(this.objects,function(c,d){var b=this._resolveImageUrl(c),f=0;if(b!==null){b=b.replace(/&amp;/,"&")}if(!this.revealing&&c.height<c.width){f=(this.height-(this.height*c.height/c.width))/2}var a=hui.build("img",{style:"margin:"+f+"px auto 0px"});a.setAttribute(this.revealing?"data-src":"src",b);var e=hui.build("div",{"class":"hui_gallery_item",style:"width:"+this.width+"px; height:"+this.height+"px"});e.appendChild(a);hui.listen(e,"click",function(g){this._itemClicked(d,g)}.bind(this));e.dragDropInfo={kind:"image",icon:"common/image",id:c.id,title:c.name||c.title};e.onmousedown=function(g){hui.ui.startDrag(g,e);return false};hui.listen(e,"dblclick",function(){this._onItemDoubleClick(d)}.bind(this));this.body.appendChild(e);this.nodes.push(e)}.bind(this));this._reveal();this.fireSizeChange()},_reveal:function(){if(!this.revealing){return}var c=this.element.parentNode;var b=c.scrollTop+c.clientHeight;if(b<=this.maxRevealed){return}this.maxRevealed=b;for(var f=0,a=this.nodes.length;f<a;f++){var g=this.nodes[f];if(g.revealed){continue}if(g.offsetTop<b){var e=g.getElementsByTagName("img")[0];g.className="hui_gallery_item hui_gallery_item_busy";var d=this;e.onload=function(){hui.defer(function(){this.parentNode.className="hui_gallery_item";if(this.height<this.width){var h=(d.height-(d.height*this.height/this.width))/2;this.style.marginTop=h+"px"}},this)};e.onerror=function(){this.parentNode.className="hui_gallery_item hui_gallery_item_error"};e.src=e.getAttribute("data-src");g.revealed=true}}},_updateUI:function(){var b=this.selected;for(var a=0;a<this.nodes.length;a++){hui.cls.set(this.nodes[a],"hui_gallery_item_selected",hui.array.contains(b,a))}},_resolveImageUrl:function(a){return hui.ui.resolveImageUrl(this,a,this.width,this.height);for(var b=0;b<this.delegates.length;b++){if(this.delegates[b]["$resolveImageUrl"]){return this.delegates[b]["$resolveImageUrl"](a,this.width,this.height)}}return""},_itemClicked:function(a,b){if(this.busy){return}b=hui.event(b);if(b.metaKey){hui.array.flip(this.selected,a)}else{this.selected=[a]}this.fire("select",this.selected);this._updateUI()},isOneSelection:function(){return this.selected.length==1},getSelectionSize:function(){return this.selected.length},getSelection:function(){var b=[];for(var a=0;a<this.selected.length;a++){var c=this.objects[this.selected[a]];if(c){b.push(c)}}return b},getSelectionIds:function(){var b=[];for(var a=0;a<this.selected.length;a++){var c=this.objects[this.selected[a]];if(c){b.push(c.id)}}return b},getFirstSelection:function(){if(this.selected.length>0){return this.objects[this.selected[0]]}return null},_onItemDoubleClick:function(a){if(this.busy){return}this.fire("itemOpened",this.objects[a]);this.fire("open",this.objects[a])},setSource:function(a){if(this.options.source!=a){if(this.options.source){this.options.source.unListen(this)}a.listen(this);this.options.source=a;a.refresh()}},$sourceIsBusy:function(){this._setBusy(true)},$sourceIsNotBusy:function(){this._setBusy(false)},$visibilityChanged:function(){if(hui.dom.isVisible(this.element)){if(this.options.source){this.options.source.refreshFirst()}this._reveal()}},$$layout:function(){if(this.nodes.length>0){this._reveal()}},_setBusy:function(a){this.busy=a;window.clearTimeout(this.busytimer);if(a){var b=this.element;this.busytimer=window.setTimeout(function(){hui.cls.add(b,"hui_gallery_busy")},300)}else{hui.cls.remove(this.element,"hui_gallery_busy")}}};hui.ui.Calendar=function(a){this.name=a.name;this.options=hui.override({startHour:7,endHour:24},a);this.element=hui.get(a.element);this.head=hui.get.firstByTag(this.element,"thead");this.body=hui.get.firstByTag(this.element,"tbody");this.date=new Date();hui.ui.extend(this);this.buildUI();this.updateUI();if(this.options.source){this.options.source.listen(this)}};hui.ui.Calendar.prototype={show:function(){this.element.style.display="block";if(this.options.source){this.options.source.refresh()}},hide:function(){this.element.style.display="none"},getFirstDay:function(){var a=new Date(this.date.getTime());a.setDate(a.getDate()-a.getDay()+1);a.setHours(0);a.setMinutes(0);a.setSeconds(0);return a},getLastDay:function(){var a=new Date(this.date.getTime());a.setDate(a.getDate()-a.getDay()+7);a.setHours(23);a.setMinutes(59);a.setSeconds(59);return a},clearEvents:function(){this.events=[];var a=hui.get.byClass(this.element,"hui_calendar_event");for(var b=0;b<a.length;b++){hui.dom.remove(a[b])}this.hideEventViewer()},$objectsLoaded:function(a){try{this.setEvents(a)}catch(b){hui.log(b)}},$sourceIsBusy:function(){this.setBusy(true)},$sourceShouldRefresh:function(){return this.element.style.display!="none"},setEvents:function(d){d=d||[];for(var c=0;c<d.length;c++){var g=d[c];if(typeof(g.startTime)!="object"){g.startTime=new Date(parseInt(g.startTime)*1000)}if(typeof(g.endTime)!="object"){g.endTime=new Date(parseInt(g.endTime)*1000)}}this.setBusy(false);this.clearEvents();this.events=d;var a=this;var h=(this.options.endHour-this.options.startHour)*40;var b=this.getFirstDay().getWeekOfYear();var f=this.getFirstDay().getYear();hui.each(this.events,function(l){var i=hui.get.byClass(a.body,"hui_calendar_day")[l.startTime.getDay()-1];if(!i){return}if(l.startTime.getWeekOfYear()!=b||l.startTime.getYear()!=f){return}var k=hui.build("div",{"class":"hui_calendar_event",parent:i});var m=((l.startTime.getHours()*60+l.startTime.getMinutes())/60-a.options.startHour)*40-1;var e=(l.endTime.getTime()-l.startTime.getTime())/1000/60/60*40+1;e=Math.min(h-m,e);hui.style.set(k,{marginTop:m+"px",height:e+"px",visibility:"hidden"});var j=hui.build("div",{parent:k});hui.build("p",{"class":"hui_calendar_event_time",text:l.startTime.dateFormat("H:i"),parent:j});hui.build("p",{"class":"hui_calendar_event_text",text:l.text,parent:j});if(l.location){hui.build("p",{"class":"hui_calendar_event_location",text:l.location,parent:j})}window.setTimeout(function(){hui.effect.bounceIn({element:k})},Math.random()*200);hui.listen(k,"click",function(){a.eventWasClicked(k)})})},eventWasClicked:function(a){this.showEvent(a)},setBusy:function(a){hui.cls.set(this.element,"hui_calendar_busy",a)},updateUI:function(){var c=this.getFirstDay();var d=hui.get.byClass(this.head,"day");for(var b=0;b<d.length;b++){var a=new Date(c.getTime());a.setDate(a.getDate()+b);hui.dom.setText(d[b],a.dateFormat("l \\d. d M"))}},buildUI:function(){var f=hui.get.firstByClass(this.element,"hui_calendar_bar");this.toolbar=hui.ui.Toolbar.create({labels:false});f.appendChild(this.toolbar.getElement());var e=hui.ui.Button.create({name:"huiCalendarPrevious",text:"",icon:"monochrome/previous"});e.listen(this);this.toolbar.add(e);var a=hui.ui.Button.create({name:"huiCalendarToday",text:"Idag"});a.click(function(){this.setDate(new Date())}.bind(this));this.toolbar.add(a);var c=hui.ui.Button.create({name:"huiCalendarNext",text:"",icon:"monochrome/next"});c.listen(this);this.toolbar.add(c);this.datePickerButton=hui.ui.Button.create({name:"huiCalendarDatePicker",text:"Vælg dato..."});this.datePickerButton.listen(this);this.toolbar.add(this.datePickerButton);var g=hui.get.firstByClass(this.body,"hui_calendar_day");for(var b=this.options.startHour;b<=this.options.endHour;b++){var d=hui.build("div",{"class":"hui_calendar_time",html:"<span><em>"+b+":00</em></span>"});if(b==this.options.startHour){hui.cls.add(d,"hui_calendar_time_first")}if(b==this.options.endHour){hui.cls.add(d,"hui_calendar_time_last")}g.appendChild(d)}},$click$huiCalendarPrevious:function(){var a=new Date(this.date.getTime());a.setDate(this.date.getDate()-7);this.setDate(a)},$click$huiCalendarNext:function(){var a=new Date(this.date.getTime());a.setDate(this.date.getDate()+7);this.setDate(a)},setDate:function(a){this.date=new Date(a.getTime());this.updateUI();this.refresh();if(this.datePicker){this.datePicker.setValue(this.date)}},$click$huiCalendarDatePicker:function(){this.showDatePicker()},refresh:function(){this.clearEvents();this.setBusy(true);var a={startTime:this.getFirstDay(),endTime:this.getLastDay()};this.fire("calendarSpanChanged",a);hui.ui.firePropertyChange(this,"startTime",this.getFirstDay());hui.ui.firePropertyChange(this,"endTime",this.getLastDay())},valueForProperty:function(a){if(a=="startTime"){return this.getFirstDay()}if(a=="endTime"){return this.getLastDay()}return this[a]},showDatePicker:function(){if(!this.datePickerPanel){this.datePickerPanel=hui.ui.BoundPanel.create();this.datePicker=hui.ui.DatePicker.create({name:"huiCalendarDatePicker",value:this.date});this.datePicker.listen(this);this.datePickerPanel.add(this.datePicker);this.datePickerPanel.addSpace(3);var a=hui.ui.Button.create({name:"huiCalendarDatePickerClose",text:"Luk",small:true,rounded:true});a.listen(this);this.datePickerPanel.add(a)}this.datePickerPanel.position(this.datePickerButton.getElement());this.datePickerPanel.show()},$click$huiCalendarDatePickerClose:function(){this.datePickerPanel.hide()},$dateChanged$huiCalendarDatePicker:function(a){this.setDate(a)},showEvent:function(b){if(!this.eventViewerPanel){this.eventViewerPanel=hui.ui.BoundPanel.create({width:270,padding:3});this.eventInfo=hui.ui.InfoView.create(null,{height:240,clickObjects:true});this.eventViewerPanel.add(this.eventInfo);this.eventViewerPanel.addSpace(5);var a=hui.ui.Button.create({name:"huiCalendarEventClose",text:"Luk"});a.listen(this);this.eventViewerPanel.add(a)}this.eventInfo.clear();this.eventInfo.setBusy(true);this.eventViewerPanel.position(b);this.eventViewerPanel.show();hui.ui.callDelegates(this,"requestEventInfo");return},updateEventInfo:function(a,b){this.eventInfo.setBusy(false);this.eventInfo.update(b)},$click$huiCalendarEventClose:function(){this.hideEventViewer()},hideEventViewer:function(){if(this.eventViewerPanel){this.eventViewerPanel.hide()}}};hui.ui.DatePicker=function(a){this.name=a.name;this.element=hui.get(a.element);this.options={};hui.override(this.options,a);this.cells=[];this.title=hui.get.firstByTag(this.element,"strong");this.today=new Date();this.value=this.options.value?new Date(this.options.value.getTime()):new Date();this.viewDate=new Date(this.value.getTime());this.viewDate.setDate(1);hui.ui.extend(this);this._addBehavior();this._updateUI()};hui.ui.DatePicker.create=function(m){var c=m.element=hui.build("div",{"class":"hui_datepicker",html:'<div class="hui_datepicker_header"><a class="hui_datepicker_next"></a><a class="hui_datepicker_previous"></a><strong></strong></div>'}),h=hui.build("table",{parent:c}),f=hui.build("thead",{parent:h}),g=hui.build("tr",{parent:f});for(var d=0;d<7;d++){g.appendChild(hui.build("th",{text:Date.dayNames[d].substring(0,3)}))}var e=hui.build("tbody",{parent:h});for(var b=0;b<6;b++){var l=hui.build("tr",{parent:e});for(var a=0;a<7;a++){hui.build("td",{parent:l})}}return new hui.ui.DatePicker(m)};hui.ui.DatePicker.prototype={_addBehavior:function(){var a=this;this.cells=hui.get.byTag(this.element,"td");hui.each(this.cells,function(d,e){hui.listen(d,"mousedown",function(f){hui.stop(f);a._selectCell(e)})});var b=hui.get.firstByClass(this.element,"hui_datepicker_next");var c=hui.get.firstByClass(this.element,"hui_datepicker_previous");hui.listen(b,"mousedown",function(d){hui.stop(d);a.next()});hui.listen(c,"mousedown",function(d){hui.stop(d);a.previous()})},setValue:function(a){if(!a){a=new Date()}this.value=new Date(a.getTime());this.viewDate=new Date(a.getTime());this.viewDate.setDate(1);this._updateUI()},_updateUI:function(){hui.dom.setText(this.title,this.viewDate.dateFormat("F Y"));var c=this.value.getFullYear()==this.viewDate.getFullYear();var e=this.viewDate.getMonth();for(var d=0;d<this.cells.length;d++){var b=this._indexToDate(d);var a=this.cells[d];if(b.getMonth()<e){a.className="hui_datepicker_dimmed"}else{if(b.getMonth()>e){a.className="hui_datepicker_dimmed"}else{a.className=""}}if(b.getDate()==this.value.getDate()&&b.getMonth()==this.value.getMonth()&&c){hui.cls.add(a,"hui_datepicker_selected")}if(b.getDate()==this.today.getDate()&&b.getMonth()==this.today.getMonth()&&b.getFullYear()==this.today.getFullYear()){hui.cls.add(a,"hui_datepicker_today")}hui.dom.setText(a,b.getDate())}},_getPreviousMonth:function(){var a=new Date(this.viewDate.getTime());a.setMonth(a.getMonth()-1);return a},_getNextMonth:function(){var a=new Date(this.viewDate.getTime());a.setMonth(a.getMonth()+1);return a},previous:function(){this.viewDate=this._getPreviousMonth();this._updateUI()},next:function(){this.viewDate=this._getNextMonth();this._updateUI()},_selectCell:function(a){this.value=this._indexToDate(a);this.viewDate=new Date(this.value.getTime());this.viewDate.setDate(1);this._updateUI();hui.ui.callDelegates(this,"dateChanged",this.value)},_indexToDate:function(b){var d=this.viewDate.getDay(),e=this.viewDate.getDaysInMonth(),c=this._getPreviousMonth().getDaysInMonth(),a;if(b<d){a=this._getPreviousMonth();a.setDate(c-d+b+1)}else{if(b>d+e-1){a=this._getPreviousMonth();a.setDate(b-d-e+1)}else{a=new Date(this.viewDate.getTime());a.setDate(b+1-d)}}return a}};Date.monthNames=["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"];Date.dayNames=["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"];hui.ui.Layout=function(a){this.name=a.name;this.options=a||{};this.element=hui.get(a.element);hui.ui.extend(this)};hui.ui.Layout.create=function(a){a=hui.override({text:"",highlighted:false,enabled:true},a);a.element=hui.dom.parseToNode('<table class="hui_layout"><tbody class="hui_layout"><tr class="hui_layout_middle"><td class="hui_layout_middle"><table class="hui_layout_middle"><tr><td class="hui_layout_left hui_context_sidebar"><div class="hui_layout_left"></div></td><td class="hui_layout_center"></td></tr></table></td></tr></tbody></table>');return new hui.ui.Layout(a)};hui.ui.Layout.prototype={addToLeft:function(b){var a=hui.get.firstByClass(this.element,"hui_layout_left");a.appendChild(b.element)},addToCenter:function(b){var a=hui.get.firstByClass(this.element,"hui_layout_center");a.appendChild(b.element)},$$layout:function(){if(hui.browser.gecko){var b=hui.get.firstByClass(this.element,"hui_layout_center");if(b){b.style.height="100%"}}if(!window.navigator.userAgent.indexOf("AppleWebKit/536")){if(!hui.browser.msie7&&!hui.browser.msie8&&!hui.browser.msie9){return}}if(!hui.dom.isVisible(this.element)){return}if(this.diff===undefined){var e=hui.get.firstByClass(this.element,"hui_layout_top");var d=hui.get.firstByTag(e,"*").clientHeight;var f=hui.get.firstByTag(hui.get.firstByTag(this.element,"tfoot"),"td");var a=0;if(f){var i=hui.get.firstByTag(f,"*");if(i){a=i.clientHeight}}d+=hui.position.getTop(this.element);this.diff=a+d;if(this.element.parentNode!==document.body){this.diff+=15}else{}}var c=hui.get.firstByTag(this.element,"tbody");var g=hui.get.firstByTag(c,"td");var h=(hui.window.getViewHeight()-this.diff+5);g.style.height=h+"px"}};hui.ui.Dock=function(a){this.options=a;this.element=hui.get(a.element);this.iframe=hui.get.firstByTag(this.element,"iframe");this.progress=hui.get.firstByClass(this.element,"hui_dock_progress");this.resizer=hui.get.firstByClass(this.element,"hui_dock_sidebar_line");this.bar=hui.get.firstByClass(this.element,"hui_dock_bar");hui.listen(this.iframe,"load",this._load.bind(this));this.name=a.name;hui.ui.extend(this);this.busy=true;hui.ui.listen(this);this._addBehavior()};hui.ui.Dock.prototype={_addBehavior:function(){if(this.resizer){this.sidebar=hui.get.firstByClass(this.element,"hui_dock_sidebar");this.main=hui.get.firstByClass(this.element,"hui_dock_sidebar_main");hui.drag.register({element:this.resizer,onStart:function(){this.hasDragged=false;hui.cls.add(this.element,"hui_dock_sidebar_resizing");this._setBusy(true)}.bind(this),onMove:function(b){var a=b.getLeft();if(a<10){a=10}this._updateSidebarWidth(a);if(!this.hasDragged){hui.cls.remove(this.element,"hui_dock_sidebar_collapsed")}this.hasDragged=true}.bind(this),onEnd:function(){this._setBusy(false);if(!this.hasDragged){this.toggle()}else{if(this.latestWidth==10){this.collapse()}else{this.latestExpandedWidth=this.latestWidth}}hui.cls.remove(this.element,"hui_dock_sidebar_resizing");hui.ui.callVisible(this);hui.ui.reLayout()}.bind(this)})}},_updateSidebarWidth:function(a){this.latestWidth=a;this.sidebar.style.width=(a-1)+"px";this.main.style.left=a+"px";this.resizer.style.left=(a-5)+"px"},setUrl:function(a){this._setBusy(true);hui.frame.getDocument(this.iframe).location.href=a},collapse:function(){hui.cls.add(this.element,"hui_dock_sidebar_collapsed");this._updateSidebarWidth(10);hui.ui.callVisible(this)},expand:function(){hui.cls.remove(this.element,"hui_dock_sidebar_collapsed");this._updateSidebarWidth(this.latestExpandedWidth||200);hui.ui.callVisible(this)},toggle:function(){if(hui.cls.has(this.element,"hui_dock_sidebar_collapsed")){this.expand()}else{this.collapse()}},_load:function(){this._setBusy(false)},_setBusy:function(a){if(a){hui.style.set(this.progress,{display:"block",height:this.iframe.clientHeight+"px",width:this.iframe.clientWidth+"px"})}else{this.progress.style.display="none"}},$frameLoaded:function(a){if(a==hui.frame.getWindow(this.iframe)){this._setBusy(false)}},$$layout:function(){return;var a=hui.window.getViewHeight();hui.log(a,this.bar.clientHeight);this.iframe.style.height=(a-this.bar.clientHeight)+"px";this.progress.style.width=(this.iframe.clientWidth)+"px";this.progress.style.height=(a-this.bar.clientHeight)+"px"}};hui.ui.Box=function(a){this.options=hui.override({},a);this.name=a.name;this.element=hui.get(a.element);this.visible=!this.options.absolute;hui.ui.extend(this);if(this.nodes.close){hui.listen(this.nodes.close,"click",this._close.bind(this))}};hui.ui.Box.create=function(a){a=a||{};var c=a.variant||"standard";var d=c!=="plain";var b=(a.closable?'<a class="hui_box_close hui_box_close_'+c+'" href="#"></a>':"");if(d){b+='<div class="hui_box_top"><div><div></div></div></div><div class="hui_box_middle"><div class="hui_box_middle">'}if(a.title){b+='<div class="hui_box_header"><strong class="hui_box_title">'+hui.string.escape(hui.ui.getTranslated(a.title))+"</strong></div>"}b+='<div class="hui_box_body" style="'+(a.padding?"padding: "+a.padding+"px;":"")+(a.width?"width: "+a.width+"px;":"")+'"></div>';if(d){b+='</div></div><div class="hui_box_bottom"><div><div></div></div></div>'}a.element=hui.build("div",{"class":"hui_box hui_box_"+c,html:b,style:a.width?a.width+"px":null});if(a.absolute){hui.cls.add(a.element,"hui_box_absolute")}if(c){hui.cls.add(a.element,"hui_box_"+c)}return new hui.ui.Box(a)};hui.ui.Box.prototype={nodes:{body:"hui_box_body",close:"hui_box_close"},_close:function(a){hui.stop(a);this.hide();this.fire("boxWasClosed");this.fire("close")},shake:function(){hui.effect.shake({element:this.element})},addToDocument:function(){document.body.appendChild(this.element)},add:function(b){var a=this.nodes.body;if(b.getElement){a.appendChild(b.getElement())}else{a.appendChild(b)}},show:function(){var d=this.element;if(this.options.modal){var b=hui.ui.nextPanelIndex();d.style.zIndex=b+1;hui.ui.showCurtain({widget:this,zIndex:b})}if(this.options.absolute){hui.style.set(d,{display:"block",visibility:"hidden"});var a=d.clientWidth;var c=(hui.window.getViewHeight()-d.clientHeight)/2+hui.window.getScrollTop();hui.style.set(d,{marginLeft:(a/-2)+"px",top:c+"px",display:"block",visibility:"visible"})}else{d.style.display="block"}this.visible=true;hui.ui.callVisible(this)},isVisible:function(){return this.visible},$$layout:function(){if(this.options.absolute&&this.visible){var c=this.element;var a=c.clientWidth;var b=(hui.window.getViewHeight()-c.clientHeight)/2+hui.window.getScrollTop();hui.style.set(c,{marginLeft:(a/-2)+"px",top:b+"px"})}},hide:function(){hui.ui.hideCurtain(this);this.element.style.display="none";this.visible=false;hui.ui.callVisible(this)},$curtainWasClicked:function(){this.fire("boxCurtainWasClicked");if(this.options.curtainCloses){this._close()}}};hui.ui.Wizard=function(a){this.options=a||{};this.element=hui.get(a.element);this.name=a.name;this.container=hui.get.firstByClass(this.element,"hui_wizard_steps");this.steps=hui.get.byClass(this.element,"hui_wizard_step");this.anchors=hui.get.byClass(this.element,"hui_wizard_selection");this.selected=0;hui.ui.extend(this);this._addBehavior()};hui.ui.Wizard.prototype={_addBehavior:function(){var a=this;hui.each(this.anchors,function(c,b){hui.listen(c,"mousedown",function(d){hui.stop(d);a.goToStep(b)});hui.listen(c,"click",function(d){hui.stop(d)})})},getStep:function(){return this.selected},goToStep:function(a){var b=this.container;b.style.height=b.clientHeight+"px";hui.cls.remove(this.anchors[this.selected],"hui_selected");this.steps[this.selected].style.display="none";hui.cls.add(this.anchors[a],"hui_selected");this.steps[a].style.display="block";this.selected=a;hui.animate(b,"height",this.steps[a].clientHeight+"px",500,{ease:hui.ease.slowFastSlow,onComplete:function(){b.style.height=""}});hui.ui.callVisible(this);this.fire("stepChanged",this.selected)},isFirst:function(){return this.selected==0},isLast:function(){return this.selected==this.steps.length-1},next:function(){if(this.selected<this.steps.length-1){this.goToStep(this.selected+1)}},previous:function(){if(this.selected>0){this.goToStep(this.selected-1)}}};hui.ui.Input=function(a){this.options=hui.override({placeholderElement:null,validator:null},a);var b=this.element=hui.get(a.element);this.element.setAttribute("autocomplete","off");this.value=this._validate(this.element.value);this.isPassword=this.element.type=="password";this.name=a.name;hui.ui.extend(this);this._addBehavior();if(this.options.placeholderElement&&this.value!=""){hui.style.set(this.options.placeholderElement,{opacity:0,display:"none"})}this._checkPlaceholder();try{if(b==document.activeElement){this._onFocus()}}catch(b){}};hui.ui.Input.prototype={_addBehavior:function(){var b=this.element,a=this.options.placeholderElement;hui.listen(b,"keyup",this._onKeyUp.bind(this));hui.listen(b,"blur",this._onBlur.bind(this));if(a){hui.listen(b,"focus",this._onFocus.bind(this));hui.listen(b,"blur",this._checkPlaceholder.bind(this));if(a){a.style.cursor="text";hui.listen(a,"mousedown",this.focus.bind(this));hui.listen(a,"click",this.focus.bind(this))}}if(b.type=="submit"){hui.listen(b,"click",function(c){this.fire("click",c)}.bind(this))}},_onFocus:function(){var b=this.element,a=this.options.placeholderElement;if(a&&b.value==""){hui.style.set(a,{opacity:0,display:"none"})}},_validate:function(c){var b=this.options.validator;var a;if(b){a=b.validate(c);hui.cls.set(this.element,"hui_invalid",!a.valid);return a.value}return c},_checkPlaceholder:function(){if(this.options.placeholderElement&&this.value==""){hui.effect.fadeIn({element:this.options.placeholderElement,duration:200})}if(this.isPassword&&!hui.browser.msie){this.element.type="password"}},_onKeyUp:function(){if(this.value!==this.element.value){var a=this._validate(this.element.value);var b=a!==this.value;this.value=a;if(b){this.fire("valueChanged",this.value)}}},_onBlur:function(){hui.cls.remove(this.element,"hui_invalid");this.element.value=this.value||""},getValue:function(){return this.value},setValue:function(a){if(a===undefined||a===null){a=""}this.element.value=a;this.value=this._validate(a)},isEmpty:function(){return this.value==""},isBlank:function(){return hui.isBlank(this.value)},focus:function(){this.element.focus()},setError:function(a){var b=a?true:false;hui.cls.set(this.element,"hui_field_error",b);if(typeof(a)=="string"){hui.ui.showToolTip({text:a,element:this.element,key:this.name})}if(!b){hui.ui.hideToolTip({key:this.name})}}};hui.ui.InfoView=function(a){this.options=hui.override({clickObjects:false},a);this.element=hui.get(a.element);this.body=hui.get.firstByTag(this.element,"tbody");this.name=a.name;hui.ui.extend(this)};hui.ui.InfoView.create=function(a){a=a||{};var b=a.element=hui.build("div",{"class":"hui_infoview",html:"<table><tbody></tbody></table>"});if(a.height){hui.style.set(b,{height:a.height+"px",overflow:"auto",overflowX:"hidden"})}if(a.margin){b.style.margin=a.margin+"px"}return new hui.ui.InfoView(a)};hui.ui.InfoView.prototype={addHeader:function(b){var a=hui.build("tr",{parent:this.body});hui.build("th",{"class":"hui_infoview_header",colspan:"2",text:b,parent:a})},addProperty:function(a,c){var b=hui.build("tr",{parent:this.body});hui.build("th",{parent:b,text:a});hui.build("td",{parent:b,text:c})},addObjects:function(b,d){if(!d||d.length==0){return}var e=hui.build("tr",{parent:this.body});e.appendChild(hui.build("th",{text:b}));var a=hui.build("td",{parent:e});var c=this.options.clickObjects;hui.each(d,function(g){var f=hui.build("div",{text:g.title,parent:a});if(c){hui.cls.add(f,"hui_infoview_click");hui.listen(f,"click",function(){hui.ui.callDelegates(this,"objectWasClicked",g)})}})},setBusy:function(a){hui.cls.set(this,element,"hui_infoview_busy",a)},clear:function(){hui.dom.clear(this.body)},update:function(b){this.clear();for(var a=0;a<b.length;a++){switch(b[a].type){case"header":this.addHeader(b[a].value);break;case"property":this.addProperty(b[a].label,b[a].value);break;case"objects":this.addObjects(b[a].label,b[a].value);break}}}};hui.ui.Overflow=function(a){this.options=a;this.element=hui.get(a.element);this.topShadow=hui.get.firstByClass(this.element,"hui_overflow_top");this.bottomShadow=hui.get.firstByClass(this.element,"hui_overflow_bottom");hui.listen(this.element,"scroll",this._checkShadows.bind(this));this.name=a.name;hui.ui.extend(this)};hui.ui.Overflow.create=function(a){a=a||{};var b=a.element=hui.build("div",{"class":"hui_overflow",html:'<div class="hui_overflow_top"></div><div class="hui_overflow_bottom"></div>'});if(a.height){b.style.height=a.height+"px"}return new hui.ui.Overflow(a)};hui.ui.Overflow.prototype={_checkShadows:function(){if(hui.browser.msie){return}if(this.element.scrollTop>0){this.topShadow.style.display="block";this.topShadow.style.top=this.element.scrollTop+"px"}else{this.topShadow.style.display="none"}if(this.element.scrollHeight-this.element.scrollTop-this.element.clientHeight>0){this.bottomShadow.style.display="block";this.bottomShadow.style.top=(this.element.scrollTop+this.element.clientHeight-this.bottomShadow.clientHeight)+"px"}else{this.bottomShadow.style.display="none"}},show:function(){this.element.style.display="";hui.ui.callVisible(this)},hide:function(){this.element.style.display="none";hui.ui.callVisible(this)},add:function(a){if(a.getElement){this.element.appendChild(a.getElement())}else{this.element.appendChild(a)}return this},$$childSizeChanged:function(){this._checkShadows()},$$layout:function(){if(!this.options.dynamic){this._checkShadows();return}this.element.style.height=hui.position.getRemainingHeight(this.element)+"px";this._checkShadows()},$visibilityChanged:function(){if(hui.dom.isVisible(this.element)){this.$$layout()}}};hui.ui.SearchField=function(a){this.options=hui.override({expandedWidth:null},a);this.element=hui.get(a.element);this.name=a.name;this.field=hui.get.firstByTag(this.element,"input");this.value=this.field.value;this.adaptive=hui.cls.has(this.element,"hui_searchfield_adaptive");this.initialWidth=null;hui.ui.extend(this);this._addBehavior();if(this.value!==""){this._updateClass()}};hui.ui.SearchField.create=function(a){a=a||{};a.element=hui.build("span",{"class":a.adaptive?"hui_searchfield hui_searchfield_adaptive":"hui_searchfield",html:'<em class="hui_searchfield_placeholder"></em><a href="javascript:void(0);" class="hui_searchfield_reset"></a><span><span><input type="text"/></span></span>'});return new hui.ui.SearchField(a)};hui.ui.SearchField.prototype={_addBehavior:function(){var b=this;hui.listen(this.field,"keyup",this._onKeyUp.bind(this));var c=hui.get.firstByTag(this.element,"a");c.tabIndex=-1;if(!hui.browser.ipad){var a=function(){b.field.focus();b.field.select()};hui.listen(this.element,"mousedown",a);hui.listen(this.element,"mouseup",a);hui.listen(hui.get.firstByTag(this.element,"em"),"mousedown",a)}else{var a=function(){b.field.focus()};hui.listen(hui.get.firstByTag(this.element,"em"),"click",a)}hui.listen(c,"mousedown",function(d){hui.stop(d);b.reset();a()});hui.listen(this.field,"focus",this._onFocus.bind(this));hui.listen(this.field,"blur",this._onBlur.bind(this))},_onFocus:function(){hui.ui.setKeyboardTarget(this);this.focused=true;this._updateClass();if(this.options.expandedWidth>0){if(this.initialWidth==null){this.initialWidth=parseInt(hui.style.get(this.element,"width"))}hui.animate(this.element,"width",this.options.expandedWidth+"px",500,{ease:hui.ease.slowFastSlow})}},_onBlur:function(){hui.ui.setKeyboardTarget(null);this.focused=false;this._updateClass();if(this.initialWidth!==null){hui.animate(this.element,"width",this.initialWidth+"px",500,{ease:hui.ease.slowFastSlow,delay:100})}},_onKeyUp:function(a){this._fieldChanged();if(a.keyCode===hui.KEY_RETURN){this.fire("submit")}},focus:function(){this.field.focus()},setValue:function(a){this.field.value=a===undefined||a===null?"":a;this._fieldChanged()},getValue:function(){return this.field.value},isEmpty:function(){return this.field.value==""},isBlank:function(){return hui.isBlank(this.field.value)},reset:function(){this.field.value="";this._fieldChanged()},_updateClass:function(){var a="hui_searchfield";if(this.adaptive){a+=" hui_searchfield_adaptive"}if(this.focused&&this.value!=""){a+=" hui_searchfield_focus_dirty"}else{if(this.focused){a+=" hui_searchfield_focus"}else{if(this.value!=""){a+=" hui_searchfield_dirty"}}}this.element.className=a},_fieldChanged:function(){if(this.field.value!=this.value){this.value=this.field.value;this._updateClass();this.fireValueChange()}}};if(window.define){define("hui.ui.SearchField",hui.ui.SearchField)}hui.ui.Fragment=function(a){this.options=a;this.element=hui.get(a.element);this.name=a.name;hui.ui.extend(this)};hui.ui.Fragment.prototype={show:function(){this.element.style.display="block";hui.ui.callVisible(this)},hide:function(){this.element.style.display="none";hui.ui.callVisible(this)},setHTML:function(a){this.element.innerHTML=a},setContent:function(a){this.element.innerHTML="";this.element.appendChild(a)}};hui.ui.LocationPicker=function(a){a=a||{};this.name=a.name;this.options=a.options||{};this.element=hui.get(a.element);this.backendLoaded=window.google!==undefined&&window.google.maps!==undefined;this.defered=[];hui.ui.extend(this)};hui.ui.LocationPicker.prototype={show:function(b){if(!this.panel){var a=this.panel=hui.ui.BoundPanel.create({width:302,modal:true});var e=hui.build("div",{style:"width:300px;height:300px;border:1px solid #bbb;"});a.add(e);var d=hui.ui.Buttons.create({align:"right",top:5});var c=hui.ui.Button.create({text:{en:"Close",da:"Luk"},small:true});c.listen({$click:function(){a.hide()}});a.add(d.add(c));hui.style.set(a.element,{left:"-10000px",top:"-10000px",display:""});this._whenReady(function(){var f={zoom:15,mapTypeId:google.maps.MapTypeId.TERRAIN};this.defaultCenter=new google.maps.LatLng(57.0465,9.9185);this.map=new google.maps.Map(e,f);google.maps.event.addListener(this.map,"click",function(g){var h={latitude:g.latLng.lat(),longitude:g.latLng.lng()};this.setLocation(h);this.fire("locationChanged",h)}.bind(this));this.setLocation(b.location)}.bind(this))}if(b.node){this.panel.position(b.node)}this.panel.show()},_whenReady:function(a){if(this.backendLoaded){a();return}this.defered.push(a);if(this.loadingBackend){return}this.loadingBackend=true;window.huiLocationPickerReady=function(){this.loadingBackend=false;this.backendLoaded=true;hui.log("Google maps loaded!");for(var b=0;b<this.defered.length;b++){this.defered[b]()}window.huiLocationPickerReady=null}.bind(this);hui.log("Loading google maps...");hui.require("http://maps.google.com/maps/api/js?sensor=false&callback=huiLocationPickerReady")},setLocation:function(a){this._whenReady(function(){hui.log("Setting location...");if(!a&&this.marker){this.marker.setMap(null);this.map.setCenter(this.defaultCenter);return}a=this._buildLatLng(a);if(!this.marker){this.marker=new google.maps.Marker({position:a,map:this.map})}else{this.marker.setPosition(a);this.marker.setMap(this.map)}this.map.setCenter(a)}.bind(this))},_buildLatLng:function(a){if(!a){a={latitude:57.0465,longitude:9.9185}}return new google.maps.LatLng(a.latitude,a.longitude)}};hui.ui.Bar=function(a){this.options=hui.override({},a);this.name=a.name;this.element=hui.get(a.element);this.visible=hui.cls.has(this.element,"hui_bar_absolute")||this.element.style.display=="none"?false:true;this.body=hui.get.firstByClass(this.element,"hui_bar_left");hui.ui.extend(this)};hui.ui.Bar.create=function(c){c=c||{};var b="hui_bar";if(c.variant){b+=" hui_bar_"+c.variant}if(c.absolute){b+=" hui_bar_absolute"}c.element=hui.build("div",{"class":b});var a=hui.build("div",{"class":"hui_bar_body",parent:c.element});hui.build("div",{"class":"hui_bar_left",parent:a});return new hui.ui.Bar(c)};hui.ui.Bar.prototype={addToDocument:function(){document.body.appendChild(this.element)},add:function(a){this.body.appendChild(a.getElement())},addDivider:function(){hui.build("span",{"class":"hui_bar_divider",parent:this.body})},addToRight:function(b){var a=this._getRight();a.appendChild(b.getElement())},placeAbove:function(a){if(a.getElement){a=a.getElement()}hui.position.place({source:{element:this.element,vertical:1,horizontal:0},target:{element:a,vertical:0,horizontal:0}});this.element.style.zIndex=hui.ui.nextTopIndex()},setVisible:function(a){if(this.visible===a){return}if(a){this.show()}else{this.hide()}},show:function(){if(this.visible){return}if(this.options.absolute){this.element.style.visibility="visible"}else{this.element.style.display="";hui.ui.reLayout()}this.visible=true;hui.ui.callVisible(this)},hide:function(){if(!this.visible){return}if(this.options.absolute){this.element.style.visibility="hidden"}else{this.element.style.display="none";hui.ui.reLayout()}this.visible=false;hui.ui.callVisible(this)},_getRight:function(){if(!this.right){this.right=hui.get.firstByClass(this.element,"hui_bar_right");if(!this.right){var a=hui.get.firstByClass(this.element,"hui_bar_body");this.right=hui.build("div",{"class":"hui_bar_right",parentFirst:a})}}return this.right},select:function(c){var b=hui.ui.getDescendants(this);hui.log(b);for(var a=0;a<b.length;a++){var d=b[a];if(d.getKey&&d.setSelected){d.setSelected(d.getKey()==c)}}},$clickButton:function(a){this.fire("clickButton",a)}};hui.ui.Bar.Button=function(a){this.options=hui.override({},a);this.name=a.name;this.element=hui.get(a.element);hui.listen(this.element,"click",this._click.bind(this));hui.listen(this.element,"mousedown",this._mousedown.bind(this));hui.listen(this.element,"mouseup",hui.stop);hui.ui.extend(this)};hui.ui.Bar.Button.create=function(a){a=a||{};var b=a.element=hui.build("a",{"class":"hui_bar_button"});if(a.icon){b.appendChild(hui.ui.createIcon(a.icon,16))}return new hui.ui.Bar.Button(a)};hui.ui.Bar.Button.prototype={_mousedown:function(a){this.fire("mousedown");if(this.options.stopEvents){hui.stop(a)}},_click:function(a){this.fire("click");if(this.options.stopEvents){hui.stop(a)}hui.ui.callAncestors(this,"$clickButton")},setSelected:function(a){hui.cls.set(this.element,"hui_bar_button_selected",a)},getKey:function(){return this.options.key}};hui.ui.Bar.Text=function(a){this.options=hui.override({},a);this.name=a.name;this.element=hui.get(a.element);hui.ui.extend(this)};hui.ui.Bar.Text.prototype={setText:function(a){hui.dom.setText(this.element,hui.ui.getTranslated(a))}};hui.ui.IFrame=function(a){this.options=a;this.element=hui.get(a.element);this.name=a.name;hui.ui.extend(this)};hui.ui.IFrame.prototype={setUrl:function(a){this.element.setAttribute("src",a)},clear:function(){this.setUrl("about:blank")},getDocument:function(){return hui.frame.getDocument(this.element)},getWindow:function(){return hui.frame.getWindow(this.element)},reload:function(){this.getWindow().location.reload()},show:function(){this.element.style.display=""},hide:function(){this.element.style.display="none"}};hui.ui.VideoPlayer=function(a){this.options=a;this.element=hui.get(a.element);this.placeholder=hui.get.firstByTag(this.element,"div");this.name=a.name;this.state={duration:0,time:0,loaded:0};this.handlers=[hui.ui.VideoPlayer.HTML5,hui.ui.VideoPlayer.QuickTime,hui.ui.VideoPlayer.Embedded];this.handler=null;hui.ui.extend(this);if(this.options.video){if(this.placeholder){hui.listen(this.placeholder,"click",function(){this.setVideo(this.options.video)}.bind(this))}else{hui.ui.onReady(function(){this.setVideo(this.options.video)}.bind(this))}}};hui.ui.VideoPlayer.prototype={setVideo:function(a){if(this.placeholder){this.placeholder.style.display="none"}this.handler=this.getHandler(a);this.element.appendChild(this.handler.element);if(this.handler.showController()){this.buildController()}},getHandler:function(c){for(var a=0;a<this.handlers.length;a++){var b=this.handlers[a];if(b.isSupported(c)){return new b(c,this)}}},buildController:function(){var a=hui.build("div",{"class":"hui_videoplayer_controller",parent:this.element});this.playButton=hui.build("a",{href:"javascript:void(0);","class":"hui_videoplayer_playpause",text:"wait!",parent:a});hui.listen(this.playButton,"click",this.playPause.bind(this));this.status=hui.build("span",{"class":"hui_videoplayer_status",parent:a})},onCanPlay:function(){this.playButton.update("Play")},onLoad:function(){this.state.loaded=this.state.duration;this.updateStatus()},onDurationChange:function(a){this.state.duration=a;this.updateStatus()},onTimeChange:function(a){this.state.time=a;this.updateStatus()},onLoadProgressChange:function(a){this.state.loaded=a;this.updateStatus()},playPause:function(){if(this.handler.isPlaying()){this.pause()}else{this.play()}},play:function(){this.handler.play()},pause:function(){this.handler.pause()},updateStatus:function(){this.status.innerHTML=this.state.time+" / "+this.state.duration+" / "+this.state.loaded}};hui.ui.VideoPlayer.HTML5=function(b,a){var c=this.element=hui.build("video",{width:b.width,height:b.height,src:b.src});hui.listen(c,"load",a.onLoad.bind(a));hui.listen(c,"canplay",a.onCanPlay.bind(a));hui.listen(c,"durationchange",function(d){a.onDurationChange(c.duration)});hui.listen(c,"timeupdate",function(){a.onTimeChange(this.element.currentTime)}.bind(this))};hui.ui.VideoPlayer.HTML5.isSupported=function(a){if(hui.browser.webkitVersion>528&&(a.type==="video/quicktime"||a.type==="video/mp4")){return true}return false};hui.ui.VideoPlayer.HTML5.prototype={showController:function(){return true},pause:function(){this.element.pause()},play:function(){this.element.play()},getTime:function(){return this.element.currentTime},isPlaying:function(){return !this.element.paused}};hui.ui.VideoPlayer.QuickTime=function(b,a){this.player=a;var c=this.element=hui.build("object",{width:b.width,height:b.height,data:b.src,type:"video/quicktime"});c.innerHTML='<param value="false" name="controller"/><param value="true" name="enablejavascript"/><param value="undefined" name="posterframe"/><param value="false" name="showlogo"/><param value="false" name="autostart"/><param value="true" name="cache"/><param value="white" name="bgcolor"/><param value="false" name="aggressivecleanup"/><param value="true" name="saveembedtags"/><param value="true" name="postdomevents"/>';hui.listen(c,"qt_canplay",a.onCanPlay.bind(a));hui.listen(c,"qt_load",a.onLoad.bind(a));hui.listen(c,"qt_progress",function(){a.onLoadProgressChange(c.GetMaxTimeLoaded()/3000)});hui.listen(c,"qt_durationchange",function(d){a.onDurationChange(c.GetDuration()/3000)});hui.listen(c,"qt_timechanged",function(){a.onTimeChange(c.GetTime())})};hui.ui.VideoPlayer.QuickTime.isSupported=function(a){return a.html==undefined};hui.ui.VideoPlayer.QuickTime.prototype={showController:function(){return true},pause:function(){window.clearInterval(this.observer);this.element.Stop()},play:function(){this.element.Play();this.observer=window.setInterval(this.observeVideo.bind(this),100)},observeVideo:function(){this.player.onTimeChange(this.element.GetTime()/3000)},getTime:function(){return this.element.GetTime()},isPlaying:function(){return this.element.GetRate()!==0}};hui.ui.VideoPlayer.Embedded=function(b,a){this.element=hui.build("div",{width:b.width,height:b.height,html:b.html})};hui.ui.VideoPlayer.Embedded.isSupported=function(a){return a.html!==undefined};hui.ui.VideoPlayer.Embedded.prototype={showController:function(){return false},pause:function(){},play:function(){},getTime:function(){},isPlaying:function(){}};hui.ui.Segmented=function(a){this.options=hui.override({value:null,allowNull:false},a);this.element=hui.get(a.element);this.name=a.name;this.value=this.options.value;hui.ui.extend(this);hui.listen(this.element,"mousedown",this._click.bind(this))};hui.ui.Segmented.create=function(c){var g=c.element=hui.build("span",{"class":"hui_segmented hui_segmented_standard"});if(c.items){for(var d=0;d<c.items.length;d++){var f=c.items[d];var b=hui.build("a",{parent:g,href:"javascript://",rel:f.value});if(f.icon){b.appendChild(hui.ui.createIcon(f.icon,16))}if(f.text){hui.build("span",{"class":"hui_segmented_text",text:f.text,parent:b})}if(c.value!==undefined&&c.value==f.value){hui.cls.add(b,"hui_segmented_selected")}}}return new hui.ui.Segmented(c)};hui.ui.Segmented.prototype={_click:function(g){g=new hui.Event(g);var c=g.findByTag("a");if(c){var h=false;var f=c.getAttribute("rel");var b=hui.get.byClass(this.element,"hui_segmented_selected");for(var d=0;d<b.length;d++){hui.cls.remove(b[d],"hui_segmented_selected")}if(f===this.value&&this.options.allowNull){h=true;this.value=null}else{hui.cls.add(c,"hui_segmented_selected");h=this.value!==f;this.value=f}if(h){this.fireValueChange()}}},setValue:function(c){if(c===undefined){c=null}var a=this.element.getElementsByTagName("a");this.value=null;for(var b=0;b<a.length;b++){if(a[b].getAttribute("rel")===c){hui.cls.add(a[b],"hui_segmented_selected");this.value=c}else{hui.cls.remove(a[b],"hui_segmented_selected")}}},getValue:function(){return this.value}};hui.ui.Flash={fullVersion:undefined,getMajorVersion:function(){var b=this.getFullVersion();if(b===null||b===undefined){return null}var a=(b+"").match(/[0-9]+/gi);return a.length>0?parseInt(a[0]):null},getFullVersion:function(){if(this.fullVersion!==undefined){return this.fullVersion}var g=null;if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var f=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"";var a=navigator.plugins["Shockwave Flash"+f].description;var e=a.split(" ");var c=e[2].split(".");var h=c[0];var b=c[1];var d=e[3];if(d==""){d=e[4]}if(d[0]=="d"){d=d.substring(1)}else{if(d[0]=="r"){d=d.substring(1);if(d.indexOf("d")>0){d=d.substring(0,d.indexOf("d"))}}}g=h+"."+b+"."+d}}else{if(navigator.userAgent.toLowerCase().indexOf("webtv/2.6")!=-1){g=4}else{if(navigator.userAgent.toLowerCase().indexOf("webtv/2.5")!=-1){g=3}else{if(navigator.userAgent.toLowerCase().indexOf("webtv")!=-1){g=2}else{if(hui.browser.msie){g=this.getActiveXVersion()}}}}}this.fullVersion=g;return g},getActiveXVersion:function(){var a;var b;var c;try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");a=b.GetVariable("$version")}catch(c){}if(!a){try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");a="WIN 6,0,21,0";b.AllowScriptAccess="always";a=b.GetVariable("$version")}catch(c){}}if(!a){try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");a=b.GetVariable("$version")}catch(c){}}if(!a){try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");a="WIN 3,0,18,0"}catch(c){}}if(!a){try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");a="WIN 2,0,0,11"}catch(c){a=-1}}return a}};hui.ui.Link=function(a){this.options=a;this.name=a.name;this.element=hui.get(a.element);hui.ui.extend(this);this.addBehavior()};hui.ui.Link.prototype={addBehavior:function(){var a=this;hui.listen(this.element,"click",function(b){hui.stop(b);window.setTimeout(function(){a.fire("click")})})}};hui.ui.Links=function(a){this.options=a;this.element=hui.get(a.element);this.name=a.name;hui.ui.extend(this);this.items=[];this.addBehavior();this.selectedIndex=null;this.inputs={}};hui.ui.Links.prototype={addBehavior:function(){hui.listen(this.element,"click",this.onClick.bind(this));hui.listen(this.element,"dblclick",this.onDblClick.bind(this))},reset:function(){this.setValue([])},setValue:function(a){this.items=a;this.selectedIndex=null;this.build()},getValue:function(){return this.items},onDblClick:function(d){d=new hui.Event(d);hui.selection.clear();d.stop(d);var b=this.selectAndGetRow(d);var a={text:b.text};a[b.kind]=b.value;this.editedLink=b;var c=this.getEditWindow();this.editForm.reset();this.editForm.setValues(a);c.show()},onClick:function(b){b=new hui.Event(b);b.stop();var a=b.getElement();if(hui.cls.has(a,"hui_links_remove")){var c=b.findByClass("hui_links_row");hui.ui.confirmOverlay({element:a,text:"Vil du fjerne linket?",okText:"Ja, fjern",cancelText:"Annuller",onOk:function(){this.items.splice(c.hui_index,1);if(this.selectedIndex===c.hui_index){this.selectedIndex=null}this.build()}.bind(this)})}else{this.selectAndGetRow(b)}},selectAndGetRow:function(c){var d=c.findByClass("hui_links_row");if(d){var b=d.hui_index;if(this.selectedIndex!==null){var a=hui.get.byClass(this.element,"hui_links_row")[this.selectedIndex];hui.cls.remove(a,"hui_links_row_selected")}this.selectedIndex=b;hui.cls.add(d,"hui_links_row_selected");return this.items[b]}},build:function(){var e=this.list||hui.get.firstByClass(this.element,"hui_links_list"),b,d,g,c,f,a;e.innerHTML="";for(b=0;b<this.items.length;b++){d=this.items[b];g=hui.build("div",{"class":"hui_links_row"});g.hui_index=b;g.appendChild(hui.ui.createIcon(d.icon,16));f=hui.build("div",{"class":"hui_links_text",text:d.text});g.appendChild(f);c=hui.build("div",{"class":"hui_links_info",text:hui.string.wrap(d.info)});g.appendChild(c);a=hui.ui.createIcon("monochrome/delete",16);hui.cls.add(a,"hui_links_remove");g.appendChild(a);e.appendChild(g)}},addLink:function(){this.editedLink=null;this.getEditWindow().show();this.editForm.reset();this.editForm.focus()},getEditWindow:function(){if(!this.editWindow){var f=this.editWindow=hui.ui.Window.create({title:"Link",width:300,padding:5});var e=this.editForm=hui.ui.Formula.create();var d=e.buildGroup({above:false},[{label:"Tekst",type:"TextField",options:{key:"text"}}]);var c=hui.ui.TextField.create({key:"url"});d.add(c,"URL");this.inputs.url=c;var b=hui.ui.TextField.create({key:"email"});d.add(b,"E-mail");this.inputs.email=b;page=hui.ui.DropDown.create({key:"page",source:this.options.pageSource});d.add(page,"Side");this.inputs.page=page;file=hui.ui.DropDown.create({key:"file",source:this.options.fileSource});d.add(file,"Fil");this.inputs.file=file;var a=this;hui.each(this.inputs,function(g,h){h.listen({$valueChanged:function(){a.changeType(g)}})});d.createButtons().add(hui.ui.Button.create({text:"Gem",submit:true,highlighted:true}));this.editForm.listen({$submit:this.saveLink.bind(this)});f.add(e);if(this.options.pageSource){this.options.pageSource.refresh()}if(this.options.fileSource){this.options.fileSource.refresh()}}return this.editWindow},saveLink:function(){var a=this.editForm.getValues();var b=this.valuesToLink(a);var c=this.editedLink;if(c){hui.override(c,b)}else{this.items.push(b)}this.build();this.editForm.reset();this.editWindow.hide();this.editedLink=null},valuesToLink:function(a){var b={};b.text=a.text;if(a.email!=""){b.kind="email";b.value=a.email;b.info=a.email;b.icon="monochrome/email"}else{if(a.url!=""){b.kind="url";b.value=a.url;b.info=a.url;b.icon="monochrome/globe"}else{if(hui.isDefined(a.page)){b.kind="page";b.value=a.page;b.info=this.inputs.page.getItem().title;b.icon="common/page"}else{if(hui.isDefined(a.file)){b.kind="file";b.value=a.file;b.info=this.inputs.file.getItem().title;b.icon="monochrome/file"}}}}return b},changeType:function(a){hui.each(this.inputs,function(b,c){if(b!=a){c.setValue()}})}};hui.ui.MarkupEditor=function(a){this.name=a.name;this.options=a=hui.override({debug:false,value:"",autoHideToolbar:true},a);if(a.replace){a.replace=hui.get(a.replace);a.element=hui.build("div",{"class":"hui_markupeditor "+a.replace.className});a.replace.parentNode.insertBefore(a.element,a.replace);a.replace.style.display="none";a.value=this.options.replace.innerHTML}this.ready=false;this.pending=[];this.element=hui.get(a.element);if(hui.browser.msie){this.impl=hui.ui.MarkupEditor.MSIE}else{this.impl=hui.ui.MarkupEditor.webkit}this.impl.initialize({element:this.element,controller:this,$ready:this._ready.bind(this)});if(a.value){this.setValue(a.value)}hui.ui.extend(this)};hui.ui.MarkupEditor.create=function(a){a=a||{};a.element=hui.build("div",{className:"hui_markupeditor"});return new hui.ui.MarkupEditor(a)};hui.ui.MarkupEditor.prototype={_ready:function(){this.ready=true;for(var a=0;a<this.pending.length;a++){this.pending[a]()}},implFocused:function(){this._showBar()},implBlurred:function(){this.bar.hide();this.fire("blur")},implValueChanged:function(){this._valueChanged()},implSelectionChanged:function(){if(this.options.linkDelegate){this.options.linkDelegate.$cancel()}this._highlightNode(null);this.temporaryLink=null;this._valueChanged();this._refreshInfoWindow();this.bar&&this.bar.setBlock(this._getFirstBlock())},_getFirstBlock:function(){var c=this.impl.getPath();var d=["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE"];for(var b=c.length-1;b>=0;b--){var a=c[b].tagName;if(d.indexOf(a)!==-1){return c[b]}}return null},destroy:function(){hui.dom.remove(this.element);if(this.options.replace){this.options.replace.style.display=""}var a=["colorPicker","_infoWindow","bar","impl"];for(var b=a.length-1;b>=0;b--){if(this[a[b]]){this[a[b]].destroy()}}},getValue:function(){return this.impl.getHTML()},setValue:function(a){this._whenReady(function(){this.impl.setHTML(a)}.bind(this))},focus:function(){this._whenReady(this.impl.focus.bind(this.impl))},_whenReady:function(a){if(this.ready){a()}else{this.pending.push(a)}},_showBar:function(){if(!this.bar){this.bar=new hui.ui.MarkupEditor.Bar({$clickButton:this._buttonClicked.bind(this),$changeBlock:this._changeBlock.bind(this)})}this.bar.show(this)},_buttonClicked:function(a){this.impl.saveSelection();if(a.key=="color"){this._showColorPicker()}else{if(a.key=="addLink"){this._showLinkEditor()}else{if(a.key=="align"){this.impl.align(a.value)}else{if(a.key=="clear"){this.impl.removeFormat()}else{if(a.key=="info"){this._toggleInfoWindow()}else{this.impl.format(a)}}}}}this._valueChanged();this._refreshInfoWindow();this.impl.restoreSelection();this.impl._selectionChanged()},_changeBlock:function(a){var b=this._getFirstBlock();if(b){b=hui.dom.changeTag(b,a);this.impl.selectNode(b)}},_showColorPicker:function(){if(!this.colorPicker){this.colorPicker=hui.ui.Window.create({title:{en:"Color",da:"Farve"}});var a=hui.ui.ColorPicker.create();a.listen(this);this.colorPicker.add(a);this.colorPicker.listen({$userClosedWindow:function(){this.impl.restoreSelection()}.bind(this)})}this.colorPicker.show({avoid:this.element})},_highlightNode:function(a){if(this._highlightedNode){hui.cls.remove(this._highlightedNode,"hui_markupeditor_highlighted")}this._highlightedNode=a;if(a){hui.cls.add(a,"hui_markupeditor_highlighted")}},_showLinkEditor:function(){this.temporaryLink=this.impl.getOrCreateLink();this._highlightNode(this.temporaryLink);if(this.options.linkDelegate){var b=this.options.linkDelegate;b.$editLink({node:this.temporaryLink,$changed:function(){this._highlightNode(null);this.temporaryLink=null;this._valueChanged()}.bind(this),$cancel:function(){this._highlightNode(null);this.temporaryLink=null;this._valueChanged()}.bind(this),$remove:function(){this.impl._unWrap(this.temporaryLink);this.impl._selectionChanged()}.bind(this)})}else{if(!this.linkEditor){this.linkEditor=hui.ui.Window.create({padding:5,width:300});this.linkForm=hui.ui.Formula.create();this.linkEditor.add(this.linkForm);var d=this.linkForm.buildGroup({},[{type:"TextField",options:{key:"url",label:"Address:"}}]);var c=d.createButtons();var a=hui.ui.Button.create({text:"OK",submit:true});this.linkForm.listen({$submit:this._updateLink.bind(this)});c.add(a)}}if(this.linkEditor){this.linkForm.setValues({url:this.temporaryLink.href});this.linkEditor.show({avoid:this.element});this.linkForm.focus()}},_updateLink:function(){var a=this.linkForm.getValues();this.temporaryLink.href=a.url;this.linkForm.reset();this.temporaryLink=null;this.linkEditor.hide();this._valueChanged()},_valueChanged:function(){this.fire("valueChanged",this.impl.getHTML());this._refreshInfoWindow()},_toggleInfoWindow:function(){if(!this._infoWindow){this._infoWindow=new hui.ui.MarkupEditor.Info({editor:this})}this._infoWindow.toggle();this._refreshInfoWindow()},_refreshInfoWindow:function(){if(!this._infoWindow){return}this._infoWindow.updatePath(this.impl.getPath())},$colorWasSelected:function(a){this.impl.restoreSelection(function(){this.impl.colorize(a);this._valueChanged()}.bind(this))},$$parentMoved:function(){if(this.bar){this.bar.place(this)}}};hui.ui.MarkupEditor.Bar=function(a){this.options=a;this._initialize();hui.ui.extend(this)};hui.ui.MarkupEditor.Bar.prototype={_initialize:function(){var b=[{key:"bold",icon:"edit/text_bold"},{key:"italic",icon:"edit/text_italic"},{divider:true},{key:"color",icon:"common/color"},{key:"addLink",icon:"monochrome/link"},{divider:true},{key:"align",value:"left",icon:"edit/text_align_left"},{key:"align",value:"center",icon:"edit/text_align_center"},{key:"align",value:"right",icon:"edit/text_align_right"},{key:"align",value:"justify",icon:"edit/text_align_justify"},{divider:true},{key:"clear",icon:"edit/clear"},{key:"info",icon:"monochrome/info"}];this.bar=hui.ui.Bar.create({absolute:true,variant:"mini",small:true});var a=this.blockSelector=hui.ui.DropDown.create({focus:false,variant:"bar_mini",items:[{value:"h1",text:"Header 1"},{value:"h2",text:"Header 2"},{value:"h3",text:"Header 3"},{value:"h4",text:"Header 4"},{value:"h5",text:"Header 5"},{value:"h6",text:"Header 6"},{value:"p",text:"Paragraph"},{value:"div",text:"Division"},{value:"blockquote",text:"Blockquote"}]});this.bar.add(a);a.listen({$valueChanged:function(c){this.options.$changeBlock(c)}.bind(this)});hui.each(b,function(d){if(d.divider){this.bar.addDivider();return}var c=new hui.ui.Bar.Button.create({icon:d.icon,stopEvents:true});c.listen({$mousedown:function(){this.options.$clickButton(d)}.bind(this)});this.bar.add(c)}.bind(this));this.bar.addToDocument()},show:function(a){this.bar.placeAbove(a);this.bar.show()},place:function(a){this.bar.placeAbove(a)},hide:function(){this.bar.hide()},setBlock:function(a){if(a){this.blockSelector.setValue(a.tagName.toLowerCase())}},destroy:function(){this.bar.destroy()}};hui.ui.MarkupEditor.Info=function(a){this.options=a;this._initialize()};hui.ui.MarkupEditor.Info.prototype={_initialize:function(){this._window=hui.ui.Window.create({title:"Info",width:400});this._css=hui.ui.CodeInput.create();this._css.listen({$valueChanged:function(a){if(!this.tag){return}this.tag.setAttribute("style",a)}.bind(this)});this._window.add(this._css);this._path=hui.build("div",{"class":"hui_markupeditor_path"});this._window.add(this._path)},toggle:function(){this._window.toggle({avoid:this.options.editor.element})},updatePath:function(c){var b="";for(var a=c.length-1;a>=0;a--){b+='<a data-index="'+a+'" href="javascript://">'+c[a].tagName+"</a> "}this._path.innerHTML=b;this.tag=c[0];this._css.setValue(this.tag?this.tag.getAttribute("style"):"")},destroy:function(){this._window.destroy()}};hui.ui.MarkupEditor.webkit={path:[],initialize:function(a){this.element=a.element;hui.style.set(this.element,a.controller.options.style);this.element.style.overflow="auto";this.element.contentEditable=true;var b=this.controller=a.controller;hui.listen(this.element,"focus",function(){b.implFocused()});hui.listen(this.element,"blur",function(){b.implBlurred()});hui.listen(this.element,"keyup",this._change.bind(this));hui.listen(this.element,"mouseup",this._change.bind(this));a.$ready()},saveSelection:function(){},restoreSelection:function(a){if(a){a()}},focus:function(){this.element.focus();this._selectionChanged();this.controller.implFocused()},format:function(b){if(b.key=="strong"||b.key=="em"){this._wrapInTag(b.key)}else{if(b.key=="insert-table"){this._insertHTML("<table><tbody><tr><td>Lorem ipsum dolor</td><td>Lorem ipsum dolor</td></tr></tbody></table>")}else{document.execCommand(b.key,null,b.value);var a=this._getSelectedNode();if(a.tagName=="B"){a=hui.dom.changeTag(a,"strong");this.selectNode(a)}else{if(a.tagName=="I"){a=hui.dom.changeTag(a,"em");this.selectNode(a)}}this.controller._valueChanged()}}this._selectionChanged()},selectNode:function(a){window.getSelection().selectAllChildren(a);this._selectionChanged()},getOrCreateLink:function(){var a=this._getSelectedNode();if(a&&a.tagName.toLowerCase()=="a"){return a}document.execCommand("createLink",null,"#");this._selectionChanged();return this._getSelectedNode()},_getSelectedNode:function(){var c=window.getSelection();var a=c.getRangeAt(0);var b=a.commonAncestorContainer;if(!hui.dom.isElement(b)){b=b.parentNode}return b},colorize:function(a){document.execCommand("forecolor",null,a);var c=this._getSelectedNode();if(c.tagName=="FONT"){c=hui.dom.changeTag(c,"span");c.style.color=a;c.removeAttribute("color");var b=window.getSelection();b.selectAllChildren(c)}this._selectionChanged()},align:function(b){var a={center:"justifycenter",justify:"justifyfull",left:"justifyleft",right:"justifyright"};document.execCommand(a[b],null,null);this._updateInlinePanel()},_change:function(){this.controller.implValueChanged();this._selectionChanged()},_wrapInTag:function(a){var d=window.getSelection();if(d.rangeCount<1){return}var b=d.getRangeAt(0);var c=b.commonAncestorContainer;if(!hui.dom.isElement(c)){c=c.parentNode}if(c.tagName.toLowerCase()==a){this._unWrap(c)}else{var e=document.createElement(a);b.surroundContents(e);d.selectAllChildren(e)}this._selectionChanged()},_getInlineTag:function(){var a=window.getSelection();if(a.rangeCount<1){return}},removeLink:function(a){this._unWrap(a);this._selectionChanged()},_unWrap:function(b){var d=b.childNodes;for(var a=0;a<d.length;a++){b.parentNode.insertBefore(d[a],b)}b.parentNode.removeChild(b)},_insertHTML:function(a){document.execCommand("inserthtml",null,a)},_getAncestor:function(){var c=window.getSelection();if(c.rangeCount<1){return null}var a=c.getRangeAt(0);var b=a.commonAncestorContainer;if(!hui.dom.isElement(b)){b=b.parentNode}return b},_buildInlinePanel:function(){this._inlinePanel=hui.ui.BoundPanel.create({variant:"light"});var a=hui.build("div",{"class":"hui_markupeditor_inlinepanel",html:'<a href="javascript://" data="bold"><strong>Bold</strong></a><a href="javascript://" data="italic"><em>Italic</em></a>'});hui.listen(a,"mousedown",function(c){c=hui.event(c);c.stop();var b=c.findByTag("a");if(b){this.saveSelection();this.format({key:b.getAttribute("data")});this.restoreSelection();this._selectionChanged()}}.bind(this));this._inlinePanel.add(a)},_updateInlinePanel:function(){var c=window.getSelection();this._inlinePanel||this._buildInlinePanel();if(c.rangeCount<1){this._inlinePanel.hide();return}var b=c.getRangeAt(0);if(b.startOffset==b.endOffset){this._inlinePanel.hide();return}var a=b.getClientRects();if(a.length>0){var d=a[0];this._inlinePanel.position({rect:d,position:"vertical"});this._inlinePanel.show()}},_selectionChanged:function(){var d=window.getSelection();var f=this._hash(d);var c=d.anchorNode?d.anchorNode.parentNode:null;var b=this._latestSelection;if(b){if(c==b.node&&b.hash==f){return}}this._latestSelection={node:c,hash:f};var e=[],a=this._getAncestor();while(a&&a!==this.element){e.push(a);a=a.parentNode}this.path=e;this.controller.implSelectionChanged();this._updateInlinePanel()},_storeSelection:function(a){},_hash:function(a){return a.anchorOffset+":"+a.baseOffset+":"+a.extentOffset},removeFormat:function(){document.execCommand("removeFormat",null,null);this._selectionChanged()},setHTML:function(a){this.element.innerHTML=a},getHTML:function(){var a=hui.ui.MarkupEditor.util.clean(this.element);return a.innerHTML},getPath:function(){return this.path},destroy:function(){if(this._inlinePanel){this._inlinePanel.destroy()}}};hui.ui.MarkupEditor.MSIE={initialize:function(a){this.element=a.element;this.iframe=hui.build("iframe",{style:"display:block; width: 100%; border: 0;",parent:this.element});hui.listen(this.iframe,"load",function(){this._load();a.$ready()}.bind(this));this.controller=a.controller},saveSelection:function(){this.savedRange=this.document.selection.createRange()},restoreSelection:function(a){window.setTimeout(function(){this.body.focus();this.savedRange.select();if(a){a()}}.bind(this))},_load:function(){this.document=hui.frame.getDocument(this.iframe);this.body=this.document.body;this.body.contentEditable=true;hui.listen(this.body,"keyup",this._keyUp.bind(this));hui.listen(this.body,"mouseup",this._mouseUp.bind(this))},_keyUp:function(){this.controller.implValueChanged();this.saveSelection()},_mouseUp:function(){this.saveSelection()},focus:function(){this.body.focus();this.controller.implFocused()},align:function(b){var a={center:"justifycenter",justify:"justifyfull",left:"justifyleft",right:"justifyright"};this.document.execCommand(a[b],null,null)},format:function(a){if(a.key=="strong"||a.key=="em"){this._wrapInTag(a.key)}else{if(a.key=="insert-table"){this._insertHTML("<table><tbody><tr><td>Lorem ipsum dolor</td><td>Lorem ipsum dolor</td></tr></tbody></table>")}else{this.document.execCommand(a.key,null,null)}}},removeFormat:function(){this.document.execCommand("removeFormat",null,null)},colorize:function(a){this.document.execCommand("forecolor",null,a);this.restoreSelection()},_wrapInTag:function(a){document.execCommand("inserthtml",null,"<"+a+">"+hui.string.escape(hui.selection.getText())+"</"+a+">")},_insertHTML:function(a){document.execCommand("inserthtml",null,a)},setHTML:function(a){this.body.innerHTML=a},getHTML:function(){var a=hui.ui.MarkupEditor.util.clean(this.body);return a.innerHTML},getPath:function(){return[]},destroy:function(){}};hui.ui.MarkupEditor.util={clean:function(c){var d=c.cloneNode(true);this.replaceNodes(d,{b:"strong",i:"em",font:"span"});var b=hui.get.byClass(d,"Apple-style-span");for(var a=b.length-1;a>=0;a--){b[a].removeAttribute("class")}this.convertAttributesToStyle(d);return d},replaceNodes:function(c,k){for(var l in k){var m=c.getElementsByTagName(l);for(var f=m.length-1;f>=0;f--){var h=m[f];var b=document.createElement(k[l]);var d=m[f].getAttribute("color");if(d){b.style.color=d}hui.dom.replaceNode(h,b);var a=h.childNodes;for(var e=0;e<a.length;e++){var g=h.removeChild(a[e]);b.appendChild(g)}}}},convertAttributesToStyle:function(c){var b=c.getElementsByTagName("*");for(var a=0;a<b.length;a++){var e=b[a];var d=e.getAttribute("align");if(d){e.style.textAlign=d;e.removeAttribute("align")}}}};hui.ui.ColorPicker=function(a){this.options=a||{};this.name=a.name;this.element=hui.get(a.element);this.color=null;this.buttons=[];this.preview=hui.get.firstByClass(this.element,"hui_colorpicker_preview");this.pages=hui.get.byClass(this.element,"hui_colorpicker_page");this.input=hui.get.firstByTag(this.element,"input");this.wheel1=this.pages[0];this.wheel2=this.pages[1];this.wheel3=this.pages[2];this.swatches=this.pages[3];hui.ui.extend(this);if(a.listener){this.listen(a.listener)}this.addBehavior();this.buildData()};hui.ui.ColorPicker.create=function(d){var a="",g,f,b;for(var e=0;e<360;e+=30){for(b=0.05;b<=1;b+=0.15){g=hui.Color.hsv2rgb(e,b,1);f=hui.Color.rgb2hex(g);a+='<a style="background: rgb('+g[0]+","+g[1]+","+g[2]+')" rel="'+f+'"></a>'}for(b=1;b>=0.2;b-=0.15){g=hui.Color.hsv2rgb(e,1,b);f=hui.Color.rgb2hex(g);a+='<a style="background: rgb('+g[0]+","+g[1]+","+g[2]+')" rel="'+f+'"></a>'}}for(b=255;b>=0;b-=255/12){f=hui.Color.rgb2hex([b,b,b]);a+='<a style="background: rgb('+Math.round(b)+","+Math.round(b)+","+Math.round(b)+')" rel="'+f+'"></a>'}d=d||{};d.element=hui.build("div",{"class":"hui_colorpicker",html:'<div class="hui_bar hui_bar_window_mini"><div class="hui_bar_body"><a class="hui_bar_button hui_bar_button_selected" href="javascript:void(0)" rel="0"><span class="hui_icon_16" style="background: url('+hui.ui.getIconUrl("colorpicker/wheel_pastels",16)+')"></span></a><a class="hui_bar_button" href="javascript:void(0)" rel="1"><span class="hui_icon_16" style="background: url('+hui.ui.getIconUrl("colorpicker/wheel_brightness",16)+')"></span></a><a class="hui_bar_button" href="javascript:void(0)" rel="2"><span class="hui_icon_16" style="background: url('+hui.ui.getIconUrl("colorpicker/wheel_saturated",16)+')"></span></a><a class="hui_bar_button" href="javascript:void(0)" rel="3"><span class="hui_icon_16" style="background: url('+hui.ui.getIconUrl("colorpicker/swatches",16)+')"></span></a><input class="hui_colorpicker"/></div></div><div class="hui_colorpicker_pages"><div class="hui_colorpicker_page hui_colorpicker_wheel1"></div><div class="hui_colorpicker_page hui_colorpicker_wheel2"></div><div class="hui_colorpicker_page hui_colorpicker_wheel3"></div><div class="hui_colorpicker_page hui_colorpicker_swatches">'+a+'</div></div><div class="hui_colorpicker_preview"></div>'});return new hui.ui.ColorPicker(d)};hui.ui.ColorPicker.prototype={addBehavior:function(){var a=hui.get.byClass(this.element,"hui_bar_button");for(var c=0;c<a.length;c++){var b=new hui.ui.Bar.Button({element:a[c]});b.listen(this);this.buttons.push(b)}hui.listen(this.element,"click",this._click.bind(this));hui.listen(this.wheel1,"mousemove",this._hoverWheel1.bind(this));hui.listen(this.wheel1,"click",this._pickColor.bind(this));hui.listen(this.wheel2,"mousemove",this._hoverWheel2.bind(this));hui.listen(this.wheel2,"click",this._pickColor.bind(this));hui.listen(this.wheel3,"mousemove",this._hoverWheel3.bind(this));hui.listen(this.wheel3,"click",this._pickColor.bind(this));hui.listen(this.element,"mousedown",function(d){hui.stop(d)});hui.listen(this.swatches,"mousemove",function(d){d=hui.event(d);this._hoverColor(d.element.getAttribute("rel"))}.bind(this));hui.listen(this.swatches,"click",this._pickColor.bind(this))},$click:function(b){var c=parseInt(b.element.getAttribute("rel")),a;for(a=this.pages.length-1;a>=0;a--){this.pages[a].style.display=a==c?"block":"none"}for(a=0;a<this.buttons.length;a++){this.buttons[a].setSelected(this.buttons[a]==b)}},_click:function(b){b=hui.event(b);b.stop();var a=b.findByTag("input");if(a){a.focus()}},_pickColor:function(a){hui.stop(a);this.fire("colorWasSelected",this.color)},_hoverColor:function(a){this.preview.style.background=a;this.color=a;this.fire("colorWasHovered",this.color);this.input.value=a},buildData:function(){var a=new Array();a[0]=new Array(0,1,0);a[1]=new Array(-1,0,0);a[2]=new Array(0,0,1);a[3]=new Array(0,-1,0);a[4]=new Array(1,0,0);a[5]=new Array(0,0,-1);a[6]=new Array(255,1,1);var e=new Array(360);for(var d=0;d<6;d++){for(var c=0;c<60;c++){e[60*d+c]=new Array(3);for(var b=0;b<3;b++){e[60*d+c][b]=a[6][b];a[6][b]+=(a[d][b]*4)}}}this.colorArray=e},_hoverWheel1:function(v){v=hui.event(v);var b=hui.position.get(this.wheel1);var h=4*(v.getLeft()-b.left);var f=4*(v.getTop()-b.top);var m=h-512;var k=f-512;var B=(m<0)?0:1;var A=(k<0)?0:1;var o=2*A+B;var g=new Array(-180,360,180,0);var u=Math.abs(m);var a=Math.abs(k);var w=a*45/u;if(a>u){w=90-(u*45/a)}var j=Math.floor(Math.abs(g[o]-w));m=Math.abs(h-512);k=Math.abs(f-512);var l=Math.sqrt((m*m)+(k*k));if(h==512&f==512){var z="000000"}else{var p=0;for(var t=0;t<3;t++){var s=this.colorArray[j][t]*l/256;if(l>256){s+=Math.floor(l-256)}if(s>255){s=255}p=256*p+Math.floor(s)}z=p.toString(16)}while(z.length<6){z="0"+z}this._hoverColor("#"+z)},_hoverWheel2:function(k){var l,f,d;k=hui.event(k);var m=hui.position.get(this.wheel2);var o=(k.getLeft()-m.left);var n=(k.getTop()-m.top);if(n>256){return}var h=o-128;var g=128-n;var j=h*h;var c=g*g;var b=Math.sqrt(j+c);var a=b/128;if(b==0){f=0;d=0;l=new Array(0,0,0)}else{var i=Math.acos(h/b);var q=(g>=0)?i:2*Math.PI-i;var p=360*q/(2*Math.PI);if(a>1){l=new Array(255,255,255);f=1;d=1}else{if(a>=0.5){f=1-((a-0.5)*2);d=1;l=hui.Color.hsv2rgb(p,f,d)}else{f=1;d=a*2;l=hui.Color.hsv2rgb(p,f,d)}}}this._hoverColor(hui.Color.rgb2hex(l))},_hoverWheel3:function(k){var l,f,d;k=hui.event(k);var m=hui.position.get(this.wheel3);var o=(k.getLeft()-m.left);var n=(k.getTop()-m.top);if(n>256){return}var h=o-128;var g=128-n;var j=h*h;var c=g*g;var b=Math.sqrt(j+c);var a=b/128;if(b==0){f=0;d=0;l=new Array(0,0,0)}else{var i=Math.acos(h/b);var q=(g>=0)?i:2*Math.PI-i;var p=360*q/(2*Math.PI);if(a>1){l=new Array(255,255,255);f=1;d=1}else{f=a;d=1;l=hui.Color.hsv2rgb(p,f,d)}}this._hoverColor(hui.Color.rgb2hex(l))}};hui.ui.LocationField=function(a){this.options=hui.override({value:null},a);this.name=a.name;this.element=hui.get(a.element);this.chooser=hui.get.firstByTag(this.element,"a");this.latField=new hui.ui.Input({element:hui.get.firstByTag(this.element,"input"),validator:new hui.ui.NumberValidator({min:-90,max:90,allowNull:true})});this.latField.listen(this);this.lngField=new hui.ui.Input({element:this.element.getElementsByTagName("input")[1],validator:new hui.ui.NumberValidator({min:-180,max:180,allowNull:true})});this.lngField.listen(this);this.value=this.options.value;hui.ui.extend(this);this.setValue(this.value);this._addBehavior()};hui.ui.LocationField.create=function(c){c=c||{};var d=c.element=hui.build("span",{"class":"hui_locationfield"});var a=hui.build("span",{html:'<span class="hui_locationfield_latitude"><span><input/></span></span><span class="hui_locationfield_longitude"><span><input/></span></span>'});d.appendChild(hui.ui.wrapInField(a));d.appendChild(hui.build("a",{"class":"hui_locationfield_picker",href:"javascript:void(0);"}));return new hui.ui.LocationField(c)};hui.ui.LocationField.prototype={_addBehavior:function(){hui.listen(this.chooser,"click",this._showPicker.bind(this));hui.ui.addFocusClass({element:this.latField.element,classElement:this.element,"class":"hui_field_focused"});hui.ui.addFocusClass({element:this.lngField.element,classElement:this.element,"class":"hui_field_focused"})},getLabel:function(){return this.options.label},reset:function(){this.setValue()},getValue:function(){return this.value},setValue:function(a){if(a){this.latField.setValue(a.latitude);this.lngField.setValue(a.longitude);this.value=a}else{this.latField.setValue();this.lngField.setValue();this.value=null}this._updatePicker()},_updatePicker:function(){if(this.picker){this.picker.setLocation(this.value)}},_showPicker:function(){if(!this.picker){this.picker=new hui.ui.LocationPicker();this.picker.listen(this)}this.picker.show({node:this.chooser,location:this.value})},$locationChanged:function(a){this.setValue(a);this.fire("valueChanged",this.value);hui.ui.callAncestors(this,"childValueChanged",this.value)},$valueChanged:function(){var b=this.latField.getValue();var a=this.lngField.getValue();if(b===null||a===null){this.value=null}else{this.value={latitude:b,longitude:a}}this._updatePicker();this.fire("valueChanged",this.value);hui.ui.callAncestors(this,"childValueChanged",this.value)}};hui.ui.StyleLength=function(c){this.options=hui.override({value:null,min:0,max:1000,units:["px","pt","em","%"],initialValue:null,defaultUnit:"px",allowNull:false},c);this.name=c.name;var b=this.element=hui.get(c.element);this.input=hui.get.firstByTag(b,"input");var a=b.getElementsByTagName("a");this.up=a[0];this.down=a[1];this.value=this.parseValue(this.options.value);hui.ui.extend(this);this._addBehavior()};hui.ui.StyleLength.create=function(a){a.element=hui.build("span",{"class":"hui_style_length hui_numberfield",html:'<span><span><input type="text"/><a class="hui_numberfield_up"></a><a class="hui_numberfield_down"></a></span></span>'});return new hui.ui.StyleLength(a)};hui.ui.StyleLength.prototype={_addBehavior:function(){var a=this.element;hui.listen(this.input,"focus",function(){hui.cls.add(a,"hui_numberfield_focused")});hui.listen(this.input,"blur",this._onBlur.bind(this));hui.listen(this.input,"keyup",this.keyEvent.bind(this));hui.listen(this.up,"mousedown",this._upEvent.bind(this));hui.listen(this.down,"mousedown",this._downEvent.bind(this))},parseValue:function(e){if(e===null||e===undefined){return null}var b=parseFloat(e,10);if(isNaN(b)){return null}var a={number:b,unit:this.options.defaultUnit};for(var c=0;c<this.options.units.length;c++){var d=this.options.units[c];if(e.indexOf(d)!=-1){a.unit=d;break}}a.number=Math.max(this.options.min,Math.min(this.options.max,a.number));return a},_onBlur:function(){hui.cls.remove(this.element,"hui_numberfield_focused");this._updateInput()},keyEvent:function(a){a=a||window.event;if(a.keyCode==hui.KEY_UP){hui.stop(a);this._upEvent()}else{if(a.keyCode==hui.KEY_DOWN){this._downEvent()}else{this._checkAndSetValue(this.parseValue(this.input.value))}}},_updateInput:function(){this.input.value=this.getValue()},_checkAndSetValue:function(b){var a=this.value;var c=false;if(a===null&&b===null){}else{if(a!=null&&b!=null&&a.number===b.number&&a.unit===b.unit){}else{c=true}}this.value=b;if(c){hui.ui.callAncestors(this,"childValueChanged",this.input.value);this.fire("valueChanged",this.getValue())}},_setInitialValue:function(){if(!this.value&&this.options.initialValue){this.setValue(this.options.initialValue)}},_downEvent:function(){this._setInitialValue();if(this.value){this._checkAndSetValue({number:Math.max(this.options.min,this.value.number-1),unit:this.value.unit})}else{this._checkAndSetValue({number:this.options.min,unit:this.options.defaultUnit})}this._updateInput()},_upEvent:function(){this._setInitialValue();if(this.value){this._checkAndSetValue({number:Math.min(this.options.max,this.value.number+1),unit:this.value.unit})}else{this._checkAndSetValue({number:this.options.min+1,unit:this.options.defaultUnit})}this._updateInput()},setInitialValue:function(a){this.options.initialValue=a},getValue:function(){return this.value?this.value.number+this.value.unit:""},setValue:function(a){this.value=this.parseValue(a);this._updateInput()},focus:function(){try{this.input.focus()}catch(a){}},reset:function(){this.setValue("")}};hui.ui.DateTimeField=function(a){this.inputFormats=["d-m-Y","d/m-Y","d/m/Y","d-m-Y H:i:s","d/m-Y H:i:s","d/m/Y H:i:s","d-m-Y H:i","d/m-Y H:i","d/m/Y H:i","d-m-Y H","d/m-Y H","d/m/Y H","d-m","d/m","d","Y","m-d-Y","m-d","m/d"];this.outputFormat="d-m-Y H:i:s";this.name=a.name;this.element=hui.get(a.element);this.input=hui.get.firstByTag(this.element,"input");this.options=hui.override({returnType:null,label:null,allowNull:true,value:null},a);this.value=this.options.value;hui.ui.extend(this);this._addBehavior();this._updateUI()};hui.ui.DateTimeField.create=function(a){var b=hui.build("span",{"class":"hui_field_singleline"});hui.build("input",{"class":"hui_formula_text",parent:b});hui.build("a",{"class":"hui_datetime",href:"javascript://",tabIndex:"-1",html:"<span></span>",parent:b});a.element=hui.ui.wrapInField(b);return new hui.ui.DateTimeField(a)};hui.ui.DateTimeField.prototype={_addBehavior:function(){hui.ui.addFocusClass({element:this.input,classElement:this.element,"class":"hui_field_focused"});hui.listen(this.input,"blur",this._onBlur.bind(this));hui.listen(this.input,"keyup",this._parse.bind(this));hui.listen(this.input,"focus",this._onFocus.bind(this));var b=hui.get.firstByTag(this.element,"a");hui.listen(b,"mousedown",hui.stop);hui.listen(b,"click",this._onClickIcon.bind(this))},_onClickIcon:function(a){hui.stop(a);this.input.focus();this._showPicker()},focus:function(){try{this.input.focus()}catch(a){}},reset:function(){this.setValue("")},setValue:function(a){if(!a){this.value=null}else{if(a.constructor==Date){this.value=a}else{this.value=new Date();this.value.setTime(parseInt(a)*1000)}}this._updateUI()},_parse:function(){var d=this.value?this.value.getTime():0;var e=this.input.value;var a=null;for(var b=0;b<this.inputFormats.length&&a==null;b++){a=Date.parseDate(e,this.inputFormats[b])}if(this.options.allowNull||a!=null){this.value=a}if(this.datePicker){this.datePicker.setValue(this.value)}var c=this.value?this.value.getTime():0;if(d!=c){hui.ui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value)}},_check:function(){this._parse();this._updateUI()},getValue:function(){if(this.value!=null&&this.options.returnType=="seconds"){return Math.round(this.value.getTime()/1000)}return this.value},getElement:function(){return this.element},getLabel:function(){return this.options.label},_updateUI:function(){if(this.value){this.input.value=this.value.dateFormat(this.outputFormat)}else{this.input.value=""}},_onBlur:function(){this._check();if(this.panel){this.panel.hide()}if(this.datePickerPanel){this.datePickerPanel.hide()}},_onFocus:function(){this._showPanel()},_showPanel:function(){if(!this.panel){this.panel=hui.ui.BoundPanel.create({variant:"light"});var a=hui.ui.Buttons.create({align:"center"});a.add(hui.ui.Button.create({text:"Idag",small:true,variant:"light",listener:{$click:this.goToday.bind(this)}}));a.add(hui.ui.Button.create({text:"+ dag",small:true,variant:"light",listener:{$click:function(){this.addDays(1)}.bind(this)}}));a.add(hui.ui.Button.create({text:"+ uge",small:true,variant:"light",listener:{$click:function(){this.addDays(7)}.bind(this)}}));a.add(hui.ui.Button.create({text:"12:00",small:true,variant:"light",listener:{$click:function(){this.setHour(12)}.bind(this)}}));a.add(hui.ui.Button.create({text:"00:00",small:true,variant:"light",listener:{$click:function(){this.setHour(0)}.bind(this)}}));this.panel.add(a)}this.panel.position({element:this.element,position:"vertical"});this.panel.show()},goToday:function(){var a=this._getValueOrNowCopy();var b=new Date();a.setDate(b.getDate());a.setMonth(b.getMonth());a.setFullYear(b.getFullYear());this.setValue(a)},addDays:function(b){var a=this._getValueOrNowCopy();a.setDate(a.getDate()+b);this.setValue(a)},setHour:function(b){var a=this._getValueOrNowCopy();a.setMilliseconds(0);a.setSeconds(0);a.setMinutes(0);a.setHours(b);this.setValue(a)},_getValueOrNowCopy:function(){return this.value==null?new Date():new Date(this.value.getTime())},_showPicker:function(){if(this.panel){this.panel.hide()}if(!this.datePickerPanel){this.datePickerPanel=hui.ui.BoundPanel.create({variant:"light"});this.datePicker=hui.ui.DatePicker.create({value:this.value});this.datePicker.listen({$dateChanged:function(a){this.setValue(a)}.bind(this)});this.datePickerPanel.add(this.datePicker)}this.datePicker.setValue(this.value);this.datePickerPanel.position(this.element);this.datePickerPanel.show()},$$parentMoved:function(){if(this.datePickerPanel&&this.datePickerPanel.isVisible()){this.datePickerPanel.position(this.element);this.datePickerPanel.show()}if(this.panel&&this.panel.isVisible()){this.panel.position({element:this.element,position:"vertical"});this.panel.show()}},$visibilityChanged:function(){if(this.datePickerPanel){this.datePickerPanel.hide()}if(this.panel){this.panel.hide()}}};hui.ui.TokenField=function(a){this.options=hui.override({label:null,key:null},a);this.element=hui.get(a.element);this.name=a.name;this.value=[""];hui.ui.extend(this);this._updateUI()};hui.ui.TokenField.create=function(a){a=a||{};a.element=hui.build("div",{"class":"hui_tokenfield"});return new hui.ui.TokenField(a)};hui.ui.TokenField.prototype={setValue:function(a){this.value=a||[];this.value.push("");this._updateUI()},reset:function(){this.value=[""];this._updateUI()},getValue:function(){var a=[];hui.each(this.value,function(b){b=hui.string.trim(b);if(b.length>0){a.push(b)}});return a},getLabel:function(){return this.options.label},_updateUI:function(){this.element.innerHTML="";hui.each(this.value,function(c,b){var a=hui.build("input",{"class":"hui_tokenfield_token",parent:this.element});if(this.options.width){a.style.width=this.options.width+"px"}a.value=c;hui.listen(a,"keyup",function(){this._inputChanged(a,b)}.bind(this))}.bind(this))},_inputChanged:function(a,b){if(b==this.value.length-1&&a.value!=this.value[b]){this._addField()}this.value[b]=a.value;hui.animate({node:a,css:{width:Math.min(Math.max(a.value.length*7+3,50),150)+"px"},duration:200})},$visibilityChanged:function(){if(hui.dom.isVisible(this.element)){this.$$layout()}},$$layout:function(){var a=hui.get.byTag(this.element,"input");for(var b=0;b<a.length;b++){a[b].style.width=Math.min(Math.max(a[b].value.length*7+3,50),150)+"px"}},_addField:function(){var b=hui.build("input",{"class":"hui_tokenfield_token"});if(this.options.width){b.style.width=this.options.width+"px"}var c=this.value.length;this.value.push("");this.element.appendChild(b);var a=this;hui.listen(b,"keyup",function(){a._inputChanged(b,c)})}};hui.ui.Checkbox=function(a){this.element=hui.get(a.element);this.control=hui.get.firstByTag(this.element,"span");this.options=a;this.name=a.name;this.value=a.value==="true"||a.value===true;hui.ui.extend(this);this.addBehavior()};hui.ui.Checkbox.create=function(b){var a=b.element=hui.build("a",{"class":"hui_checkbox",href:"javascript://",html:"<span><span></span></span>"});if(b.value){hui.cls.add(a,"hui_checkbox_selected")}return new hui.ui.Checkbox(b)};hui.ui.Checkbox.prototype={addBehavior:function(){hui.ui.addFocusClass({element:this.element,"class":"hui_checkbox_focused"});hui.listen(this.element,"click",this.click.bind(this))},click:function(a){hui.stop(a);this.element.focus();this.value=!this.value;this.updateUI();hui.ui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value);hui.ui.firePropertyChange(this,"value",this.value)},updateUI:function(){hui.cls.set(this.element,"hui_checkbox_selected",this.value)},setValue:function(a){this.value=a===true||a==="true";this.updateUI()},getValue:function(){return this.value},reset:function(){this.setValue(false)},getLabel:function(){return this.options.label}};hui.ui.Checkboxes=function(a){this.options=a;this.element=hui.get(a.element);this.name=a.name;this.items=a.items||[];this.subItems=[];this.values=a.values||a.value||[];hui.ui.extend(this);this._addBehavior();this._updateUI();if(a.url){new hui.ui.Source({url:a.url,delegate:this})}};hui.ui.Checkboxes.create=function(a){a.element=hui.build("div",{"class":a.vertical?"hui_checkboxes hui_checkboxes_vertical":"hui_checkboxes"});if(a.items){hui.each(a.items,function(c){var b=hui.build("a",{"class":"hui_checkbox",href:"javascript:void(0);",html:"<span><span></span></span>"+c.title});hui.ui.addFocusClass({element:b,"class":"hui_checkbox_focused"});a.element.appendChild(b)})}return new hui.ui.Checkboxes(a)};hui.ui.Checkboxes.prototype={_addBehavior:function(){var a=hui.get.byClass(this.element,"hui_checkbox");hui.each(a,function(b,c){hui.ui.addFocusClass({element:b,"class":"hui_checkbox_focused"});hui.listen(b,"click",function(d){hui.stop(d);this.flipValue(this.items[c].value)}.bind(this))}.bind(this))},getValue:function(){return this.values},_checkValues:function(){var b=[];for(var c=0;c<this.values.length;c++){var e=this.values[c],d=false,a;for(a=0;a<this.items.length;a++){d=d||this.items[a].value===e}for(a=0;a<this.subItems.length;a++){d=d||this.subItems[a]._hasValue(e)}if(d){b.push(e)}}this.values=b},setValue:function(a){this.values=a;this._checkValues();this._updateUI()},flipValue:function(a){hui.array.flip(this.values,a);this._checkValues();this._updateUI();this.fire("valueChanged",this.values);hui.ui.callAncestors(this,"childValueChanged",this.values)},_updateUI:function(){var b,c,d;for(b=0;b<this.subItems.length;b++){this.subItems[b]._updateUI()}var a=hui.get.byClass(this.element,"hui_checkbox");for(b=0;b<this.items.length;b++){c=this.items[b];d=hui.array.contains(this.values,c.value);hui.cls.set(a[b],"hui_checkbox_selected",d)}},refresh:function(){for(var a=0;a<this.subItems.length;a++){this.subItems[a].refresh()}},reset:function(){this.setValues([])},getLabel:function(){return this.options.label},setValues:function(a){this.setValue(a)},getValues:function(){return this.values},registerItem:function(a){if(parseInt(a.value)==a.value){a.value=parseInt(a.value)}this.items.push(a)},registerItems:function(a){a.parent=this;this.subItems.push(a)},$itemsLoaded:function(a){hui.each(a,function(c){var b=hui.build("a",{"class":"hui_checkbox",href:"javascript:void(0);",html:"<span><span></span></span>"+hui.string.escape(c.title)});hui.listen(b,"click",function(d){hui.stop(d);this.flipValue(c.value)}.bind(this));hui.ui.addFocusClass({element:b,"class":"hui_checkbox_focused"});this.element.appendChild(b);this.items.push(c)}.bind(this));this._checkValues();this._updateUI()}};hui.ui.Checkboxes.Items=function(a){this.element=hui.get(a.element);this.name=a.name;this.parent=null;this.options=a;this.checkboxes=[];hui.ui.extend(this);if(this.options.source){this.options.source.listen(this)}};hui.ui.Checkboxes.Items.prototype={refresh:function(){if(this.options.source){this.options.source.refresh()}},$itemsLoaded:function(b){this.checkboxes=[];this.element.innerHTML="";var a=this;hui.each(b,function(d){var c=hui.build("a",{"class":"hui_checkbox",href:"javascript://",html:"<span><span></span></span>"+d.title});hui.listen(c,"click",function(f){hui.stop(f);c.focus();a._onItemClick(d)});hui.ui.addFocusClass({element:c,"class":"hui_checkbox_focused"});a.element.appendChild(c);a.checkboxes.push({title:d.title,element:c,value:d.value})});this.parent._checkValues();this._updateUI()},_onItemClick:function(a){this.parent.flipValue(a.value)},_updateUI:function(){try{for(var b=0;b<this.checkboxes.length;b++){var c=this.checkboxes[b];var a=hui.array.indexOf(this.parent.values,c.value);hui.cls.set(c.element,"hui_checkbox_selected",a!=-1)}}catch(d){alert(typeof(this.parent.values));alert(d)}},_hasValue:function(b){for(var a=0;a<this.checkboxes.length;a++){if(this.checkboxes[a].value==b){return true}}return false}};hui.ui.Radiobuttons=function(a){this.options=a;this.element=hui.get(a.element);this.name=a.name;this.radios=[];this.value=a.value;this.defaultValue=this.value;this.enabled=true;hui.ui.extend(this)};hui.ui.Radiobuttons.prototype={updateUI:function(){for(var b=0;b<this.radios.length;b++){var a=this.radios[b];hui.cls.set(hui.get(a.id),"hui_radiobutton_selected",a.value==this.value)}},setValue:function(a){this.value=a;this.updateUI()},getValue:function(){if(!this.enabled){return null}return this.value},reset:function(){this.setValue(this.defaultValue)},setEnabled:function(a){this.enabled=a==true;hui.cls.set(this.element,"hui_radiobuttons_disabled",!this.enabled)},registerRadiobutton:function(b){this.radios.push(b);var c=hui.get(b.id);var a=this;c.onclick=function(){if(!a.enabled){return}a.setValue(b.value);a.fire("valueChanged",b.value);hui.ui.callAncestors(a,"childValueChanged",b.value)}}};hui.ui.NumberField=function(b){this.options=hui.override({min:0,max:undefined,value:null,tickSize:1,decimals:0,allowNull:false},b);this.name=b.name;var a=this.element=hui.get(b.element);this.input=hui.get.firstByTag(a,"input");this.up=hui.get.firstByClass(a,"hui_numberfield_up");this.down=hui.get.firstByClass(a,"hui_numberfield_down");if(hui.isString(this.options.value)){this.value=parseInt(this.options.value,10)}else{this.value=this.options.value}if(isNaN(this.value)){this.value=null}hui.ui.extend(this);this._addBehavior()};hui.ui.NumberField.create=function(a){a.element=hui.build("span",{"class":"hui_numberfield",html:'<span><span><input type="text" value="'+(a.value!==undefined?a.value:"0")+'"/><a class="hui_numberfield_up"></a><a class="hui_numberfield_down"></a></span></span>'});return new hui.ui.NumberField(a)};hui.ui.NumberField.prototype={_addBehavior:function(){var a=this.element;hui.listen(this.input,"focus",this._onFocus.bind(this));hui.listen(this.input,"blur",this._onBlur.bind(this));hui.listen(this.input,"keyup",this._onKey.bind(this));hui.listen(this.up,"mousedown",this.upEvent.bind(this));hui.listen(this.down,"mousedown",this.downEvent.bind(this))},_onBlur:function(){hui.cls.remove(this.element,"hui_numberfield_focused");this._updateField();if(this.sliderPanel){this.sliderPanel.hide()}},_onFocus:function(){hui.cls.add(this.element,"hui_numberfield_focused");this._showSlider();this._updateSlider()},_onKey:function(b){b=b||window.event;if(b.keyCode==hui.KEY_UP){hui.stop(b);this.upEvent()}else{if(b.keyCode==hui.KEY_DOWN){this.downEvent()}else{var a=parseFloat(this.input.value,10);if(!isNaN(a)){this._setLocalValue(a,true)}else{this._setLocalValue(null,true)}}}},downEvent:function(a){hui.stop(a);if(this.value===null){this._setLocalValue(this.options.min,true)}else{this._setLocalValue(this.value-this.options.tickSize,true)}this._updateField()},upEvent:function(a){hui.stop(a);this._setLocalValue(this.value+this.options.tickSize,true);this._updateField()},focus:function(){try{this.input.focus()}catch(a){}},getValue:function(){return this.value},getLabel:function(){return this.options.label},setValue:function(a){if(a===null||a===undefined){this._setLocalValue(null,false)}else{a=parseFloat(a,10);if(!isNaN(a)){this._setLocalValue(a,false)}}this._updateField()},_updateField:function(){this.input.value=this.value===null||this.value===undefined?"":this.value},_setLocalValue:function(b,a){var c=this.value;if(b===null||b===undefined&&this.options.allowNull){this.value=null}else{b=this._getValueWithinRange(b);this.value=this._round(b)}if(a&&c!==this.value){this.fireValueChange()}this._updateSlider()},_round:function(b){if(this.options.decimals!==undefined){var a=Math.pow(10,this.options.decimals);b=Math.round(b*a)/a}return b},reset:function(){if(this.options.allowNull){this.value=null}else{this.value=this._getValueWithinRange(0)}this._updateField()},_getValueWithinRange:function(a){if(hui.isDefined(this.options.min)){a=Math.max(a,this.options.min)}if(hui.isDefined(this.options.max)){a=Math.min(a,this.options.max)}return a},_onSliderChange:function(a){var b=this.options.min+(this.options.max-this.options.min)*a;this._setLocalValue(b,true);this._updateField()},_showSlider:function(){if(this.options.min===undefined||this.options.max===undefined){return}if(!this.sliderPanel){this.sliderPanel=hui.ui.BoundPanel.create({variant:"light"});this.slider=hui.ui.Slider.create({width:200});this.slider.element.style.margin="0 3px";this.slider.listen({$valueChanged:this._onSliderChange.bind(this)});this.sliderPanel.add(this.slider)}this.sliderPanel.position({element:this.element,position:"vertical"});this.sliderPanel.show()},_updateSlider:function(){if(this.slider){this.slider.setValue((this.value-this.options.min)/(this.options.max-this.options.min))}},$$parentMoved:function(){if(this.sliderPanel&&this.sliderPanel.isVisible()){this.sliderPanel.position({element:this.element,position:"vertical"});this.sliderPanel.show()}}};hui.ui.TextField=function(a){this.options=hui.override({label:null,key:null,lines:1,maxHeight:100,animateUserChange:true},a);this.element=hui.get(a.element);this.name=a.name;hui.ui.extend(this);this.input=hui.get.firstByClass(this.element,"hui_formula_text");this.multiline=this.input.tagName.toLowerCase()=="textarea";this.placeholder=hui.get.firstByClass(this.element,"hui_field_placeholder");this.value=this.input.value;this.modified=false;this._attach()};hui.ui.TextField.create=function(b){b=hui.override({lines:1},b);var c,a;if(b.lines>1||b.multiline){a=hui.build("textarea",{"class":"hui_formula_text",rows:b.lines,style:"height: 32px;"});c=hui.build("span",{"class":"hui_formula_text_multiline"});c.appendChild(a)}else{a=hui.build("input",{"class":"hui_formula_text"});if(b.secret){a.setAttribute("type","password")}c=hui.build("span",{"class":"hui_field_singleline"});c.appendChild(a)}if(b.value!==undefined){a.value=b.value}b.element=hui.ui.wrapInField(c);return new hui.ui.TextField(b)};hui.ui.TextField.prototype={_attach:function(){if(this.placeholder){var a=this;hui.ui.onReady(function(){window.setTimeout(function(){a.value=a.input.value;a._updateClass()},500)})}hui.ui.addFocusClass({element:this.input,classElement:this.element,"class":"hui_field_focused",widget:this});hui.listen(this.input,"keyup",this._onKeyUp.bind(this));hui.listen(this.input,"keydown",this._onKeyDown.bind(this));var b=this.element.getElementsByTagName("em")[0];if(b){this._updateClass();hui.listen(b,"mousedown",function(){window.setTimeout(function(){this.input.focus();this.input.select()}.bind(this))}.bind(this));hui.listen(b,"mouseup",function(){this.input.focus();this.input.select()}.bind(this))}},_updateClass:function(){hui.cls.set(this.element,"hui_field_dirty",this.value.length>0)},_onKeyDown:function(b){if(!this.multiline&&b.keyCode===hui.KEY_RETURN){hui.stop(b);this.fire("submit");var a=hui.ui.getAncestor(this,"hui_formula");if(a){a.submit()}return}},_onKeyUp:function(a){if(this.input.value==this.value){return}this.value=this.input.value;this._updateClass();this._expand(this.options.animateUserChange);hui.ui.callAncestors(this,"childValueChanged",this.input.value);this.fire("valueChanged",this.input.value);this.modified=true},focus:function(){try{this.input.focus()}catch(a){}},select:function(){try{this.input.focus();this.input.select()}catch(a){}},reset:function(){this.setValue("")},isModified:function(){return this.modified},stress:function(){hui.ui.stress(this)},setValue:function(a){if(a===undefined||a===null){a=""}this.value=a;this.input.value=a;this._expand(this.options.animateValueChange);this.modified=false},getValue:function(){return this.input.value},getLabel:function(){return this.options.label},isEmpty:function(){return this.input.value==""},isBlank:function(){return hui.isBlank(this.input.value)},setError:function(a){var b=a?true:false;hui.cls.set(this.element,"hui_field_error",b);if(typeof(a)=="string"){hui.ui.showToolTip({text:a,element:this.element,key:this.name})}if(!b){hui.ui.hideToolTip({key:this.name})}},$visibilityChanged:function(){if(hui.dom.isVisible(this.element)){window.setTimeout(this._expand.bind(this))}},_expand:function(a){if(!this.multiline||!hui.dom.isVisible(this.element)){return}var b=this._getTextAreaHeight(this.input);b=Math.max(32,b);b=Math.min(b,this.options.maxHeight);if(a){this._updateOverflow();hui.animate(this.input,"height",b+"px",300,{ease:hui.ease.slowFastSlow,$complete:function(){this._updateOverflow()}.bind(this)})}else{this.input.style.height=b+"px";this._updateOverflow()}},_getTextAreaHeight:function(a){var c=this.textAreaDummy;if(!c){c=this.textAreaDummy=document.createElement("div");c.className="hui_textarea_dummy";document.body.appendChild(c)}var b=a.value;if(b[b.length-1]==="\n"){b+="x"}b=hui.string.escape(b).replace(/\n/g,"<br/>");c.innerHTML=b;c.style.width=(a.clientWidth)+"px";return c.clientHeight},_updateOverflow:function(){if(!this.multiline){return}this.input.style.overflowY=this.input.clientHeight>=this.options.maxHeight?"auto":"hidden"}};hui.ui.Rendering=function(a){this.options=hui.override({clickObjects:false},a);this.element=hui.get(a.element);this.name=a.name;hui.ui.extend(this)};hui.ui.Rendering.prototype={_click:function(a){a=hui.event(a)},setContent:function(a){this.element.innerHTML=a}};hui.ui.Icon=function(a){this.options=a;this.name=a.name;this.icon=this.options.icon;this.size=this.options.size;this.element=hui.get(a.element);hui.ui.extend(this);this._addBehavior()};hui.ui.Icon.prototype={_addBehavior:function(){hui.listen(this.element,"click",function(){this.fire("click")}.bind(this))},setSize:function(b){this.size=b;this.element.className="hui_icon_labeled hui_icon_labeled_"+this.size;var a=hui.get.firstByTag(this.element,"span");a.className="hui_icon_"+this.size;a.style.backgroundImage="url("+hui.ui.getIconUrl(this.options.icon,this.size)+")"}};hui.ui.ColorInput=function(a){this.options=hui.override({value:null},a);this.name=a.name;this.element=hui.get(a.element);this.button=hui.get.firstByTag(this.element,"a");this.input=new hui.ui.Input({element:hui.get.firstByTag(this.element,"input"),validator:{validate:function(c){var b=new hui.Color(c);return{valid:true,value:b.toHex()}}}});this.input.listen({$valueChanged:this._onInputChange.bind(this)});this.value=null;hui.ui.extend(this);this.setValue(this.options.value);this._addBehavior()};hui.ui.ColorInput.create=function(a){a=a||{};var b=a.element=hui.build("span",{"class":"hui_colorinput",html:'<span class="hui_field_top"><span><span></span></span></span><span class="hui_field_middle"><span class="hui_field_middle"><span class="hui_field_content"><span class="hui_field_singleline"><input type="text" value=""/></span></span></span></span><span class="hui_field_bottom"><span><span></span></span></span><a tabindex="-1" class="hui_colorinput" href="javascript://"></a>'});return new hui.ui.ColorInput(a)};hui.ui.ColorInput.prototype={_addBehavior:function(){hui.ui.addFocusClass({element:this.input.element,classElement:this.element,"class":"hui_field_focused"});hui.listen(this.button,"click",this._onButtonClick.bind(this))},_syncInput:function(){this.input.setValue(this.value)},_syncColorButton:function(){this.button.innerHTML=this.value?"":"?";this.button.style.backgroundColor=this.value?this.value:""},_onInputChange:function(a){var b=a!=this.value;this.value=a;this._syncColorButton();if(b){this._fireChange()}},_fireChange:function(){hui.ui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value)},_onBlur:function(){hui.Color.parse(this.value)},_onButtonClick:function(){if(hui.window.getViewHeight()<200){this.fire("clickPicker",this.value);return}if(!this.panel){this.panel=hui.ui.BoundPanel.create({modal:true});this.picker=hui.ui.ColorPicker.create();this.picker.listen(this);this.panel.add(this.picker)}this.panel.position(this.button);this.panel.show()},$colorWasSelected:function(a){this.panel.hide();this.setValue(a);this._fireChange()},getValue:function(){return this.value},setValue:function(a){this.value=new hui.Color(a).toHex();this._syncInput();this._syncColorButton()},focus:function(){try{this.input.focus()}catch(a){}},reset:function(){this.setValue("")},destroy:function(){hui.dom.remove(this.element);if(this.panel){this.panel.destroy()}}};hui.ui.Columns=function(a){this.name=a.name;this.options=a||{};this.element=hui.get(a.element);this.body=hui.get.firstByTag(this.element,"tr");hui.ui.extend(this)};hui.ui.Columns.create=function(a){a=a||{};a.flexible=true;a.element=hui.build("table",{"class":"hui_columns",html:"<tbody><tr></tr></tbody>"});return new hui.ui.Columns(a)};hui.ui.Columns.prototype={$$layout:function(){if(this.options.flexible){return}this.element.style.height=hui.position.getRemainingHeight(this.element)+"px";var b=hui.get.children(this.element);var d=0;for(var a=0;a<b.length;a++){var e=b[a];var c=(this.element.clientWidth/b.length);e.style.width=c+"px";e.style.position="absolute";e.style.marginLeft=d+"px";e.style.height=this.element.clientHeight+"px";d+=c}},addToColumn:function(a,b){var d=this._ensureColumn(a);d.appendChild(b.getElement())},setColumnStyle:function(a,b){var d=this._ensureColumn(a);hui.style.set(d,b)},setColumnWidth:function(a,b){var d=this._ensureColumn(a);d.style.width=b+"px"},_ensureColumn:function(a){var c=hui.get.children(this.body);for(var b=c.length-1;b<a;b++){this.body.appendChild(hui.build("td",{"class":"hui_columns_column"}))}return hui.get.children(this.body)[a]}};hui.ui.Finder=function(a){this.options=hui.override({title:"Finder",selection:{},list:{}},a);this.name=a.name;this.uploader=null;hui.ui.extend(this);if(a.listener){this.listen(a.listener)}};hui.ui.Finder.create=function(a){return new hui.ui.Finder(a)};hui.ui.Finder.prototype={show:function(){if(!this.window){this._build()}this.window.show()},hide:function(){if(this.window){this.window.hide()}},clear:function(){this.list.clearSelection()},_build:function(){var a=this.window=hui.ui.Window.create({title:this.options.title,icon:"common/search",width:600,height:400});a.listen({$userClosedWindow:function(){this.fire("cancel")}.bind(this)});if(this.options.url){a.setBusy(true);hui.ui.request({url:this.options.url,$object:function(b){hui.override(this.options,b);if(b.title){a.setTitle(b.title)}a.setBusy(false);this._buildBody()}.bind(this)});return}this._buildBody()},_buildBody:function(){var g=hui.ui.Layout.create();this.window.add(g);var c=hui.ui.Overflow.create({dynamic:true});g.addToLeft(c);var h=this.list=hui.ui.List.create();this.list.listen({$open:function(i){},$select:this._selectionChanged.bind(this)});var b=this.options.search||this.options.gallery;if(b){var j=hui.ui.Bar.create({variant:"layout"});g.addToCenter(j);if(this.options.search){var p=hui.ui.SearchField.create({expandedWidth:200});p.listen({$valueChanged:function(){h.resetState()}});j.addToRight(p)}}var l=hui.ui.Overflow.create({dynamic:true});g.addToCenter(l);l.add(this.list);this.selection=hui.ui.Selection.create({value:this.options.selection.value});this.selection.listen({$select:function(){h.resetState()}});var d=new hui.ui.Source({url:this.options.selection.url});this.selection.addItems({source:d});c.add(this.selection);var m=[];if(this.options.list.url){m=[{key:"windowSize",value:10},{key:"windowPage",value:"@"+h.name+".window.page"},{key:"direction",value:"@"+h.name+".sort.direction"},{key:"sort",value:"@"+h.name+".sort.key"}]}if(this.options.selection.parameter){m.push({key:this.options.selection.parameter||"text",value:"@"+this.selection.name+".value"})}if(this.options.selection.kindParameter){m.push({key:this.options.selection.kindParameter||"text",value:"@"+this.selection.name+".kind"})}if(this.options.search){m.push({key:this.options.search.parameter||"text",value:"@"+p.name+".value"})}if(this.options.list.pageParameter){m.push({key:this.options.list.pageParameter,value:"@"+h.name+".window.page"})}var e=this.options.list.source;if(e){for(var f=0;f<m.length;f++){e.addParameter(m[f])}}if(this.options.list.url){e=new hui.ui.Source({url:this.options.list.url,parameters:m})}this.list.setSource(e);if(this.options.gallery){var a=hui.ui.Segmented.create({value:"gallery",items:[{icon:"view/list",value:"list"},{icon:"view/gallery",value:"gallery"}]});a.listen({$valueChanged:this.changeView.bind(this)});j.add(a);var k=new hui.ui.Source({url:this.options.gallery.url,parameters:m});var o=this.gallery=hui.ui.Gallery.create({source:k});this.list.hide();l.add(o);o.listen({$select:function(i){this.fire("select",o.getFirstSelection())}.bind(this)});k.refresh()}if(this.options.upload&&hui.ui.Upload.HTML5.support().supported){var n=hui.ui.Button.create({text:"Add...",small:true});n.listen({$click:this._showUpload.bind(this)});j.add(n)}d.refresh();hui.ui.reLayout()},changeView:function(a){if(a=="gallery"){this.list.hide();this.gallery.show()}else{this.list.show();this.gallery.hide()}},_selectionChanged:function(){var a=this.list.getFirstSelection();if(a!=null){this.fire("select",a)}},_showUpload:function(c){if(!this.uploadPanel){var b=this.options.upload;var a=this.uploadPanel=hui.ui.BoundPanel.create({padding:5,width:300,modal:true});this.uploader=hui.ui.Upload.create({url:b.url,placeholder:b.placeholder,chooseButton:{en:"Choose file...",da:"Vælg fil..."}});this.uploader.listen({$uploadDidComplete:function(d){this._uploadSuccess(hui.string.fromJSON(d.request.responseText))}.bind(this)});a.add(this.uploader)}this.uploadPanel.show({target:c})},_uploadSuccess:function(a){this.uploadPanel.hide();this.fire("select",a)}};hui.ui.Structure=function(a){this.name=a.name;this.options=a||{};this.element=hui.get(a.element);hui.ui.extend(this)};hui.ui.Structure.prototype={$$layout:function(){var d=hui.get.firstByClass(this.element,"hui_structure_top");var c=hui.get.firstByClass(this.element,"hui_structure_bottom");var a=hui.get.firstByClass(this.element,"hui_structure_middle");if(a){a.style.top=(d?d.clientHeight+2:0)+"px";a.style.bottom=(c?c.clientHeight+2:0)+"px"}}};hui.ui.Slider=function(a){this.options=hui.override({value:0,min:0,max:1},a);this.name=a.name;this.element=hui.get(a.element);this.handler=hui.get.firstByTag(a.element,"a");hui.ui.extend(this);this.position=0;this.value=0;this.setValue(this.options.value);this._addBehavior()};hui.ui.Slider.create=function(a){a=hui.override({},a);var b=a.element=hui.build("span",{"class":"hui_slider",html:'<a href="javascript://"></a><span></span>'});if(a.width){b.style.width=a.width+"px"}return new hui.ui.Slider(a)};hui.ui.Slider.prototype={_addBehavior:function(){hui.drag.register({element:this.handler,onBeforeMove:this._onBeforeMove.bind(this),onMove:this._onMove.bind(this),onAfterMove:this._onAfterMove.bind(this)})},_onBeforeMove:function(a){this.dragging=true;var b=hui.position.get(this.handler);this.dragInfo={left:hui.position.getLeft(this.element),diff:a.getLeft()-b.left,max:this.element.clientWidth-this.handler.clientWidth-5};hui.cls.add(this.element,"hui_slider_active")},_onMove:function(a){var b=a.getLeft()-this.dragInfo.left;b=(b-this.dragInfo.diff);b=Math.max(b,5);b=Math.min(b,this.dragInfo.max);this.handler.style.left=b+"px";this._setPosition((b-5)/(this.dragInfo.max-5))},_onAfterMove:function(){this.dragging=false;hui.cls.remove(this.element,"hui_slider_active");this.fire("valueChangedEnd",this.position)},_setPosition:function(a){this.position=a;this.fire("valueChanged",a)},setValue:function(b){var c=Math.max(0,Math.min(b,1));var a=this.element.clientWidth-10-this.handler.clientWidth;if(!this.dragging){hui.animate({node:this.handler,css:{left:(c*a+5)+"px"},duration:200,ease:hui.ease.fastSlow})}this.position=this.value=c}};hui.ui.CodeInput=function(a){this.options=hui.override({},a);this.name=a.name;var b=this.element=hui.get(a.element);this.textarea=hui.get.firstByTag(b,"textarea");if(a.value){this.textarea.value=a.value}this.value=this.textarea.value;hui.ui.extend(this);this._addBehavior()};hui.ui.CodeInput.create=function(a){a=a||{};a.element=hui.build("div",{className:"hui_codeinput",html:'<textarea spellcheck="false"></textarea>'});if(a.height){hui.get.firstByTag(a.element,"textarea").style.height=hui.style.length(a.height)}return new hui.ui.CodeInput(a)};hui.ui.CodeInput.prototype={_addBehavior:function(){hui.listen(this.textarea,"keydown",this._onKeyDown.bind(this));hui.listen(this.textarea,"keyup",this._onKeyUp.bind(this))},getValue:function(){return this.textarea.value},setValue:function(a){this.textarea.value=a;this.value=a},addLine:function(a){if(this.value===""){this.setValue(a)}else{this.setValue(this.value+"\n"+a)}},reset:function(){this.setValue("")},_onKeyUp:function(){if(this.textarea.value!==this.value){this.value=this.textarea.value;this.fireValueChange()}},_onKeyDown:function(m){var d=String.fromCharCode(9);var y=window.event||m;var j=y.target?y.target:y.srcElement?y.srcElement:y.which;var c=j.scrollTop;var v=y.keyCode?y.keyCode:y.charCode?y.charCode:y.which;if(v==9&&!y.ctrlKey&&!y.altKey){if(j.setSelectionRange){y.preventDefault();var s=j.selectionStart;var B=j.selectionEnd;if(s!=B&&j.value.slice(s,B).indexOf("\n")!=-1){if(s>0){s=j.value.slice(0,s).lastIndexOf("\n")+1}var q=j.value.slice(0,s);var u=j.value.slice(s,B);var w=j.value.slice(B,j.value.length);if(y.shiftKey){var A=u.split("\n");for(var x=0;x<A.length;x++){if(A[x].slice(0,1)==d||A[x].slice(0,1)==" "){A[x]=A[x].slice(1,A[x].length)}}u=A.join("\n");j.value=q.concat(u,w);j.selectionStart=s;j.selectionEnd=q.length+u.length}else{u=u.replace(/\n/g,"\n"+d);q=q.concat(d);j.value=q.concat(u,w);j.selectionStart=s;j.selectionEnd=B+(d.length*u.split("\n").length)}}else{if(y.shiftKey){var l=j.value.slice(0,s);var h=l.slice(l.length-1,l.length);if(h==d||h==" "){j.value=l.slice(0,l.length-1).concat(j.value.slice(s,j.value.length));j.selectionStart=s-1;j.selectionEnd=B-1}}else{j.value=j.value.slice(0,s).concat(d).concat(j.value.slice(s,j.value.length));if(s==B){j.selectionStart=j.selectionEnd=s+d.length}else{j.selectionStart=s+d.length;j.selectionEnd=B+d.length}}}}else{y.returnValue=false;var n=document.selection.createRange();var z=document.body.createTextRange();z.moveToElementText(j);z.setEndPoint("EndToStart",n);if(n.text.length==0||n.text.indexOf("\n")==-1){if(y.shiftKey){var h=z.text.slice(z.text.length-1,z.text.length);if(h==d||h==" "){z.text=z.text.slice(0,z.text.length-1);n.setEndPoint("StartToEnd",z)}}else{var f=j.value.slice(z.text.length,z.text.length+1);if(f!=n.text.slice(0,1)){z.text=z.text.concat(f)}z.text=z.text.concat(d)}var b=document.body.createTextRange();b.setEndPoint("StartToEnd",z);b.setEndPoint("EndToEnd",n);b.select()}else{if(y.shiftKey){var A=n.text.split("\r\n");var g=j.value.slice(z.text.length,z.text.length+2);if(g==n.text.slice(0,2)){var o=z.text.lastIndexOf("\r\n".concat(d));if(o!=-1){z.text=z.text.slice(0,o+2).concat(z.text.slice(o+3,z.text.length))}}for(var x=0;x<A.length;x++){var h=A[x].length>0&&A[x].slice(0,1);if(h==d||h==" "){A[x]=A[x].slice(1,A[x].length)}}n.text=A.join("\r\n")}else{if(z.text.length>0){var g=j.value.slice(z.text.length,z.text.length+2);if(g!=n.text.slice(0,2)){n.text=d.concat(n.text.split("\r\n").join("\r\n".concat(d)))}else{var o=z.text.slice(0,s).lastIndexOf("\r\n")+2;z.text=z.text.slice(0,o).concat(d,z.text.slice(o,z.text.length));n.text=n.text.split("\r\n").join("\r\n".concat(d))}}else{n.text=d.concat(n.text).split("\r\n").join("\r\n".concat(d))}}var b=document.body.createTextRange();b.setEndPoint("StartToEnd",z);b.setEndPoint("EndToEnd",n);b.select()}}}j.scrollTop=c}};hui.ui.LinkInput=function(a){var b=this.element=hui.get(a.element);this.options=hui.override({types:[]},a);this.types=this.options.types;this.name=a.name;this.value=a.value;this.input=new hui.ui.Input({element:hui.get.firstByTag(b,"input")});this.input.listen({$valueChanged:this._onInputChange.bind(this)});this.object=hui.get.firstByClass(b,"hui_linkinput_object");this.dropdown=new hui.ui.DropDown({element:hui.get.firstByClass(b,"hui_dropdown"),value:"none",items:this._buildDropDownOptions(),listener:{$valueChanged:this._onDropDownChange.bind(this)}});hui.ui.extend(this);this._addBehavior()};hui.ui.LinkInput.prototype={_addBehavior:function(){},_buildDropDownOptions:function(){var a=[{value:"none",text:"Intet link"}];for(var b=0;b<this.options.types.length;b++){var c=this.options.types[b];a.push({value:c.key,text:c.label})}return a},_getType:function(b){for(var a=0;a<this.types.length;a++){if(this.types[a].key==b){return this.types[a]}}},_onInputChange:function(a){this.value={type:this.dropdown.getValue(),value:a};this._updateUI();this.fireValueChange()},_onDropDownChange:function(b){this._closeAllFinders();var a=this._getType(b);if(!a){this.input.element.style.display=this.object.style.display="none";return}this.input.element.style.display=!a.finderOptions?"":"none";this.object.style.display=a.finderOptions?"":"none";if(a.finderOptions){if(!a._finder){a._finder=hui.ui.Finder.create(a.finderOptions);a._finder.listen({$select:function(c){this._selectObject(a,c)}.bind(this)})}a._finder.show();this.value={type:b,value:null}}else{this.input.focus();this.input.setValue("");this.value={type:b,value:""}}this._updateUI();this.fireValueChange()},_closeAllFinders:function(){for(var a=0;a<this.types.length;a++){if(this.types[a]._finder){this.types[a]._finder.hide()}}},_selectObject:function(b,a){this.value={type:b.key,value:a};this._updateUI();this._closeAllFinders();this.fireValueChange()},_updateUI:function(){var c=this.value;if(!hui.isDefined(c)){this.dropdown.setValue("none");this.input.element.style.display=this.object.style.display="none"}else{var b=this._getType(c.type);if(b){this.dropdown.setValue(c.type);this.input.element.style.display=!b.finderOptions?"":"none";this.object.style.display=b.finderOptions?"":"none";if(!b.finderOptions){this.input.value=c.value}else{var d=hui.get.firstByClass(this.element,"hui_linkinput_title"),a=hui.get.firstByClass(this.element,"hui_linkinput_icon");if(!c.value){this.object.style.display="none"}else{this.object.style.display="";if(hui.isDefined(c.value.title)){hui.dom.setText(d,hui.string.shorten(c.value.title,40))}else{this._setBusy(true);hui.ui.request({url:b.lookupUrl,parameters:{id:c.value.id},$object:function(e){hui.dom.setText(d,hui.string.shorten(e.title,40));this._setBusy(false)}.bind(this),$failure:function(){hui.dom.setText(d,"!!Error");this._setBusy(false)}.bind(this)})}a.style.backgroundImage="url('"+hui.ui.getIconUrl(b.icon,16)+"')"}}}}},_setBusy:function(a){this.busy=a;hui.cls.set(this.element,"hui_linkinput_busy",a)},getValue:function(){return this.value},setValue:function(a){this.value=a;this._updateUI()},reset:function(){this.setValue(null)}};hui.ui.FontInput=function(a){this.options=hui.override({value:null},a);this.name=a.name;this.element=hui.get(a.element);this.button=hui.get.firstByClass(this.element,"hui_fontinput");this.dropdown=new hui.ui.DropDown({element:hui.get.firstByClass(this.element,"hui_dropdown"),items:[{text:"",value:""}].concat(hui.ui.FontPicker.fonts),listener:this});this.value=null;hui.ui.extend(this);this.setValue(this.options.value);this._addBehavior()};hui.ui.FontInput.create=function(a){a=a||{};var b=a.element=hui.build("span",{"class":"hui_colorinput",html:'<span class="hui_field_top"><span><span></span></span></span><span class="hui_field_middle"><span class="hui_field_middle"><span class="hui_field_content"><span class="hui_field_singleline"><input type="text" value=""/></span></span></span></span><span class="hui_field_bottom"><span><span></span></span></span><a tabindex="-1" class="hui_colorinput" href="javascript://"></a>'});return new hui.ui.ColorInput(a)};hui.ui.FontInput.prototype={_addBehavior:function(){hui.listen(this.button,"click",this._onButtonClick.bind(this))},_syncInput:function(){this.dropdown.setValue(this.value)},_fireChange:function(){hui.ui.callAncestors(this,"childValueChanged",this.value);this.fire("valueChanged",this.value)},_onBlur:function(){hui.Color.parse(this.value)},_onButtonClick:function(){if(hui.window.getViewHeight()<200){this.fire("clickPicker",this.value);return}if(!this.panel){this.panel=hui.ui.BoundPanel.create({modal:true,variant:"light"});this.picker=hui.ui.FontPicker.create();this.picker.listen(this);this.panel.add(this.picker)}this.panel.position(this.button);this.panel.show()},$select:function(a){this.panel.hide();this.setValue(a.value);this._fireChange()},$valueChanged:function(a){this.setValue(a);this._fireChange()},getValue:function(){return this.value},setValue:function(a){this.value=a;this._syncInput();this.button.style.fontFamily=a},focus:function(){try{this.input.focus()}catch(a){}},reset:function(){this.setValue("")},destroy:function(){hui.dom.remove(this.element);if(this.panel){this.panel.destroy();this.picker.destroy()}}};hui.ui.FontPicker=function(a){this.name=a.name;this.element=hui.get(a.element);this.fonts=a.fonts.concat(a.additionalFonts);this.previews={};this.options=a||{};hui.override(this.options,a);hui.ui.extend(this);if(this.options.listener){this.listen(this.options.listener)}this._addBehavior()};hui.ui.FontPicker.fonts=[{text:"Verdana",value:"Verdana,sans-serif"},{text:"Tahoma",value:"Tahoma,Geneva,sans-serif"},{text:"Trebuchet",value:"Trebuchet MS,Helvetica,sans-serif"},{text:"Geneva",value:"Geneva,Tahoma,sans-serif"},{text:"Helvetica",value:"Helvetica,Arial,sans-serif"},{text:"Helvetica Neue",value:"Helvetica Neue,Helvetica,Arial,sans-serif"},{text:"Arial",value:"Arial,Helvetica,sans-serif"},{text:"Arial Black",value:"Arial Black,Gadget,Arial,sans-serif"},{text:"Impact",value:"Impact,Charcoal,Arial Black,Gadget,Arial,sans-serif"},{text:"Times New Roman",value:"Times New Roman,Times,serif"},{text:"Times",value:"Times,Times New Roman,serif"},{text:"Book Antiqua",value:"Book Antiqua,Palatino,serif"},{text:"Palatino",value:"Palatino,Book Antiqua,serif"},{text:"Georgia",value:"Georgia,Book Antiqua,Palatino,serif"},{text:"Garamond",value:"Garamond,Times New Roman,Times,serif"},{text:"Comic Sans",value:"Comic Sans MS,cursive"},{text:"Courier New",value:"Courier New,Courier,monospace"},{text:"Courier",value:"Courier,Courier New,monospace"},{text:"Lucida Console",value:"Lucida Console,Monaco,monospace"},{text:"Monaco",value:"Monaco,Lucida Console,monospace"}];hui.ui.FontPicker.create=function(b){b=hui.override({fonts:hui.ui.FontPicker.fonts,additionalFonts:[]},b);var g=b.fonts.concat(b.additionalFonts);var d=b.element=hui.build("div",{"class":"hui_fontpicker"});for(var c=0;c<g.length;c++){var a=g[c];var f=hui.build("div",{parent:d,"class":"hui_fontpicker_item",text:a.text,style:"font-family:"+a.value+";"});var e=hui.ui.createIcon("monochrome/info",16,"a");f.appendChild(e);f.huiIndex=c}return new hui.ui.FontPicker(b)};hui.ui.FontPicker.prototype={_addBehavior:function(){hui.listen(this.element,"click",this._onClick.bind(this))},_onClick:function(f){f=hui.event(f);var d=f.findByClass("hui_fontpicker_item");if(d){var b=f.findByClass("hui_icon");var c=this.fonts[d.huiIndex];if(b){this._buildPreview(c)}else{this.fire("select",c)}}},$visibilityChanged:function(){if(!hui.dom.isVisible(this.element)){hui.each(this.previews,function(a,b){b.hide()})}},_buildPreview:function(a){if(this.previews[a.text]){this.previews[a.text].show();return}var k=hui.build("div",{className:"hui_fontpicker_example",style:"font-family:"+a.value+";"});var f=[100,200,300,"normal",500,600,"bold","bolder"];var g=["9pt","10pt","11pt","12pt","13pt","14pt","16px","18pt"];var d="<h1>"+a.text+"</h1>";d+='<p style="font-size: 12px;">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>';d+="<table>";d+="<thead><tr><th></th>";for(var c=0;c<f.length;c++){d+="<th>"+f[c]+"</th>"}d+="</tr></thead>";d+="<tbody>";for(var c=0;c<g.length;c++){d+="<tr><th>"+g[c]+"</th>";for(var b=0;b<f.length;b++){d+='<td style="font-weight: '+f[b]+"; font-size:"+g[c]+';">Pack my box with five dozen liquor jugs</td>'}}d+="</tbody>";k.innerHTML=d;var h=hui.ui.Window.create({title:a.text,padding:3});h.add(k);this.previews[a.text]=h;h.show()},destroy:function(){hui.each(this.previews,function(a,b){b.destroy()});hui.dom.remove(this.element)}};hui.ui.Split=function(a){this.options=hui.override({},a);this.name=a.name;this.element=hui.get(a.element);this.rows=hui.get.children(this.element);this.handles=[];this.sizes=[];for(var b=0;b<this.rows.length;b++){if(b>0){this.handles.push(hui.build("div",{"class":"hui_split_handle",parent:this.element}))}}this._buildSizes();hui.ui.extend(this);this._attach()};hui.ui.Split.prototype={_attach:function(){hui.each(this.handles,function(a){hui.drag.register({element:a,onBeforeMove:function(b){hui.log("before")},onMove:function(b){hui.log("moving")}})})},_buildSizes:function(){this.sizes=[];for(var b=0;b<this.rows.length;b++){var f=this.rows[b],e=f.getAttribute("data-height");if(e){this.sizes.push(this._getSize(e))}else{this.sizes.push(0)}}var d=0,a=0;for(var b=0;b<this.sizes.length;b++){d+=this.sizes[b];a+=this.sizes[b]==0?1:0}var c=(1-d)/a;for(var b=0;b<this.sizes.length;b++){if(this.sizes[b]==0){this.sizes[b]=c}}},_getSize:function(a){if(a.indexOf("%")!=-1){return parseInt(a)/100}return parseInt(a)/this.element.clientHeight},$$layout:function(){this._layout()},_getSiblingHeight:function(d){var a=d.parentNode.clientHeight;var f=d.parentNode.childNodes;for(var c=0;c<f.length;c++){var b=f[c];if(b!==d&&hui.dom.isElement(f[c])){if(hui.style.get(b,"position")!="absolute"){a-=b.offsetHeight}}}return a},_layout:function(){var d=0,c=hui.position.getRemainingHeight(this.element);for(var b=0;b<this.rows.length;b++){this.rows[b].style.top=(d*c)+"px";var a=(this.sizes[b]*c);if(b<this.rows.length-1){a-=6}this.rows[b].style.height=a+"px";d+=this.sizes[b];if(b<this.rows.length-1){this.handles[b].style.top=(d*c)+"px"}}}};hui.ui.NumberValidator=function(a){hui.override({allowNull:false,min:0,max:10},a);this.min=a.min;this.max=a.max;this.allowNull=a.allowNull;this.middle=Math.max(Math.min(this.max,0),this.min)};hui.ui.NumberValidator.prototype={validate:function(b){if(hui.isBlank(b)&&this.allowNull){return{valid:true,value:null}}var a=parseFloat(b);if(isNaN(a)){return{valid:false,value:this.middle}}else{if(a<this.min){return{valid:false,value:this.min}}else{if(a>this.max){return{valid:false,value:this.max}}}}return{valid:true,value:a}}};hui.ui.ObjectInput=function(a){this.options=hui.override({value:null},a);this.name=a.name;this.element=hui.get(a.element);this.text=hui.get.firstByClass(this.element,"hui_objectinput_text");this.choose=null;this.remove=null;hui.ui.extend(this);this._attach()};hui.ui.ObjectInput.create=function(a){a=a||{};a.element=hui.build("span",{"class":"hui_object",html:"TODO"});return new hui.ui.ObjectInput(a)};hui.ui.ObjectInput.prototype={_attach:function(){this.choose=new hui.ui.Button({element:hui.get.firstByClass(this.element,"hui_objectinput_choose")});this.choose.listen({$click:this._choose.bind(this)});this.remove=new hui.ui.Button({element:hui.get.firstByClass(this.element,"hui_objectinput_remove")});this.remove.listen({$click:this._remove.bind(this)})},_choose:function(){if(!this.finder){this.finder=hui.ui.Finder.create(this.options.finder);this.finder.listen({$select:this._found.bind(this)})}this.finder.show()},_remove:function(){this.setValue(null)},_found:function(a){this.finder.hide();this.setValue(a);this.fireValueChange()},_render:function(){var a=this.value?this.value.title:"No value";hui.dom.setText(this.text,a)},setValue:function(a){this.value=a;this._render()}};