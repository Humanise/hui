<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:o="http://www.onlineobjects.com/jsf" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:gui="http://www.in2isoft.dk/in2igui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
>
	<ui:composition template="templates/photo.xhtml">
		
		<ui:define name="title">#{photosPhotoView.image.name} - </ui:define>
		
		<ui:define name="body">
			<c:if test="#{not empty photosPhotoView.image}">
      <span class="js-data"
        data-editable="#{photosPhotoView.canModify}"
        data-id="#{photosPhotoView.image.id}"
        data-username="#{photosPhotoView.user.username}"
      ></span>
				<o:script>
				</o:script>
			</c:if>

      <o:dependency src="/WEB-INF/apps/photos/web/style/css/photos_photo.css"/>
      <o:dependency src="/WEB-INF/apps/photos/web/style/css/photos_sidebar.css"/>
      <o:dependency src="/WEB-INF/apps/photos/web/style/css/photos_controller.css"/>
      <o:dependency src="/WEB-INF/apps/photos/web/style/css/photos_profile.css"/>

      <o:dependency src="/WEB-INF/core/web/js/oo_inlineeditor.js"/>
      <o:dependency src="/WEB-INF/apps/photos/web/style/js/photo_view.js"/>
      
			<c:if test="#{empty photosPhotoView.image}">
				<h1 class="photos_photo_not_found">#{msg.image_not_found}</h1>
			</c:if>
			<c:if test="#{not empty photosPhotoView.image}">
				
				<div class="photos_photo_image">
					<c:if test="#{photosPhotoView.vertical}">
						<o:thumbnail image="#{photosPhotoView.image}" height="500" present="true" frame="false"/>
					</c:if>
					<c:if test="#{not photosPhotoView.vertical}">
						<o:thumbnail image="#{photosPhotoView.image}" className="photos_photo_image_vertical" width="980" present="true" frame="false" responsive="true"/>
					</c:if>
					<div class="photos_controls">
					<div class="photos_controller">
						<o:link href="/service/image/id#{photosPhotoView.image.id}.jpg?download=true" core="true" plain="true"><i>d</i></o:link>
						<o:link href="/service/image/id#{photosPhotoView.image.id}.jpg" core="true" plain="true"><i>x</i></o:link>
					</div>
					<div class="photos_controller photos_controller_direction">
						<o:link href="/#{wordsLayoutView.language}/photo/#{photosPhotoView.previousId}.html" plain="true"><i>&lt;</i></o:link>
						<o:link href="/#{wordsLayoutView.language}/photo/#{photosPhotoView.nextId}.html" plain="true"><i>&gt;</i></o:link>
					</div>
					</div>
				</div>
				
				<div class="photos_photo">
					<div class="photos_photo_left">
						<div class="photos_photo_left_body">
							<div class="photos_photo_info">
								<h1 id="editableTitle">#{photosPhotoView.title}</h1>
								<o:words words="#{photosPhotoView.words}" editable="#{photosPhotoView.canModify}" name="words"/>
								<div id="photos_photo_description">
									<c:if test="#{not photosPhotoView.canModify and not empty photosPhotoView.description}">
										<p class="photos_photo_description" style="margin-top: 10px;">
											<span class="photos_photo_description_start">&#8220;</span><o:out value="#{photosPhotoView.description}" escape="false"/><span class="photos_photo_description_end">&#8221;</span>
										</p>
									</c:if>
									<c:if test="#{photosPhotoView.canModify}">
										<div style="margin-top: 10px;">
										<gui:pages name="descriptionPages">
											<gui:page>
												<c:if test="#{not empty photosPhotoView.description}">
													<p class="photos_photo_description">
														<span class="photos_photo_description_start">&#8220;</span><o:out value="#{photosPhotoView.description}" escape="false"/><span class="photos_photo_description_end">&#8221;</span>
													</p>
												</c:if>
												<div style="padding: 0 0px 10px;">
													<gui:button variant="light" text="#{msg.edit_description}" small="true" name="addDescription"/>
												</div>
											</gui:page>
											<gui:page>
												<div style="padding: 0 0px 10px;">
												<gui:textInput name="description" multiline="true" value="#{photosPhotoView.description}"/>
												<div style="padding: 5px 0 0;">
												<gui:buttons>
													<gui:button text="#{msg.save}" variant="light" name="saveDescription" small="true"/>
													<gui:button text="#{msg.cancel}" variant="light" name="cancelDescription" small="true"/>
												</gui:buttons>
												</div>
												</div>
											</gui:page>
										</gui:pages>
										</div>
									</c:if>
								</div>
							</div>
							<o:map name="theMap" location="#{photosPhotoView.mapPoint}" dynamic="false" editable="#{photosPhotoView.canModify}"/>
						</div>
					</div>
					
					
					<div class="photos_photo_right">
						<div class="photos_photo_right_body">
						<div class="photos_profile">
							<div class="photos_profile_photo">
								<o:thumbnail image="#{photosPhotoView.personImage}" width="80" height="90" zoom="true" frame="false"/>
							</div>
							<div class="photos_profile_body">
								<p class="photos_profile_name">#{photosPhotoView.fullPersonName}</p>
								<p class="photos_profile_username">
									<o:icon icon="user" size="12"/>
									<strong>#{photosPhotoView.user.username}</strong>
								</p>
								<p class="photos_profile_link"><o:link app="photos" href="/users/#{photosPhotoView.user.username}/">#{msg.all_photos} »</o:link></p>
								<p class="photos_profile_link"><o:link app="people" href="/#{photosPhotoView.user.username}/">#{msg.profile} »</o:link></p>
							</div>
						</div>
						<c:if test="#{not empty photosPhotoView.galleries}">
							<div class="photos_photo_galleries">
								<h2>#{msg.albums}</h2>
								<ul id="galleries">
									<c:forEach items="#{photosPhotoView.galleries}" var="gallery">
										<li>
											<o:link href="/gallery/#{gallery.id}/" app="photos" plain="true">
												<o:icon icon="album"/>
												<o:out value="#{gallery.name}"/>
											</o:link>
										</li>
									</c:forEach>
								</ul>
							</div>
						</c:if>
						
						
						<div class="photos_photo_properties">
							<o:block id="properties">
								<c:forEach items="#{photosPhotoView.properties}" var="prop">
									<p class="photos_photo_property"><strong>#{prop.label}:</strong> #{prop.value}</p>
								</c:forEach>
							</o:block>
							<c:if test="#{photosPhotoView.canModify}">
							<o:link name="viewMetaData">Meta data</o:link>
								<div style="background: #f6f6f6; border: 1px solid #eee; border-width: 1px 0; margin: 30px -20px 0; padding: 5px 20px 7px;">
									<h2 style="font-weight: 200; font-size: 12pt; line-height: 24px; border-bottom: 1px solid #ddd; color: #666; margin: 0 0 8px;">Anyone can...</h2>
									<p style="margin: 5px 0;">
										<gui:checkbox label="See the photo" name="publicAccess" value="#{not photosPhotoView.secret}"/>
									</p>
									<h2 style="font-weight: 200; font-size: 12pt; line-height: 24px; border-bottom: 1px solid #ddd; color: #666; margin: 10px 0 8px;">Actions</h2>
									<p style="margin: 0;">
										<gui:button text="Delete" name="deletePhoto" small="true" variant="light" right="4"/>								
										<gui:button text="Synchronize" name="syncMetaData" small="true" variant="light" right="4"/>
									</p>
								</div>
							</c:if>
						</div>
						</div>
					</div>

				</div>
				
				<c:if test="#{photosPhotoView.canModify}">
				
					<gui:boundPanel name="locationPanel" modal="true" >
						<gui:formula name="locationForm">
							<gui:locationInput key="location"/>
						</gui:formula>
						<div style="margin-top: 3px;">
							<gui:button text="Save" name="saveLocation" small="true"/>
						</div>
					</gui:boundPanel>
				
					<ui:include src="../shared/wordfinder.xhtml"/>
				</c:if>
			</c:if>
		</ui:define>
		
		<ui:define name="sidebar">
		</ui:define>
		
	</ui:composition>
</html>